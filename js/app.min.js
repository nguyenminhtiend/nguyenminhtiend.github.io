!function(){"use strict";function e(e,t){t.isLocal||e.debugInfoEnabled(!1)}function t(e){e.interceptors.push("httpInterceptor")}function n(e){e.when("/",{redirectTo:"/dashboard"}).otherwise({redirectTo:"/"})}function o(e,t,n,o,r){var i=o.getCurrentUser();if(i)e.currentUser=i,e.indexRoute="#"+r[e.currentUser.role].defaultRoute;else{var a=n.path(),s=t.routes[a];s&&s.authorize&&n.path("/login")}e.$on("$locationChangeStart",function(e,r,i){var a=n.path();a.indexOf("milkruns")>-1&&(a+="/:view?");var s=t.routes[a];if(s&&s.authorize){if(!o.isAuthenticated())return void n.path("/login");var l=o.getToken();if(!l)return o.logout(),void n.path("/login");var c=o.getCurrentUser();(!o.isAuthorized(s.authorize)||s.preventViewOnly&&c.viewOnly)&&(o.logout(),n.path("/accessDeny"))}}),e.$on("$routeChangeSuccess",function(){t.current&&(e.hideHeader=t.current.hideHeader,e.hideFooter=t.current.hideFooter,e.alignFooter=t.current.alignFooter||"center",e.stickyFooter=t.current.stickyFooter,e.hideNavbar=t.current.hideNavbar,e.showHeaderDashboardControls=t.current.showHeaderDashboardControls,e.noContainer=t.current.noContainer,e.darkBg=t.current.darkBg,e.category=t.current.category,e.headerSelectedJob="0"),t.current.title?document.title="Sitadel eCMS - "+t.current.title:document.title="Sitadel eCMS"})}angular.module("main.module",["constants.module","ngRoute","ngAnimate","ui.bootstrap","LocalStorageModule","ui.bootstrap.datetimepicker","toastr","ngTouch","ngSanitize","angularjs-dropdown-multiselect","hljs","ngFileUpload","ngScrollbar","customer.module","spAdminUser.module","adminUser.module","account.module","milkRun.module","log.module","report.module","allLocations.module","dashboard.module","profile.module","ui.odometer","adhoc.module","milkrunTask.module","adhocTask.module","vendorAdhoc.module","vendorMilkrun.module","vendorManagement.module","driver.module","accessDeny.module"]).config(e).config(t).config(n).run(o),e.$inject=["$compileProvider","systemSetting"],t.$inject=["$httpProvider"],n.$inject=["$routeProvider"],o.$inject=["$rootScope","$route","$location","authService","systemRolesConfigs"]}(),function(){"use strict";var e={};window&&_.assign(e,window.env);var t={ADHOC_TRANSACTIONS:"AdhocTransactions",MILKRUN_TRANSACTIONS:"MilkrunTransactions",USERS:"Users",CLIENTS:"Customers",JOBTYPES:"Jobtypes",REPORTS:"Reports",LOGS:"Logs",DASHBOARD:"Dashboard",ALL_LOCATIONS:"AllLocations",VENDORS:"VendorManagement",DRIVERS:"Drivers",ADHOC_VENDOR:"AdhocVendor",MILKRUN_VENDOR:"MilkrunVendor"};angular.module("constants.module",[]).constant("systemSetting",{serviceUrl:e.apiUrl,simpleDateFormat:"yyyy-MM-dd",isLocal:["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.hostname)>-1}).constant("userConfig",e).constant("defaultTimezone",e.defaultTimeZone).constant("maxNumberOfRecord",2147483647).constant("systemRole",{SuperAdmin:"SuperAdmin",Admin:"Admin",User:"User",Vendor:"Vendor",Driver:"Driver"}).constant("systemRolesConfigs",{SuperAdmin:{navigationItems:[t.ADHOC_TRANSACTIONS,t.MILKRUN_TRANSACTIONS,t.USERS,t.CLIENTS,t.REPORTS,t.LOGS,t.ALL_LOCATIONS,t.VENDORS,t.DRIVERS],defaultRoute:"users"},Admin:{navigationItems:[t.ADHOC_TRANSACTIONS,t.MILKRUN_TRANSACTIONS,t.USERS,t.CLIENTS,t.REPORTS,t.LOGS,t.DASHBOARD,t.VENDORS,t.DRIVERS],defaultRoute:"dashboard",cmsRoute:"adhocs/transactions",viewOnly:!0,preventPage:[]},User:{navigationItems:[t.ADHOC_TRANSACTIONS,t.MILKRUN_TRANSACTIONS,t.USERS,t.DASHBOARD],defaultRoute:"dashboard",cmsRoute:"adhocs/transactions"},Vendor:{navigationItems:[t.ADHOC_VENDOR,t.MILKRUN_VENDOR,t.DRIVERS],defaultRoute:"vendor/adhocs"}}).constant("setItemPerPage",[{value:10,text:"10 entities"},{value:20,text:"20 entities"},{value:50,text:"50 entities"},{value:100,text:"100 entities"}]).constant("pageName",t).constant("departments",{PSS:{id:1,name:"PSS"},Healthcare:{id:2,name:"Healthcare"}}).constant("pricingType",{Adhoc:1,AdhocExpres:2,MilkRun:3}).constant("weightCategory",{ThreeKg:0,FourKg:1,FiveKg:2,TenKg:3,TwentyKg:4,Extra:5}).constant("milkRunTypes",{none:0,oneToOne:1,oneToMany:2,manyToOne:3}).constant("adhocTypes",{none:0,oneToOne:1,oneToMany:2,manyToOne:3,roundTrip:4}).constant("milkRunFrequency",{daily:{value:0,display:"Daily"},twiceADay:{value:1,display:"Twice a day"},weekly:{value:2,display:"Weekly"},projectRun:{value:3,display:"Project run"},threeTimesADay:{value:4,display:"3 times a day"},fourTimesADay:{value:5,display:"4 times a day"}}).constant("days",{monday:{text:"M",value:1,display:"Monday"},tuesday:{text:"T",value:2,display:"Tuesday"},wednesday:{text:"W",value:3,display:"Wednesday"},thursday:{text:"T",value:4,display:"Thursday"},friday:{text:"F",value:5,display:"Friday"}}).constant("milkRunAdditionals",{saturdays:{value:6,display:"Saturdays"},sundays:{value:0,display:"Sundays"},afterOfficeHours:{value:2,display:"After Office Hours"},publicHolidays:{value:3,display:"Public Holidays"}}).constant("milkRunWeight",{upTo5kg:{id:7,text:"Up to 5kg",textImport:"<5"},from5To10kg:{id:8,text:"5 - 10kg",textImport:"5to10"},from10To30kg:{id:9,text:"10 - 30kg",textImport:"10to30"},from30To60kg:{id:10,text:"30 - 60kg",textImport:"30to60"},from60To100kg:{id:11,text:"60 - 100kg",textImport:"60to100"}}).constant("milkRunProgress",{chosenMilkRunType:1,collectionPoint:2,deliveryPoint:3,remark:4,confirmOrder:5}).constant("jobStatusType",{pendingApproval:{value:1,display:"Pending Acceptance"},rejected:{value:2,display:"Rejected"},accepted:{value:3,display:"Accepted"},ongoing:{value:4,display:"On going"},completed:{value:5,display:"Delivered"},deactivated:{value:6,display:"Deactivated"}}).constant("deliveryPointCategory",{one:{value:1,display:"A to 1 point"},two:{value:2,display:"A to 2 point"},five:{value:3,display:"A to 5 point"},ten:{value:4,display:"A to 10 point"},twenty:{value:5,display:"A to 20 point"},fifty:{value:6,display:"A to 50 point"},oneHundred:{value:7,display:"A to 100 point"},fourHundred:{value:8,display:"A to 400 point"}}).constant("adhocWeightCategory",{adhocUptoThreeKg:{value:1,display:"Up to 3kg"},adhocThreeToFourKg:{value:2,display:">3 - 4kg"},adhocFourToFiveKg:{value:3,display:">4 - 5kg"},adhocFiveToTenKg:{value:4,display:">5 - 10kg"},adhocTenToTwentyKg:{value:5,display:">10 - 20kg"},adhocAboveTwenty:{value:6,display:">20kg"}}).constant("milkRunWeightCategory",{milkrunUptoFiveKg:{value:7,display:"Up to 5kg"},milkrunFiveToTenKg:{value:8,display:"> 5 - 10kg"},milkrunThirtyToSixty:{value:9,display:"> 10 - 30kg"},milkrunTenToThirtyKg:{value:10,display:"> 30 - 60kg"},milkrunSixtyToHundred:{value:11,display:"> 60 - 100kg"}}).constant("defaultFixedRunPricing",e.defaultFixedRunPricing).constant("addNewItemReference",e.addNewItemReference).constant("healthCareWeightCategory",{adhocDocument:{value:12,display:"DOCUMENTS (X-Rays, case notes, medical records etc)"},adhocPharmaceutical:{value:13,display:"HOME DELIVERY (Pharmaceutical items)"},adhocSingpostMail:{value:14,display:"SINGPOST MAILS"},adhocParcel:{value:15,display:"PARCELS"},adhocInstrument:{value:16,display:"SOLID INSTRUMENTS"},adhocSpecimen:{value:17,display:"BLOOD SPECIMEN, HUMAN/ANIMAL SPECIMEN"}}).constant("healthCareDeliveryTiming",{officeHour:{value:4,display:"Office Hours"},officeHourExpress:{value:5,display:"Office Hours (Express)"},weekdayEvening:{value:6,display:"After Office Hours"},weekdayEveningExpress:{value:7,display:"After Office Hours (Express)"},weekend:{value:8,display:"Late Night, Sun & PH"}}).constant("dashboardConst",{maxTickerItems:5}).constant("adhocProgress",{chosenAdhocType:1,collectionPoint:2,deliveryPoint:3,addItem:4,remark:5,confirmOrder:6}).constant("adhocPSSServiceType",{sameDay:{value:2,display:"Same Day Delivery"},nextDay:{value:3,display:"Next Day Delivery"},threeHour:{value:1,display:"3 Hour Delivery"}}).constant("adHocSurcharge",{weekdayEvening:{value:1,display:"Evening, Sat, Sun & Public Holiday"},nonworkingDay:{value:2,display:"Restricted Area"}}).constant("healthCareServiceNote",e.healthCareServiceNote).constant("adhocHealthCareServiceType",{hCOfficeHour:{value:5,display:"Office Hours"},hCOfficeHourExpress:{value:6,display:"Office Hours (Express)"},hCWeekdayEvening:{value:7,display:"After Office Hours"},hCWeekdayEveningExpress:{value:8,display:"After Office Hours (Express)"},hCWeekend:{value:9,display:"Late Night, Sun & PH"}}).constant("uomPSS",["Document","Each","Box","Carton","Pallet","Pack"]).constant("uomHealthCare",["Bag","Bottle","Box","Can","Carton","Piece","Lot","Each","Packet","Set","Tin","Tube","Pallet"]).constant("itemsHealthCare",["Documents (X-Rays, case notes, medical records etc)","Home delivery: Pharmaceutical items","Singpost Mails","Parcels","Solid Instruments","Blood/Blood Specimen/Human or Animal Specimen"]).constant("jobGridType",{milkRunJob:"milkRunJob",milkRunTransaction:"milkRunTransaction",adhocJob:"adhocJob",adhocTransaction:"adhocTransaction"}).constant("jobStatus",{pendingApproval:{value:1,display:"Pending Acceptance"},rejected:{value:2,display:"Rejected"},accepted:{value:3,display:"Accepted"},ongoing:{value:4,display:"On going"},delivered:{value:5,display:"Delivered"},deactivated:{value:6,display:"Deactivated"}}).constant("taskStatus",{pendingCollection:{value:1,display:"Pending Collection"},collecting:{value:2,display:"Collecting"},collected:{value:3,display:"Collected"},collectionFailed:{value:4,display:"Collection Failed"},delivering:{value:5,display:"Delivering"},delivered:{value:6,display:"Delivered"},deliverFailed:{value:7,display:"Delivery Failed"},pendingReturn:{value:8,display:"Pending Return"},returning:{value:9,display:"Returning"},returned:{value:10,display:"Returned"}}).constant("cutOffTime",{case1:"case1",case2:"case2",case3:"case3"}).constant("customerDetailMode",{po:"po",sap:"sap",user:"user",cc:"cc"})}(),function(){"use strict";function e(e,t){e.when("/customers",{title:"Client Management",category:"Customers",controller:"CustomerController",templateUrl:"app/components/customer/customers.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]}).when("/customers/create",{title:"Create new client",category:"Customers",controller:"CustomerDetailController",templateUrl:"app/components/customer/detail.html",controllerAs:"vm",authorize:[t.Admin],preventViewOnly:!0}).when("/customers/detail/:id",{title:"Client detail",category:"Customers",controller:"CustomerDetailController",templateUrl:"app/components/customer/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]}).when("/example",{title:"Client detail",category:"Customers",controller:"ExampleController",templateUrl:"app/components/customer/example.html",controllerAs:"vm"})}function t(e,t,n,o){function r(){i(),a()}function i(){l.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:""},l.gridConfig={onClickRowDetail:s,columns:[{name:"organizationCode",display:"Org Code",columnNameSort:"organizationCode",css:"col-md-2"},{name:"name",display:"Org Name",columnNameSort:"name",css:"col-md-2"},{name:"clientType",display:"Client Type",columnNameSort:"departmentId",css:"col-md-2"},{name:"address",display:"Address",columnNameSort:"address",css:"col-md-4"},{name:"sapCodesText",display:"SAP Code",preventSort:!0,css:"col-md-2"}]},e.currentUser.role===o.Admin&&l.gridConfig.columns.splice(2,1)}function a(){l.isGridLoading=!0,n.getCustomerByCriteria(l.options).then(function(e){l.options.totalItems=e.data.totalCount,l.customers=n.convertListCustomer(e.data.customers),l.isGridLoading=!1})}function s(e){t.path("/customers/detail/"+e.id)}var l=this;l.systemRole=o,l.getCustomerByCriteria=a,r()}function n(e,t,n,o,r,i,a,s){function l(){var i=t.id;i?(u.isLoading=!0,r.getCustomerById(i).then(function(e){u.clientDetail=r.convertCustomer(e.data),u.isLoading=!1},function(){n.path("/accessDeny")}),u.viewMode=!0):(u.clientDetail={address:{},department:{name:e.currentUser.department},clientTypeId:o[e.currentUser.department].id,sapCodes:[],pricings:[]},u.viewMode=!1)}function c(){u.clientDetail.contractEndDate&&u.clientDetail.cutOffTimeForSameDayPickupAndDelivery&&u.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery&&(u.isLoading=!0,u.orgCode=!1,r.saveCustomer(u.clientDetail).then(function(e){u.isLoading=!1;var t=u.clientDetail.id?"The client has been updated successfully.":"The client has been created successfully.";i.success(t),n.path("/customers")},function(e){u.isLoading=!1,"Organization code has been used already"==e.data.message?(u.orgCode=!0,s.createWarningPopup("Organization code has been used already","Warning",null,!0,"OK")):i.error(e.data.message)}))}function d(){u.clientDetail.id&&u.clientDetail.contractEndDate&&u.clientDetail.cutOffTimeForSameDayPickupAndDelivery&&u.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery&&(u.isLoading=!0,r.saveCustomer(u.clientDetail).then(function(e){i.success("The user has been added to this customer successfully."),r.getCustomerById(u.clientDetail.id).then(function(e){u.clientDetail=r.convertCustomer(e.data),u.isLoading=!1},function(){n.path("/accessDeny")})}))}var u=this;u.systemRole=a,u.pssAdhocPricing={},u.healthCareAdhocPricing={},u.newUser={},u.saveCustomer=c,u.addUserToCustomer=d,l()}function o(e){}angular.module("customer.module",["ngRoute"]).config(e).controller("CustomerController",t).controller("CustomerDetailController",n).controller("ExampleController",o),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$location","customerService","systemRole"],n.$inject=["$rootScope","$routeParams","$location","departments","customerService","toastr","systemRole","modalService"],o.$inject=["fileReaderService"]}(),function(){"use strict";function e(e,t,n,o,r,i){function a(){s(),l()}function s(){T.listPricing=T.listPricing||[]}function l(){T.milkRunPricingExist=c(t.MilkRun)>=0,T.adhocPricingExist=c(t.Adhoc)>=0,T.adhocExpresPricingExist=c(t.AdhocExpres)>=0}function c(e){for(var t=0;t<T.listPricing.length;t++)if(T.listPricing[t].pricingType===e)return t;return-1}function d(t){e.currentUser.department===o.PSS.name?u(t):m(t)}function u(e){T.adhocPricingModel=y(e);var t=c(e);t<0&&P(T.adhocPricingModel),C(p,{ngModel:T.adhocPricingModel,viewMode:T.viewMode},"app/components/customer/pricing/adhocPricingModal.html")}function m(e){T.adhocHealthCarePricingModel=y(e),C(g,{ngModel:T.adhocHealthCarePricingModel,viewMode:T.viewMode},"app/components/customer/pricing/healthCarePricingModal.html")}function p(){k(T.adhocPricingModel)}function g(){k(T.adhocHealthCarePricingModel)}function f(){T.milkRunPricingModel=y(t.MilkRun),T.milkRunPricingModel.viewMode=T.viewMode,C(v,T.milkRunPricingModel,"app/components/customer/pricing/milkRunPricingAdvanceModal.html")}function v(){k(T.milkRunPricingModel)}function h(e,t){if(T[t])T[t]=!1,n.createWarningPopup("Please set pricing for this service first!","Warning",null,!0);else{var o=c(e);o>=0&&T.listPricing.splice(o,1)}}function y(n){var r=c(n);return r>=0?angular.copy(T.listPricing[r]):n==t.MilkRun&&e.currentUser.department===o.PSS.name?{pricingType:t.MilkRun,weightCategories:i}:{pricingType:n}}function C(e,t,o){var r={setPricing:e};n.createPopup({templateUrl:o,size:"lg",data:t},r)}function k(e){var t=c(e.pricingType);t>=0?T.listPricing[t]=e:T.listPricing.push(e),l()}function P(e){e.weightCategories=[];for(var t in r)e.weightCategories.push({weightCategoryId:r[t].value,deliveryTimings:[{deliveryTimingId:1},{deliveryTimingId:2},{deliveryTimingId:3}]})}var T=this;T.viewMode=T.viewMode||!1,T.pricingType=t,T.setPricing=d,T.setMilkRunPricing=f,T.checkSetPricing=h,a()}angular.module("customer.module").directive("customerPricing",function(){return{restrict:"E",scope:{viewMode:"=",listPricing:"="},templateUrl:"app/components/customer/pricing/customerPricing.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","pricingType","modalService","departments","adhocWeightCategory","defaultFixedRunPricing"]}(),function(){"use strict";function e(e,t){function n(e){var t={onCreateOrUpdate:a};l.sapDetail=angular.copy(e),s(l.sapDetail,t)}function o(){l.newSap={};var e={onCreateOrUpdate:i};s(l.newSap,e)}function r(e){l.listSap.splice(e,1)}function i(){l.newSap.id=-1,l.listSap.push(l.newSap)}function a(){for(var e=0;e<l.listSap.length;e++)if(l.listSap[e].id===l.sapDetail.id)return void(l.listSap[e]=l.sapDetail)}function s(t,n){e.createPopup({templateUrl:"app/components/customer/sap/sapDetail.html",size:"lg",data:{ngModel:t}},n)}var l=this;l.listSap=l.listSap||[],l.addNewSap=o,l.removeSap=r,l.viewSapDetail=n,l.systemRole=t}angular.module("customer.module").directive("customerSap",function(){return{restrict:"E",scope:{listSap:"="},templateUrl:"app/components/customer/sap/customerSap.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["modalService","systemRole"]}(),function(){"use strict";function e(e,t,n){function o(){}o()}angular.module("customer.module").directive("sapDetail",function(){return{restrict:"E",scope:{sapDetail:"=",onCreateOrUpdate:"&",onCancel:"&"},templateUrl:"app/components/customer/sap/sapDetail/sapDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["clientUserService","modalService","toastr"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s){function l(e){b.userDetail=angular.copy(e),b.userDetail.customerId=b.clientDetail.id,h(b.userDetail)}function c(e){s.currentUser.role!==t.SuperAdmin&&(b.poDetail=angular.copy(e),b.poDetail.detailName=e.number,b.poDetail.customerId=b.clientDetail.id,k(b.poDetail))}function d(e){s.currentUser.role!==t.SuperAdmin&&(b.sapDetail=angular.copy(e),b.sapDetail.customerId=b.clientDetail.id,C(b.sapDetail))}function u(e){s.currentUser.role!==t.SuperAdmin&&(b.costCenterDetail=angular.copy(e),b.costCenterDetail.detailName=e.name,b.costCenterDetail.customerId=b.clientDetail.id,P(b.costCenterDetail))}function m(){A[b.displayMode]()}function p(){b.isLoading=!0,o.saveSapCode(b.sapDetail).then(function(e){b.isLoading=!1;var t="";if(b.sapDetail.id){for(var n=0;n<b.clientDetail.sapCodes.length;n++)if(b.clientDetail.sapCodes[n].id===b.sapDetail.id){b.clientDetail.sapCodes[n]=b.sapDetail;break}t="The sap code has been updated successfully."}else b.clientDetail.sapCodes.push(e.data),t="The sap code has been created successfully.";b.onSearch[b.displayMode](!0),r.success(t)},function(e){b.isLoading=!1,r.error(e.data.message)})}function g(){b.isLoading=!0,i.saveUser(b.userDetail).then(function(e){b.isLoading=!1;var t="";if(b.userDetail.id){b.userDetail.sapCode=e.data.sapCode,b.userDetail.costCentres=e.data.costCentres;for(var n=0;n<b.clientDetail.users.length;n++)if(b.clientDetail.users[n].id===b.userDetail.id){b.clientDetail.users[n]=b.userDetail;break}t="The user has been updated successfully."}else b.clientDetail.users.push(e.data),t="The user has been created successfully.";b.onSearch[b.displayMode](!0),r.success(t)},function(e){b.isLoading=!1,r.error(e.data.message)})}function f(){b.isLoading=!0,o.savePoNumber(b.poDetail).then(function(e){b.isLoading=!1;var t="";if(b.poDetail.id){for(var n=0;n<b.clientDetail.poNumbers.length;n++)if(b.clientDetail.poNumbers[n].id===b.poDetail.id){b.clientDetail.poNumbers[n]=b.poDetail,b.clientDetail.poNumbers[n].number=b.poDetail.detailName,b.clientDetail.poNumbers[n].users=e.data.users;break}t="The PO number has been updated successfully."}else b.clientDetail.poNumbers.push(e.data),t="The PO number has been created successfully.";b.onSearch[b.displayMode](!0),r.success(t)},function(e){b.isLoading=!1,r.error(e.data.message)})}function v(){b.isLoading=!0,o.saveCostCenter(b.costCenterDetail).then(function(e){b.isLoading=!1;var t="";if(b.costCenterDetail.id){for(var n=0;n<b.clientDetail.costCentres.length;n++)if(b.clientDetail.costCentres[n].id===b.costCenterDetail.id){b.clientDetail.costCentres[n]=b.costCenterDetail,b.clientDetail.costCentres[n].name=b.costCenterDetail.detailName,b.clientDetail.costCentres[n].users=e.data.users;break}t="The Const Centre has been updated successfully."}else b.clientDetail.costCentres.push(e.data),t="The Cost Centre has been created successfully.";b.onSearch[b.displayMode](!0),r.success(t)},function(e){b.isLoading=!1,r.error(e.data.message)})}function h(n){var o={onCreateOrUpdate:g,onActivateOrDeactivate:y};e.createPopup({templateUrl:"app/components/customer/user/userDetail.html",size:"lg",data:{ngModel:n,viewMode:!1,poNumbers:b.clientDetail.poNumbers,sapCodes:b.clientDetail.sapCodes,costCenters:b.clientDetail.costCentres,viewMode:s.currentUser.role===t.SuperAdmin}},o)}function y(){for(var e=0;e<b.clientDetail.users.length;e++)if(b.clientDetail.users[e].id===b.userDetail.id){b.clientDetail.users[e].lockoutEnabled=!b.clientDetail.users[e].lockoutEnabled;break}b.onSearch[b.displayMode](!0)}function C(t){var n={onCreateOrUpdate:p};e.createPopup({templateUrl:"app/components/customer/sap/sapDetail.html",size:"lg",data:{ngModel:t}},n)}function k(t){var n={onCreateOrUpdate:f};e.createPopup({templateUrl:"app/components/customer/poCc/poModal.html",size:"lg",data:{ngModel:t,users:b.clientDetail.users,isPo:!0}},n)}function P(t){var n={onCreateOrUpdate:v};e.createPopup({templateUrl:"app/components/customer/poCc/poModal.html",size:"lg",data:{ngModel:t,users:b.clientDetail.users,isPo:!1}},n)}function T(e){b.displayMode=e}var b=this;b.listUser=b.listUser||[],b.addNew=m,b.viewUserDetail=l,b.viewSapDetail=d,b.viewPoDetail=c,b.viewCostCenterDetail=u,b.systemRole=t,b.customerDetailMode=n,b.displayMode=n.user,b.switchDisplay=T,b.searchTerm="",b.placeHolder={po:"Search by PO number",sap:"Search by SAP code",user:"Search by first name, last name",cc:"Search by Cost centre"},b.search=function(){a(function(){b.onSearch[b.displayMode](!0)})},b.onSearch={};var A={po:function(){b.poDetail={customerId:b.clientDetail.id,userIds:[]},k(b.poDetail)},sap:function(){b.sapDetail={customerId:b.clientDetail.id,userIds:[]},C(b.sapDetail)},cc:function(){b.costCenterDetail={customerId:b.clientDetail.id,userIds:[]},P(b.costCenterDetail)},user:function(){b.userDetail={customerId:b.clientDetail.id},h(b.userDetail)}}}angular.module("customer.module").directive("sectionDetail",function(){return{restrict:"E",scope:{clientDetail:"="},templateUrl:"app/components/customer/sectionDetail/sectionDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["modalService","systemRole","customerDetailMode","customerService","toastr","clientUserService","$timeout","$rootScope"]}(),function(){"use strict";function e(e,t){function n(){r(),i(),a(),s()}function o(e){var t=c.clientDetail.sapCodes.find(function(t){return t.id===e});return t?t.blockNumber+" "+t.streetName+" "+t.unitNumber+" "+t.postalCode:""}function r(e){var t=function(e){return(e.firstName+" "+e.lastName).toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1};c.listUser=l(e,"userCriteria",c.clientDetail.users,t)}function i(e){var t=function(e){return e.name.toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1};c.listCc=l(e,"ccCriteria",c.clientDetail.costCentres,t)}function a(e){var t=function(e){return e.code.toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1};c.listSap=l(e,"sapCriteria",c.clientDetail.sapCodes,t)}function s(e){var t=function(e){return e.number.toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1};c.listPo=l(e,"poCriteria",c.clientDetail.poNumbers,t)}function l(e,t,n,o){e&&(c[t].currentPage=1);var r=c[t].currentPage-1,i=n.filter(o);return c[t].totalItem=i.length,i=i.slice(r*c[t].itemPerPage,r*c[t].itemPerPage+c[t].itemPerPage)}var c=this;c.setItemPerPage=t,c.userCriteria={currentPage:1,itemPerPage:20},c.ccCriteria={currentPage:1,itemPerPage:20},c.poCriteria={currentPage:1,itemPerPage:20},c.sapCriteria={currentPage:1,itemPerPage:20},c.customerDetailMode=e,c.getBillingAddress=o,c.getUserByCriteria=c.onSearch[e.user]=r,c.getPoByCriteria=c.onSearch[e.po]=s,c.getSapByCriteria=c.onSearch[e.sap]=a,c.getCcByCriteria=c.onSearch[e.cc]=i,n()}angular.module("customer.module").directive("detailUserSap",function(){return{restrict:"E",scope:{displayMode:"=",viewSapDetail:"&",viewPoDetail:"&",viewUserDetail:"&",viewCostCenterDetail:"&",clientDetail:"=",searchTerm:"=",onSearch:"="},templateUrl:"app/components/customer/sectionDetail/detailUserSap.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["customerDetailMode","setItemPerPage"]}(),function(){"use strict";function e(e,t){function n(e){var t={onCreateOrUpdate:i};s.userDetail=angular.copy(e),a(s.userDetail,t)}function o(){s.newUser={workAddress:{},billingAddresses:[{}]};var e={onCreateOrUpdate:r};a(s.newUser,e,!0)}function r(){s.listUser.push(s.newUser),s.saveCustomer()}function i(){for(var e=0;e<s.listUser.length;e++)if(s.listUser[e].id===s.userDetail.id)return void(s.listUser[e]=s.userDetail)}function a(t,n,o){var r=!o&&s.viewMode;e.createPopup({templateUrl:"app/components/customer/user/userDetail.html",size:"lg",data:{ngModel:t,viewMode:r}},n)}var s=this;s.listUser=s.listUser||[],s.addNewUser=o,s.viewUserDetail=n,s.systemRole=t}angular.module("customer.module").directive("customerUser",function(){return{restrict:"E",scope:{viewMode:"=",listUser:"=",orgCode:"@",saveCustomer:"&?"},templateUrl:"app/components/customer/user/customerUser.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["modalService","systemRole"]}(),function(){"use strict";function e(e,t,n){function o(){l.filteredUsers=angular.copy(l.users)}function r(){l.filteredUsers=l.users.filter(function(e){return(e.firstName+" "+e.lastName).toLowerCase().indexOf(l.searchTerm.toLowerCase())>-1})}function i(){l.isCheckAll=!l.isCheckAll,l.isCheckAll?l.detail.userIds=l.filteredUsers.map(function(e){return e.id}):l.detail.userIds=[]}function a(e){var t=l.detail.userIds.find(function(t){return t===e});return!!t}function s(e){l.isCheckAll=!1;for(var t=0;t<l.detail.userIds.length;t++)if(l.detail.userIds[t]===e)return void l.detail.userIds.splice(t,1);l.detail.userIds.push(e)}var l=this;l.isCheckAll=!1,l.searchTerm="",l.bindingCheck=a,l.onCheck=s,l.selectAll=i,l.filter=r,o()}angular.module("customer.module").directive("poCc",function(){return{restrict:"E",scope:{detail:"=?",users:"=?",onCreateOrUpdate:"&",onCancel:"&",isPo:"="},templateUrl:"app/components/customer/poCc/poCcDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["clientUserService","modalService","toastr"]}(),function(){"use strict";function e(e){function t(){s.ngModel=s.ngModel||[],s.source=s.source||[]}function n(e){var t=s.source.find(function(t){return t.id===e});return t?t[s.fieldKey]:""}function o(e){var t=s.source.filter(function(t){return!!(t[s.fieldKey].toLowerCase().indexOf(e.toLowerCase())>-1&&s.ngModel.indexOf(t.id)===-1)});return t}function r(e){s.ngModel.push(e.id),s.searchTerm=""}function i(e){s.ngModel.splice(e,1)}function a(){s.isFocus=!0,document.getElementById("input-"+e.$id).focus()}var s=this;s.search=o,s.onSelect=r,s.onRemove=i,s.getValue=n,s.setFocus=a,t()}angular.module("customer.module").directive("multiSelect",function(){return{restrict:"E",scope:{source:"=?",ngModel:"=?",isError:"=?",fieldName:"=?",fieldKey:"=?"},templateUrl:"app/components/customer/multiselect/multiselect.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$scope"]}(),function(){"use strict";function e(e){e.when("/dashboard",{title:"Dashboard",category:"Dashboard",controller:"DashboardController",templateUrl:"app/components/dashboard/dashboard.html",controllerAs:"vm",authorize:["Admin","User"],hideNavbar:!0,showHeaderDashboardControls:!0,hideFooter:!0,noContainer:!0,darkBg:!0})}function t(e,t,n,o,r,i,a,s,l,c,d,u,m,p,g,f,v,h,y,C){function k(){r(function(){D()})}function P(e){var t=e.target,n=angular.element(t),o=H.contains(t)&&n.hasClass("uib-left"),r=H.contains(t)&&n.hasClass("uib-right"),i=n.parent().hasClass("dashboard__schedule-calendar-date");o?j("prev"):r?j("next"):i&&$()}function T(){var e=B(),t=e?e.clientHeight:0;F.scheduleHeight=n.innerHeight-t-34-10}function b(){F.scheduleJobsStyles={height:F.scheduleHeight-H.clientHeight-52+"px"}}function A(){var e=B(),t=e?e.clientHeight:0;F.spendingsGraphHeight=n.innerHeight-t-34-C.getAbsoluteElHeight(z)-C.getAbsoluteElHeight(J)-C.getAbsoluteElHeight(q)-10}function D(){T(),b(),A(),E()}function M(){angular.element(n).off("resize",k),angular.element(o).off("click",P)}function S(e,t){"boolean"==typeof t||"true"===t||"false"===t?e.isOpen=t:e.isOpen=!e.isOpen}function R(){l.getSummary(F.dateRange.startDate.model,F.dateRange.endDate.model,F.jobType).then(function(e){F.summaryCounts=e.data},function(e){console.warn(e)})}function w(){var e={status:f.pendingApproval.value};switch(F.jobType){case 0:h.getAdhocByCriteria(e).then(function(e){F.pendingJobsCount=e.data.totalCount},function(e){console.warn(e)}).finally(function(){F.pendingJobsLoading=!1,r(function(){D()})});break;case 1:y.getMilkRunByCriteria(e).then(function(e){F.pendingJobsCount=e.data.totalCount},function(e){console.warn(e)}).finally(function(){F.pendingJobsLoading=!1,r(function(){D()})})}}function U(){var e=0===F.jobType?"adhocs/jobs":"milkruns/jobs";i.path(e).search({status:f.pendingApproval.value})}function I(){var e=new Date(F.calendar.yearInView+"-"+F.calendar.monthInView+"-01");F.daysWithJobsLoading=!0,l.getDaysOfMonthWithJobs(e,F.jobType).then(function(e){F.daysWithJobs=e},function(e){console.warn(e)}).finally(function(){F.daysWithJobsLoading=!1,r(function(){T(),b(),angular.element(document.querySelector(".dashboard__schedule-calendar tbody .uib-weeks:nth-child(2) .btn")).triggerHandler("click")})})}function N(e){var t=e.date,n=e.mode;if("day"===n){var o=["dashboard__schedule-calendar-date"],r=new Date,i=new Date(t),a=i.getFullYear()+"-"+(i.getMonth()+1);"undefined"!=typeof F.daysWithJobs[F.jobType]&&"undefined"!=typeof F.daysWithJobs[F.jobType][a]&&F.daysWithJobs[F.jobType][a].indexOf(i.getDate())>-1&&o.push("date-has-jobs");var s=i.setHours(0,0,0,0);return s===r.setHours(0,0,0,0)&&o.push("date-today"),o.push("date-y-"+i.getFullYear()+"-m-"+(i.getMonth()+1)+"-d-"+i.getDate()),o.join(" ")}return""}function j(e){r(function(){"prev"===e?F.calendar.monthInView-=1:F.calendar.monthInView+=1,F.calendar.monthInView<1?(F.calendar.yearInView-=1,F.calendar.monthInView=12):F.calendar.monthInView>12&&(F.calendar.yearInView+=1,F.calendar.monthInView=1),I()})}function $(){r(function(){var e=0===F.jobType?"adhocs/transactions":"milkruns/transactions";i.path(e).search({jobDate:a("date")(new Date(F.calendar.model),s.simpleDateFormat)})})}function L(){F.todaysJobsLoading=!0;var e={jobDate:new Date};switch(F.jobType){case 0:m.getAdhocTaskByCriteria(e).then(function(e){F.todaysJobs=e.data.jobTasks},function(e){console.warn(e)}).finally(function(){F.todaysJobsLoading=!1,r(E,100)});break;case 1:m.getMilkRunTaskByCriteria(e).then(function(e){F.todaysJobs=e.data.milkRunTasks},function(e){console.warn(e)}).finally(function(){F.todaysJobsLoading=!1,r(E,100)})}}function E(){e.$broadcast("dashboard:scrollbar:rebuild")}function x(){var t="undefined"==typeof F.chartSelection||F.chartSelection.id===-1?void 0:F.chartSelection.id;switch(e.currentUser.role){case"Admin":l.getSpending(F.jobType,t).then(function(e){F.spendings=e.data},function(e){console.warn(e)});break;case"User":l.getSpending(F.jobType,e.currentUser.id,t).then(function(e){F.spendings=e.data},function(e){console.warn(e)})}}function O(e){for(var t in v)if(v[t].value===e)return v[t].display;return"N/A"}function V(e){var t=0===F.jobType?"adhocTask/":"milkrunTask/";i.path(t+e)}var F=this,B=function(){return document.querySelector(".header")},H=document.querySelector(".dashboard__schedule-calendar-wrap"),z=document.querySelector(".dashboard__heading"),J=document.querySelector(".dashboard__donuts-container"),q=document.querySelector(".dashboard__chart-heading");switch(F.jobType=parseInt(e.headerSelectedJob),F.jobTypeNames=["Ad Hoc","Fixed Run"],F.goToJobDetail=V,e.$watch("headerSelectedJob",function(t,n){"undefined"!=typeof t&&parseInt(e.headerSelectedJob)!==F.jobType&&(F.jobType=parseInt(e.headerSelectedJob),x(),L(),R(),I(),w())}),r(function(){D()}),angular.element(n).on("resize",k),angular.element(o).on("click",P),t.$on("$destroy",M),F.tickerShowCta="Admin"===e.currentUser.role,
F.tickerCtaLink=g[e.currentUser.role].cmsRoute?"#"+g[e.currentUser.role].cmsRoute:"#"+e.indexRoute,F.tickerItems=[],l.getTrafficUpdates().then(function(e){F.tickerItems=e},function(e){console.warn(e)}),F.datepickerConfig={showWeeks:!1},F.dateRange={startDate:{model:null,isOpen:!1,toggleOpen:function(e){S(this,e)},onChange:R},endDate:{model:null,isOpen:!1,toggleOpen:function(e){S(this,e)},onChange:R}},F.summaryCountsConfig={duration:1500},F.summaryCounts={approved:0,rejected:0,completed:0,scheduled:0},R(),F.pendingJobsLoading=e.currentUser.role===p.Admin,F.pendingJobsCount=0,F.clickPendingBarButton=U,w(),F.daysWithJobsLoading=!0,F.daysWithJobs={},F.calendar={model:"",monthInView:(new Date).getMonth()+1,yearInView:(new Date).getFullYear(),initialLoad:!0,opts:{showWeeks:!1,formatDayTitle:"yyyy MMM",formatDay:"d",formatDayHeader:"EEE",datepickerMode:"day",maxMode:"day",minMode:"day",customClass:N}},I(),F.todaysJobsLoading=!0,F.todaysJobs=[],L(),F.rebuildTodaysJobsScrollbar=E,F.chartSelection,F.chartSelectionList=[],e.currentUser.role){case p.Admin:F.chartSelectionList=[{id:-1,label:"All customers"}],d.getCustomerByCriteria({sortColumn:"name",sortAscending:!0}).then(function(e){var t=_.map(e.data.customers,function(e){return{id:e.id,label:e.name}});F.chartSelectionList=F.chartSelectionList.concat(t),F.chartSelection=F.chartSelectionList[0]},function(e){console.warn(e)});break;case p.User:F.chartSelectionList=[{id:-1,label:"All cost centers"}],u.getClientUserById(e.currentUser.id).then(function(e){var t=_.map(e.data.costCentre.split(","),function(e){return{id:e,label:e}});F.chartSelectionList=F.chartSelectionList.concat(t),F.chartSelection=F.chartSelectionList[0]},function(e){console.warn(e)})}F.onChartSelectionChange=function(){x()},F.spendings=[],x(),F.getTextStatus=O}angular.module("dashboard.module",["ngRoute"]).config(e).controller("DashboardController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$scope","$window","$document","$timeout","$location","$filter","systemSetting","dashboardService","dashboardConst","customerService","clientUserService","taskService","systemRole","systemRolesConfigs","jobStatus","taskStatus","adhocService","milkrunService","utilityService"]}(),function(){"use strict";function e(e){e.when("/users",{title:"User management",category:"Users",controller:"SpAdminUserController",templateUrl:"app/components/spAdminUser/users.html",controllerAs:"vm",authorize:["SuperAdmin"]}).when("/users/create",{title:"New admin",category:"Users",controller:"SpAdminUserDetailController",templateUrl:"app/components/spAdminUser/detail.html",controllerAs:"vm",authorize:["SuperAdmin"]}).when("/users/detail/:id",{title:"Admin detail",category:"Users",controller:"SpAdminUserDetailController",templateUrl:"app/components/spAdminUser/detail.html",controllerAs:"vm",authorize:["SuperAdmin"]})}function t(e,t,n){function o(){r(),i()}function r(){s.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",department:""},s.gridConfig={onClickRowDetail:a,columns:[{name:"name",display:"Name",columnNameSort:"firstName"},{name:"email",display:"Email",columnNameSort:"email"},{name:"phoneNumber",display:"Contact number",columnNameSort:"phoneNumber"},{name:"departmentName",display:"Department",columnNameSort:"department"},{name:"status",display:"Status",columnNameSort:"lockoutEnabled"}]},s.departments=[{id:"",name:"All"},n.PSS,n.Healthcare]}function i(){s.isGridLoading=!0,t.getAdminUserByCriteria(s.options).then(function(e){s.options.totalItems=e.data.totalCount;var t=e.data.users;angular.forEach(t,function(e){e.name=e.firstName+" "+e.lastName,e.departmentName=e.department.name,e.status=e.lockoutEnabled?"Inactive":"Active"}),s.users=t,s.isGridLoading=!1})}function a(t){e.path("/users/detail/"+t.id)}var s=this;s.getAdminUserByCriteria=i,o()}function n(e,t,n,o,r,i){function a(){var t=e.id;t?(n.getAdminUserById(t).then(function(e){m.userDetail=e.data,m.userDetail.adminType=m.userDetail.viewOnly.toString(),m.originalEmail=m.userDetail.email}),m.viewMode=!0):m.viewMode=!1}function s(){m.viewMode=!1}function l(){m.isSaving=!0,m.userDetail.viewOnly="true"===m.userDetail.adminType,n.saveAdminUser(m.userDetail).then(function(e){m.isSaving=!1;var n=m.userDetail.id?"The admin has been updated successfully.":"The admin has been created successfully.";r.success(n),t.path("/users")},function(e){m.isSaving=!1})}function c(){var e=m.userDetail.lockoutEnabled?"Are you sure you want to activate this admin?":"Are you sure you want to deactivate this admin?";i.createWarningPopup(e,"Warning",d)}function d(){n.activateOrDeactivate(m.userDetail).then(function(e){var t=m.userDetail.lockoutEnabled?"The admin has been activated successfully.":"The admin has been deactivated successfully.";m.userDetail.lockoutEnabled=!m.userDetail.lockoutEnabled,r.success(t)})}function u(){!m.userDetail||m.userDetail.id&&m.userDetail.email===m.originalEmail||n.checkEmailExist(m.userDetail.email).then(function(e){m.emailExist=!0},function(e){m.emailExist=!1})}var m=this;m.departments=[{id:void 0,name:"Please select ..."},o.PSS,o.Healthcare],m.roles=[{text:"Please select ...",value:void 0},{text:"Full Access Admin",value:"false"},{text:"View Only Admin",value:"true"}],m.edit=s,m.save=l,m.activateOrDeactivate=c,m.checkEmailExist=u,a()}angular.module("spAdminUser.module",["ngRoute"]).config(e).controller("SpAdminUserController",t).controller("SpAdminUserDetailController",n),e.$inject=["$routeProvider"],t.$inject=["$location","adminUserService","departments"],n.$inject=["$routeParams","$location","adminUserService","departments","toastr","modalService"]}(),function(){"use strict";function e(e){e.when("/login",{title:"Login",controller:"AccountController",templateUrl:"app/components/account/login.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0}).when("/account/forgot",{title:"Forgot password",controller:"AccountController",templateUrl:"app/components/account/forgot.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0}).when("/reset",{title:"Reset password",controller:"ResetController",templateUrl:"app/components/account/reset.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0}).when("/account/activate",{title:"Activate account",controller:"AccountController",templateUrl:"app/components/account/activate.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0})}function t(e,t,n,o){function r(){return l.email&&l.password?(l.isLoginInProgress=!0,void t.login(l.email,l.password).then(function(e){l.isLoginInProgress=!1,s(e)}).catch(function(e){l.password="",l.isLoginInProgress=!1,l.wrongPassword=!0,l.errorMessage=e.data.message,"Account has been locked out"===l.errorMessage&&(l.errorMessage="This account has been deactivated")})):(l.wrongPassword=!0,void(l.errorMessage="Please enter username and password."))}function i(){n.path("/login")}function a(){return l.email?(l.isLoading=!0,void t.resetPassword(l.email).then(function(e){l.isLoading=!1,l.isSentResetPassword=!0}).catch(function(e){l.isLoading=!1,l.userNotFound=!0,l.errorMessage=e.data.message,l.isSentResetPassword=!1})):void(l.wrongPassword=!0)}function s(t){e.currentUser=t,e.indexRoute="#"+o[e.currentUser.role].defaultRoute,n.path("/"+o[e.currentUser.role].defaultRoute)}var l=this;l.login=r,l.activateAccount=i,l.resetPassword=a,l.password="",l.isLoginInProgress=!1,l.wrongPassword=!1}function n(e,t,n){function o(){r.resetModel.resetPasswordToken=t.search().token.replace(/ /g,"+"),r.resetModel.userId=t.search().userId,e.confirmResetPassword(r.resetModel).then(function(e){t.url(t.path()),t.path("/login"),n.success("Reset password successfully")}).catch(function(e){n.error(e.data.message)})}var r=this;r.updatePassword=o}angular.module("account.module",["ngRoute"]).config(e).controller("AccountController",t).controller("ResetController",n),e.$inject=["$routeProvider"],t.$inject=["$rootScope","authService","$location","systemRolesConfigs"],n.$inject=["authService","$location","toastr"]}(),function(){"use strict";function e(e){e.when("/clientUsers",{title:"User Client management",category:"Users",controller:"AdminUserController",templateUrl:"app/components/adminUser/clientUsers.html",controllerAs:"vm",authorize:["Admin","User"]})}function t(e,t,n,o,r,i){function a(){s(),e.currentUser.role===r.User?n.getClientUserById(e.currentUser.id).then(function(e){m.options.organizationCode=e.data.organizationCode,l()}):l()}function s(){m.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",department:e.currentUser.department},m.gridConfig={onClickRowDetail:c,columns:[{name:"name",display:"Name",css:"col-md-2",columnNameSort:"name"},{name:"email",display:"Email",css:"col-md-2 email",columnNameSort:"email"},{name:"phoneNumber",display:"Contact no",css:"column-user-phoneNumer",columnNameSort:"contact"},{name:"costCentres",display:"Cost centre",css:"column-user-costCentre",preventSort:!0},{name:"sapCode",display:"SAP",preventSort:!0},{name:"organizationCode",display:"Org code",css:"column-user-orgCode",columnNameSort:"organizationCode"},{name:"status",display:"Status",preventSort:!0}]}}function l(){m.isGridLoading=!0,n.getClientUserByCriteria(m.options).then(function(e){m.options.totalItems=e.data.totalCount,m.users=n.convertListUser(e.data.users),m.isGridLoading=!1})}function c(t){m.isGridLoading=!0,e.currentUser.role===r.User||e.currentUser.viewOnly||i.getCustomerById(t.customerId).then(function(e){n.getClientUserById(t.id).then(function(t){m.isGridLoading=!1,m.userDetail=t.data;var n={onCreateOrUpdate:u,onActivateOrDeactivate:l},o={ngModel:m.userDetail,poNumbers:e.data.poNumbers,sapCodes:e.data.sapCodes,costCenters:e.data.costCentres};d(o,n)})})}function d(e,n){t.createPopup({templateUrl:"app/components/customer/user/userDetail.html",size:"lg",data:e},n)}function u(){m.isGridLoading=!0,n.updateClientUser(m.userDetail).then(function(e){o.success("The user has been updated successfully."),l()})}var m=this;m.userDetail={},m.getUserByCriteria=l,m.openDetailModal=c,a()}angular.module("adminUser.module",["ngRoute"]).config(e).controller("AdminUserController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","modalService","clientUserService","toastr","systemRole","customerService"]}(),function(){"use strict";function e(e,t){e.when("/milkruns/:view?",{title:"Fixed Run",category:"MilkrunTransactions",controller:"MilkrunManagementController",templateUrl:"app/components/milkrun/milkruns.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]}).when("/milkrun/create",{title:"Create new Fixed Run",category:"MilkrunTransactions",controller:"MilkRunDetailController",templateUrl:"app/components/milkrun/detail.html",controllerAs:"vm",authorize:[t.Admin,t.User],preventViewOnly:!0,resolve:{checkContractDateExpire:o}}).when("/milkrun/detail/:id",{title:"Fixed Run detail",category:"MilkrunTransactions",controller:"MilkRunDetailController",templateUrl:"app/components/milkrun/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]})}function t(e,t,n,o,r,i,a,s){function l(){c(),p()}function c(){var t="undefined"!=typeof n.search().jobDate&&n.search().jobDate.length>0?new Date(n.search().jobDate):"",o="undefined"!=typeof n.search().status&&isFinite(n.search().status)?n.search().status:"";g.options={itemPerPage:20,currentPage:1,customer:"",status:o,requestType:""},g.transactionOptions={itemPerPage:20,currentPage:1,customer:"",status:"",requestType:"",jobDate:t,vendor:""},g.gridConfig={columns:[{name:"id",display:"ID"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"frequency",display:"Frequency"},{name:"status",display:"Status"},{name:"collectionPoints",display:"Collection point"},{name:"deliveryPoints",display:"Delivery point"},{name:"createdBy",display:"Created by"}]},g.gridConfigTransation={columns:[{name:"barcode",display:"Barcode"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"frequency",display:"Frequency"},{name:"status",display:"Status"},{name:"jobDate",display:"Job date"},{name:"collectionPoints",display:"Collection point"},{name:"deliveryPoints",display:"Delivery point"},{name:"vendor",display:"Vendor name"},{name:"createdBy",display:"Created by"}]},e.currentUser.role===i.User&&(g.gridConfig.columns.splice(1,1),g.gridConfigTransation.columns.splice(1,1),g.gridConfigTransation.columns.splice(7,1))}function d(){g.isLoading=!0,o.getMilkRunByCriteria(g.options).then(function(e){g.listMilkRun=o.convertListMilkRun(e.data.milkRuns),g.options.totalItems=e.data.totalCount,g.isLoading=!1})}function u(){g.isLoading=!0,s.getMilkRunTaskByCriteria(g.transactionOptions).then(function(e){g.listMilkRunTask=s.convertListMilkRunTask(e.data.milkRunTasks),g.transactionOptions.totalItems=e.data.totalCount,g.isLoading=!1})}function m(e){g.isJob=e,p(),n.path(e?"/milkruns/jobs":"/milkruns/transactions")}function p(){g.isJob?d():u()}var g=this;g.isJob="transactions"!==t.view,g.jobStatusType=r,g.systemRole=i,g.jobGridType=a,g.getMilkRunByCriteria=d,g.getMilkRunTaskByCriteria=u,g.switchDisplayJob=m,l()}function n(e,t,n,o,r,i){function a(){var e=t.id;e?(l.viewMode=!0,l.currentProgress=n.confirmOrder,l.isLoading=!0,r.getMilkRunById(e).then(s,function(){i.path("/accessDeny")})):(l.viewMode=!1,l.milkrunDetail={},l.currentProgress=n.chosenMilkRunType)}function s(e){l.milkrunDetail=r.convertMilkRun(e.data),l.isLoading=!1}var l=this;l.systemRole=o,l.milkRunProgress=n,a()}function o(e,t,n,o,r){e.currentUser.role===r.User&&o.checkContractExpire(e.currentUser.customerId).then(function(e){e&&(n.createWarningPopup("Unable to create new jobs, Please contact STLogs Admin.","Warning",null,!0,"OK"),t.history.back())})}angular.module("milkRun.module",["ngRoute"]).config(e).controller("MilkrunManagementController",t).controller("MilkRunDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$routeParams","$location","milkrunService","jobStatusType","systemRole","jobGridType","taskService"],n.$inject=["$rootScope","$routeParams","milkRunProgress","systemRole","milkrunService","$location"],o.$inject=["$rootScope","$window","modalService","customerService","systemRole"]}(),function(){"use strict";function e(e){e.when("/logs",{title:"Logs management",category:"Logs",controller:"LogController",templateUrl:"app/components/log/logs.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"]})}function t(e,t){function n(){o(),r()}function o(){i.options={itemPerPage:20,currentPage:1,dateFrom:"",dateTo:"",role:"",action:"",userSearch:"",descriptionSearch:""},i.roles=[{text:"All",value:""},{text:"Super Admin",value:"SuperAdmin"},{text:"Admin",value:"Admin"},{text:"User",value:"User"},{text:"Driver",value:"Driver"},{text:"Vendor",value:"Vendor"}],i.actions=[{text:"All",value:""},{text:"Create",value:"Created"},{text:"Modify",value:"Modified"},{text:"Delete",value:"Deleted"},{text:"Cancel",value:"Cancelled"},{text:"Approve",value:"Approved"},{text:"Reject",value:"Rejected"},{text:"Login",value:"Logged In"}]}function r(){i.isLoading=!0,t.getLogByCriteria(i.options).then(function(e){i.logs=e.data.logs,i.options.totalItems=e.data.totalCount,i.isLoading=!1})}var i=this;i.setItemPerPage=e,i.getLogByCriteria=r,n()}angular.module("log.module",["ngRoute"]).config(e).controller("LogController",t),e.$inject=["$routeProvider"],t.$inject=["setItemPerPage","logService"]}(),function(){"use strict";function e(e){e.when("/reports",{title:"Report management",category:"Reports",controller:"ReportController",templateUrl:"app/components/report/reports.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"]})}function t(e,t,n,o,r,i,a){function s(){c(),l(),d()}function l(){n.getCustomerByCriteria({}).then(function(e){m.customers=n.convertListCustomerDropDownList(e.data.customers)})}function c(){m.departments=[{id:"",name:"All"},r.PSS,r.Healthcare],m.options={itemPerPage:20,currentPage:1,fromDate:"",toDate:"",type:"0",customer:"",departmentId:""}}function d(){m.isLoading=!0,t.getReportByCriteria(m.options).then(function(e){m.listReport=t.convertListReport(e.data.reports,m.options.type),m.options.totalItems=e.data.totalCount,m.isLoading=!1})}function u(){m.isLoading=!0,t.getReportByCriteria(m.options,!0).then(function(e){var t=document.createElement("a");t.href="data:attachment/csv,"+encodeURI(e.data),t.target="_blank",t.download="report.csv",t.click(),m.isLoading=!1})}var m=this;m.setItemPerPage=e,m.systemRole=o,m.getReportByCriteria=d,m.exportExcel=u,m.stickHeader=!1,s(),angular.element(i).bind("scroll",function(){var e=!1;e=this.pageYOffset>=460,a.$apply(function(){m.stickHeader=e;var t=document.getElementById("stick-header");t&&(t.scrollLeft=document.getElementById("report").scrollLeft)})}),angular.element(document.getElementById("report")).bind("scroll",function(){document.getElementById("stick-header").scrollLeft=document.getElementById("report").scrollLeft})}angular.module("report.module",["ngRoute"]).config(e).controller("ReportController",t),e.$inject=["$routeProvider"],t.$inject=["setItemPerPage","reportService","customerService","systemRole","departments","$window","$scope"]}(),function(){"use strict";function e(e){e.when("/allLocations",{title:"All Locations",category:"AllLocations",controller:"AllLocationsController",templateUrl:"app/components/allLocations/allLocations.html",controllerAs:"vm",authorize:["SuperAdmin"]})}function t(e,t,n,o,r){function i(){e.downloadFile()}function a(){e.lastUpdate().then(function(e){var t=new Date(e.data);c.lastUpdate=n("date")(t,"medium","+0800")})}function s(n){c.fileUploading=!0,e.uploadFile(c.file).then(function(e){a(),c.isLoading=!1,c.file=null,c.fileUploading=!1,t.success("File processed successfully."),r(function(){c.fileUploadProgress=null},1500)},function(e){t.error("The file upload failed. Please check the format and your connection and try again."),c.isLoading=!1,c.fileUploading=!1},function(e){var n=parseInt(100*e.loaded/e.total);c.fileUploadProgress=n,100!=n||c.isLoading||(c.isLoading=!0,t.success("The file is uploaded and being processed."))})}function l(e){c.file=e,console.log("fire")}var c=this;c.downloadFile=i,c.uploadFile=s,c.file=null,c.onFileSelect=l,c.fileUploading=!1,c.fileUploadProgress=null,c.fileUploadProgressPercentage="0%",o.$watch(function(){return c.fileUploadProgress},function(e){"number"==typeof e?c.fileUploadProgressPercentage=e+"%":c.fileUploadProgressPercentage="0%"}),a()}angular.module("allLocations.module",["ngRoute"]).config(e).controller("AllLocationsController",t),e.$inject=["$routeProvider"],t.$inject=["allLocationsService","toastr","$filter","$scope","$timeout"]}(),function(){"use strict";function e(e,t){e.when("/profile",{title:"Profile",controller:"ProfileController",templateUrl:"app/components/profile/profiles.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User,t.Vendor]})}function t(e,t,n,o,r,i){function a(){s.isLoading=!0;var a;return e.currentUser.role===n.SuperAdmin?void t.path("/customers"):(e.currentUser.role===n.Admin&&(a=o.getAdminUserById),e.currentUser.role===n.User&&(a=r.getClientUserById),e.currentUser.role===n.Vendor&&(a=i.getVendorById),void a(e.currentUser.id).then(function(e){s.userDetail=e.data,s.isLoading=!1}))}var s=this;s.systemRole=n,a()}angular.module("profile.module",["ngRoute"]).config(e).controller("ProfileController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$location","systemRole","adminUserService","clientUserService","vendorService"]}(),function(){"use strict";function e(e,t){e.when("/vendors",{title:"Vendor Management",category:"VendorManagement",controller:"VendorManagementController",templateUrl:"app/components/vendor/vendors.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]}).when("/vendors/create",{title:"Create new vendor",category:"VendorManagement",controller:"VendorDetailController",templateUrl:"app/components/vendor/detail.html",controllerAs:"vm",authorize:[t.Admin],preventViewOnly:!0}).when("/vendors/detail/:id",{title:"Client detail",category:"VendorManagement",controller:"VendorDetailController",templateUrl:"app/components/vendor/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]})}function t(e,t,n,o,r){function i(){a(),s()}function a(){c.departments=[{id:"",name:"All"},o.PSS,o.Healthcare],c.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",departmentId:""},c.gridConfig={onClickRowDetail:l,columns:[{name:"organization",display:"Organization name",columnNameSort:"organizationName"},{name:"organizationCode",display:"Organization code",columnNameSort:"organizationCode"},{name:"contactPerson",display:"Contact person",columnNameSort:"contactPerson"},{name:"phoneNumber",display:"Contact number",columnNameSort:"phoneNumber"},{name:"alternativeContactPerson",display:"Alternative contact person",columnNameSort:"alternativeContactPerson"},{name:"alternativePhoneNumber",display:"Alternative contact number",columnNameSort:"alternativePhoneNumber"},{name:"workAddress",display:"Address",columnNameSort:"workAddress"},{name:"status",display:"Status",preventSort:!0}]}}function s(){c.isGridLoading=!0,n.getVendorByCriteria(c.options).then(function(e){c.options.totalItems=e.data.totalCount,c.vendors=n.convertListVendor(e.data.users),c.isGridLoading=!1})}function l(e){t.path("/vendors/detail/"+e.id)}var c=this;c.systemRole=r,c.getVendorByCriteria=s,i()}function n(e,t,n,o,r,i,a){function s(){var i=t.id;i?(m.isLoading=!0,r.getVendorById(i).then(function(e){m.vendorDetail=r.convertVendor(e.data),m.isLoading=!1},function(){n.path("/accessDeny")}),m.viewMode=!0):(m.vendorDetail={department:{name:e.currentUser.department,id:o[e.currentUser.department].id},workAddress:{}},m.viewMode=!1)}function l(){m.isLoading=!0,r.deactivateVendor(m.vendorDetail.id).then(function(e){m.isLoading=!1;var t="The vendor "+m.vendorDetail.name+" has been deactivated.";i.success(t),n.path("/vendors")})}function c(){m.isLoading=!0,r.activateVendor(m.vendorDetail.id).then(function(e){m.isLoading=!1;var t="The vendor "+m.vendorDetail.name+" has been activated.";i.success(t),n.path("/vendors")})}function d(){m.isLoading=!0,r.saveVendor(m.vendorDetail).then(function(e){var t=m.vendorDetail.id?"The vendor has been updated successfully.":"The vendor has been created successfully.";i.success(t),n.path("/vendors")}).catch(function(e){i.error(e.data.message)}).finally(function(){m.isLoading=!1})}function u(){!m.vendorDetail||m.vendorDetail.id&&m.vendorDetail.email===m.originalEmail||r.checkEmailExist(m.vendorDetail.email).then(function(e){m.emailExist=!0},function(e){m.emailExist=!1})}var m=this;m.systemRole=a,m.saveVendor=d,m.deactivateVendor=l,m.activateVendor=c,m.checkEmailExist=u,s()}angular.module("vendorManagement.module",["ngRoute"]).config(e).controller("VendorManagementController",t).controller("VendorDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$location","vendorService","departments","systemRole"],n.$inject=["$rootScope","$routeParams","$location","departments","vendorService","toastr","systemRole"]}(),function(){"use strict";function e(e,t){e.when("/adhocs/:view?",{title:"Ad Hoc",category:"AdhocTransactions",controller:"AdhocManagementController",templateUrl:"app/components/adhoc/adhocs.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]}).when("/adhoc/create",{title:"Create new Adhoc Job",category:"AdhocTransactions",controller:"AdhocDetailController",templateUrl:"app/components/adhoc/detail.html",controllerAs:"vm",authorize:[t.Admin,t.User],preventViewOnly:!0,resolve:{checkContractDateExpire:o}}).when("/adhoc/detail/:id",{title:"Adhoc Job detail",category:"AdhocTransactions",controller:"AdhocDetailController",templateUrl:"app/components/adhoc/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]}).otherwise({redirectTo:"/adhocs"})}function t(e,t,n,o,r,i,a){function s(){l(),m()}function l(){var t="undefined"!=typeof n.search().jobDate&&n.search().jobDate.length>0?new Date(n.search().jobDate):"",o="undefined"!=typeof n.search().status&&isFinite(n.search().status)?n.search().status:"";p.options={itemPerPage:20,currentPage:1,customer:"",status:o,requestType:""},p.transactionOptions={itemPerPage:20,currentPage:1,customer:"",status:"",requestType:"",jobDate:t,vendor:""},p.gridConfig={columns:[{name:"id",display:"ID"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"requestType",display:"Request type"},{name:"status",display:"Status"},{name:"collectionPoints",display:"Collection point"},{name:"deliveryPoints",display:"Delivery point"},{name:"createdBy",display:"Created by"}]},p.gridConfigTransation={columns:[{name:"barcode",display:"Barcode"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"requestType",display:"Request type"},{name:"status",display:"Status"},{name:"collectionPoint",display:"Collection point"},{name:"pickUpDate",display:"Pick up Date & Time"},{name:"deliveryPoint",display:"Delivery point"},{name:"deliveryDate",display:"Delivery Date & Time"},{name:"vendor",display:"Vendor Name"},{name:"createdBy",display:"Created by"}]},e.currentUser.role===r.User&&(p.gridConfig.columns.splice(1,1),p.gridConfigTransation.columns.splice(1,1),p.gridConfigTransation.columns.splice(8,1))}function c(){p.isLoading=!0,i.getAdhocByCriteria(p.options).then(function(e){p.listJob=i.convertListAdhoc(e.data.jobs),p.options.totalItems=e.data.totalCount,p.isLoading=!1})}function d(){p.isLoading=!0,a.getAdhocTaskByCriteria(p.transactionOptions).then(function(e){p.listTask=a.convertListAdhocTask(e.data.jobTasks),p.transactionOptions.totalItems=e.data.totalCount,p.isLoading=!1})}function u(e){p.isJob=e,m(),n.path(e?"/adhocs/jobs":"/adhocs/transactions")}function m(){p.isJob?c():d()}var p=this;p.isJob="transactions"!==t.view,p.jobGridType=o,p.systemRole=r,p.switchDisplayJob=u,p.getJobByCriteria=c,p.getTaskByCriteria=d,s()}function n(e,t,n,o,r){function i(){var i=e.id;i?(s.viewMode=!0,s.currentProgress=t.confirmOrder,s.isLoading=!0,n.getAdhocById(i).then(a,function(){o.path("/accessDeny")})):(s.viewMode=!1,s.adhocDetail={jobType:r.oneToMany,collectionPoints:[],deliveryPoints:[]},s.currentProgress=t.chosenAdhocType)}function a(e){s.adhocDetail=n.convertAdhoc(e.data),s.isLoading=!1}var s=this;s.adhocProgress=t,i()}function o(e,t,n,o,r){e.currentUser.role===r.User&&o.checkContractExpire(e.currentUser.customerId).then(function(e){e&&(n.createWarningPopup("Unable to create new jobs, Please contact STLogs Admin.","Warning",null,!0,"OK"),t.history.back())})}angular.module("adhoc.module",["ngRoute"]).config(e).controller("AdhocManagementController",t).controller("AdhocDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$routeParams","$location","jobGridType","systemRole","adhocService","taskService"],n.$inject=["$routeParams","adhocProgress","adhocService","$location","adhocTypes"],o.$inject=["$rootScope","$window","modalService","customerService","systemRole"]}(),function(){"use strict";function e(e){e.when("/milkrunTask/:id",{title:"Transaction job detail",category:"MilkrunTransactions",controller:"MilkRunTaskController",templateUrl:"app/components/milkrunTask/milkrunTasks.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"],preventViewOnly:!0})}function t(e,t,n,o,r,i,a,s,l,c,d){function u(){p(),m()}function m(){var e=n.id;k.isLoading=!0,r.getMilkRunTaskById(e).then(function(e){k.taskDetail=r.convertMilkrunTask(e.data),k.tasks=[{id:k.taskDetail.id,barcode:k.taskDetail.barcode}],JsBarcode("#barcode",k.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),k.taskDetail.frequency=d.convertFrequency(k.taskDetail),k.isLoading=!1,g()},function(){t.path("/accessDeny")})}function p(){var t=e.milkrunTransaction;return t?(k.isNextJob=t.currentIndex<t.listTransaction.length-1,void(k.isPrevious=t.currentIndex>0)):(k.isNextJob=!1,void(k.isPrevious=!1))}function g(){k.isReturn=k.taskDetail.status===l.deliverFailed.value,k.isReattempt=k.taskDetail.status===l.collectionFailed.value||k.taskDetail.status===l.deliverFailed.value}function f(n){var o=e.milkrunTransaction,r=o.currentIndex;r=n?r+1:r-1;var i=o.listTransaction[r];e.milkrunTransaction.currentIndex=r,t.path("/milkrunTask/"+i)}function v(e){var t={returnReattempt:h};k.dataReturnAttempt={isReturn:e},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:k.dataReturnAttempt},t)}function h(){k.isLoading=!0,k.dataReturnAttempt.id=k.taskDetail.id,k.dataReturnAttempt.barcode=k.taskDetail.barcode,r.returnOrReattemptTask(k.taskDetail.id,k.dataReturnAttempt).then(function(e){k.isLoading=!1;var t=k.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";i.success(t),m()})}function y(){var e={assignVendor:C};k.dataAssignVendor={},o.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:k.dataAssignVendor},e)}function C(){k.isLoading=!0,r.assignVendorMilkrun({vendorId:k.dataAssignVendor.vendor.id,targetIds:[k.taskDetail.id]}).then(function(e){m(),i.success("The Transaction has been assigned to vendor successfully."),k.isLoading=!1})}var k=this;k.systemRole=c,k.milkRunTypes=a,k.departments=s,k.taskStatus=l,k.assignVendor=y,k.returnReattempt=v,k.nextPrevious=f,k.checkReturnReattemptButton=g,k.loadTaskById=m,u()}angular.module("milkrunTask.module",["ngRoute"]).config(e).controller("MilkRunTaskController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","$routeParams","modalService","taskService","toastr","milkRunTypes","departments","taskStatus","systemRole","milkrunService"]}(),function(){"use strict";function e(e){e.when("/adhocTask/:id",{title:"Transaction job detail",category:"AdhocTransactions",controller:"AdhocTaskController",templateUrl:"app/components/adhocTask/adhocTasks.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"]})}function t(e,t,n,o,r,i,a,s,l,c,d){function u(){p(),m()}function m(){var e=t.id;T.isLoading=!0,r.getAdhocTaskById(e).then(function(e){T.taskDetail=r.convertAdhocTask(e.data),T.tasks=[{id:T.taskDetail.id,barcode:T.taskDetail.barcode}],JsBarcode("#barcode",T.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),T.isLoading=!1,g()},function(){n.path("/accessDeny")})}function p(){var t=e.adhocTransaction;return t?(T.isNextJob=t.currentIndex<t.listTransaction.length-1,void(T.isPrevious=t.currentIndex>0)):(T.isNextJob=!1,void(T.isPrevious=!1))}function g(){T.isReturn=T.taskDetail.status===s.deliverFailed.value,T.isReattempt=T.taskDetail.status===s.collectionFailed.value||T.taskDetail.status===s.deliverFailed.value}function f(e){var t={returnReattempt:v};T.dataReturnAttempt={isReturn:e},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:T.dataReturnAttempt},t)}function v(){T.isLoading=!0,T.dataReturnAttempt.id=T.taskDetail.id,T.dataReturnAttempt.barcode=T.taskDetail.barcode,r.returnOrReattemptTask(T.taskDetail.id,T.dataReturnAttempt).then(function(e){T.isLoading=!1;var t=T.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";i.success(t),m()})}function h(){T.isLoading=!0,c.getCustomerById(T.taskDetail.customerId).then(function(t){T.isLoading=!1;var n=y(t.data),r=e.currentUser.department===a.PSS.name?"app/components/customer/pricing/adhocPricingModal.html":"app/components/customer/pricing/healthCarePricingModal.html";o.createPopup({templateUrl:r,size:"lg",data:{ngModel:n,viewMode:!0}},{})})}function y(e){for(var t=0;t<e.pricings.length;t++)if(e.pricings[t].pricingType===l.Adhoc)return e.pricings[t];return null}function C(t){var o=e.adhocTransaction,r=o.currentIndex;r=t?r+1:r-1;var i=o.listTransaction[r];e.adhocTransaction.currentIndex=r,n.path("/adhocTask/"+i)}function k(){var e={assignVendor:P};T.dataAssignVendor={},o.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",
size:"lg",data:T.dataAssignVendor},e)}function P(){T.isLoading=!0,r.assignVendorAdhoc({vendorId:T.dataAssignVendor.vendor.id,targetIds:[T.taskDetail.id]}).then(function(e){m(),i.success("The Transaction has been assigned to vendor successfully."),T.isLoading=!1})}var T=this;T.departments=a,T.systemRole=d,T.taskStatus=s,T.assignVendor=k,T.nextPrevious=C,T.viewPricing=h,T.returnReattempt=f,T.checkReturnReattemptButton=g,T.loadTaskById=m,u()}angular.module("adhocTask.module",["ngRoute"]).config(e).controller("AdhocTaskController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$routeParams","$location","modalService","taskService","toastr","departments","taskStatus","pricingType","customerService","systemRole"]}(),function(){"use strict";function e(e){e.when("/vendor/adhocs",{title:"Vendor Ad hoc Jobs",category:"AdhocVendor",controller:"VendorAdhocTaskController",templateUrl:"app/components/vendorAdhoc/vendorTasks.html",controllerAs:"vm",authorize:["Vendor"]}).when("/vendor/adhocTask/:id",{title:"Vendor Adhoc Job Detail",category:"AdhocVendor",controller:"VendorAdhocTaskDetailController",templateUrl:"app/components/vendorAdhoc/vendorTaskDetail.html",controllerAs:"vm",authorize:["Vendor"]})}function t(e,t,n,o,r,i,a,s,l){function c(){d(),p()}function d(){D.options={itemPerPage:20,currentPage:1,customer:"",driver:"",status:"",requestType:""},D.statuses=T(n),m(),u()}function u(){l.getCustomerByCriteria({sortColumn:"name",sortAscending:!0}).then(function(e){D.customers=l.convertListCustomerDropDownList(e.data.customers)})}function m(){s.getDriverByCriteria({sortColumn:"name",sortAscending:!0}).then(function(e){D.drivers=s.convertListVendorDropDownList(e.data.users)})}function p(){D.isLoading=!0,i.getAdhocTaskByCriteria(D.options).then(function(e){D.listJob=i.convertListAdhocTask(e.data.jobTasks),D.options.totalItems=e.data.totalCount,D.isLoading=!1,D.listAssignTransaction=[]})}function g(){if(D.listAssignTransaction.length){var e={assignDriver:f};D.dataAssignDriver={},r.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:D.dataAssignDriver},e)}}function f(){D.isLoading=!0,i.assignDriverAdhoc({driverId:D.dataAssignDriver.driver.id,taskIds:D.listAssignTransaction}).then(function(e){angular.forEach(D.listJob,function(e){D.listAssignTransaction.indexOf(e.id)>=0&&(e.driverName=D.dataAssignDriver.driver.name)}),a.success("The selected transactions have been assigned to driver successfully."),D.listAssignTransaction=[],D.isCheckAll=!1,D.isLoading=!1})}function v(e){h(e),t.path("/vendor/adhocTask/"+e)}function h(t){var n=[];angular.forEach(D.listJob,function(e){n.push(e.id)}),e.vendorAdhocTransaction={listTransaction:n,currentIndex:n.indexOf(t)}}function y(){D.isCheckAll?P():D.listAssignTransaction=[]}function C(e,t){e.stopPropagation(),D.isCheckAll=!1;for(var n=!1,o=0;o<D.listAssignTransaction.length;o++)if(D.listAssignTransaction[o]==t)return n=!0,void D.listAssignTransaction.splice(o,1);D.listAssignTransaction.push(t)}function k(e){for(var t=0;t<D.listAssignTransaction.length;t++)if(D.listAssignTransaction[t]==e)return!0;return!1}function P(){D.listAssignTransaction=[],angular.forEach(D.listJob,function(e){e.status!=D.taskStatus.delivered.value&&D.listAssignTransaction.push(e.id)})}function T(e){var t=[{value:"",text:"All"}];for(var n in e)t.push({value:e[n].value,text:e[n].display});return t}function b(e,t){e.preventDefault(),e.stopPropagation(),t.status!=D.taskStatus.delivered.value&&(C(e,t.id),k(t.id))}function A(){var e=[];return angular.forEach(D.listJob,function(t){D.listAssignTransaction.indexOf(t.id)>-1&&e.push({id:t.id,barcode:t.barcode})}),e}var D=this;D.setItemPerPage=o,D.taskStatus=n,D.getTaskByCriteria=p,D.listAssignTransaction=[],D.checkAllChange=y,D.bindingCheck=k,D.onCheckTransaction=C,D.assignDriver=g,D.goToDetailPage=v,D.preventClick=b,D.getListTransactionId=A,c()}function n(e,t,n,o,r,i,a,s){function l(){c(),d()}function c(){var e=t.id;y.isLoading=!0,r.getAdhocTaskById(e).then(function(e){y.taskDetail=r.convertAdhocTask(e.data),y.tasks=[{id:y.taskDetail.id,barcode:y.taskDetail.barcode}],JsBarcode("#barcode",y.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),y.isLoading=!1,h()},function(){n.path("/accessDeny")})}function d(){var t=e.vendorAdhocTransaction;return t?(y.isNextJob=t.currentIndex<t.listTransaction.length-1,void(y.isPrevious=t.currentIndex>0)):(y.isNextJob=!1,void(y.isPrevious=!1))}function u(){y.isLoading=!0,r.updateTask(y.taskDetail.id,{barcode:y.taskDetail.barcode,vendorNotes:y.taskDetail.vendorRemarks}).then(function(e){y.isLoading=!1,y.isEditVendorRemark=!1,a.success("Update vendor remark successfully.")})}function m(){var e={assignDriver:p};y.dataAssignDriver={isReassign:!!y.taskDetail.driverName},o.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:y.dataAssignDriver},e)}function p(){y.isLoading=!0,r.assignDriverAdhoc({driverId:y.dataAssignDriver.driver.id,taskIds:[y.taskDetail.id],remark:y.dataAssignDriver.remark}).then(function(e){a.success("The transactions have been assigned to driver successfully."),c()})}function g(e){var t={returnReattempt:v};y.dataReturnAttempt={isReturn:e},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:y.dataReturnAttempt},t)}function f(t){var o=e.vendorAdhocTransaction,r=o.currentIndex;r=t?r+1:r-1;var i=o.listTransaction[r];e.vendorAdhocTransaction.currentIndex=r,n.path("/vendor/adhocTask/"+i)}function v(){y.isLoading=!0,y.dataReturnAttempt.id=y.taskDetail.id,y.dataReturnAttempt.barcode=y.taskDetail.barcode,r.returnOrReattemptTask(y.taskDetail.id,y.dataReturnAttempt).then(function(e){y.isLoading=!1;var t=y.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";a.success(t),c()})}function h(){y.isReturn=y.taskDetail.status===s.deliverFailed.value,y.isReattempt=y.taskDetail.status===s.collectionFailed.value||y.taskDetail.status===s.deliverFailed.value}var y=this;y.departments=i,y.taskStatus=s,y.assignDriver=m,y.updateVendorRemark=u,y.returnReattempt=g,y.nextPrevious=f,y.loadTaskById=c,l()}angular.module("vendorAdhoc.module",["ngRoute"]).config(e).controller("VendorAdhocTaskController",t).controller("VendorAdhocTaskDetailController",n),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","taskStatus","setItemPerPage","modalService","taskService","toastr","driverService","customerService"],n.$inject=["$rootScope","$routeParams","$location","modalService","taskService","departments","toastr","taskStatus"]}(),function(){"use strict";function e(e){e.when("/vendor/milkruns",{title:"Vendor Fixed run Jobs",category:"MilkrunVendor",controller:"VendorMilkrunTaskController",templateUrl:"app/components/vendorMilkrun/vendorTasks.html",controllerAs:"vm",authorize:["Vendor"]}).when("/vendor/milkrunTask/:id",{title:"Vendor Adhoc Job Detail",category:"MilkrunVendor",controller:"VendorMilkrunTaskDetailController",templateUrl:"app/components/vendorMilkrun/vendorTaskDetail.html",controllerAs:"vm",authorize:["Vendor"]})}function t(e,t,n,o,r,i,a,s,l){function c(){d(),p()}function d(){D.options={itemPerPage:20,currentPage:1,customer:"",driver:"",status:"",requestType:""},D.statuses=T(n),m(),u()}function u(){l.getCustomerByCriteria({sortColumn:"name",sortAscending:!0}).then(function(e){D.customers=l.convertListCustomerDropDownList(e.data.customers)})}function m(){s.getDriverByCriteria({sortColumn:"name",sortAscending:!0}).then(function(e){D.drivers=s.convertListVendorDropDownList(e.data.users)})}function p(){D.isLoading=!0,i.getMilkRunTaskByCriteria(D.options).then(function(e){D.listJob=i.convertListMilkRunTask(e.data.milkRunTasks),D.options.totalItems=e.data.totalCount,D.isLoading=!1,D.listAssignTransaction=[]})}function g(){if(D.listAssignTransaction.length){var e={assignDriver:f};D.dataAssignDriver={},r.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:D.dataAssignDriver},e)}}function f(){D.isLoading=!0,i.assignDriverMilkrun({driverId:D.dataAssignDriver.driver.id,taskIds:D.listAssignTransaction}).then(function(e){angular.forEach(D.listJob,function(e){D.listAssignTransaction.indexOf(e.id)>=0&&(e.driverName=D.dataAssignDriver.driver.name)}),a.success("The selected transactions have been assigned to driver successfully."),D.listAssignTransaction=[],D.isCheckAll=!1,D.isLoading=!1})}function v(e){h(e),t.path("/vendor/milkrunTask/"+e)}function h(t){var n=[];angular.forEach(D.listJob,function(e){n.push(e.id)}),e.vendorMilkrunTransaction={listTransaction:n,currentIndex:n.indexOf(t)}}function y(){D.isCheckAll?P():D.listAssignTransaction=[]}function C(e,t){e.stopPropagation(),D.isCheckAll=!1;for(var n=!1,o=0;o<D.listAssignTransaction.length;o++)if(D.listAssignTransaction[o]==t)return n=!0,void D.listAssignTransaction.splice(o,1);D.listAssignTransaction.push(t)}function k(e){for(var t=0;t<D.listAssignTransaction.length;t++)if(D.listAssignTransaction[t]==e)return!0;return!1}function P(){D.listAssignTransaction=[],angular.forEach(D.listJob,function(e){e.status!=D.taskStatus.delivered.value&&D.listAssignTransaction.push(e.id)})}function T(e){var t=[{value:"",text:"All"}];for(var n in e)t.push({value:e[n].value,text:e[n].display});return t}function b(e,t){e.preventDefault(),e.stopPropagation(),t.status!=D.taskStatus.delivered.value&&(C(e,t.id),k(t.id))}function A(){var e=[];return angular.forEach(D.listJob,function(t){D.listAssignTransaction.indexOf(t.id)>-1&&e.push({id:t.id,barcode:t.barcode})}),e}var D=this;D.setItemPerPage=o,D.taskStatus=n,D.getTaskByCriteria=p,D.listAssignTransaction=[],D.checkAllChange=y,D.bindingCheck=k,D.onCheckTransaction=C,D.assignDriver=g,D.goToDetailPage=v,D.preventClick=b,D.getListTransactionId=A,c()}function n(e,t,n,o,r,i,a,s){function l(){c(),d()}function c(){var e=t.id;y.isLoading=!0,r.getMilkRunTaskById(e).then(function(e){y.taskDetail=r.convertMilkrunTask(e.data),y.tasks=[{id:y.taskDetail.id,barcode:y.taskDetail.barcode}],JsBarcode("#barcode",y.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),y.isLoading=!1,h()},function(){n.path("/accessDeny")})}function d(){var t=e.vendorMilkrunTransaction;return t?(y.isNextJob=t.currentIndex<t.listTransaction.length-1,void(y.isPrevious=t.currentIndex>0)):(y.isNextJob=!1,void(y.isPrevious=!1))}function u(){y.isLoading=!0,r.updateTask(y.taskDetail.id,{barcode:y.taskDetail.barcode,vendorNotes:y.taskDetail.vendorRemarks}).then(function(e){y.isLoading=!1,y.isEditVendorRemark=!1,a.success("Update vendor remark successfully.")})}function m(){var e={assignDriver:p};y.dataAssignDriver={isReassign:!!y.taskDetail.driverName},o.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:y.dataAssignDriver},e)}function p(){y.isLoading=!0,r.assignDriverMilkrun({driverId:y.dataAssignDriver.driver.id,taskIds:[y.taskDetail.id],remark:y.dataAssignDriver.remark}).then(function(e){a.success("The transactions have been assigned to driver successfully."),c()})}function g(e){var t={returnReattempt:v};y.dataReturnAttempt={isReturn:e},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:y.dataReturnAttempt},t)}function f(t){var o=e.vendorMilkrunTransaction,r=o.currentIndex;r=t?r+1:r-1;var i=o.listTransaction[r];e.vendorMilkrunTransaction.currentIndex=r,n.path("/vendor/milkrunTask/"+i)}function v(){y.isLoading=!0,y.dataReturnAttempt.id=y.taskDetail.id,y.dataReturnAttempt.barcode=y.taskDetail.barcode,r.returnOrReattemptTask(y.taskDetail.id,y.dataReturnAttempt).then(function(e){y.isLoading=!1;var t=y.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";a.success(t),c()})}function h(){y.isReturn=y.taskDetail.status===s.deliverFailed.value,y.isReattempt=y.taskDetail.status===s.collectionFailed.value||y.taskDetail.status===s.deliverFailed.value}var y=this;y.departments=i,y.taskStatus=s,y.assignDriver=m,y.updateVendorRemark=u,y.returnReattempt=g,y.nextPrevious=f,y.loadTaskById=c,l()}angular.module("vendorMilkrun.module",["ngRoute"]).config(e).controller("VendorMilkrunTaskController",t).controller("VendorMilkrunTaskDetailController",n),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","taskStatus","setItemPerPage","modalService","taskService","toastr","driverService","customerService"],n.$inject=["$rootScope","$routeParams","$location","modalService","taskService","departments","toastr","taskStatus"]}(),function(){"use strict";function e(e,t){e.when("/drivers",{title:"Vendor Ad hoc Jobs",category:"Drivers",controller:"DriverManagementController",templateUrl:"app/components/driver/drivers.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.Vendor]}).when("/driver/create",{title:"Create New Driver",category:"Drivers",controller:"DriverDetailController",templateUrl:"app/components/driver/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.Vendor]}).when("/driver/detail/:id",{title:"Driver Detail",category:"Drivers",controller:"DriverDetailController",templateUrl:"app/components/driver/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.Vendor]})}function t(e,t,n,o,r){function i(){a(),s()}function a(){c.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",department:"",driverType:""};var e=[{name:"name",display:"Name",columnNameSort:"name"},{name:"userId",display:"User ID",columnNameSort:"userName"},{name:"phoneNumber",display:"Contact no",columnNameSort:"phoneNumber"},{name:"department",display:"Department",preventSort:!0},{name:"permission",display:"Permission",preventSort:!0},{name:"status",display:"Status",preventSort:!0}];o.currentUser.role!==n.SuperAdmin&&e.splice(3,1),c.gridConfig={onClickRowDetail:l,columns:e}}function s(){c.isGridLoading=!0,t.getDriverByCriteria(c.options).then(function(e){c.options.totalItems=e.data.totalCount,c.drivers=t.convertListDriver(e.data.users),c.isGridLoading=!1})}function l(t){e.path("/driver/detail/"+t.id)}var c=this;c.systemRole=n,c.departments=[{id:"",name:"All"},r.PSS,r.Healthcare],c.driverTypes=[{id:"",name:"All"},{id:1,name:"Internal Driver"},{id:2,name:"Vendor Driver"}],c.getDriverByCriteria=s,i()}function n(e,t,n,o,r,i,a,s){function l(){var n=t.id;n&&(p.isLoading=!0,e.getDriverById(n).then(function(e){p.driverDetail=e.data,p.isLoading=!1}),p.viewMode=!0)}function c(){p.driverDetail.IsInternalDriver=!0,p.isSaving=!0,e.saveDriver(p.driverDetail).then(function(e){p.isSaving=!1;var t=p.driverDetail.id?"The driver has been updated successfully.":"The driver has been created successfully.";n.success(t),o.path("/drivers")},function(e){p.isSaving=!1;var t=e.data.message;n.error(t)})}function d(){var e=p.driverDetail.lockoutEnabled?"Are you sure you want to activate this driver?":"Are you sure you want to deactivate this driver?";r.createWarningPopup(e,"Warning",u)}function u(){e.activateOrDeactivate(p.driverDetail).then(function(e){var t=p.driverDetail.lockoutEnabled?"The driver has been activated successfully.":"The driver has been deactivated successfully.";p.driverDetail.lockoutEnabled=!p.driverDetail.lockoutEnabled,n.success(t)})}function m(){p.driverChangePassword={userId:t.id};var o={updatePassword:function(){p.isLoading=!0,e.updatePassword(p.driverChangePassword).then(function(e){p.isLoading=!1,n.success("The password has been updated successfully.")},function(){n.error("There is an error when sending the update password."),p.isLoading=!1})}};r.createPopup({templateUrl:"app/components/driver/resetPasswordModal.html",size:"lg",data:{detail:p.driverChangePassword}},o)}var p=this;p.systemRole=s,p.save=c,p.activateOrDeactivate=d,p.changePassword=m,p.departments=[{id:void 0,name:"Please select ..."},a.PSS,a.Healthcare],l()}angular.module("driver.module",["ngRoute"]).config(e).controller("DriverManagementController",t).controller("DriverDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$location","driverService","systemRole","$rootScope","departments"],n.$inject=["driverService","$routeParams","toastr","$location","modalService","authService","departments","systemRole"]}(),function(){"use strict";function e(e){e.when("/accessDeny",{title:"Access Deny",controller:"AccessDenyController",templateUrl:"app/components/accessDeny/accessDeny.html",controllerAs:"vm",hideHeader:!0,hideFooter:!0})}function t(e,t,n){function o(){if(!n.isAuthenticated())return void e.path("/login");var o=n.getCurrentUser();e.path("/"+t[o.role].defaultRoute)}var r=this;r.back=o}angular.module("accessDeny.module",["ngRoute"]).config(e).controller("AccessDenyController",t),e.$inject=["$routeProvider"],t.$inject=["$location","systemRolesConfigs","authService"]}(),function(){"use strict";function e(e,t,n,o){function r(){return!!l()}function i(e){var t=l();return!!(t&&e.indexOf(t.role)>-1)}function a(r,i){var a=t.defer(),s=o.serviceUrl+"/api/account/token",l={username:r,password:i};return e.post(s,l).then(function(e){var t={access_token:e.data.accessToken,token_type:e.data.tokenType,expired_at:(new Date).getTime()+1e3*parseInt(e.data.expiresIn)},o={id:e.data.id,email:e.data.email,role:e.data.role,department:e.data.department,customerId:e.data.customerId,firstName:e.data.firstName,lastName:e.data.lastName,viewOnly:e.data.viewOnly};n.set("tokenInfo",t),n.set("userInfo",o),a.resolve(o)},function(e){a.reject(e)}),a.promise}function s(){n.remove("tokenInfo"),n.remove("userInfo")}function l(){return n.get("userInfo")}function c(){var e=n.get("tokenInfo"),t=(new Date).getTime();return t>e.expired_at?null:e}function d(t){var n=o.serviceUrl+"/api/account/resetpassword";return e.post(n,t)}function u(t){var n=o.serviceUrl+"/api/account/forgetpassword",r={email:t};return e.post(n,r)}var m={isAuthenticated:r,isAuthorized:i,login:a,logout:s,getCurrentUser:l,resetPassword:u,confirmResetPassword:d,getToken:c};return m}angular.module("main.module").factory("authService",e),e.$inject=["$http","$q","localStorageService","systemSetting"]}(),function(){"use strict";function e(e){function t(t,n,o){var r=e.open({animation:!0,templateUrl:t.templateUrl,controller:"ModalInstanceCtrl",controllerAs:"vm",size:t.size,backdrop:"static",resolve:{data:function(){return t.data},readOnly:function(){return t.readOnly}}});r.result.then(function(e){n[e]()},o)}function n(t,n,o,r,i){var a=e.open({animation:!0,templateUrl:"app/directives/commonControls/warningModal/warningModal.html",controller:"ModalInstanceCtrl",controllerAs:"vm",backdrop:"static",resolve:{data:function(){return{message:t,title:n,isHideActionButton:r,dismissText:i}}}});a.result.then(function(e){o&&o()})}var o={createPopup:t,createWarningPopup:n};return o}angular.module("main.module").factory("modalService",e),e.$inject=["$uibModal"]}(),function(){"use strict";function e(e,t,n){function o(e){e.headers=e.headers||{};var n=t.get("tokenInfo");return n&&(e.headers.Authorization=n.token_type+" "+n.access_token),e}function r(o){return 401===o.status&&(t.remove("tokenInfo"),t.remove("userInfo"),n.path("/accessDeny")),e.reject(o)}var i={request:o,responseError:r};return i}angular.module("main.module").factory("httpInterceptor",e),e.$inject=["$q","localStorageService","$location"]}(),function(){"use strict";function e(e,t){function n(t){return t.id?e.put(s+t.id,t):e.post(s,t)}function o(t){var n=s+"?offset="+(t.currentPage-1)*t.itemPerPage;return n+="&limit="+t.itemPerPage,t.searchTerm&&(n+="&search="+t.searchTerm),t.department&&(n+="&departmentId="+t.department),t.sortColumn&&(n+="&sortBy="+t.sortColumn,n+="&ascending="+t.sortAscending),e.get(n)}function r(t){return e.get(s+t)}function i(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(s+n+t.id)}function a(t){return e.post(s+"userExists",{email:t})}var s=t.serviceUrl+"/api/adminusers/",l={saveAdminUser:n,getAdminUserByCriteria:o,getAdminUserById:r,activateOrDeactivate:i,checkEmailExist:a};return l}angular.module("main.module").factory("adminUserService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n,o,r){function i(t){var n=f;return t=t||{},t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||r,"object"==typeof t&&Object.keys(t).length>0&&(n+="?offset="+(t.currentPage-1)*t.itemPerPage,n+="&limit="+t.itemPerPage,t.searchTerm&&(n+="&search="+t.searchTerm),t.sortColumn&&(n+="&sortBy="+t.sortColumn,n+="&ascending="+t.sortAscending)),e.get(n)}function a(t){return e.get(f+t)}function s(t){return t.id?e.put(f+t.id,t):e.post(f,t)}function l(t){return t.id?e.put(f+"UpdateSAPCode/"+t.id,t):e.post(f+"CreateSAPCode",t)}function c(t){return t.number=t.detailName,t.id?e.put(f+"UpdatePONumber/"+t.id,t):e.post(f+"CreatePONumber",t)}function d(t){return t.name=t.detailName,t.id?e.put(f+"UpdateCostCentre/"+t.id,t):e.post(f+"CreateCostCentre",t)}function u(e){return e.map(function(e){return{id:e.id,organizationCode:e.organizationCode,name:e.name,clientType:e.department.name,address:e.address?e.address.blockNumber+" "+e.address.streetName+" "+e.address.unitNumber+" "+e.address.postalCode:"",sapCodesText:e.sapCodesText}})}function m(e){var t=[{id:"",name:"All"}];return angular.forEach(e,function(e){t.push({id:e.id,name:e.organizationCode+" "+e.name})}),t}function p(e){return{id:e.id,name:e.name,organizationCode:e.organizationCode,sapCode:e.sapCode,contactPerson:e.contactPerson,contactNumber:e.contactNumber,contractEndDate:o.convertDate(e.contractEndDate),cutOffTimeForSameDayPickupAndDelivery:o.convertDate(e.cutOffTimeForSameDayPickupAndDelivery),cutOffTimeForSameDayPickupAndNextDayDelivery:o.convertDate(e.cutOffTimeForSameDayPickupAndNextDayDelivery),address:e.address,department:e.department,clientTypeId:e.department.id,users:e.applicationUsers,pricings:e.pricings,sapCodes:e.sapCodes,poNumbers:e.poNumbers,costCentres:e.costCentres}}function g(e){var n=t.defer();return a(e).then(function(e){var t=o.convertDate(e.data.contractEndDate);t.setHours(0,0,0,0);var r=new Date;r.setHours(0,0,0,0),t<r?n.resolve(!0):n.resolve(!1)}),n.promise}var f=n.serviceUrl+"/api/customers/",v={getCustomerByCriteria:i,getCustomerById:a,saveCustomer:s,convertListCustomer:u,convertCustomer:p,convertListCustomerDropDownList:m,checkContractExpire:g,saveSapCode:l,savePoNumber:c,saveCostCenter:d};return v}angular.module("main.module").factory("customerService",e),e.$inject=["$http","$q","systemSetting","utilityService","maxNumberOfRecord"]}(),function(){"use strict";function e(e,t,n){function o(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var o=d+"?offset="+(t.currentPage-1)*t.itemPerPage;return o+="&limit="+t.itemPerPage,t.searchTerm&&(o+="&search="+t.searchTerm),t.department&&(o+="&departmentId="+t.department),t.organizationCode&&(o+="&organizationCode="+t.organizationCode),t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending),e.get(o)}function r(t){return e.get(d+t)}function i(t){return t.id?e.put(d+t.id,t):e.post(d,t)}function a(t){return e.put(d+t.id,t)}function s(e){return e.map(function(e){return{id:e.id,customerId:e.customerId,name:e.firstName+" "+e.lastName,email:e.email,phoneNumber:e.phoneNumber,costCentres:e.costCentres,sapCode:e.sapCode,organizationCode:e.organizationCode,status:e.lockoutEnabled?"Inactive":"Active"}})}function l(t){return e.post(d+"userExists",{email:t})}function c(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(d+n+t.id)}var d=t.serviceUrl+"/api/users/",u={getClientUserByCriteria:o,getClientUserById:r,convertListUser:s,updateClientUser:a,checkEmailExist:l,activateOrDeactivate:c,saveUser:i};return u}angular.module("main.module").factory("clientUserService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord"]}(),function(){"use strict";function e(e,t){function n(t){return e.get(r+t)}function o(){return e.get(r)}var r=t.serviceUrl+"/api/location/",i={getLocations:o,getLocationByPostalCode:n};return i}angular.module("main.module").factory("locationService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s,l,c){function d(n){var o=w+"?offset="+(n.currentPage-1)*n.itemPerPage;return o+="&limit="+n.itemPerPage,n.status&&(o+="&status="+n.status),""!==n.requestType&&(o+="&requestType="+n.requestType),n.dateFrom&&(o+="&fromCreatedDate="+t("date")(n.dateFrom,"yyyy-MM-dd")),n.dateTo&&(o+="&toCreatedDate="+t("date")(n.dateTo,"yyyy-MM-dd")),n.requestType&&(o+="&requestType="+n.requestType),n.searchTerm&&(o+="&search="+n.searchTerm),n.customer&&(o+="&customerId="+n.customer),e.get(o)}function u(t){return e.get(w+t)}function m(t){return t.id?e.put(w+t.id,t):e.post(w,t)}function p(t){return e.post(w+"assignvendor",t)}function g(t,n){return e.post(w+t+"/approve",n)}function f(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,customer:e.organizationCode+" - "+e.customerName,createdDate:e.requestDate,collectionPoints:h(e.collectionPoints,e.id),deliveryPoints:h(e.deliveryPoints,e.id),frequency:v(e,!0),status:y(e.jobStatus),createdBy:e.createdBy})}),t}function v(e,n){var a="";for(var s in o)if(o[s].value==e.milkRunFrequency){a+=o[s].display;break}if(e.milkRunFrequency===o.weekly.value){var l="";angular.forEach(e.days,function(e){for(var t in r)if(r[t].value===e){l+=r[t].display+", ";break}}),l=l.substring(0,l.length-2),a+=" ("+l+")"}var c="";return angular.forEach(e.additionals,function(e){for(var t in i)if(i[t].value===e){c+=i[t].display+", ";break}}),c&&(c=c.substring(0,c.length-2),a+=", "+c),!n&&e.milkRunFrequency===o.projectRun.value&&e.projectRunDate&&(a+=" ("+t("date")(e.projectRunDate,"dd/MM/yyyy")+")"),a}function h(e,t){var n,o="",r="";return e.length>U?(n=[e[0],e[1],e[2]],r='<a href="#milkrun/detail/'+t+'"> ... and '+(e.length-U)+" more<a/>"):n=e,angular.forEach(n,function(e){e.address&&(o+="<p>"+e.address.blockNumber+" "+e.address.streetName+" "+e.address.unitNumber+" "+e.address.postalCode+"</p>")}),o+r}function y(e){for(var t in s)if(s[t].value===e)return s[t].display;return""}function C(e){return{id:e.id,clientId:e.customerId,organizationCode:e.organizationCode,clientName:e.organizationCode+" "+e.customerName,requesterId:e.requesterId,requester:e.requesterName,costCenter:e.costCenter,requestDate:c.convertDate(e.requestDate),milkRunType:e.milkRunType,milkRunFrequency:e.milkRunFrequency,days:e.days,additionals:e.additionals,collectionPoints:k(e.collectionPoints),deliveryPoints:k(e.deliveryPoints),remarks:e.remarks,privateRemark:e.privateRemark,totalPrice:e.totalPrice,jobStatus:e.jobStatus,projectRunDate:c.convertDate(e.projectRunDate),frequency:v(e),createdBy:e.createdBy}}function k(e){return angular.forEach(e,function(e){angular.forEach(e.items,function(e){e.milkRunWeightId=e.milkRunWeight.id})}),e}function P(e){e.milkRunType==l.manyToOne&&T(e.deliveryPoints)&&b(e),e.milkRunType!=l.manyToOne&&T(e.collectionPoints)&&b(e)}function T(e){return!!(e&&e[0]&&e[0].items&&e[0].items.length>0)}function b(e){var t=e.collectionPoints;e.collectionPoints=e.deliveryPoints,e.deliveryPoints=t}function A(e){var t=[],n=e.split(/\r\n|\n/);if(n&&n.length>1)for(var o=1;o<n.length;o++)if(n[o]){var r=n[o].split(","),i=((new Date).getTime()+o).toString(),a=i.substr(-2,3);t.push({id:a+o,address:{postalCode:r[0],blockNumber:r[1],streetName:r[2],unitNumber:r[3]},name:r[4],contactNumber:r[5],items:[{milkRunWeightId:M(r[6]),quantity:isNaN(r[7])?"":parseInt(r[7])}],isInValid:D(r)})}return t}function D(e){if(!e[0]||!e[1]||!e[2]||!e[3]||!e[4]||!e[5]||isNaN(e[7]))return!0;for(var t in a)if(e[6]==a[t].textImport)return!1;return!0}function M(e){for(var t in a)if(e==a[t].textImport)return a[t].id;return 0}function S(e){if(!e||0===e.length)return!1;for(var t=0;t<e.length;t++)if(e[t].isInValid)return!1;return!0}function R(e,t){e.totalPrice=t.totalPrice;for(var n=0;n<e.collectionPoints.length;n++)e.collectionPoints[n].subTotalPrice=t.collectionPoints[n].subTotalPrice;for(var o=0;o<e.deliveryPoints.length;o++)e.deliveryPoints[o].subTotalPrice=t.deliveryPoints[o].subTotalPrice}var w=n.serviceUrl+"/api/milkrun/",U=3,I={getMilkRunByCriteria:d,getMilkRunById:u,saveMilkRun:m,assignVendor:p,convertListMilkRun:f,convertMilkRun:C,rejectApproveMilkRun:g,switchCollectionDeliveryPoint:P,getMilkRunPointsFromText:A,checkValidCollectionPoints:S,transferPricing:R,convertFrequency:v};return I}angular.module("main.module").factory("milkrunService",e),e.$inject=["$http","$filter","systemSetting","milkRunFrequency","days","milkRunAdditionals","milkRunWeight","jobStatusType","milkRunTypes","utilityService"]}(),function(){"use strict";function e(e){function t(t,n){var o=e.defer(),i=r(o,n);return i.readAsText(t),o.promise}function n(e){var t,n,r,i=o({data:e.data});null!=i&&(n=e.filename||"export.csv",i.match(/^data:text\/csv/i)||(i="data:text/csv;charset=utf-8,"+i),t=encodeURI(i),r=document.createElement("a"),r.setAttribute("href",t),r.setAttribute("download",n),r.click())}function o(e){var t,n,o,r,i,a;return a=e.data||null,null!=a&&a.length?(r=e.columnDelimiter||",",i=e.lineDelimiter||"\n",o=Object.keys(a[0]),t="",t+=o.join(r),t+=i,a.forEach(function(e){n=0,o.forEach(function(o){n>0&&(t+=r),t+=e[o],n++}),t+=i}),t):null}function r(e,t){var n=new FileReader;return n.onload=i(n,e,t),n.onerror=a(n,e,t),n}function i(e,t,n){return function(){n.$apply(function(){t.resolve(e.result)})}}function a(e,t,n){return function(){n.$apply(function(){t.reject(e.result)})}}var s={readAsDataUrl:t,exportCsvFile:n};return s}angular.module("main.module").factory("fileReaderService",e),e.$inject=["$q"]}(),function(){"use strict";function e(e,t,n){function o(t){var o=r+"?offset="+(t.currentPage-1)*t.itemPerPage;return o+="&limit="+t.itemPerPage,t.dateFrom&&(o+="&dateFrom="+n("date")(t.dateFrom,"yyyy-MM-dd")),t.dateTo&&(o+="&dateTo="+n("date")(t.dateTo,"yyyy-MM-dd")),t.action&&(o+="&action="+t.action),t.role&&(o+="&role="+t.role),t.userSearch&&(o+="&userSearch="+t.userSearch),t.descriptionSearch&&(o+="&descriptionSearch="+t.descriptionSearch),t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending),e.get(o)}var r=t.serviceUrl+"/api/log/",i={getLogByCriteria:o};return i}angular.module("main.module").factory("logService",e),e.$inject=["$http","systemSetting","$filter"]}(),function(){"use strict";function e(e,t,n){function o(){var n=t.serviceUrl+"/api/location/getFile";e({method:"GET",url:n,responseType:"arraybuffer"}).success(function(e,t,n){n=n();var o="master_location.csv",r=n["content-type"],i=document.createElement("a");try{var a=new Blob([e],{type:r}),s=window.URL.createObjectURL(a);i.setAttribute("href",s),i.setAttribute("download",o);var l=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});i.dispatchEvent(l)}catch(e){console.warn(e)}},function(e){console.warn("fail to download"),console.warn(e)})}function r(){var n=t.serviceUrl+"/api/location/lastUpdate";return e.get(n)}function i(e,o){var r=t.serviceUrl+"/api/location/import";return n.upload({url:r,data:{file:e}})}var a={downloadFile:o,uploadFile:i,lastUpdate:r};return a}angular.module("main.module").factory("allLocationsService",e),e.$inject=["$http","systemSetting","Upload"]}(),function(){"use strict";function e(e,t,n){function o(t){return e.post(l+"calculate/milkrun",t)}function r(t){return t.customerId=t.clientId,t.costCentre=t.costCenter,e.post(l+"calculate/adhoc",t)}function i(e,t){e.totalPrice=t.totalPrice,e.surchargeAmount=t.surchargeAmount,a(e.collectionPoints,t.collectionPoints),a(e.deliveryPoints,t.deliveryPoints),s(e,t)}function a(e,t){for(var n=0;n<e.length;n++)e[n].chargeableWeight=t[n].chargeableWeight,e[n].subTotalPrice=t[n].subTotalPrice}function s(e,t){if(e.jobType==n.manyToOne){for(var o=0,r=0;r<t.collectionPoints.length;r++)o+=t.collectionPoints[r].chargeableWeight;e.totalChargeableWeight=o}}var l=t.serviceUrl+"/api/pricing/",c={calculateMilkRun:o,calculateAdhoc:r,transferAdhocPricing:i};return c}angular.module("main.module").factory("pricingService",e),e.$inject=["$http","systemSetting","adhocTypes"]}(),function(){"use strict";
function e(e,t,n){function o(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var o={params:{offset:(t.currentPage-1)*t.itemPerPage,limit:t.itemPerPage}};return t.searchTerm&&(o.params.search=t.searchTerm),t.departmentId&&(o.params.departmentId=t.departmentId),t.organizationCode&&(o.params.organizationCode=t.organizationCode),t.sortColumn&&(o.params.sortBy=t.sortColumn,o.params.ascending=t.sortAscending),e.get(m,o)}function r(t){return e.get(m+t)}function i(t){return t.id?e.put(m+t.id,t):e.post(m,t)}function a(t){return e.post(m+"deactivate/"+t)}function s(t){return e.post(m+"activate/"+t)}function l(t){return e.post(m+"vendorExists",{email:t})}function c(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,organization:e.organization,organizationCode:e.organizationCode,contactPerson:e.contactPerson,phoneNumber:e.phoneNumber,alternativeContactPerson:e.alternativeContactPerson,alternativePhoneNumber:e.alternativePhoneNumber,workAddress:e.workAddress?e.workAddress.blockNumber+" "+e.workAddress.streetName+" "+e.workAddress.unitNumber+" "+e.workAddress.postalCode:"",status:e.lockoutEnabled?"Inactive":"Active"})}),t}function d(e){var t=[{id:"",organization:"All"}];return angular.forEach(e,function(e){t.push({id:e.id,organization:e.organizationCode+" "+e.organization})}),t}function u(e){var t={id:e.id,organization:e.organization,organizationCode:e.organizationCode,contactPerson:e.contactPerson,phoneNumber:e.phoneNumber,email:e.email,alternativeContactPerson:e.alternativeContactPerson,alternativePhoneNumber:e.alternativePhoneNumber,alternativeEmail:e.alternativeEmail,workAddress:e.workAddress,department:e.department,lockoutEnabled:e.lockoutEnabled};return t}function d(e){var t=[{id:"",name:"All"},{id:"Unassigned",name:"Unassigned"}];return angular.forEach(e,function(e){t.push({id:e.id,name:e.organization})}),t}var m=t.serviceUrl+"/api/vendors/",p={getVendorByCriteria:o,getVendorById:r,saveVendor:i,activateVendor:s,deactivateVendor:a,checkEmailExist:l,convertListVendor:c,convertVendor:u,convertListVendorDropDownList:d};return p}angular.module("main.module").factory("vendorService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord"]}(),function(){"use strict";function e(e,o,r,i,a,s,l){function c(){var t="//datamall2.mytransport.sg/ltaodataservice/TrafficIncidents",r=e.defer(),i=function(e){return _.chain(e).first(l.maxTickerItems).map(function(e){var t=e.Message.trim().split(/ (.+)?/);return{date:t[0].replace(")",") "),message:t[1]}}).value()};return s.isLocal?a(function(){r.resolve(i([{Message:"(16/11)14:24 Roadworks on Grange Road near Grange Road/Tanglin Road Junction."},{Message:"(16/11)14:10 Roadworks on Stevens Road (towards Bukit Timah Road) after Robin Close. Avoid right lane."},{Message:"(16/11)13:59 Roadworks on PIE (towards Changi Airport) after Kallang. Avoid lane 3."},{Message:"(16/11)13:56 Roadworks on AYE (towards Tuas) before Clementi Ave 2 Exit."},{Message:"(16/11)13:48 Roadworks on SLE (towards CTE) before Mandai Ave Exit with congestion till Woodlands Ave 12 Exit. Avoid lane 3."}]))},n.getRandomInt(100,1500)):o.get(t,{headers:{AccountKey:"z9/ibYLO05S7Cn8rgVyFQQ==","Content-Type":"application/json"}}).then(function(e){r.resolve(i(e.data.value))},function(e){console.warn(e)}),r.promise}function d(r,l,c){var d={params:{jobType:c}};if(r&&(d.params.fromCreatedDate=i("date")(new Date(r),s.simpleDateFormat)),l&&(d.params.toCreatedDate=i("date")(new Date(l),s.simpleDateFormat)),t&&s.isLocal){var u=e.defer();return a(function(){var e;1===n.usingSummaryCounts?(n.usingSummaryCounts=2,e=n.summaryCounts2):(n.usingSummaryCounts=1,e=n.summaryCounts),u.resolve({data:e})},n.getRandomInt(100,1500)),u.promise}return o.get(p+"summary",d)}function u(r,l){var c=e.defer(),d={params:{jobType:l,date:i("date")(r,s.simpleDateFormat)}},u=r.getFullYear()+"-"+(r.getMonth()+1);if("undefined"!=typeof f.daysOfMonthWithJobs&&"undefined"!=typeof f.daysOfMonthWithJobs[l]&&"undefined"!=typeof f.daysOfMonthWithJobs[l][u])return c.resolve(f.daysOfMonthWithJobs),c.promise;var m=function(e,t,n){return f.daysOfMonthWithJobs=f.daysOfMonthWithJobs||{},f.daysOfMonthWithJobs[e]=f.daysOfMonthWithJobs[e]||{},f.daysOfMonthWithJobs[e][t]=n,f.daysOfMonthWithJobs};return t&&s.isLocal?a(function(){c.resolve(m(l,u,n.daysWithJobs))},n.getRandomInt(100,1500)):o.get(p+"days",d).then(function(e){c.resolve(m(l,u,e.data))},function(e){console.warn(e)}),c.promise}function m(r,i,l){function c(e,t){t=t||[];var n,o,r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=[];if(t.length<12){for(0===t.length?n=(new Date).getMonth():(n=_.findIndex(r,function(e){return e===t[t.length-1].month})+1,n>r.length-1&&(n=0)),o=0;o<12-t.length;++o)o+n<12?i.push(r[n+o]):i.push(r[o-(12-n)]);t=_.map(i,function(e){return{month:e,amount:0}}).concat(t)}e.resolve({data:t})}var d=e.defer(),u={params:{jobType:r}};return"undefined"!=typeof i&&(u.params.customerId=i),"undefined"!=typeof l&&(u.params.costCentre=l),t&&s.isLocal?a(function(){var e;1===n.usingSpendings?(n.usingSpendings=2,e=n.spendings2):(n.usingSpendings=1,e=n.spendings),c(d,e)},n.getRandomInt(100,1500)):o.get(p+"spending",u).then(function(e){c(d,e.data)},function(e){console.warn(e)}),d.promise}var p=s.serviceUrl+"/api/dashboard/",g={getTrafficUpdates:c,getSummary:d,getDaysOfMonthWithJobs:u,getSpending:m},f={};return g}var t=!1,n={getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},usingSummaryCounts:1,summaryCounts:{approved:12,rejected:24,completed:103,scheduled:4},summaryCounts2:{approved:25,rejected:31,completed:82,scheduled:13},usingTodaysJobs:1,todaysJobs:[{collectionPointAddress:"Blk 393 Jurong Central Street 13 #13-27, S045631",deliveryPointAddress:"5 Clementi Loop, S889970",barcode:"834976531",status:"collected"},{collectionPointAddress:"Blk 393 Jurong Central Street 13 #13-27, S045631",deliveryPointAddress:"5 Clementi Loop, S889970",barcode:"834976531",status:"completed"},{collectionPointAddress:"Blk 393 Jurong Central Street 13 #13-27, S045631",deliveryPointAddress:"5 Clementi Loop, S889970",barcode:"834976531",status:"scheduled"}],todaysJobs2:[],daysWithJobs:[1,15,16,23,26],usingSpendings:1,spendings:[{month:"Nov",amount:600},{month:"Dec",amount:1e3},{month:"Jan",amount:1500},{month:"Feb",amount:1400},{month:"Mar",amount:2500},{month:"Apr",amount:3e3},{month:"May",amount:3500},{month:"Jun",amount:800},{month:"Jul",amount:2900},{month:"Aug",amount:4300},{month:"Sep",amount:1e3},{month:"Oct",amount:1300}],spendings2:[{month:"Nov",amount:2e3},{month:"Dec",amount:200},{month:"Jan",amount:3e3},{month:"Feb",amount:300},{month:"Mar",amount:1200},{month:"Apr",amount:2600},{month:"May",amount:6e3},{month:"Jun",amount:2800},{month:"Jul",amount:600},{month:"Aug",amount:1200},{month:"Sep",amount:3500},{month:"Oct",amount:1e3}]};angular.module("main.module").factory("dashboardService",e),e.$inject=["$q","$http","$location","$filter","$timeout","systemSetting","dashboardConst"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s,l){function c(t){var n=I+"?offset="+(t.currentPage-1)*t.itemPerPage;return n+="&limit="+t.itemPerPage,t.status&&(n+="&status="+t.status),t.dateFrom&&(n+="&fromCreatedDate="+a("date")(t.dateFrom,"yyyy-MM-dd")),t.dateTo&&(n+="&toCreatedDate="+a("date")(t.dateTo,"yyyy-MM-dd")),t.requestType&&(n+="&requestType="+t.requestType),t.searchTerm&&(n+="&search="+t.searchTerm),t.customer&&(n+="&customerId="+t.customer),e.get(n)}function d(t){return D(t),t.id?e.put(I+t.id,t):e.post(I,t)}function u(t){return e.get(I+t)}function m(t){return e.post(I+"assignvendor",t)}function p(t){return e.post(I+"updateStatus",t)}function g(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,customer:e.customer.organizationCode+" - "+e.customer.name,createdDate:e.requestDate,collectionPoints:U(e.collectionPoints,e.id),deliveryPoints:U(e.deliveryPoints,e.id),requestType:R(e.serviceType),status:w(e.jobStatus,i),createdBy:e.createdBy})}),t}function f(e){if(e.jobType==n.manyToOne){for(var t=0,o=0;o<e.collectionPoints.length;o++)t+=e.collectionPoints[o].chargeableWeight;e.totalChargeableWeight=t}return{id:e.id,clientId:e.customerId,clientName:e.customer.organizationCode+" - "+e.customer.name,requesterId:e.requesterId,requester:e.requester.firstName+" - "+e.requester.lastName,costCenter:e.costCentre,requestDate:l.convertDate(e.requestDate),serviceType:e.serviceType,serviceTypeName:R(e.serviceType),jobStatus:e.jobStatus,remark:e.remark,privateRemark:e.privateRemark,jobType:e.jobType,collectionPoints:S(e.collectionPoints),deliveryPoints:S(e.deliveryPoints),additionalCharges:e.additionalCharges,totalPrice:e.totalPrice,surCharge:e.surCharge,totalChargeableWeight:e.totalChargeableWeight,surcharges:e.surcharges,surchargeAmount:e.surchargeAmount,additionalSurcharges:h(e),createdBy:e.createdBy}}function v(e,t,n){angular.forEach(e,function(e){t&&e.collectionDate<t||n&&e.collectionDate.getTime()!=n.getTime()?e.isInValid=!0:e.isInValid=!1})}function h(e){if(!e||!e.surchargeAmount)return[];for(var t=[],n=0;n<e.surcharges.length;n++)e.surcharges[n]&&e.surchargeAmount[n]&&t.push({name:y(e.surcharges[n]),amount:e.surchargeAmount[n]});return t}function y(e){return e==s.nonworkingDay.value?s.nonworkingDay.display+":":s.weekdayEvening.display+":"}function C(e,t,n){var o=[],r=e.split(/\r\n|\n/);if(r&&r.length>1)for(var i=1;i<r.length;i++)if(r[i]){var a=r[i].split(",");a[6]&&(a[6]=P(a[6])),o.push({address:{postalCode:a[0],blockNumber:a[1],streetName:a[2],unitNumber:a[3]},name:a[4],contactNumber:a[5],collectionDate:new Date(angular.copy(a[6])),collectionTime:T(angular.copy(a[6])),isInValid:k(a,t,n)})}return o}function k(e,t,n){if(!e[0]||!e[1]||!e[2]||!e[3]||!e[4]||!e[5]||isNaN(Date.parse(e[6])))return!0;if(t&&new Date(e[6])<t)return!0;if(n){var o=new Date(e[6]);if(o.getDate()!=n.getDate()||o.getMonth()!=n.getMonth()||o.getFullYear()!=n.getFullYear())return!0}return!1}function P(e){var t=e.split("/");if(t.length<2)return e;var n=t[0];return t[0]=t[1],t[1]=n,t.join("/")}function T(e){return isNaN(Date.parse(e[6]))?null:new Date(e)}function b(e){A(e)}function A(e){var t=e.collectionPoints;e.collectionPoints=e.deliveryPoints,e.deliveryPoints=t}function D(e){e.customerId=e.clientId,e.costCentre=e.costCenter,M(e.collectionPoints),M(e.deliveryPoints)}function M(e){for(var t=0;t<e.length;t++)e[t].date=e[t].collectionDate}function S(e){for(var t=0;t<e.length;t++){var n=l.convertDate(e[t].date);e[t].collectionDate=angular.copy(n),e[t].collectionTime=angular.copy(n),e[t].date=angular.copy(n)}return e}function R(e){var t=w(e,o);return"N/A"==t&&(t=w(e,r)),t}function w(e,t){for(var n in t)if(t[n].value==e)return t[n].display;return"N/A"}function U(e,t){var n,o="",r="";return e.length>N?(n=[e[0],e[1],e[2]],r='<a href="#adhoc/detail/'+t+'"> ... and '+(e.length-N)+" more<a/>"):n=e,angular.forEach(n,function(e){e.address&&(o+="<p>"+e.address.blockNumber+" "+e.address.streetName+" "+e.address.unitNumber+" "+e.address.postalCode+"</p>")}),o+r}var I=t.serviceUrl+"/api/jobs/",N=3,j={getAdhocPointsFromText:C,getAdhocByCriteria:c,saveAdhoc:d,getAdhocById:u,assignVendor:m,switchCollectionDeliveryPoint:b,convertAdhoc:f,convertListAdhoc:g,rejectApproveAdhoc:p,getServiceType:R,getAdditionalSurcharge:h,validateDateOfPoint:v};return j}angular.module("main.module").factory("adhocService",e),e.$inject=["$http","systemSetting","adhocTypes","adhocPSSServiceType","adhocHealthCareServiceType","jobStatus","$filter","adHocSurcharge","utilityService"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s){function l(t){var o=R+"milkrun?offset="+(t.currentPage-1)*t.itemPerPage;return o+="&limit="+t.itemPerPage,""!==t.requestType&&(o+="&requestType="+t.requestType),t.jobDate&&(o+="&jobDate="+n("date")(t.jobDate,"yyyy-MM-dd")),t.status&&(o+="&status="+t.status),t.dateFrom&&(o+="&fromCreatedDate="+n("date")(t.dateFrom,"yyyy-MM-dd")),t.dateTo&&(o+="&toCreatedDate="+n("date")(t.dateTo,"yyyy-MM-dd")),t.searchTerm&&(o+="&search="+t.searchTerm),t.customer&&(o+="&customerId="+t.customer),t.vendor&&(o+="&vendorId="+t.vendor),t.driver&&(o+="&driverId="+t.driver),e.get(o)}function c(o){var r=R+"adhoc",i={params:{}};return o.currentPage&&o.itemPerPage&&(i.params.offset=(o.currentPage-1)*o.itemPerPage),o.itemPerPage&&(i.params.limit=o.itemPerPage),o.requestType&&(i.params.requestType=o.requestType),o.jobDate&&(i.params.jobDate=n("date")(o.jobDate,t.simpleDateFormat)),o.status&&(i.params.status=o.status),o.dateFrom&&(i.params.fromCreatedDate=n("date")(o.dateFrom,t.simpleDateFormat)),o.dateTo&&(i.params.toCreatedDate=n("date")(o.dateTo,t.simpleDateFormat)),o.searchTerm&&(i.params.search=o.searchTerm),o.customer&&(i.params.customerId=o.customer),o.vendor&&(i.params.vendorId=o.vendor),o.driver&&(i.params.driverId=o.driver),e.get(r,i)}function d(t){return e.get(R+"milkrun/"+t)}function u(t){return e.get(R+"adhoc/"+t)}function m(t){return e.post(R+"milkrun/assignvendor",t)}function p(t){return e.post(R+"adhoc/assignvendor",t)}function g(t){return e.post(R+"adhoc/assigndriver",t)}function f(t){return e.post(R+"milkrun/assigndriver",t)}function v(t,n){var o=n.isReturn?"/return":"/reattempt";return e.post(R+t+o,n)}function h(t,n){return e.post(R+"set/"+t,n)}function y(n){return e.get(t.serviceUrl+"/api/image?name="+n)}function C(t){return e.post(R+"/proof",t,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}function k(t,n){var o=n?R+"removepoc":R+"removepod";return e.post(o,t)}function P(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,barcode:e.barcode,customer:e.customer,createdDate:e.createdDate,jobDate:e.jobDate,status:e.status,statusText:S(e.status,o),frequency:a.convertFrequency(e),collectionPoints:e.collectionPointAddress.blockNumber+" "+e.collectionPointAddress.streetName+" "+e.collectionPointAddress.unitNumber+" "+e.collectionPointAddress.postalCode,deliveryPoints:e.deliveryPointAddress.blockNumber+" "+e.deliveryPointAddress.streetName+" "+e.deliveryPointAddress.unitNumber+" "+e.deliveryPointAddress.postalCode,vendorName:e.vendorName,driverName:e.driverName,createdBy:e.createdBy})}),t}function T(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,barcode:e.barcode,customer:e.customer,createdDate:e.createdDate,status:e.status,statusText:S(e.status,o),requestType:M(e.requestType),pickUpDate:e.pickUpDate,deliveryDate:e.deliveryDate,collectionPoint:e.collectionPointAddress.blockNumber+" "+e.collectionPointAddress.streetName+" "+e.collectionPointAddress.unitNumber+" "+e.collectionPointAddress.postalCode,deliveryPoint:e.deliveryPointAddress.blockNumber+" "+e.deliveryPointAddress.streetName+" "+e.deliveryPointAddress.unitNumber+" "+e.deliveryPointAddress.postalCode,vendorName:e.vendorName,driverName:e.driverName,createdBy:e.createdBy})}),t}function b(e){if(e.clientName=e.organizationCode+" - "+e.customer,e.barcode=e.barcode+e.id,e.statusText=S(e.status,o),e.requestType=M(e.requestType),e.totalPrice=e.subTotalPrice+e.returnReattemptCharges,e.adminRemarks&&0===e.adminRemarks.indexOf("<br/>")){var t=e.adminRemarks.length;e.adminRemarks=e.adminRemarks.substring(5,t)}return e}function A(e){if(e.clientName=e.organizationCode+" - "+e.customer,e.barcode=e.barcode+e.id,e.statusText=S(e.status,o),e.totalPrice=e.subTotalPrice+e.returnReattemptCharges,e.items&&e.items[0]&&(e.items[0].milkRunWeight.text=D(e.items[0].milkRunWeight.id)),e.adminRemarks&&0===e.adminRemarks.indexOf("<br/>")){var t=e.adminRemarks.length;e.adminRemarks=e.adminRemarks.substring(5,t)}return e}function D(e){for(var t in s)if(s[t].id==e)return s[t].text;return""}function M(e){var t=S(e,r);return"N/A"===t&&(t=S(e,i)),t}function S(e,t){for(var n in t)if(t[n].value===e)return t[n].display;return"N/A"}var R=t.serviceUrl+"/api/tasks/",w={getMilkRunTaskByCriteria:l,getAdhocTaskByCriteria:c,getMilkRunTaskById:d,getAdhocTaskById:u,assignVendorMilkrun:m,assignVendorAdhoc:p,assignDriverMilkrun:f,assignDriverAdhoc:g,updateTask:h,uploadProof:C,removeProof:k,returnOrReattemptTask:v,convertListMilkRunTask:P,convertListAdhocTask:T,convertAdhocTask:b,convertMilkrunTask:A,getImageFromFileName:y};return w}angular.module("main.module").factory("taskService",e),e.$inject=["$http","systemSetting","$filter","taskStatus","adhocPSSServiceType","adhocHealthCareServiceType","milkrunService","milkRunWeight"]}(),function(){"use strict";function e(e,t,n){function o(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var o=d+"?offset="+(t.currentPage-1)*t.itemPerPage;return o+="&limit="+t.itemPerPage,t.searchTerm&&(o+="&search="+t.searchTerm),t.department&&(o+="&departmentId="+t.department),t.driverType&&(o+="&driverType="+t.driverType),t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending),e.get(o)}function r(t){return t.id?e.put(d+t.id,t):e.post(d,t)}function i(t){return e.get(d+t)}function a(t){return e.post(d+"ChangePassword",t)}function s(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(d+n+t.id)}function l(e){return e.map(function(e){return{id:e.id,name:e.firstName+" "+e.lastName,userId:e.userName,department:e.departmentName,phoneNumber:e.phoneNumber,permission:e.hasCreateJobPermission?"Y":"N",status:e.lockoutEnabled?"Inactive":"Active"}})}function c(e){var t=[{id:"",name:"All"},{id:"Unassigned",name:"Unassigned"}];return angular.forEach(e,function(e){t.push({id:e.id,name:e.firstName+" "+e.lastName})}),t}var d=t.serviceUrl+"/api/drivers/",u={getDriverByCriteria:o,saveDriver:r,getDriverById:i,activateOrDeactivate:s,convertListDriver:l,convertListVendorDropDownList:c,updatePassword:a};return u}angular.module("main.module").factory("driverService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord"]}(),function(){"use strict";function e(e,t,n,o,r,i){function a(t,o){var r=o?d+"export":d;return r+="?offset="+(t.currentPage-1)*t.itemPerPage,r+="&limit="+t.itemPerPage,t.fromDate&&(r+="&fromDate="+n("date")(t.fromDate,"yyyy-MM-dd")),t.toDate&&(r+="&toDate="+n("date")(t.toDate,"yyyy-MM-dd")),t.customer&&(r+="&customerId="+t.customer),t.departmentId&&(r+="&departmentId="+t.departmentId),r+="&type="+t.type,e.get(r)}function s(e,t){return angular.forEach(e,function(e){e.statusText=l(e.status,o),e.serviceTypeText="0"==t?r.getServiceType(e.serviceType):l(e.serviceType,i),e.typeOfJob=c(e.subJobType)}),e}function l(e,t){for(var n in t)if(t[n].value===e)return t[n].display;return"N/A"}function c(e){return 1==e?"One To One":2==e?"One To Many":3==e?"Many To One":"N/A"}var d=t.serviceUrl+"/api/report/",u={getReportByCriteria:a,convertListReport:s};return u}angular.module("main.module").factory("reportService",e),e.$inject=["$http","systemSetting","$filter","taskStatus","adhocService","milkRunFrequency"]}(),function(){"use strict";function e(e){function t(t){var n=(parseInt(e),new Date(t));return n}return{convertDate:t,getAbsoluteElHeight:function(e){e="string"==typeof e?document.querySelector(e):e;var t=window.getComputedStyle(e),n=parseFloat(t.marginTop)+parseFloat(t.marginBottom);return Math.ceil(e.offsetHeight+n)}}}angular.module("main.module").factory("utilityService",e),e.$inject=["defaultTimezone"]}(),function(){"use strict";function e(e,t){function n(){i.showChosenColumn&&(i.isContainColumn=r,i.translationTexts={checkAll:"Show All",dynamicButtonTextSuffix:"columns"},i.chosenColumnConfig={idProp:"name",displayProp:"display",showUncheckAll:!1},i.chosenColumnModel=[],angular.forEach(i.gridConfig.columns,function(e){i.chosenColumnModel.push({id:e.name})}))}function o(e){i.options.sortColumn===e?i.options.sortAscending=!i.options.sortAscending:(i.options.sortAscending=!0,i.options.sortColumn=e),i.actionRequest()}function r(e){var t=!1;return angular.forEach(i.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}var i=this;i.setItemPerPage=e,i.sort=o,n(),i.eventsChosenColumn={onItemDeselect:function(e){1===i.chosenColumnModel.length&&i.chosenColumnModel.push(e),document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="none"},onSelectAll:function(){document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="inline"}}}angular.module("main.module").directive("grid",function(){return{restrict:"E",scope:{gridConfig:"=",options:"=",data:"=",actionRequest:"&",isLoading:"=",showChosenColumn:"=?"},templateUrl:"app/directives/commonControls/grid/grid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["setItemPerPage","$scope"]}(),function(){"use strict";function e(e,t){function n(e){l.optionsGrid.sortColumn===e?l.optionsGrid.sortAscending=!l.optionsGrid.sortAscending:(l.optionsGrid.sortAscending=!0,l.optionsGrid.sortColumn=e),l.actionRequest()}function o(e){t.path(l.gridConfig.navigationDetail+e)}function r(e){console.log("select > "+e.id),a(e.id)}function i(e){console.log("deselect : "+e.id),s(e.id)}function a(e){switch(e){case 1:l.column1=!0;break;case 2:l.column2=!0;break;case 3:l.column3=!0;break;case 4:l.column4=!0;break;case 5:l.column5=!0;break;case 6:l.column6=!0;break;case 7:l.column7=!0;break;case 8:l.column8=!0}}function s(e){switch(e){case 1:l.column1=!1;break;case 2:l.column2=!1;break;case 3:l.column3=!1;break;case 4:l.column4=!1;break;case 5:l.column5=!1;break;case 6:l.column6=!1;break;case 7:l.column7=!1;break;case 8:l.column8=!1}}var l=this;l.setItemPerPage=e,l.optionsGrid={sortColumn:"",sortAscending:!0,itemPerPage:20,totalItems:0},l.sort=n,l.navigateToDetail=o,l.columnModel=[],l.columnsData=[{id:1,label:"Collection barcode"},{id:2,label:"Customer"},{id:3,label:"Created date"},{id:4,label:"Request type"},{id:5,label:"Request status"},{id:6,label:"Status"},{id:7,label:"Pick up point"},{id:8,label:"Delivery point"}],l.defaultText={buttonDefaultText:"Default"},l.column1=!0,l.column2=!0,l.column3=!0,l.column4=!0,l.column5=!0,l.column6=!0,l.column7=!0,l.column8=!0,l.columnModel=[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8}],l.eventListeners={onItemSelect:r,onItemDeselect:i}}angular.module("main.module").directive("gridExt",function(){return{restrict:"E",scope:{gridConfig:"=",optionsGrid:"=",options:"=",data:"=",actionRequest:"&",isLoading:"="},templateUrl:"app/directives/commonControls/gridExt/gridExt.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["setItemPerPage","$location"]}(),function(){"use strict";function e(e,t){var n=this;n.data=t,n.ok=function(t){e.close(t)},n.cancel=function(){e.dismiss("cancel")}}angular.module("main.module").controller("ModalInstanceCtrl",e),e.$inject=["$uibModalInstance","data"]}(),function(){"use strict";function e(e,t,n,o,r,i,a){function s(){return t.currentUser?a[t.currentUser.role].navigationItems:[]}function l(e){if(t.currentUser&&t.currentUser.role){var n=a[t.currentUser.role];if(n.viewOnly&&t.currentUser.viewOnly&&n.preventPage.indexOf(e)>-1)return!1}return u.indexOf(e)>-1}function c(){o.logout(),t.currentUser=null,n.path("/login")}var d=this;d.pageName=r,d.systemRole=i,d.logout=c,d.isNavItemAllowed=l,d.profileDisplayName="",t.currentUser&&(d.profileDisplayName=t.currentUser.firstName,t.currentUser.lastName&&(d.profileDisplayName+=" "+t.currentUser.lastName));var u=s()}angular.module("main.module").directive("headerPage",function(){return{restrict:"E",templateUrl:"app/directives/header/header.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$timeout","$rootScope","$location","authService","pageName","systemRole","systemRolesConfigs"]}(),function(){"use strict";function e(e,t,n,o,r,i,a){function s(){c()}function l(){angular.element(r).off("resize",s)}function c(){if(d.doStickyCalculation){var e=0,t=m.clientHeight,n=a.getAbsoluteElHeight(footer),i=r.innerHeight,s=!1;t+n+e<i&&(s=!0),o(function(){d.stickyFooter=s})}}var d=this,u=i.footerHTML||[];d.content=_.map(u,function(t){return e(t)}),d.alignment=t.alignFooter,t.$watch("alignFooter",function(e){d.alignment=e}),d.doStickyCalculation=t.stickyFooter||!1,d.stickyFooter=!1;var m=document.getElementById("root-container");document.getElementById("footer");t.$watch("stickyFooter",function(e){d.doStickyCalculation=e,c()}),angular.element(r).on("resize",s),n.$on("$destroy",l)}angular.module("main.module").directive("footerPage",function(){return{restrict:"E",templateUrl:"app/directives/footer/footer.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$sanitize","$rootScope","$scope","$timeout","$window","userConfig","utilityService"]}(),function(){"use strict";angular.module("main.module").directive("compareTo",function(){return{restrict:"A",require:"ngModel",scope:{compareTo:"=compareTo"},link:function(e,t,n,o){t.bind("keyup",function(){e.$apply(function(){var n=t.val(),r=e.compareTo,i=n&&n===r;o.$setValidity("compareTo",i)})})}}})}(),function(){"use strict";function e(e){function t(){n.isOpen=!1,n.minDate&&e.$watch("vm.minDate",function(e){n.datepickerOptions={minDate:e}})}var n=this;t(),n.openCalendar=function(e){e.preventDefault(),e.stopPropagation(),n.isOpen=!0}}angular.module("main.module").directive("customDatePicker",function(){return{restrict:"E",scope:{ngModel:"=",placeHolder:"@?",minDate:"=?",ngDisabled:"=?",isTouch:"=?"},templateUrl:"app/directives/commonControls/datePicker/datePicker.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$scope"]}(),function(){"use strict";function e(){var e=this;e.timepickerOptions={showMeridian:!1},e.isOpen=!1,e.openCalendar=function(t){t.preventDefault(),t.stopPropagation(),e.isOpen=!0}}angular.module("main.module").directive("customTimePicker",function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/directives/commonControls/timePicker/timePicker.html",controller:e,controllerAs:"vm",bindToController:!0}})}(),function(){"use strict";function e(e){return{restrict:"A",link:function(t,n,o){var r=e(o.fileModel),i=r.assign,a=t.$eval(o.customOnChange);n.bind("change",function(){i(t,n[0].files[0]),a()})}}}angular.module("main.module").directive("fileModel",e),e.$inject=["$parse"]}(),function(){"use strict";function e(e,t,n){function o(){g.userDetail.sapCodeId=g.userDetail.sapCodeId||"",g.userDetail.id&&(g.originalEmail=g.userDetail.email)}function r(){n.success("The cost centre has been created successfully."),g.noCostCenterFound=!1}function i(t){return e.searchCostCenter(t).then(function(e){return[]})}function a(t){return e.searchPO(t).then(function(e){return e})}function s(e){g.userDetail.costCentre=e.name}function l(e){g.userDetail.po=e.name}function c(){g.userDetail.billingAddresses.push({postalCode:"",blockNumber:"",streetName:"",unitNumber:""})}function d(e){g.userDetail.billingAddresses.splice(e,1)}function u(){g.userDetail.id&&g.userDetail.email===g.originalEmail||e.checkEmailExist(g.userDetail.email).then(function(e){g.emailExist=!0},function(e){g.emailExist=!1})}function m(){var e=g.userDetail.lockoutEnabled?"Are you sure you want to activate this user?":"Are you sure you want to deactivate this user?";t.createWarningPopup(e,"Warning",p)}function p(){e.activateOrDeactivate(g.userDetail).then(function(e){var t=g.userDetail.lockoutEnabled?"The user has been activated successfully.":"The user has been deactivated successfully.";g.userDetail.lockoutEnabled=!g.userDetail.lockoutEnabled,n.success(t),g.onActivateOrDeactivate()})}var g=this;g.addBillingAddress=c,g.deleteBillAddress=d,g.checkEmailExist=u,g.activateOrDeactivate=m,g.searchCostCenter=i,g.onSelectCostCenter=s,g.searchPO=a,g.onSelectPO=l,g.createCostCenter=r,o()}angular.module("main.module").directive("userClientDetail",function(){return{restrict:"E",scope:{userDetail:"=",onCreateOrUpdate:"&",onActivateOrDeactivate:"&?",onCancel:"&",viewMode:"=",sapCodes:"=",poNumbers:"=",costCenters:"="},templateUrl:"app/directives/userClient/userClientDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["clientUserService","modalService","toastr"]}(),function(){"use strict";function e(e){function t(){r()}function n(t){return e.getLocationByPostalCode(t).then(function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]})}function o(e){i.ngModel.postalCode=e.postalCode,i.ngModel.blockNumber=e.blockNumber,i.ngModel.streetName=e.streetName}function r(){i.ngModel.postalCode&&i.ngModel.blockNumber&&i.ngModel.streetName&&i.ngModel.unitNumber||i.isDelete?i.isValid=!0:i.isValid=!1}var i=this;i.searchAddressByPostalCode=n,i.onSelect=o,i.checkValidAddress=r,t()}angular.module("main.module").directive("userAddress",function(){return{restrict:"E",scope:{ngModel:"=",isSearchable:"=",isDelete:"=?",isShowFullWidth:"=",onDelete:"&?",isValid:"=?",isShowWarning:"=?",warningMessage:"@?",viewMode:"=?",largeWidth:"=?"},templateUrl:"app/directives/userClient/userAddress.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["locationService"]}(),function(){"use strict";function e(e,t,n,o,r,i,a){function s(){g.ngModel.requestDate=g.ngModel.requestDate||new Date,g.ngModel.days=g.ngModel.days||[],g.ngModel.additionals=g.ngModel.additionals||[],g.ngModel.milkRunFrequency!=n.weekly.value&&(g.ngModel.days=[]),g.ngModel.milkRunFrequency!=n.projectRun.value&&(g.ngModel.projectRunDate=null),m()}function l(e){var t=g.ngModel.days.indexOf(e);t>-1?g.ngModel.days.splice(t,1):g.ngModel.days.push(e),g.weeklyInvalid=0===g.ngModel.days.length}function c(e){var t=g.ngModel.additionals.indexOf(e);t>-1?g.ngModel.additionals.splice(t,1):g.ngModel.additionals.push(e),m()}function d(){g.ngModel.milkRunFrequency==n.weekly.value&&0===g.ngModel.days.length?g.weeklyInvalid=!0:(g.weeklyInvalid=!1,g.ngModel.days=[]),g.ngModel.milkRunFrequency!=n.projectRun.value||g.ngModel.projectRunDate?(g.projectRunInvalid=!1,g.ngModel.projectRunDate=null):g.projectRunInvalid=!0}function u(){i.switchCollectionDeliveryPoint(g.ngModel)}function m(){g.saturdaysChecked=g.ngModel.additionals.indexOf(g.milkRunAdditionals.saturdays.value)>-1,g.sundaysChecked=g.ngModel.additionals.indexOf(g.milkRunAdditionals.sundays.value)>-1,g.afterOfficeHoursChecked=g.ngModel.additionals.indexOf(g.milkRunAdditionals.afterOfficeHours.value)>-1,g.publicHolidaysChecked=g.ngModel.additionals.indexOf(g.milkRunAdditionals.publicHolidays.value)>-1}function p(){g.currentProgress=t.collectionPoint}var g=this;g.systemRole=a,g.milkRunTypes=e,g.milkRunFrequency=n,g.days=o,g.milkRunAdditionals=r,g.next=p,g.changeDay=l,g.changeAdditional=c,g.changeFrequency=d,g.changeMilkRunType=u,s(),g.changeProjectRunDate=function(){alert("messi")}}angular.module("milkRun.module").directive("choseMilkRunType",function(){return{restrict:"E",scope:{ngModel:"=",currentProgress:"="},templateUrl:"app/directives/milkRun/step/choseMilkrunType.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunTypes","milkRunProgress","milkRunFrequency","days","milkRunAdditionals","milkrunService","systemRole"]}(),function(){"use strict";function e(e,t){function n(){r.currentProgress=e.deliveryPoint}function o(){r.currentProgress=e.chosenMilkRunType}var r=this;r.milkRunTypes=t,r.next=n,r.back=o,r.ngModel.collectionPoints=r.ngModel.collectionPoints||[]}angular.module("milkRun.module").directive("collectionPoint",function(){return{restrict:"E",scope:{ngModel:"=",currentProgress:"="},templateUrl:"app/directives/milkRun/step/collectionPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunProgress","milkRunTypes"]}(),function(){"use strict";function e(e,t,n,o){function r(){s.apllyItemTemplate=!1,s.ngModel.deliveryPoints=s.ngModel.deliveryPoints||[],s.ngModel.milkRunType==n.oneToOne&&s.ngModel.deliveryPoints.length>1&&(s.ngModel.deliveryPoints=[s.ngModel.deliveryPoints[0]])}function i(){e.currentUser.role===o.Admin?s.currentProgress=t.remark:s.currentProgress=t.confirmOrder}function a(){s.currentProgress=t.collectionPoint}var s=this;s.milkRunTypes=n,s.next=i,s.back=a,r()}angular.module("milkRun.module").directive("deliveryPoint",function(){return{restrict:"E",scope:{ngModel:"=",currentProgress:"="},templateUrl:"app/directives/milkRun/step/deliveryPoint.html",controller:e,controllerAs:"vm",bindToController:!0
}}),e.$inject=["$rootScope","milkRunProgress","milkRunTypes","systemRole"]}(),function(){"use strict";function e(e,t){function n(){r.currentProgress=e.confirmOrder}function o(){r.currentProgress=e.deliveryPoint}var r=this;r.departments=t,r.next=n,r.back=o}angular.module("milkRun.module").directive("remark",function(){return{restrict:"E",scope:{ngModel:"=",currentProgress:"="},templateUrl:"app/directives/milkRun/step/remark.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunProgress","departments"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s,l,c,d){function u(){if(C.ngModel){if(C.ngModel.frequency=r.convertFrequency(C.ngModel),e.currentUser.department!==d.PSS.name)return;(!C.ngModel.id||C.ngModel.id&&y())&&(C.isLoading=!0,c.calculateMilkRun(C.ngModel).then(function(e){r.transferPricing(C.ngModel,e.data),C.isLoading=!1}).catch(function(e){s.warning("There's no pricing for calculation!"),C.isLoading=!1}))}}function m(){C.isLoading=!0,r.saveMilkRun(C.ngModel).then(function(e){C.isLoading=!1;var n=C.ngModel.id?"The Fixed Run has been updated successfully.":"The Fixed Run has been created successfully.";s.success(n),t.path("/milkruns")})}function p(e){var t={confirm:e?f:g};C.approveRejectData={isApprove:e,remark:""},a.createPopup({templateUrl:"app/directives/milkRun/step/approveRejectModal.html",size:"lg",data:C.approveRejectData},t)}function g(){C.isLoading=!0,r.rejectApproveMilkRun(C.ngModel.id,{status:0,remark:C.approveRejectData.remark}).then(function(e){C.isLoading=!1,s.success("The Fixed Run has been rejected successfully."),C.ngModel.jobStatus=l.rejected.value})}function f(){C.isLoading=!0,r.rejectApproveMilkRun(C.ngModel.id,{status:1,remark:C.approveRejectData.remark}).then(function(e){C.isLoading=!1,s.success("The Fixed Run has been approved successfully."),C.ngModel.jobStatus=l.accepted.value})}function v(){e.currentUser.role===i.Admin?C.currentProgress=n.remark:C.currentProgress=n.deliveryPoint}function h(){C.viewMode=!1,C.ngModel.originalCollectionPoints=angular.copy(C.ngModel.collectionPoints),C.ngModel.originalDeliveryPoints=angular.copy(C.ngModel.deliveryPoints),C.currentProgress=n.chosenMilkRunType,s.warning("Changing frequency, collection point or delivery point information will recalculate pricing based on current pricing table and overwrite the manual pricing edits.")}function y(){return!angular.equals(C.ngModel.collectionPoints,C.ngModel.originalCollectionPoints)||!angular.equals(C.ngModel.deliveryPoints,C.ngModel.originalDeliveryPoints)}var C=this;C.departments=d,C.milkRunTypes=o,C.systemRole=i,C.jobStatusType=l,C.back=v,C.saveMilkRun=m,C.edit=h,C.approveRejectMilkRun=p,u()}angular.module("milkRun.module").directive("confirmOrder",function(){return{restrict:"E",scope:{ngModel:"=",currentProgress:"=",viewMode:"=",isLoading:"="},templateUrl:"app/directives/milkRun/step/confirmOrder.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","$location","milkRunProgress","milkRunTypes","milkrunService","systemRole","modalService","toastr","jobStatusType","pricingService","departments"]}(),function(){"use strict";function e(e,t,n,o,r,i,a){function s(t){for(var n in e)if(e[n].id==t)return e[n].text;return""}function l(e,t){v.ngModel.splice(t,1),v.validatePoint(),e.stopPropagation()}function c(e){v.isCheckAll=!1;for(var t=!1,n=0;n<v.listCheckPoint.length;n++)if(v.listCheckPoint[n]==e)return t=!0,void v.listCheckPoint.splice(n,1);v.listCheckPoint.push(e)}function d(e){for(var t=0;t<v.listCheckPoint.length;t++)if(v.listCheckPoint[t]==e)return!0;return!1}function u(){v.isCheckAll?(v.listCheckPoint=[],angular.forEach(v.ngModel,function(e){v.listCheckPoint.push(e.id)})):v.listCheckPoint=[]}function m(){var e={updatePricing:p};v.dataPricing={},o.createPopup({templateUrl:"app/directives/jobCommon/editPrice/editPriceModal.html",size:"lg",data:v.dataPricing},e)}function p(){var e=0;angular.forEach(v.ngModel,function(t){v.listCheckPoint.indexOf(t.id)>=0&&(t.subTotalPrice=v.dataPricing.price),e+=t.subTotalPrice}),v.totalPrice=e,v.listCheckPoint=[],v.isCheckAll=!1}function g(){var e={assignVendor:f};v.dataAssignVendor={},o.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:v.dataAssignVendor},e)}function f(){v.isLoading=!0,r.assignVendor({vendorId:v.dataAssignVendor.vendor.id,targetIds:v.listCheckPoint}).then(function(e){i.success("The selected points have been assigned to vendor successfully."),angular.forEach(v.ngModel,function(e){v.listCheckPoint.indexOf(e.id)>=0&&(e.vendorName=v.dataAssignVendor.vendor.name)}),v.listCheckPoint=[],v.isCheckAll=!1,v.isLoading=!1})}var v=this;v.systemRole=a,v.milkRunTypes=t,v.departments=n,v.getMilkRunText=s,v.removePoint=l,v.checkAllChange=u,v.onCheckPoint=c,v.bindingCheck=d,v.assignVendor=g,v.editPrice=m,v.listCheckPoint=[]}angular.module("milkRun.module").directive("listPoint",function(){return{restrict:"E",scope:{ngModel:"=",allowRemove:"=",milkRunType:"=?",onDetailClick:"&?",validatePoint:"&?",viewMode:"=?",isLoading:"=?",totalPrice:"=?"},templateUrl:"app/directives/milkRun/listPoint/listPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunWeight","milkRunTypes","departments","modalService","milkrunService","toastr","systemRole"]}(),function(){"use strict";function e(e){function t(t){return e.getLocationByPostalCode(t).then(function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]})}function n(e){o.ngModel.address.postalCode=e.postalCode,o.ngModel.address.blockNumber=e.blockNumber,o.ngModel.address.streetName=e.streetName}var o=this;o.form=o.form||{},o.searchAddressByPostalCode=t,o.onSelect=n}angular.module("milkRun.module").directive("milkrunContact",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?"},templateUrl:"app/directives/milkRun/contact/milkrunContact.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["locationService"]}(),function(){"use strict";function e(e){var t=this;t.milkRunWeight=e,t.ngModel=t.ngModel||[{}],t.form=t.form||{}}angular.module("milkRun.module").directive("milkrunItem",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?"},templateUrl:"app/directives/milkRun/milkrunItem/milkrunItem.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunWeight"]}(),function(){"use strict";function e(e,t,n,o,r,i){function a(){g.isValid=r.checkValidCollectionPoints(g.ngModel)}function s(){g.dataModal={point:{items:angular.copy(g.templateItem)||[]},index:g.ngModel.length+1,isOneToMany:g.milkRunType==t.oneToMany,applyTemplateItem:!1,isAddNew:!0},d()}function l(){g.dataModal.applyTemplateItem&&(g.templateItem=g.dataModal.point.items),g.dataModal.isAddNew?g.ngModel.push(g.dataModal.point):(g.dataModal.point.isInValid=!1,g.ngModel[g.dataModal.index-1]=g.dataModal.point),m()}function c(e,n){g.dataModal={point:angular.copy(e),index:n,isOneToMany:g.milkRunType==t.oneToMany,applyTemplateItem:!1},d()}function d(){var e={updatePoint:l};n.createPopup({templateUrl:"app/directives/milkRun/point/newPointModal.html",size:"lg",data:g.dataModal},e)}function u(){i(function(){document.getElementById("uploadFile").click()})}function m(){g.isValid=r.checkValidCollectionPoints(g.ngModel)}function p(){var e=[{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",FixedRunWeight:"<5",Quantity:2},{PostalCode:"551234",BlockNumber:"234A",StreetName:"Serangoon Avenue 2",UnitNumber:"07-08",ContactPerson:"Mr John",ContactNumber:"98769876",FixedRunWeight:"5to10",Quantity:3},{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",FixedRunWeight:"10to30",Quantity:2},{PostalCode:"551234",BlockNumber:"234A",StreetName:"Serangoon Avenue 2",UnitNumber:"07-08",ContactPerson:"Mr John",ContactNumber:"98769876",FixedRunWeight:"30to60",Quantity:3},{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",FixedRunWeight:"60to100",Quantity:2}],n=g.milkRunType==t.oneToMany?"MilkRunDeliveryTemplate.csv":"MilkRunCollectionTemplate.csv";o.exportCsvFile({data:e,filename:n})}var g=this;g.ngModel=g.ngModel||[],g.milkRunTypes=t,g.addNewPoint=s,g.editPoint=c,g.openFile=u,g.validatePoint=m,g.downloadSampleCsv=p,a(),g.uploadFile=function(){g.csvFile&&o.readAsDataUrl(g.csvFile,e).then(function(e){var t=r.getMilkRunPointsFromText(e);g.ngModel=g.ngModel.concat(t),m(),angular.element(document.getElementById("uploadFile")).val(null)})}}angular.module("milkRun.module").directive("manyPoint",function(){return{restrict:"E",scope:{ngModel:"=",milkRunType:"=",isValid:"="},templateUrl:"app/directives/milkRun/point/manyPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$scope","milkRunTypes","modalService","fileReaderService","milkrunService","$timeout"]}(),function(){"use strict";function e(){var e=this;e.ngModel=e.ngModel||[]}angular.module("milkRun.module").directive("onePoint",function(){return{restrict:"E",scope:{ngModel:"=",contactForm:"=?",milkRunItemForm:"=?"},templateUrl:"app/directives/milkRun/point/onePoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(){var e=this;e.ngModel=e.ngModel||[]}angular.module("milkRun.module").directive("pointDetail",function(){return{restrict:"E",scope:{ngModel:"=",milkRunType:"=",viewMode:"=?",isLoading:"=?",totalPrice:"=?"},templateUrl:"app/directives/milkRun/point/pointDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("main.module").directive("milkrunPricingRow",function(){return{restrict:"E",scope:{ngModel:"=",label:"@",isValidate:"=",viewMode:"=?"},templateUrl:"app/directives/advanceMilkRunPricing/milkRunPricingRow.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e){function t(){i.ngModel&&0!==i.ngModel.length?o():n()}function n(){i.ngModel=[];for(var t in e)i.ngModel.push({category:e[t].value,label:e[t].display})}function o(){angular.forEach(i.ngModel,function(e){e.label=r(e.category)})}function r(t){for(var n in e)if(e[n].value===t)return e[n].display}var i=this;t()}angular.module("main.module").directive("milkrunPricingTab",function(){return{restrict:"E",scope:{ngModel:"=",isValidate:"=",viewMode:"=?"},templateUrl:"app/directives/advanceMilkRunPricing/milkRunPricingTab.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["deliveryPointCategory"]}(),function(){"use strict";function e(e,t){function n(){d.ngModel.weightCategories&&0!==d.ngModel.weightCategories?r():o()}function o(){d.ngModel.weightCategories=[];for(var t in e)d.ngModel.weightCategories.push({weightCategoryId:e[t].value,label:e[t].display})}function r(){angular.forEach(d.ngModel.weightCategories,function(e){e.label=i(e.weightCategoryId)})}function i(t){for(var n in e)if(e[n].value===t)return e[n].display}function a(e){d.activateMilkRunTab=e}function s(){d.isValidate=!0;for(var e=!0,t=0;t<d.ngModel.weightCategories.length;t++){var n=l(d.ngModel.weightCategories[t].deliveryPointCategories);d.ngModel.weightCategories[t].isValid=n,e=!!n&&e}e&&d.setPrice()}function l(e){if(!e)return!1;for(var t=0;t<e.length;t++)if(!c(e[t]))return!1;return!0}function c(e){return!!(e.twiceDaily&&e.daily&&e.thricePerWeek&&e.weekly&&e.projectRun)}var d=this;d.departments=t,d.activateMilkRunTab=e.milkrunUptoFiveKg.value,d.changeMilkRunTab=a,d.setPricing=s,n()}angular.module("main.module").directive("milkrunPricingAdvance",function(){return{restrict:"E",scope:{ngModel:"=?",cancel:"&",setPrice:"&",viewMode:"=?"},templateUrl:"app/directives/advanceMilkRunPricing/milkRunPricingAdvance.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunWeightCategory","departments"]}(),function(){"use strict";function e(e,t,n,o){t.bind("change",function(t){var n=t.target.files,r=n[0];o.$setViewValue(r),e.$apply()})}angular.module("main.module").directive("fileUpload",function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,o){console.log(event),t.bind("change",function(t){var n=t.target.files,r=n[0];o.$setViewValue(r),e.$apply()})}}}),e.$inject=[]}(),function(){"use strict";function e(e,t){function n(){r(),o(),i()}function o(){if(!a.ngModel.deliveryTimings||0===a.ngModel.deliveryTimings.length){a.ngModel.deliveryTimings=[];for(var e in t)a.ngModel.deliveryTimings.push({deliveryTimingId:t[e].value,label:t[e].display})}}function r(){if(!a.ngModel.label)for(var t in e)if(e[t].value===a.ngModel.weightCategoryId)return void(a.ngModel.label=e[t].display)}function i(){a.rowLabels=[];for(var e in t)a.rowLabels.push(t[e].display)}var a=this;n()}angular.module("main.module").directive("healthCarePricingRow",function(){return{restrict:"E",scope:{ngModel:"=",isValidate:"=",viewMode:"=?"},templateUrl:"app/directives/healthCarePricing/healthCarePricingRow.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["healthCareWeightCategory","healthCareDeliveryTiming"]}(),function(){"use strict";function e(e){function t(){n()}function n(){if(!i.ngModel.weightCategories||0===i.ngModel.weightCategories.length){i.ngModel.weightCategories=[];for(var t in e)i.ngModel.weightCategories.push({weightCategoryId:e[t].value,label:e[t].display})}}function o(){i.isValidate=!0;for(var e=0;e<i.ngModel.weightCategories.length;e++)if(!r(i.ngModel.weightCategories[e]))return!1;i.setPrice()}function r(e){for(var t=0;t<e.deliveryTimings.length;t++)if(!e.deliveryTimings[t].rate||e.deliveryTimings[t].rate<=0)return!1;return!0}var i=this;i.validateAndSave=o,t()}angular.module("main.module").directive("healthCarePricing",function(){return{restrict:"E",scope:{ngModel:"=",cancel:"&",setPrice:"&",viewMode:"=?"},templateUrl:"app/directives/healthCarePricing/healthCarePricing.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["healthCareWeightCategory"]}(),function(){"use strict";function e(){var e={restrict:"AE",templateUrl:"app/directives/dashboard/dashboardSpinner/dashboardSpinner.html",scope:{spinnerClasses:"@"},controller:t,controllerAs:"vm",bindToController:!0};return e}function t(){}angular.module("main.module").directive("dashboardSpinner",e),t.$inject=[]}(),function(){"use strict";function e(){var e={restrict:"AE",templateUrl:"app/directives/dashboard/ticker/ticker.html",scope:{tickerItems:"=",tickerShowCta:"=",tickerCtaLink:"="},controller:t,controllerAs:"vm",bindToController:!0};return e}function t(e,t,n){function o(){r.tickerItemsLooped=JSON.parse(angular.toJson([].concat(r.tickerItems,r.tickerItems))),r.tickerDataLoaded=!0}var r=this;r.showCta="boolean"!=typeof r.tickerShowCta||r.tickerShowCta,r.ctaLink=r.tickerCtaLink||t.indexRoute,r.tickerDataLoaded=!1,r.tickerItemsLooped=[],e.$watch(function(){return r.tickerItems},function(){r.tickerItems&&r.tickerItems.length>0&&o()})}angular.module("main.module").directive("ticker",e),t.$inject=["$scope","$rootScope","$element"]}(),function(){"use strict";function e(){var e={restrict:"AE",templateUrl:"app/directives/dashboard/spendingsGraph/spendingsGraph.html",scope:{data:"=",spendingsGraphHeight:"="},controller:t,controllerAs:"vm",bindToController:!0};return e}function t(e,t,r){function i(){var e=m.spendingsGraphHeight?m.spendingsGraphHeight:"270";m.graphHeight=e+"px"}function a(){m.maxY=l(),m.xAxis=c(),m.yAxis=d(),m.chartData=u()}function s(){m.maxY=l(),m.xAxis=c(),m.yAxis=d(),m.chartData=f,r(function(){m.chartData=u()},g)}function l(e){var t=_.max(m.data,function(e){return e.amount}).amount;t=t<7?7:t;var o=1;o=t<=100*p?10:100;var r=n(t,p*o);return e?void e(r):r}function c(){return _.map(m.data,function(e){return e.month})}function d(){for(var e=[],t=0;t<p;++t)e.push(m.maxY/p*(p-t));return e}function u(){return _.map(m.data,function(e){return e.height=e.amount/m.maxY*100+"%",e})}var m=this,p=7,g=200,f=o(),v=!1;m.maxY=0,m.xAxis=[],m.yAxis=[],m.chartData=[],m.graphHeight="270px",i(),e.$watch("vm.spendingsGraphHeight",i),e.$watch("vm.data",function(){m.data&&(v?a():(s(),v=!0))})}function n(e,t){return Math.ceil(e/t)*t}function o(){for(var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=(new Date).getMonth(),n=[],o=0;o<12;++o)o+t<12?n.push(e[t+o]):n.push(e[o-(12-t)]);return _.map(n,function(e){return{month:e,amount:0,height:0}})}angular.module("main.module").directive("spendingsGraph",e),t.$inject=["$scope","$element","$timeout"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s,l,c,d){function u(){h.ngModel.surcharges=h.ngModel.surcharges||[],m(),v()}function m(){var t=e.currentUser.department===r.PSS.name?n:o;h.serviceTypes=[];for(var i in t)h.serviceTypes.push({value:t[i].value,display:t[i].display,notes:d[i]?d[i].notes:null})}function p(){a.switchCollectionDeliveryPoint(h.ngModel)}function g(){if(e.currentUser.department===r.Healthcare.name&&e.currentUser.role===c.User){var o=new Date;h.ngModel.minCollectionDateFinal=o,h.ngModel.minDeliveryDateFinal=o}else h.ngModel.serviceType==n.threeHour.value?(h.ngModel.minCollectionDateFinal=null,h.ngModel.minDeliveryDateFinal=null):h.ngModel.cutOffTime==l.case2&&h.ngModel.serviceType==n.sameDay.value?h.ngModel.minCollectionDateFinal=angular.copy(h.ngModel.minDeliveryDate):(h.ngModel.minCollectionDateFinal=h.ngModel.minCollectionDate,h.ngModel.minDeliveryDateFinal=h.ngModel.minDeliveryDate);h.currentProgress=t.collectionPoint}function f(e){var t=h.ngModel.surcharges.indexOf(e);t>-1?h.ngModel.surcharges.splice(t,1):(h.ngModel.surcharges.push(e),h.ngModel.surcharges.length>1&&(h.ngModel.surcharges=[s.weekdayEvening.value,s.nonworkingDay.value])),v()}function v(){h.weekdayEveningChecked=h.ngModel.surcharges.indexOf(h.adHocSurcharge.weekdayEvening.value)>-1,h.nonworkingDayChecked=h.ngModel.surcharges.indexOf(h.adHocSurcharge.nonworkingDay.value)>-1}var h=this;h.departments=r,h.adhocTypes=i,h.adHocSurcharge=s,h.next=g,h.changeAdhocType=p,h.changeAdditionalSurCharge=f,u()}angular.module("adhoc.module").directive("choseAdhocType",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/choseAdhocType.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","adhocProgress","adhocPSSServiceType","adhocHealthCareServiceType","departments","adhocTypes","adhocService","adHocSurcharge","cutOffTime","systemRole","healthCareServiceNote"]}(),function(){"use strict";function e(e){var t=this;t.adhocTypes=e}angular.module("adhoc.module").directive("adhocCollectionPoint",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/collectionPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocTypes"]}(),function(){"use strict";function e(e,t,n,o,r){function i(){a.ngModel.deliveryPoints=a.ngModel.deliveryPoints||[],a.ngModel.jobType==n.oneToOne&&a.ngModel.deliveryPoints.length>1&&(a.ngModel.deliveryPoints=[a.ngModel.deliveryPoints[0]])}var a=this;a.adhocTypes=n,i()}angular.module("adhoc.module").directive("adhocDeliveryPoint",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/deliveryPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","adhocProgress","adhocTypes","adhocPSSServiceType","departments"]}(),function(){"use strict";function e(e,t,n,o){function r(){i()}function i(){for(var e=l.ngModel.jobType==n.manyToOne?l.ngModel.collectionPoints:l.ngModel.deliveryPoints,t=0;t<e.length;t++)if(!e[t].items||0===e[t].items.length)return void(l.isValid=!1);l.isValid=!0}function a(){e.currentUser.role===o.Admin?l.currentProgress=t.remark:l.currentProgress=t.confirmOrder}function s(){l.currentProgress=t.deliveryPoint}var l=this;l.adhocTypes=n,l.next=a,l.back=s,l.validate=i,r()}angular.module("adhoc.module").directive("addItems",function(){return{restrict:"E",scope:{ngModel:"=",currentProgress:"="},templateUrl:"app/directives/adhoc/step/addItems.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","adhocProgress","adhocTypes","systemRole"]}(),function(){"use strict";function e(e,t){}angular.module("adhoc.module").directive("adhocRemark",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/remark.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocProgress","modalService"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s,l,c,d,u){function m(){C.ngModel&&(C.ngModel.serviceTypeName=r.getServiceType(C.ngModel.serviceType),C.isLoading=!0,c.calculateAdhoc(C.ngModel).then(function(e){c.transferAdhocPricing(C.ngModel,e.data),C.ngModel.additionalSurcharges=r.getAdditionalSurcharge(C.ngModel),C.isLoading=!1}).catch(function(e){s.warning("There's no pricing for calculation!"),C.isLoading=!1}))}function p(){C.isLoading=!0,r.saveAdhoc(C.ngModel).then(function(e){C.isLoading=!1;var n=C.ngModel.id?"The Ad Hoc has been updated successfully.":"The Ad Hoc has been created successfully.";s.success(n),t.path("/adhocs")})}function g(e){var t={confirm:e?v:f};C.approveRejectData={isApprove:e,remark:""},a.createPopup({templateUrl:"app/directives/milkRun/step/approveRejectModal.html",size:"lg",data:C.approveRejectData},t)}function f(){C.isLoading=!0,r.rejectApproveAdhoc({id:C.ngModel.id,jobStatus:l.rejected.value,remark:C.approveRejectData.remark}).then(function(e){C.isLoading=!1,s.success("The Ad Hoc has been rejected successfully."),C.ngModel.jobStatus=l.rejected.value})}function v(){C.isLoading=!0,r.rejectApproveAdhoc({id:C.ngModel.id,jobStatus:l.accepted.value,remark:C.approveRejectData.remark}).then(function(e){C.isLoading=!1,s.success("The Ad Hoc has been approved successfully."),C.ngModel.jobStatus=l.accepted.value})}function h(){e.currentUser.role===i.Admin?C.currentProgress=n.remark:C.currentProgress=n.addItem}function y(){C.viewMode=!1,C.currentProgress=n.chosenAdhocType}var C=this;C.departments=d,C.adhocTypes=o,C.systemRole=i,C.jobStatusType=l,C.back=h,C.saveAdhoc=p,C.edit=y,C.approveRejectMilkRun=g,m()}angular.module("adhoc.module").directive("adhocConfirmOrder",function(){return{restrict:"E",scope:{ngModel:"=",currentProgress:"=",viewMode:"=",isLoading:"="},templateUrl:"app/directives/adhoc/step/confirmOrder.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","$location","adhocProgress","adhocTypes","adhocService","systemRole","modalService","toastr","jobStatusType","pricingService","departments","adHocSurcharge"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s,l,c){function d(){h.ngModel&&(h.ngModel.serviceTypeName=o.getServiceType(h.ngModel.serviceType))}function u(){h.isLoading=!0,o.saveAdhoc(h.ngModel).then(function(t){h.isLoading=!1;var n=h.ngModel.id?"The Ad Hoc has been updated successfully.":"The Ad Hoc has been created successfully.";a.success(n),e.path("/adhocs")})}function m(){e.path("/adhocs")}function p(e){var t={confirm:e?f:g};h.approveRejectData={isApprove:e,remark:""},i.createPopup({templateUrl:"app/directives/milkRun/step/approveRejectModal.html",size:"lg",data:h.approveRejectData},t)}function g(){h.isLoading=!0,o.rejectApproveAdhoc({id:h.ngModel.id,jobStatus:s.rejected.value,remark:h.approveRejectData.remark}).then(function(e){h.isLoading=!1,a.success("The Ad Hoc has been rejected successfully."),h.ngModel.jobStatus=s.rejected.value})}function f(){h.isLoading=!0,o.rejectApproveAdhoc({id:h.ngModel.id,jobStatus:s.accepted.value,remark:h.approveRejectData.remark}).then(function(e){h.isLoading=!1,a.success("The Ad Hoc has been approved successfully."),h.ngModel.jobStatus=s.accepted.value})}function v(){h.viewMode=!1,h.currentProgress=t.chosenAdhocType}var h=this;h.departments=c,h.adhocTypes=n,h.systemRole=r,h.jobStatusType=s,h.saveAdhoc=u,h.edit=v,h.cancel=m,h.approveRejectMilkRun=p,d()}angular.module("adhoc.module").directive("adhocConfirmPricing",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/confirmPricing.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$location","adhocProgress","adhocTypes","adhocService","systemRole","modalService","toastr","jobStatusType","pricingService","departments"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s){function l(){h.ngModel.requestDate=h.ngModel.requestDate||new Date,c()}function c(){h.ngModel.clientId&&e.currentUser.role===t.Admin&&n.getClientUserByCriteria({organizationCode:h.ngModel.organizationCode,sortColumn:"name",sortAscending:!0}).then(function(e){h.users=e.data.users.filter(function(e){return 0==e.lockoutEnabled}),h.users.unshift({id:void 0,firstName:"Please",lastName:"select ..."}),f()}),e.currentUser.role===t.User&&(h.ngModel.costCenter=h.ngModel.costCenter||"",o.getCustomerById(e.currentUser.customerId).then(function(e){m(e.data)}),n.getClientUserById(e.currentUser.id).then(function(t){h.ngModel.clientName=t.data.organizationCode+" - "+t.data.customerName,h.ngModel.clientId=e.currentUser.customerId,h.users=[t.data],h.ngModel.requester=t.data.firstName+" "+t.data.lastName,h.ngModel.requesterId=e.currentUser.id,h.costCenters=[{id:"",name:"Please select ..."}];var n=t.data.costCentre.split(",");angular.forEach(n,function(e){h.costCenters.push({id:e,name:e})})}))}function d(t){return o.getCustomerByCriteria({currentPage:1,itemPerPage:20,searchTerm:t,sortColumn:"name",sortAscending:!0},e.currentUser.department).then(function(e){return e.data.customers})}function u(e){var t=i.convertDate(e.contractEndDate);t.setHours(0,0,0,0);var o=new Date;o.setHours(0,0,0,0),t<o?(s.createWarningPopup("This customer’s contract has expired. Please extend the contract date.","Warning",null,!0,"OK"),v(),h.ngModel.clientName=""):(h.ngModel.client=e,h.ngModel.clientId=e.id,h.ngModel.clientName=e.organizationCode+" - "+e.name,n.getClientUserByCriteria({organizationCode:e.organizationCode,sortColumn:"name",sortAscending:!0}).then(function(e){h.users=e.data.users.filter(function(e){return 0==e.lockoutEnabled}),h.users.unshift({id:"",firstName:"Please",lastName:"select ..."})}))}function m(t){if(e.currentUser.department!==a.Healthcare.name){var n=i.convertDate(t.cutOffTimeForSameDayPickupAndDelivery),o=i.convertDate(t.cutOffTimeForSameDayPickupAndNextDayDelivery),s=new Date;if(!p(s,n))return s.setHours(0),s.setMinutes(0),s.setSeconds(0),h.ngModel.minCollectionDate=s,h.ngModel.minDeliveryDate=s,void(h.ngModel.cutOffTime=r.case1);var l=new Date;return l.setDate(l.getDate()+1),p(s,n)&&!p(s,o)?(s.setHours(0),s.setMinutes(0),s.setSeconds(0),h.ngModel.minCollectionDate=s,h.ngModel.minDeliveryDate=l,void(h.ngModel.cutOffTime=r.case2)):void(p(s,o)&&(h.ngModel.minCollectionDate=l,h.ngModel.minDeliveryDate=l,h.ngModel.cutOffTime=r.case3))}}function p(e,t){return e.getHours()>t.getHours()||e.getHours()==t.getHours()&&e.getMinutes()>t.getMinutes()}function g(){h.ngModel.requesterId&&h.users?f():(h.ngModel.costCenter="",h.costCenters=[])}function f(){var e=h.users.filter(function(e){return e.id===h.ngModel.requesterId});if(e&&e[0]&&e[0].costCentre){h.ngModel.requester=e[0].firstName+" "+e[0].lastName,h.costCenters=[{id:"",name:"Please select ..."}];var t=e[0].costCentre.split(",");angular.forEach(t,function(e){h.costCenters.push({id:e,name:e})})}}function v(){h.users=[],h.costCenters=[],h.ngModel.requesterId="",h.ngModel.costCenter=""}var h=this;h.systemRole=t,h.searchClient=d,h.onSelectClient=u,h.changeUser=g,h.clientChange=v,l()}angular.module("adhoc.module").directive("jobChoseCustomer",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/jobCommon/jobChoseCustomer.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","systemRole","clientUserService","customerService","cutOffTime","utilityService","departments","modalService"]}(),function(){"use strict";function e(e,t){function n(e,t){o.ngModel.splice(t,1),o.validatePoint(),e.stopPropagation()}var o=this;o.adhocTypes=e,o.departments=t,o.removePoint=n}angular.module("adhoc.module").directive("adhocListPoint",function(){return{restrict:"E",scope:{ngModel:"=",allowRemove:"=",jobType:"=?",onDetailClick:"&?",validatePoint:"&?"},templateUrl:"app/directives/adhoc/listPoint/listPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocTypes","departments"]}(),function(){"use strict";function e(e,t,n,o,r,i,a){function s(){a.validateDateOfPoint(f.ngModel,f.minDate,f.defaultCollectionDate),f.isValid=r.checkValidCollectionPoints(f.ngModel)}function l(){f.dataModal={point:{items:angular.copy(f.templateItem)||[]},index:f.ngModel.length+1,isOneToMany:f.jobType==t.oneToMany,applyTemplateItem:!1,isAddNew:!0,minDate:f.minDate,defaultCollectionDate:f.defaultCollectionDate},u()}function c(){f.dataModal.applyTemplateItem&&(f.templateItem=f.dataModal.point.items),f.dataModal.isAddNew?f.ngModel.push(f.dataModal.point):(f.dataModal.point.isInValid=!1,f.ngModel[f.dataModal.index-1]=f.dataModal.point),p()}function d(e,n){f.dataModal={point:angular.copy(e),index:n,isOneToMany:f.jobType==t.oneToMany,applyTemplateItem:!1,minDate:f.minDate,defaultCollectionDate:f.defaultCollectionDate},u()}function u(){var e={updatePoint:c};n.createPopup({templateUrl:"app/directives/adhoc/point/newPointModal.html",size:"lg",data:f.dataModal},e)}function m(){i(function(){document.getElementById("uploadFile").click()})}function p(){f.isValid=r.checkValidCollectionPoints(f.ngModel)}function g(){var e=[{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",Date:"11/12/2016"},{PostalCode:"551234",BlockNumber:"234A",StreetName:"Serangoon Avenue 2",UnitNumber:"07-08",ContactPerson:"Mr John",ContactNumber:"98769876",Date:"12/12/2016"}],n=f.jobType==t.oneToMany?"AdhocDeliveryTemplate.csv":"AdhocCollectionTemplate.csv";o.exportCsvFile({data:e,filename:n})}var f=this;f.ngModel=f.ngModel||[],f.adhocTypes=t,f.addNewPoint=l,f.editPoint=d,f.openFile=m,f.validatePoint=p,f.downloadSampleCsv=g,s(),f.uploadFile=function(){f.csvFile&&o.readAsDataUrl(f.csvFile,e).then(function(e){var t=a.getAdhocPointsFromText(e,f.minDate,f.defaultCollectionDate);f.ngModel=f.ngModel.concat(t),p(),angular.element(document.getElementById("uploadFile")).val(null)})}}angular.module("adhoc.module").directive("adhocManyPoint",function(){return{restrict:"E",scope:{ngModel:"=",jobType:"=",isValid:"=",minDate:"=?",defaultCollectionDate:"=?"},templateUrl:"app/directives/adhoc/point/manyPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$scope","adhocTypes","modalService","fileReaderService","milkrunService","$timeout","adhocService"]}(),function(){"use strict";function e(e,t,n,o,r){function i(e){d.isCheckAll=!1;for(var t=!1,n=0;n<d.listCheckPoint.length;n++)if(d.listCheckPoint[n]==e)return t=!0,void d.listCheckPoint.splice(n,1);d.listCheckPoint.push(e)}function a(e){for(var t=0;t<d.listCheckPoint.length;t++)if(d.listCheckPoint[t]==e)return!0;return!1}function s(){d.isCheckAll?(d.listCheckPoint=[],angular.forEach(d.ngModel,function(e){d.listCheckPoint.push(e.id)})):d.listCheckPoint=[]}function l(){var e={assignVendor:c};d.dataAssignVendor={},t.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:d.dataAssignVendor},e)}function c(){d.isLoading=!0,n.assignVendor({vendorId:d.dataAssignVendor.vendor.id,targetIds:d.listCheckPoint}).then(function(e){o.success("The selected points have been assigned to vendor successfully."),angular.forEach(d.ngModel,function(e){d.listCheckPoint.indexOf(e.id)>=0&&(e.vendorName=d.dataAssignVendor.vendor.name)}),d.listCheckPoint=[],d.isCheckAll=!1,d.isLoading=!1})}var d=this;d.systemRole=r,d.adhocTypes=e,d.checkAllChange=s,d.onCheckPoint=i,d.bindingCheck=a,d.assignVendor=l,d.listCheckPoint=[],d.ngModel=d.ngModel||[];
}angular.module("adhoc.module").directive("adhocPointDetail",function(){return{restrict:"E",scope:{ngModel:"=",jobType:"=",title:"@",viewMode:"=",isLoading:"=?"},templateUrl:"app/directives/adhoc/point/pointDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocTypes","modalService","adhocService","toastr","systemRole"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s,l){function c(){g.ngModel.items=g.ngModel.items||[]}function d(){g.dataModal={item:{},isAddNew:!0},u()}function u(){g.dataModal.uoms=e.currentUser.department===i.PSS.name?o:r,g.dataModal.isHealthCare=e.currentUser.department===i.Healthcare.name,g.dataModal.isHealthCare&&(g.dataModal.itemsHealthCare=[{id:void 0,name:"Please select ..."}],angular.forEach(a,function(e){g.dataModal.itemsHealthCare.push({id:e,name:e})})),g.dataModal.reference=l;var t={updateItem:m};n.createPopup({templateUrl:"app/directives/adhoc/pointItem/newItemModal.html",size:"lg",data:g.dataModal},t)}function m(){g.dataModal.isAddNew?(g.ngModel.items.push(g.dataModal.item),s.success("An item has been added successfully."),d()):g.ngModel.items[g.dataModal.index]=g.dataModal.item,g.validate()}function p(e,t){g.dataModal={item:angular.copy(e),index:t,isAddNew:!1},u()}var g=this;g.adhocTypes=t,g.addNewItem=d,g.editItem=p,c()}angular.module("adhoc.module").directive("pointItem",function(){return{restrict:"E",scope:{ngModel:"=",index:"@",jobType:"@",validate:"&"},templateUrl:"app/directives/adhoc/pointItem/pointItem.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","adhocTypes","modalService","uomPSS","uomHealthCare","departments","itemsHealthCare","toastr","addNewItemReference"]}(),function(){"use strict";function e(e,t){function n(e,t){o.ngModel.splice(t,1),o.validate(),e.stopPropagation()}var o=this;o.adhocTypes=e,o.departments=t,o.removeItem=n}angular.module("adhoc.module").directive("listItem",function(){return{restrict:"E",scope:{ngModel:"=",allowRemove:"=",jobType:"=?",onDetailClick:"&?",validate:"&?"},templateUrl:"app/directives/adhoc/pointItem/listItem.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocTypes","departments"]}(),function(){"use strict";function e(e){function t(){r.ngModel=r.ngModel||{},r.defaultValue&&(r.ngModel.collectionDate=angular.copy(r.defaultValue)),r.form=r.form||{}}function n(t){return e.getLocationByPostalCode(t).then(function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]})}function o(e){r.ngModel.address.postalCode=e.postalCode,r.ngModel.address.blockNumber=e.blockNumber,r.ngModel.address.streetName=e.streetName}var r=this;r.searchAddressByPostalCode=n,r.onSelect=o,t()}angular.module("adhoc.module").directive("adhocContact",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?",minDate:"=?",defaultValue:"=?"},templateUrl:"app/directives/adhoc/contact/adhocContact.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["locationService"]}(),function(){"use strict";function e(){function e(){if(n.isValidate=!0,!(!n.ngModel.additionalRestrictedArea||n.ngModel.additionalRestrictedArea<=0||!n.ngModel.additionalAfterOfficeHr||n.ngModel.additionalAfterOfficeHr<=0)){for(var e=0;e<n.ngModel.weightCategories.length;e++)if(!t(n.ngModel.weightCategories[e]))return;n.setPrice()}}function t(e){for(var t=0;t<e.deliveryTimings.length;t++)if(!e.deliveryTimings[t].rate||e.deliveryTimings[t].rate<=0)return!1;return!0}var n=this;n.validateAndSave=e}angular.module("main.module").directive("adhocPssPricing",function(){return{restrict:"E",scope:{ngModel:"=",cancel:"&",setPrice:"&",viewMode:"=?"},templateUrl:"app/directives/adhocPSSPricing/adhocPSSPricing.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("main.module").directive("adhocPssPricingRow",function(){return{restrict:"E",scope:{ngModel:"=",isValidate:"=",viewMode:"=?"},templateUrl:"app/directives/adhocPSSPricing/adhocPSSPricingRow.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e){function t(e){var t=!1;return angular.forEach(o.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}function n(t){e.path("/milkrun/detail/"+t)}var o=this;o.isContainColumn=t,o.goToDetailPage=n}angular.module("milkRun.module").directive("milkrunJobGrid",function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"="},templateUrl:"app/directives/milkRun/jobs/milkRunJobGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$location"]}(),function(){"use strict";function e(e,t,n,o,r,i,a){function s(){if(y.listAssignTransaction.length){var e={assignVendor:l};y.dataAssignVendor={},r.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:y.dataAssignVendor},e)}}function l(){y.isLoading=!0,n.assignVendorMilkrun({vendorId:y.dataAssignVendor.vendor.id,targetIds:y.listAssignTransaction}).then(function(e){angular.forEach(y.ngModel,function(e){y.listAssignTransaction.indexOf(e.id)>=0&&(e.vendorName=y.dataAssignVendor.vendor.name)}),o.success("The selected transactions have been assigned to vendor successfully."),y.listAssignTransaction=[],y.isCheckAll=!1,y.isLoading=!1})}function c(){o.success("Upload successfully for the selected transactions."),y.listAssignTransaction=[],y.isCheckAll=!1}function d(t){u(t),e.path("/milkrunTask/"+t)}function u(e){var n=[];angular.forEach(y.ngModel,function(e){n.push(e.id)}),t.milkrunTransaction={listTransaction:n,currentIndex:n.indexOf(e)}}function m(){y.isCheckAll?f():y.listAssignTransaction=[]}function p(e,t){e.stopPropagation(),y.isCheckAll=!1;for(var n=!1,o=0;o<y.listAssignTransaction.length;o++)if(y.listAssignTransaction[o]==t)return n=!0,void y.listAssignTransaction.splice(o,1);y.listAssignTransaction.push(t)}function g(e){for(var t=0;t<y.listAssignTransaction.length;t++)if(y.listAssignTransaction[t]==e)return!0;return!1}function f(){y.listAssignTransaction=[],angular.forEach(y.ngModel,function(e){e.status!=y.taskStatus.delivered.value&&y.listAssignTransaction.push(e.id)})}function v(e){var t=!1;return angular.forEach(y.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}function h(e,t){e.preventDefault(),e.stopPropagation(),t.status!=y.taskStatus.delivered.value&&(p(e,t.id),g(t.id))}var y=this;y.systemRole=i,y.taskStatus=a,y.isContainColumn=v,y.checkAllChange=m,y.bindingCheck=g,y.onCheckTransaction=p,y.goToDetailPage=d,y.assignVendorFunc=s,y.preventClick=h,y.resetGridCheckingFunc=c,y.listAssignTransaction=[],y.listTransactionId=y.listAssignTransaction}angular.module("milkRun.module").directive("milkrunTransactionGrid",function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"=",assignVendorFunc:"=",isLoading:"=?",listTransactionId:"=",resetGridCheckingFunc:"="},templateUrl:"app/directives/milkRun/jobs/milkRunTransactionGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$location","$rootScope","taskService","toastr","modalService","systemRole","taskStatus"]}(),function(){"use strict";function e(e,t,n,o,r,i,a,s,l,c,d){function u(){e.currentUser.role!==n.User&&e.currentUser.role!==n.Vendor&&(m(),h.isTransaction&&p()),g(),h.statuses=f(h.isTransaction?r:o)}function m(){t.getCustomerByCriteria({sortColumn:"name",sortAscending:!0}).then(function(e){h.customers=t.convertListCustomerDropDownList(e.data.customers)})}function p(){var t=0;e.currentUser.role==n.Admin&&(t=e.currentUser.department===s.PSS.name?s.PSS.id:s.Healthcare.id),d.getVendorByCriteria({departmentId:t,sortColumn:"organizationName",sortAscending:!0}).then(function(e){h.vendors=d.convertListVendorDropDownList(e.data.users)})}function g(){h.gridType===i.milkRunJob||h.gridType===i.milkRunTransaction?h.requestTypes=f(a):e.currentUser.role==n.SuperAdmin?h.requestTypes=v():e.currentUser.department===s.PSS.name?h.requestTypes=f(l):h.requestTypes=f(c)}function f(e){var t=[{value:"",text:"All"}];for(var n in e)t.push({value:e[n].value,text:e[n].display});return t}function v(){var e=[{value:"",text:"All"}];for(var t in l)e.push({value:l[t].value,text:l[t].display});for(var t in c)e.push({value:c[t].value,text:c[t].display});return e}var h=this;h.systemRole=n,h.jobGridType=i,u()}angular.module("main.module").directive("jobFilter",function(){return{restrict:"E",scope:{options:"=",actionRequest:"&",isTransaction:"@",gridType:"@"},templateUrl:"app/directives/jobCommon/jobFilter.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","customerService","systemRole","jobStatus","taskStatus","jobGridType","milkRunFrequency","departments","adhocPSSServiceType","adhocHealthCareServiceType","vendorService"]}(),function(){"use strict";function e(e,t,n){function o(){s.assignVendorFunc={},s.resetGrid={},s.listTransactionId=[],s.translationTexts={checkAll:"Show All",dynamicButtonTextSuffix:"columns"},s.chosenColumnConfig={idProp:"name",displayProp:"display",showUncheckAll:!1},s.chosenColumnModel=[],angular.forEach(s.gridConfig.columns,function(e){s.chosenColumnModel.push({id:e.name})})}function r(){s.assignVendorFunc()}function i(){s.actionRequest(),s.resetGrid()}function a(){var e=window.location.hostname,t='<link rel="stylesheet" type="text/css" href="../bower_components/bootstrap/dist/css/bootstrap.css"><link href="./css/custom.css" rel="stylesheet" type="text/css">';"localhost"!==e&&(t='<link rel="stylesheet" href="css/styles.min.css">');var n=document.getElementById("printOrderTable").innerHTML,o=window.open("","_blank");o.document.open(),o.document.write("<html><head>"+t+'</head><body onload="window.print()">'+n+"</html>"),o.document.close()}var s=this;s.systemRole=n,s.setItemPerPage=e,s.jobGridType=t,s.printOrder=a,s.assignVendor=r,s.uploadCallback=i,o(),s.getListTransactionId=function(){var e=[];return angular.forEach(s.ngModel,function(t){s.listTransactionId.indexOf(t.id)>-1&&e.push({id:t.id,barcode:t.barcode})}),e},s.eventsChosenColumn={onItemDeselect:function(e){1===s.chosenColumnModel.length&&s.chosenColumnModel.push(e),document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="none"},onSelectAll:function(){document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="inline"}}}angular.module("main.module").directive("jobGrid",function(){return{restrict:"E",scope:{ngModel:"=",options:"=",gridConfig:"=",actionRequest:"&",isLoading:"=",gridType:"@"},templateUrl:"app/directives/jobCommon/jobGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["setItemPerPage","jobGridType","systemRole"]}(),function(){"use strict";function e(e){function t(e){var t=!1;return angular.forEach(o.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}function n(t){e.path("/adhoc/detail/"+t)}var o=this;o.isContainColumn=t,o.goToDetailPage=n}angular.module("adhoc.module").directive("adhocJobGrid",function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"="},templateUrl:"app/directives/adhoc/jobs/adhocJobGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$location"]}(),function(){"use strict";function e(e,t,n,o,r,i,a){function s(){if(y.listAssignTransaction.length){var e={assignVendor:l};y.dataAssignVendor={},n.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:y.dataAssignVendor},e)}}function l(){y.isLoading=!0,o.assignVendorAdhoc({vendorId:y.dataAssignVendor.vendor.id,targetIds:y.listAssignTransaction}).then(function(e){angular.forEach(y.ngModel,function(e){y.listAssignTransaction.indexOf(e.id)>=0&&(e.vendorName=y.dataAssignVendor.vendor.name)}),r.success("The selected transactions have been assigned to vendor successfully."),y.listAssignTransaction=[],y.isCheckAll=!1,y.isLoading=!1})}function c(){r.success("Upload successfully for the selected transactions."),y.listAssignTransaction=[],y.isCheckAll=!1}function d(){y.isCheckAll?f():y.listAssignTransaction=[]}function u(e){m(e),t.path("/adhocTask/"+e)}function m(t){var n=[];angular.forEach(y.ngModel,function(e){n.push(e.id)}),e.adhocTransaction={listTransaction:n,currentIndex:n.indexOf(t)}}function p(e,t){e.stopPropagation(),y.isCheckAll=!1;for(var n=!1,o=0;o<y.listAssignTransaction.length;o++)if(y.listAssignTransaction[o]==t)return n=!0,void y.listAssignTransaction.splice(o,1);y.listAssignTransaction.push(t)}function g(e){for(var t=0;t<y.listAssignTransaction.length;t++)if(y.listAssignTransaction[t]==e)return!0;return!1}function f(){y.listAssignTransaction=[],angular.forEach(y.ngModel,function(e){e.status!=y.taskStatus.delivered.value&&y.listAssignTransaction.push(e.id)})}function v(e){var t=!1;return angular.forEach(y.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}function h(e,t){e.preventDefault(),e.stopPropagation(),t.status!=y.taskStatus.delivered.value&&(p(e,t.id),g(t.id))}var y=this;y.systemRole=i,y.taskStatus=a,y.isContainColumn=v,y.listAssignTransaction=[],y.listTransactionId=y.listAssignTransaction,y.checkAllChange=d,y.bindingCheck=g,y.onCheckTransaction=p,y.assignVendorFunc=s,y.goToDetailPage=u,y.preventClick=h,y.resetGridCheckingFunc=c}angular.module("adhoc.module").directive("adhocTransactionGrid",function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"=",assignVendorFunc:"=",listTransactionId:"=",resetGridCheckingFunc:"="},templateUrl:"app/directives/adhoc/jobs/adhocTransactionGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","$location","modalService","taskService","toastr","systemRole","taskStatus"]}(),function(){"use strict";function e(e){function t(){o.isLoading=!0,e.getVendorByCriteria({}).then(function(e){o.isLoading=!1,o.vendors=e.data.users.filter(function(e){return e.lockoutEnabled===!1}),o.vendors.unshift({id:void 0,organization:"Please select ..."})})}function n(){angular.forEach(o.vendors,function(e){o.ngModel.vendor.id===e.id&&(o.ngModel.vendor.name=e.organization)})}var o=this;o.vendorChange=n,t()}angular.module("main.module").directive("assignVendor",function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&",onAction:"&"},templateUrl:"app/directives/jobCommon/assignVendor/assignVendor.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["vendorService"]}(),function(){"use strict";function e(e){function t(){e.getDriverByCriteria({}).then(function(e){o.drivers=e.data.users.filter(function(e){return e.lockoutEnabled===!1}),o.drivers.unshift({id:void 0,firstName:"Please",lastName:"select ..."})})}function n(){angular.forEach(o.drivers,function(e){o.ngModel.driver.id===e.id&&(o.ngModel.driver.name=e.firstName+" "+e.lastName)})}var o=this;o.driverChange=n,t()}angular.module("main.module").directive("assignDriver",function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&",onAction:"&"},templateUrl:"app/directives/jobCommon/assignDriver/assignDriver.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["driverService"]}(),function(){"use strict";function e(){function e(e,n){t.ngModel.splice(n,1),t.validatePoint(),e.stopPropagation()}var t=this;t.removeCharge=e}angular.module("adhoc.module").directive("listAdditionalCharge",function(){return{restrict:"E",scope:{ngModel:"=",allowRemove:"=",onDetailClick:"&?"},templateUrl:"app/directives/adhoc/listPoint/listAdditionalCharge.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e){function t(){n()}function n(){r.poc.imageUrl&&e.getImageFromFileName(o(r.poc.imageUrl)).then(function(e){r.pocSrc="data:image/png;base64,"+e.data}),r.pod.imageUrl&&e.getImageFromFileName(o(r.pod.imageUrl)).then(function(e){r.podSrc="data:image/png;base64,"+e.data})}function o(e){var t=e.split("/");return t[t.length-1]}var r=this;t()}angular.module("main.module").directive("proofOfCollectionAndDelivery",function(){return{restrict:"E",scope:{poc:"=",pod:"="},templateUrl:"app/directives/jobCommon/proofOfCollectionAndDelivery/proofOfCollectionAndDelivery.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["taskService"]}(),function(){"use strict";function e(e){function t(t){t&&t.includes("localhost")&&(t=t.replace("localhost","localhost:54516")),n.data={},e.createPopup({templateUrl:"app/directives/jobCommon/viewPhotoModal.html",size:"lg",data:{imageUrl:t}},{})}var n=this;n.viewPhoto=t}angular.module("main.module").directive("driverRemarks",function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/directives/jobCommon/driverRemarks/driverRemarks.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["modalService"]}(),function(){"use strict";function e(e,t,n,o){function r(){a.status=a.ngModel.status,a.statuses=[];for(var t in e)a.statuses.push({value:e[t].value,display:e[t].display})}function i(){n.updateTask(a.ngModel.id,{barcode:a.ngModel.barcode,status:a.status}).then(function(t){a.ngModel.status=a.status;for(var n in e)if(e[n].value==a.status){a.ngModel.statusText=e[n].display;break}a.callback(),o.success("The Transaction has been updated status successfully.")})}var a=this;a.systemRole=t,a.changeStatus=i,r()}angular.module("main.module").directive("changeStatus",function(){return{restrict:"E",scope:{ngModel:"=",callback:"&"},templateUrl:"app/directives/jobCommon/changeStatus/changeStatus.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["taskStatus","systemRole","taskService","toastr"]}(),function(){"use strict";function e(e){var t=this;e(function(){JsBarcode("#transaction"+t.transactionId,t.ngModel,{width:1,height:30})})}angular.module("main.module").directive("barcodePrint",function(){return{restrict:"E",scope:{ngModel:"=",transactionId:"="},templateUrl:"app/directives/jobCommon/barcodePrint/barcodePrint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$timeout"]}(),function(){"use strict";function e(e){function t(){}function n(){o.tasks=o.getTransactionId?o.getTransactionId():o.tasks,o.tasks.length&&(o.data={isPOC:o.poc,tasks:o.tasks,callback:o.callback},e.createPopup({templateUrl:"app/directives/jobCommon/uploadProof/uploadProofModal.html",size:"lg",data:o.data},{}))}var o=this;o.uploadProof=n,t()}angular.module("main.module").directive("uploadProof",function(){return{restrict:"E",scope:{label:"@",poc:"=",tasks:"=?",getTransactionId:"&?",callback:"&?"},templateUrl:"app/directives/jobCommon/uploadProof/uploadProof.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["modalService"]}(),function(){"use strict";function e(e,t){function n(){i.proofDetail={},i.isFileChoosen=!1,i.dataFile=null}function o(){var e=i.proofDetail.signedAtDate,n=i.proofDetail.signedAtTime;e.setHours(n.getHours()),e.setMinutes(n.getMinutes());var o=new FormData;o.append("file",i.dataFile);var r={type:i.ngModel.isPOC?"poc":"pod",remark:i.proofDetail.signedBy,signedDate:e,tasks:i.ngModel.tasks};o.append("data",JSON.stringify(r)),t.uploadProof(o).then(function(e){i.onCancel(),i.ngModel.callback&&i.ngModel.callback()})}function r(){e(function(){i.isFileChoosen=!0;var e=new FileReader;e.onload=function(e){document.getElementById("image-proof").src=e.target.result},e.readAsDataURL(i.dataFile)})}var i=this;i.onFileChange=r,i.uploadProof=o,n()}angular.module("main.module").directive("uploadProofDetail",function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&"},templateUrl:"app/directives/jobCommon/uploadProof/uploadProofDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$timeout","taskService"]}(),function(){"use strict";function e(e){function t(){e.removeProof({id:n.transactionId,barcode:n.barcode},n.poc).then(function(e){n.callback()})}var n=this;n.removeProof=t}angular.module("main.module").directive("removeProof",function(){return{restrict:"E",scope:{label:"@",poc:"=",transactionId:"=",barcode:"=",callback:"&?"},templateUrl:"app/directives/jobCommon/uploadProof/removeProof.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["taskService"]}(),function(){"use strict";function e(e){function t(){i.ngModel=i.ngModel||{},i.includeItems&&!i.ngModel.items&&(i.ngModel.items=[{}])}function n(){i.viewMode=!0,i.parentViewMode=!0}function o(t){return e.getLocationByPostalCode(t).then(function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]})}function r(e){i.ngModel.address.postalCode=e.postalCode,i.ngModel.address.blockNumber=e.blockNumber,i.ngModel.address.streetName=e.streetName}var i=this;i.searchAddressByPostalCode=o,i.onSelect=r,i.viewMode=!1,i.save=n,t()}angular.module("main.module").directive("pointContact",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?",includeItems:"=?",isCollection:"=?",index:"=",parentViewMode:"=?",canRemove:"=?",removePoint:"&?"},templateUrl:"app/directives/jobCommon/pointContact.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["locationService"]}(),function(){"use strict";function e(e,t,n,o,r,i){function a(){c.ngModel=c.ngModel||{},c.form=c.form||{},c.addNewItemReference=e,c.isAddItemSubmitted=!1,c.uoms=t.currentUser.department===i.PSS.name?o:r,c.isHealthCare=t.currentUser.department===i.Healthcare.name,c.isHealthCare&&(c.itemsHealthCare=[{id:void 0,name:"Please select ..."}],angular.forEach(n,function(e){c.dataModal.itemsHealthCare.push({id:e,name:e})}))}function s(){var e=c.ngModel.items.filter(function(e){return!(e.description&&e.uom&&e.issueQuantity&&e.unitMass)});0===e.length?(c.ngModel.items.push({}),c.isAddItemSubmitted=!1):c.isAddItemSubmitted=!0}function l(e){c.ngModel.items.splice(e,1)}var c=this;c.departments=i,c.removeItem=l,c.addItem=s,a()}angular.module("main.module").directive("itemSurcharge",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?",viewMode:"=?"},templateUrl:"app/directives/jobCommon/items/itemSurcharge.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["addNewItemReference","$rootScope","itemsHealthCare","uomPSS","uomHealthCare","departments"]}(),function(){"use strict";function e(e){function t(){}function n(){r.internalViewMode=!1,r.ngModel.push({items:[{}]})}function o(e){r.ngModel.splice(e,1)}var r=this;r.adhocTypes=e,r.addPoint=n,r.removePoint=o,r.internalViewMode=!0,t()}angular.module("main.module").directive("jobPoints",function(){return{restrict:"E",scope:{ngModel:"=",isCollection:"=?",jobType:"=",viewMode:"="},templateUrl:"app/directives/jobCommon/points/jobPoints.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocTypes"]}();