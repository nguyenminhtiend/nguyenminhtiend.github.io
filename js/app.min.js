!function(){"use strict";function e(e,t){t.isLocal||e.debugInfoEnabled(!1)}function t(e){e.interceptors.push("httpInterceptor")}function n(e){e.when("/",{redirectTo:"/dashboard"}).otherwise({redirectTo:"/"})}function o(e,t,n,o,i){var r=o.getCurrentUser();if(r)e.currentUser=r,e.indexRoute="#"+i[e.currentUser.role].defaultRoute;else{var a=n.path(),s=t.routes[a];s&&s.authorize&&n.path("/login")}e.$on("$locationChangeStart",function(e,i,r){var a=n.path();a.indexOf("milkruns")>-1&&(a+="/:view?");var s=t.routes[a];if(s&&s.authorize){if(!o.isAuthenticated())return void n.path("/login");var l=o.getToken();if(!l)return o.logout(),void n.path("/login");var c=o.getCurrentUser();(!o.isAuthorized(s.authorize)||s.preventViewOnly&&c.viewOnly)&&(o.logout(),n.path("/accessDeny"))}}),e.$on("$routeChangeSuccess",function(){t.current&&(e.hideHeader=t.current.hideHeader,e.hideFooter=t.current.hideFooter,e.alignFooter=t.current.alignFooter||"center",e.stickyFooter=t.current.stickyFooter,e.hideNavbar=t.current.hideNavbar,e.showHeaderDashboardControls=t.current.showHeaderDashboardControls,e.noContainer=t.current.noContainer,e.darkBg=t.current.darkBg,e.category=t.current.category,e.headerSelectedJob="0"),t.current.title?document.title="Sitadel eCMS - "+t.current.title:document.title="Sitadel eCMS"})}angular.module("main.module",["constants.module","ngRoute","ngAnimate","ui.bootstrap","LocalStorageModule","ui.bootstrap.datetimepicker","toastr","ngTouch","ngSanitize","angularjs-dropdown-multiselect","hljs","ngFileUpload","ngScrollbar","customer.module","spAdminUser.module","adminUser.module","account.module","milkRun.module","log.module","report.module","allLocations.module","dashboard.module","profile.module","ui.odometer","adhoc.module","milkrunTask.module","adhocTask.module","vendorAdhoc.module","vendorMilkrun.module","vendorManagement.module","driver.module","accessDeny.module","favorite.module","financeUser.module","financeBilling.module","financeBillingDetail.module","financeInvoiced.module","financeInvoicedDetail.module"]).config(e).config(t).config(n).run(o),e.$inject=["$compileProvider","systemSetting"],t.$inject=["$httpProvider"],n.$inject=["$routeProvider"],o.$inject=["$rootScope","$route","$location","authService","systemRolesConfigs"]}(),function(){"use strict";var e={};window&&_.assign(e,window.env);var t={ADHOC_TRANSACTIONS:"AdhocTransactions",MILKRUN_TRANSACTIONS:"MilkrunTransactions",USERS:"Users",CLIENTS:"Customers",JOBTYPES:"Jobtypes",REPORTS:"Reports",LOGS:"Logs",DASHBOARD:"Dashboard",ALL_LOCATIONS:"AllLocations",VENDORS:"VendorManagement",DRIVERS:"Drivers",ADHOC_VENDOR:"AdhocVendor",MILKRUN_VENDOR:"MilkrunVendor",FAVORITES:"Favorites",FINANCE:"Finance"};angular.module("constants.module",[]).constant("systemSetting",{serviceUrl:e.apiUrl,simpleDateFormat:"yyyy-MM-dd",isLocal:["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.hostname)>-1}).constant("userConfig",e).constant("defaultTimeZoneOffset",e.defaultTimeZoneOffset).constant("maxNumberOfRecord",2147483647).constant("systemRole",{SuperAdmin:"SuperAdmin",Admin:"Admin",User:"User",Vendor:"Vendor",Driver:"Driver",Finance:"Finance"}).constant("systemRolesConfigs",{SuperAdmin:{navigationItems:[t.ADHOC_TRANSACTIONS,t.MILKRUN_TRANSACTIONS,t.USERS,t.CLIENTS,t.REPORTS,t.LOGS,t.ALL_LOCATIONS,t.VENDORS,t.DRIVERS],defaultRoute:"users"},Admin:{navigationItems:[t.ADHOC_TRANSACTIONS,t.MILKRUN_TRANSACTIONS,t.USERS,t.CLIENTS,t.REPORTS,t.FAVORITES,t.LOGS,t.DASHBOARD,t.VENDORS,t.DRIVERS,t.FINANCE],defaultRoute:"dashboard",cmsRoute:"adhocs/transactions",viewOnly:!0,preventPage:[]},User:{navigationItems:[t.ADHOC_TRANSACTIONS,t.MILKRUN_TRANSACTIONS,t.USERS,t.FAVORITES,t.DASHBOARD,t.FINANCE,t.REPORTS],defaultRoute:"dashboard",cmsRoute:"adhocs/transactions"},Vendor:{navigationItems:[t.ADHOC_VENDOR,t.MILKRUN_VENDOR,t.DRIVERS],defaultRoute:"vendor/adhocs"},Finance:{navigationItems:[],defaultRoute:"financeBillings"}}).constant("setItemPerPage",[{value:10,text:"10 entities"},{value:20,text:"20 entities"},{value:50,text:"50 entities"},{value:100,text:"100 entities"}]).constant("pageName",t).constant("departments",{PSS:{id:1,name:"PSS"},Healthcare:{id:2,name:"Healthcare"}}).constant("pricingType",{Adhoc:1,AdhocExpres:2,MilkRun:3}).constant("weightCategory",{ThreeKg:0,FourKg:1,FiveKg:2,TenKg:3,TwentyKg:4,Extra:5}).constant("milkRunTypes",{none:0,oneToOne:1,oneToMany:2,manyToOne:3,roundTrip:4}).constant("adhocTypes",{none:0,oneToOne:1,oneToMany:2,manyToOne:3,roundTrip:4}).constant("milkRunFrequency",{daily:{value:0,display:"Daily"},twiceADay:{value:1,display:"Twice a day"},weekly:{value:2,display:"Weekly"},projectRun:{value:3,display:"Project run"},threeTimesADay:{value:4,display:"3 times a day"},fourTimesADay:{value:5,display:"4 times a day"}}).constant("days",{monday:{text:"M",value:1,display:"Monday"},tuesday:{text:"T",value:2,display:"Tuesday"},wednesday:{text:"W",value:3,display:"Wednesday"},thursday:{text:"T",value:4,display:"Thursday"},friday:{text:"F",value:5,display:"Friday"}}).constant("milkRunAdditionals",{saturdays:{value:6,display:"Saturdays"},sundays:{value:0,display:"Sundays"},afterOfficeHours:{value:2,display:"After Office Hours"},publicHolidays:{value:3,display:"Public Holidays"}}).constant("milkRunWeight",{upTo5kg:{id:7,text:"Up to 5kg",textImport:"<5"},from5To10kg:{id:8,text:"5 - 10kg",textImport:"5to10"},from10To30kg:{id:9,text:"10 - 30kg",textImport:"10to30"},from30To60kg:{id:10,text:"30 - 60kg",textImport:"30to60"},from60To100kg:{id:11,text:"60 - 100kg",textImport:"60to100"}}).constant("milkRunProgress",{chosenMilkRunType:1,collectionPoint:2,deliveryPoint:3,remark:4,confirmOrder:5}).constant("jobStatusType",{pendingApproval:{value:1,display:"Pending Acceptance"},rejected:{value:2,display:"Rejected"},accepted:{value:3,display:"Accepted"},ongoing:{value:4,display:"On going"},completed:{value:5,display:"Delivered"},deactivated:{value:6,display:"Deactivated"},onHold:{value:7,display:"On hold"},cancelled:{value:8,display:"Cancelled"},readyToBill:{value:9,display:"Ready to Bill"},pendingRejection:{value:10,display:"Pending Rejection"},financeRejected:{value:11,display:"Finance Rejected"},billed:{value:12,display:"Billed"}}).constant("invoiceStatus",{new:{value:1,display:"Pending Acceptance"},invoiced:{value:2,display:"Rejected"},cancelled:{value:3,display:"Accepted"},creditNoted:{value:4,display:"On going"}}).constant("deliveryPointCategory",{one:{value:1,display:"A to 1 point"},two:{value:2,display:"A to 2 point"},five:{value:3,display:"A to 5 point"},ten:{value:4,display:"A to 10 point"},twenty:{value:5,display:"A to 20 point"},fifty:{value:6,display:"A to 50 point"},oneHundred:{value:7,display:"A to 100 point"},fourHundred:{value:8,display:"A to 400 point"}}).constant("adhocWeightCategory",{adhocUptoThreeKg:{value:1,display:"Up to 3kg"},adhocThreeToFourKg:{value:2,display:">3 - 4kg"},adhocFourToFiveKg:{value:3,display:">4 - 5kg"},adhocFiveToTenKg:{value:4,display:">5 - 10kg"},adhocTenToTwentyKg:{value:5,display:">10 - 20kg"},adhocAboveTwenty:{value:6,display:">20kg"}}).constant("milkRunWeightCategory",{milkrunUptoFiveKg:{value:7,display:"Up to 5kg"},milkrunFiveToTenKg:{value:8,display:"> 5 - 10kg"},milkrunThirtyToSixty:{value:9,display:"> 10 - 30kg"},milkrunTenToThirtyKg:{value:10,display:"> 30 - 60kg"},milkrunSixtyToHundred:{value:11,display:"> 60 - 100kg"}}).constant("defaultFixedRunPricing",e.defaultFixedRunPricing).constant("addNewItemReference",e.addNewItemReference).constant("healthCareWeightCategory",{adhocDocument:{value:12,display:"DOCUMENTS (X-Rays, case notes, medical records etc)"},adhocPharmaceutical:{value:13,display:"HOME DELIVERY (Pharmaceutical items)"},adhocSingpostMail:{value:14,display:"SINGPOST MAILS"},adhocParcel:{value:15,display:"PARCELS"},adhocInstrument:{value:16,display:"SOLID INSTRUMENTS"},adhocSpecimen:{value:17,display:"BLOOD SPECIMEN, HUMAN/ANIMAL SPECIMEN"}}).constant("healthCareFixedRunWeightCategory",{document:{value:18,display:"Documents / Parcel & Solid Instruments"},pharmaceutical:{value:19,display:"Pharmaceutical items / Home Delivery / TPN / PPI"},blood:{value:20,display:"Blood / Human Specimens"}}).constant("healthCareDeliveryTiming",{officeHour:{value:4,display:"Office Hours"},officeHourExpress:{value:5,display:"Office Hours (Express)"},weekdayEvening:{value:6,display:"After Office Hours"},weekdayEveningExpress:{value:7,display:"After Office Hours (Express)"},weekend:{value:8,display:"Late Night, Sun & PH"}}).constant("dashboardConst",{maxTickerItems:5}).constant("adhocProgress",{chosenAdhocType:1,collectionPoint:2,deliveryPoint:3,addItem:4,remark:5,confirmOrder:6}).constant("adhocPSSServiceType",{sameDay:{value:2,display:"Same Day Delivery"},nextDay:{value:3,display:"Next Day Delivery"},threeHour:{value:1,display:"3 Hour Delivery"}}).constant("adHocSurcharge",{weekdayEvening:{value:1,display:"Evening, Sat, Sun & Public Holiday"},nonworkingDay:{value:2,display:"Restricted Area"}}).constant("healthCareServiceNote",e.healthCareServiceNote).constant("adhocHealthCareServiceType",{hCOfficeHour:{value:5,display:"Office Hours"},hCOfficeHourExpress:{value:6,display:"Office Hours (Express)"},hCWeekdayEvening:{value:7,display:"After Office Hours"},hCWeekdayEveningExpress:{value:8,display:"After Office Hours (Express)"},hCWeekend:{value:9,display:"Late Night, Sun & PH"}}).constant("uomPSS",["Each","Carton","Bag","Box","Pallet"]).constant("uomHealthCare",["Each","Carton","Bag","Box","Pallet"]).constant("itemsHealthCare",["Documents (X-Rays, case notes, medical records etc)","Home delivery: Pharmaceutical items","Singpost Mails","Parcels","Solid Instruments","Blood/Blood Specimen/Human or Animal Specimen"]).constant("jobGridType",{milkRunJob:"milkRunJob",milkRunTransaction:"milkRunTransaction",adhocJob:"adhocJob",adhocTransaction:"adhocTransaction"}).constant("jobStatus",{pendingApproval:{value:1,display:"Pending Acceptance"},rejected:{value:2,display:"Rejected"},accepted:{value:3,display:"Accepted"},ongoing:{value:4,display:"On going"},delivered:{value:5,display:"Delivered"},deactivated:{value:6,display:"Deactivated"},onHold:{value:7,display:"OnHold"},cancelled:{value:8,display:"Cancelled"},readyToBill:{value:9,display:"Ready to Bill"},pendingRejection:{value:10,display:"Pending Rejection"},financeRejected:{value:11,display:"Finance Rejected"},billed:{value:12,display:"Billed"}}).constant("taskStatus",{pendingCollection:{value:1,display:"Pending Collection"},collecting:{value:2,display:"Collecting"},collected:{value:3,display:"Collected"},collectionFailed:{value:4,display:"Collection Failed"},delivering:{value:5,display:"Delivering"},delivered:{value:6,display:"Delivered"},deliverFailed:{value:7,display:"Delivery Failed"},pendingReturn:{value:8,display:"Pending Return"},returning:{value:9,display:"Returning"},returned:{value:10,display:"Returned"},pendingAssignment:{value:11,display:"Pending Assignment"},pendingDriverAssignment:{value:12,display:"Pending Driver Assignment"},onHold:{value:13,display:"On Hold"},readyToBill:{value:14,display:"Ready to Bill"},financeReject:{value:15,display:"Finance Reject"},billed:{value:16,display:"Billed"},pendingReject:{value:17,display:"To be rejected"}}).constant("cutOffTime",{case1:"case1",case2:"case2",case3:"case3"}).constant("customerDetailMode",{po:"po",sap:"sap",user:"user",cc:"cc"})}(),function(){"use strict";function e(e,t){e.when("/customers",{title:"Client Management",category:"Customers",controller:"CustomerController",templateUrl:"app/components/customer/customers.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]}).when("/customers/create",{title:"Create new client",category:"Customers",controller:"CustomerDetailController",templateUrl:"app/components/customer/detail.html",controllerAs:"vm",authorize:[t.Admin],preventViewOnly:!0}).when("/customers/detail/:id",{title:"Client detail",category:"Customers",controller:"CustomerDetailController",templateUrl:"app/components/customer/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]}).when("/example",{title:"Client detail",category:"Customers",controller:"ExampleController",templateUrl:"app/components/customer/example.html",controllerAs:"vm"})}function t(e,t,n,o){function i(){r(),a()}function r(){l.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:""},l.gridConfig={onClickRowDetail:s,columns:[{name:"organizationCode",display:"Org Code",columnNameSort:"organizationCode",css:"col-md-2"},{name:"name",display:"Org Name",columnNameSort:"name",css:"col-md-2"},{name:"clientType",display:"Client Type",columnNameSort:"departmentId",css:"col-md-2"},{name:"address",display:"Address",columnNameSort:"address",css:"col-md-4"},{name:"sapCodesText",display:"SAP Code",preventSort:!0,css:"col-md-2",isShowMore:!0}]},e.currentUser.role===o.Admin&&l.gridConfig.columns.splice(2,1)}function a(){l.isGridLoading=!0,n.getCustomerByCriteria(l.options).then(function(e){l.options.totalItems=e.data.totalCount,l.customers=n.convertListCustomer(e.data.customers),l.isGridLoading=!1})}function s(e){t.path("/customers/detail/"+e.id)}var l=this;l.systemRole=o,l.getCustomerByCriteria=a,i()}function n(e,t,n,o,i,r,a,s,l){function c(){l.loadGBizCode();var r=t.id;r?(p.isLoading=!0,i.getCustomerById(r).then(function(e){p.clientDetail=i.convertCustomer(e.data),p.originalClient=angular.copy(p.clientDetail),p.isLoading=!1},function(){n.path("/accessDeny")}),p.viewMode=!0):(p.clientDetail={address:{},department:{name:e.currentUser.department},clientTypeId:o[e.currentUser.department].id,sapCodes:[],pricings:[],cutOffTimeFor3HourDelivery:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),11,30,0,0),cutOffTimeForSameDayPickupAndDelivery:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),13,30,0,0),cutOffTimeForSameDayPickupAndNextDayDelivery:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),15,0,0,0)},p.viewMode=!1)}function d(){p.clientDetail.id?(p.clientDetail=angular.copy(p.originalClient),p.viewMode=!0):n.path("/customers")}function u(){var t=!!p.clientDetail.contractEndDate;e.currentUser.department===o.PSS.name&&(t=t&&p.clientDetail.cutOffTimeFor3HourDelivery&&p.clientDetail.cutOffTimeForSameDayPickupAndDelivery&&p.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery),t&&(p.isLoading=!0,p.orgCode=!1,i.saveCustomer(p.clientDetail).then(function(e){p.isLoading=!1;var t=p.clientDetail.id?"The client has been updated successfully.":"The client has been created successfully.";r.success(t),n.path("/customers")},function(e){p.isLoading=!1,"Organization code has been used already"==e.data.message?(p.orgCode=!0,s.createWarningPopup("Organization code has been used already","Warning",null,!0,"OK")):r.error(e.data.message)}))}function m(){p.clientDetail.id&&p.clientDetail.contractEndDate&&p.clientDetail.cutOffTimeForSameDayPickupAndDelivery&&p.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery&&(p.isLoading=!0,i.saveCustomer(p.clientDetail).then(function(e){r.success("The user has been added to this customer successfully."),i.getCustomerById(p.clientDetail.id).then(function(e){p.clientDetail=i.convertCustomer(e.data),p.isLoading=!1},function(){n.path("/accessDeny")})}))}var p=this;p.systemRole=a,p.cancel=d,p.departments=o,p.pssAdhocPricing={},p.healthCareAdhocPricing={},p.newUser={},p.ids=[],p.saveCustomer=u,p.addUserToCustomer=m,c()}function o(e,t){var n=this;n.items=["Barcode","Organisation name","Organisation code","SAP code","Department","Requestor name","Requestor contact","Cost centre","Created date"],n.ngModel=["Organisation name","Organisation code","SAP code","Department","Requestor name","Requestor contact","Cost centre","Created date"],n.toggle=function(){n.isOpen=!n.isOpen},n.bindingCheck=function(e){var t=n.ngModel.find(function(t){return t===e});return!!t},n.onCheck=function(e){for(var t=0;t<n.ngModel.length;t++)if(n.ngModel[t]===e)return void n.ngModel.splice(t,1);n.ngModel.push(id)}}angular.module("customer.module",["ngRoute"]).config(e).controller("CustomerController",t).controller("CustomerDetailController",n).controller("ExampleController",o),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$location","customerService","systemRole"],n.$inject=["$rootScope","$routeParams","$location","departments","customerService","toastr","systemRole","modalService","pricingService"],o.$inject=["fileReaderService","$timeout"]}(),function(){"use strict";function e(e,t,n,o,i,r){function a(){s(),l()}function s(){P.listPricing=P.listPricing||[]}function l(){P.milkRunPricingExist=c(t.MilkRun)>=0,P.adhocPricingExist=c(t.Adhoc)>=0,P.adhocExpresPricingExist=c(t.AdhocExpres)>=0}function c(e){for(var t=0;t<P.listPricing.length;t++)if(P.listPricing[t].pricingType===e)return t;return-1}function d(t){e.currentUser.department===o.PSS.name?u(t):m(t)}function u(e){P.adhocPricingModel=y(e);var t=c(e);t<0&&k(P.adhocPricingModel),C(p,{ngModel:P.adhocPricingModel,viewMode:P.viewMode},"app/components/customer/pricing/adhocPricingModal.html")}function m(e){P.adhocHealthCarePricingModel=y(e),C(g,{ngModel:P.adhocHealthCarePricingModel,viewMode:P.viewMode},"app/components/customer/pricing/healthCarePricingModal.html")}function p(){b(P.adhocPricingModel)}function g(){b(P.adhocHealthCarePricingModel)}function v(){P.milkRunPricingModel=y(t.MilkRun),P.milkRunPricingModel.viewMode=P.viewMode,C(f,P.milkRunPricingModel,"app/components/customer/pricing/milkRunPricingAdvanceModal.html")}function f(){b(P.milkRunPricingModel)}function h(e,t){if(P[t])P[t]=!1,n.createWarningPopup("Please set pricing for this service first!","Warning",null,!0);else{var o=c(e);o>=0&&P.listPricing.splice(o,1)}}function y(n){var i=c(n);return i>=0?angular.copy(P.listPricing[i]):n==t.MilkRun&&e.currentUser.department===o.PSS.name?{pricingType:t.MilkRun,weightCategories:r}:{pricingType:n}}function C(e,t,o){var i={setPricing:e};n.createPopup({templateUrl:o,size:"lg",data:t},i)}function b(e){var t=c(e.pricingType);t>=0?P.listPricing[t]=e:P.listPricing.push(e),l()}function k(e){e.weightCategories=[];for(var t in i)e.weightCategories.push({weightCategoryId:i[t].value,deliveryTimings:[{deliveryTimingId:1},{deliveryTimingId:2},{deliveryTimingId:3}]})}var P=this;P.viewMode=P.viewMode||!1,P.pricingType=t,P.setPricing=d,P.setMilkRunPricing=v,P.checkSetPricing=h,a()}angular.module("customer.module").directive("customerPricing",function(){return{restrict:"E",scope:{viewMode:"=",listPricing:"="},templateUrl:"app/components/customer/pricing/customerPricing.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","pricingType","modalService","departments","adhocWeightCategory","defaultFixedRunPricing"]}(),function(){"use strict";function e(e,t){function n(e){var t={onCreateOrUpdate:a};l.currentIndex=l.listSap.indexOf(e),l.sapDetail=angular.copy(e),s(l.sapDetail,t)}function o(){l.newSap={userIds:[]};var e={onCreateOrUpdate:r};s(l.newSap,e)}function i(e){l.listSap.splice(e,1)}function r(){l.listSap.push(l.newSap)}function a(){l.listSap[l.currentIndex]=l.sapDetail}function s(t,n){e.createPopup({templateUrl:"app/components/customer/sap/sapDetail.html",size:"lg",data:{ngModel:t}},n)}var l=this;l.listSap=l.listSap||[],l.addNewSap=o,l.removeSap=i,l.viewSapDetail=n,l.systemRole=t,l.currentIndex=-1}angular.module("customer.module").directive("customerSap",function(){return{restrict:"E",scope:{listSap:"="},templateUrl:"app/components/customer/sap/customerSap.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["modalService","systemRole"]}(),function(){"use strict";function e(){function e(){}e()}angular.module("customer.module").directive("sapDetail",function(){return{restrict:"E",scope:{sapDetail:"=",onCreateOrUpdate:"&",onCancel:"&"},templateUrl:"app/components/customer/sap/sapDetail/sapDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s){function l(e){A.userDetail=angular.copy(e),A.userDetail.customerId=A.clientDetail.id,h(A.userDetail)}function c(e){s.currentUser.role!==t.SuperAdmin&&(A.poDetail=angular.copy(e),A.poDetail.detailName=e.number,A.poDetail.customerId=A.clientDetail.id,b(A.poDetail))}function d(e){s.currentUser.role!==t.SuperAdmin&&(A.sapDetail=angular.copy(e),A.sapDetail.customerId=A.clientDetail.id,C(A.sapDetail))}function u(e){s.currentUser.role!==t.SuperAdmin&&(A.costCenterDetail=angular.copy(e),A.costCenterDetail.detailName=e.name,A.costCenterDetail.customerId=A.clientDetail.id,k(A.costCenterDetail))}function m(){M[A.displayMode]()}function p(){A.isLoading=!0,o.saveSapCode(A.sapDetail).then(function(e){var t=A.sapDetail.id?"The sap code has been updated successfully.":"The sap code has been created successfully.";D(),i.success(t)},function(e){A.isLoading=!1,i.error(e.data.message)})}function g(){A.isLoading=!0,r.saveUser(A.userDetail).then(function(e){var t=A.userDetail.id?"The user has been updated successfully.":"The user has been created successfully.";D(),i.success(t)},function(e){A.isLoading=!1,i.error(e.data.message)})}function v(){A.isLoading=!0,o.savePoNumber(A.poDetail).then(function(e){var t=A.poDetail.id?"The PO number has been updated successfully.":"The PO number has been created successfully.";D(),i.success(t)},function(e){A.isLoading=!1,i.error(e.data.message)})}function f(){A.isLoading=!0,o.saveCostCenter(A.costCenterDetail).then(function(e){var t=A.costCenterDetail.id?"The SBU has been updated successfully.":"The SBU has been created successfully.";D(),i.success(t)},function(e){A.isLoading=!1,i.error(e.data.message)})}function h(n){var o={onCreateOrUpdate:g,onActivateOrDeactivate:y};e.createPopup({templateUrl:"app/components/customer/user/userDetail.html",size:"lg",data:{ngModel:n,poNumbers:A.clientDetail.poNumbers,sapCodes:angular.copy(A.clientDetail.sapCodes),costCenters:A.clientDetail.costCentres,viewMode:s.currentUser.role===t.SuperAdmin}},o)}function y(){for(var e=0;e<A.clientDetail.users.length;e++)if(A.clientDetail.users[e].id===A.userDetail.id){A.clientDetail.users[e].lockoutEnabled=!A.clientDetail.users[e].lockoutEnabled;break}A.onSearch[A.displayMode](!0)}function C(t){var n={onCreateOrUpdate:p};e.createPopup({templateUrl:"app/components/customer/sap/sapDetail.html",size:"lg",data:{ngModel:t}},n)}function b(t){var n={onCreateOrUpdate:v};e.createPopup({templateUrl:"app/components/customer/poCc/poModal.html",size:"lg",data:{ngModel:t,users:A.clientDetail.users,isPo:!0}},n)}function k(t){var n={onCreateOrUpdate:f};e.createPopup({templateUrl:"app/components/customer/poCc/poModal.html",size:"lg",data:{ngModel:t,users:A.clientDetail.users,isPo:!1}},n)}function P(e){A.displayMode=e,A.onSearch[A.displayMode]()}function D(){o.getCustomerById(A.clientDetail.id).then(function(e){A.clientDetail.users=e.data.applicationUsers,A.clientDetail.sapCodes=e.data.sapCodes,A.clientDetail.poNumbers=e.data.poNumbers,A.clientDetail.costCentres=e.data.costCentres,A.isLoading=!1,A.onSearch[A.displayMode](!0)})}var A=this;A.listUser=A.listUser||[],A.addNew=m,A.viewUserDetail=l,A.viewSapDetail=d,A.viewPoDetail=c,A.viewCostCenterDetail=u,A.systemRole=t,A.customerDetailMode=n,A.displayMode=n.user,A.switchDisplay=P,A.searchTerm="",A.placeHolder={po:"Search by PO number",sap:"Search by SAP code",user:"Search by name, SBU, SAP and contact no",cc:"Search by SBU"},A.search=function(){a(function(){A.onSearch[A.displayMode](!0)})},A.onSearch={};var M={po:function(){A.poDetail={customerId:A.clientDetail.id,userIds:[]},b(A.poDetail)},sap:function(){A.sapDetail={customerId:A.clientDetail.id,userIds:[]},C(A.sapDetail)},cc:function(){A.costCenterDetail={customerId:A.clientDetail.id,userIds:[]},k(A.costCenterDetail)},user:function(){A.userDetail={customerId:A.clientDetail.id},h(A.userDetail)}}}angular.module("customer.module").directive("sectionDetail",function(){return{restrict:"E",scope:{clientDetail:"="},templateUrl:"app/components/customer/sectionDetail/sectionDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["modalService","systemRole","customerDetailMode","customerService","toastr","clientUserService","$timeout","$rootScope"]}(),function(){"use strict";function e(e,t){function n(){i()}function o(e){var t=c.clientDetail.sapCodes.find(function(t){return t.id===e});return t?t.blockNumber+" "+t.streetName+" "+t.unitNumber+" "+t.postalCode:""}function i(e){var t=function(e){return(e.firstName+" "+e.lastName).toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1||e.phoneNumber.indexOf(c.searchTerm)>-1||e.sapCode&&e.sapCode.toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1||e.costCentres&&e.costCentres.toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1};c.listUser=l(e,"userCriteria",c.clientDetail.users,t)}function r(e){var t=function(e){return e.name.toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1};c.listCc=l(e,"ccCriteria",c.clientDetail.costCentres,t)}function a(e){var t=function(e){return e.code.toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1};c.listSap=l(e,"sapCriteria",c.clientDetail.sapCodes,t)}function s(e){var t=function(e){return e.number.toLowerCase().indexOf(c.searchTerm.toLowerCase())>-1};c.listPo=l(e,"poCriteria",c.clientDetail.poNumbers,t)}function l(e,t,n,o){e&&(c[t].currentPage=1);var i=c[t].currentPage-1,r=n.filter(o);return c[t].totalItem=r.length,r=r.slice(i*c[t].itemPerPage,i*c[t].itemPerPage+c[t].itemPerPage)}var c=this;c.setItemPerPage=t,c.userCriteria={currentPage:1,itemPerPage:20},c.ccCriteria={currentPage:1,itemPerPage:20},c.poCriteria={currentPage:1,itemPerPage:20},c.sapCriteria={currentPage:1,itemPerPage:20},c.customerDetailMode=e,c.getBillingAddress=o,c.getUserByCriteria=c.onSearch[e.user]=i,c.getPoByCriteria=c.onSearch[e.po]=s,c.getSapByCriteria=c.onSearch[e.sap]=a,c.getCcByCriteria=c.onSearch[e.cc]=r,n()}angular.module("customer.module").directive("detailUserSap",function(){return{restrict:"E",scope:{displayMode:"=",viewSapDetail:"&",viewPoDetail:"&",viewUserDetail:"&",viewCostCenterDetail:"&",clientDetail:"=",searchTerm:"=",onSearch:"="},templateUrl:"app/components/customer/sectionDetail/detailUserSap.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["customerDetailMode","setItemPerPage"]}(),function(){"use strict";function e(){function e(){r.filteredUsers=angular.copy(r.users)}function t(){r.filteredUsers=r.users.filter(function(e){return(e.firstName+" "+e.lastName).toLowerCase().indexOf(r.searchTerm.toLowerCase())>-1})}function n(){r.isCheckAll=!r.isCheckAll,r.isCheckAll?r.detail.userIds=r.filteredUsers.map(function(e){return e.id}):r.detail.userIds=[]}function o(e){var t=r.detail.userIds.find(function(t){return t===e});return!!t}function i(e){r.isCheckAll=!1;for(var t=0;t<r.detail.userIds.length;t++)if(r.detail.userIds[t]===e)return void r.detail.userIds.splice(t,1);r.detail.userIds.push(e)}var r=this;r.isCheckAll=!1,r.searchTerm="",r.bindingCheck=o,r.onCheck=i,r.selectAll=n,r.filter=t,e()}angular.module("customer.module").directive("poCc",function(){return{restrict:"E",scope:{detail:"=?",users:"=?",onCreateOrUpdate:"&",onCancel:"&",isPo:"="},templateUrl:"app/components/customer/poCc/poCcDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n){function o(){u.ngModel=u.ngModel||[],u.source=u.source||[]}function i(e){var t=u.source.find(function(t){return t.id===e});return t?t[u.fieldKey]:""}function r(){u.filterItems=u.source.filter(function(e){return!!(e[u.fieldKey].toLowerCase().indexOf(u.searchTerm.toLowerCase())>-1&&u.ngModel.indexOf(e.id)===-1)})}function a(e){u.ngModel.push(e.id),u.searchTerm="",u.isOpen=!1}function s(e){u.ngModel.splice(e,1)}function l(){r(),u.isOpen=!0,u.isFocus=!0,document.getElementById("input-"+e.$id).focus()}function c(){u.isOpen=!1,u.isFocus=!1}function d(){u.isLoading=!0,t.createPoOrCC({name:u.searchTerm,customerId:u.customerId,userIds:[]},u.isPo).then(function(e){u.isLoading=!1,u.source.push(e.data),a(e.data),n.success("The "+(u.isPo?"PO":"SBU")+" has been created successfully.")},function(e){u.isLoading=!1,n.error(e.data.message)})}var u=this;u.search=r,u.onSelect=a,u.onRemove=s,u.getValue=i,u.setFocus=l,u.onBlur=c,u.onCreate=d,u.searchTerm="",o()}angular.module("customer.module").directive("multiSelect",function(){return{restrict:"E",scope:{source:"=?",ngModel:"=?",isError:"=?",fieldName:"=?",fieldKey:"=?",isPo:"=?",customerId:"="},templateUrl:"app/components/customer/multiselect/multiselect.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$scope","customerService","toastr"]}(),function(){"use strict";function e(e){e.when("/dashboard",{title:"Dashboard",category:"Dashboard",controller:"DashboardController",templateUrl:"app/components/dashboard/dashboard.html",controllerAs:"vm",authorize:["Admin","User"],hideNavbar:!0,showHeaderDashboardControls:!0,hideFooter:!0,noContainer:!0,darkBg:!0})}function t(e,t,n,o,i,r,a,s,l,c,d,u,m,p,g,v,f,h,y,C){function b(){i(function(){M()})}function k(e){var t=e.target,n=angular.element(t),o=H.contains(t)&&n.hasClass("uib-left"),i=H.contains(t)&&n.hasClass("uib-right"),r=n.parent().hasClass("dashboard__schedule-calendar-date");o?j("prev"):i?j("next"):r&&x()}function P(){var e=V(),t=e?e.clientHeight:0;B.scheduleHeight=n.innerHeight-t-34-10}function D(){B.scheduleJobsStyles={height:B.scheduleHeight-H.clientHeight-52+"px"}}function A(){var e=V(),t=e?e.clientHeight:0;B.spendingsGraphHeight=n.innerHeight-t-34-C.getAbsoluteElHeight(z)-C.getAbsoluteElHeight(q)-C.getAbsoluteElHeight(J)-10}function M(){P(),D(),A(),E()}function S(){angular.element(n).off("resize",b),angular.element(o).off("click",k)}function T(e,t){"boolean"==typeof t||"true"===t||"false"===t?e.isOpen=t:e.isOpen=!e.isOpen}function R(){l.getSummary(B.dateRange.startDate.model,B.dateRange.endDate.model,B.jobType).then(function(e){B.summaryCounts=e.data},function(e){console.warn(e)})}function I(){var e={status:v.pendingApproval.value};switch(B.jobType){case 0:h.getAdhocByCriteria(e).then(function(e){B.pendingJobsCount=e.data.totalCount},function(e){console.warn(e)}).finally(function(){B.pendingJobsLoading=!1,i(function(){M()})});break;case 1:y.getMilkRunByCriteria(e).then(function(e){B.pendingJobsCount=e.data.totalCount},function(e){console.warn(e)}).finally(function(){B.pendingJobsLoading=!1,i(function(){M()})})}}function N(){var e=0===B.jobType?"adhocs/jobs":"milkruns/jobs";r.path(e).search({status:v.pendingApproval.value})}function w(){var e=new Date(B.calendar.yearInView+"-"+B.calendar.monthInView+"-01");B.daysWithJobsLoading=!0,l.getDaysOfMonthWithJobs(e,B.jobType).then(function(e){B.daysWithJobs=e},function(e){console.warn(e)}).finally(function(){B.daysWithJobsLoading=!1,i(function(){P(),D(),angular.element(document.querySelector(".dashboard__schedule-calendar tbody .uib-weeks:nth-child(2) .btn")).triggerHandler("click")})})}function U(e){var t=e.date,n=e.mode;if("day"===n){var o=["dashboard__schedule-calendar-date"],i=new Date,r=new Date(t),a=r.getFullYear()+"-"+(r.getMonth()+1);"undefined"!=typeof B.daysWithJobs[B.jobType]&&"undefined"!=typeof B.daysWithJobs[B.jobType][a]&&B.daysWithJobs[B.jobType][a].indexOf(r.getDate())>-1&&o.push("date-has-jobs");var s=r.setHours(0,0,0,0);return s===i.setHours(0,0,0,0)&&o.push("date-today"),o.push("date-y-"+r.getFullYear()+"-m-"+(r.getMonth()+1)+"-d-"+r.getDate()),o.join(" ")}return""}function j(e){i(function(){"prev"===e?B.calendar.monthInView-=1:B.calendar.monthInView+=1,B.calendar.monthInView<1?(B.calendar.yearInView-=1,B.calendar.monthInView=12):B.calendar.monthInView>12&&(B.calendar.yearInView+=1,B.calendar.monthInView=1),w()})}function x(){i(function(){var e=0===B.jobType?"adhocs/transactions":"milkruns/transactions";r.path(e).search({jobDate:a("date")(new Date(B.calendar.model),s.simpleDateFormat)})})}function $(){B.todaysJobsLoading=!0;var e={jobDate:new Date};switch(B.jobType){case 0:m.getAdhocTaskByCriteria(e).then(function(e){B.todaysJobs=e.data.jobTasks},function(e){console.warn(e)}).finally(function(){B.todaysJobsLoading=!1,
i(E,100)});break;case 1:m.getMilkRunTaskByCriteria(e).then(function(e){B.todaysJobs=e.data.milkRunTasks},function(e){console.warn(e)}).finally(function(){B.todaysJobsLoading=!1,i(E,100)})}}function E(){e.$broadcast("dashboard:scrollbar:rebuild")}function L(){var t="undefined"==typeof B.chartSelection||B.chartSelection.id===-1?void 0:B.chartSelection.id;switch(e.currentUser.role){case"Admin":l.getSpending(B.jobType,t).then(function(e){B.spendings=e.data},function(e){console.warn(e)});break;case"User":l.getSpending(B.jobType,e.currentUser.id,t).then(function(e){B.spendings=e.data},function(e){console.warn(e)})}}function F(e){for(var t in f)if(f[t].value===e)return f[t].display;return"N/A"}function O(e){var t=0===B.jobType?"adhocTask/":"milkrunTask/";r.path(t+e)}var B=this,V=function(){return document.querySelector(".header")},H=document.querySelector(".dashboard__schedule-calendar-wrap"),z=document.querySelector(".dashboard__heading"),q=document.querySelector(".dashboard__donuts-container"),J=document.querySelector(".dashboard__chart-heading");switch(B.jobType=parseInt(e.headerSelectedJob),B.jobTypeNames=["Ad Hoc","Fixed Run"],B.goToJobDetail=O,e.$watch("headerSelectedJob",function(t,n){"undefined"!=typeof t&&parseInt(e.headerSelectedJob)!==B.jobType&&(B.jobType=parseInt(e.headerSelectedJob),L(),$(),R(),w(),I())}),i(function(){M()}),angular.element(n).on("resize",b),angular.element(o).on("click",k),t.$on("$destroy",S),B.tickerShowCta="Admin"===e.currentUser.role,B.tickerCtaLink=g[e.currentUser.role].cmsRoute?"#"+g[e.currentUser.role].cmsRoute:"#"+e.indexRoute,B.tickerItems=[],l.getTrafficUpdates().then(function(e){B.tickerItems=e},function(e){console.warn(e)}),B.datepickerConfig={showWeeks:!1},B.dateRange={startDate:{model:null,isOpen:!1,toggleOpen:function(e){T(this,e)},onChange:R},endDate:{model:null,isOpen:!1,toggleOpen:function(e){T(this,e)},onChange:R}},B.summaryCountsConfig={duration:1500},B.summaryCounts={approved:0,rejected:0,completed:0,scheduled:0},R(),B.pendingJobsLoading=e.currentUser.role===p.Admin,B.pendingJobsCount=0,B.clickPendingBarButton=N,I(),B.daysWithJobsLoading=!0,B.daysWithJobs={},B.calendar={model:"",monthInView:(new Date).getMonth()+1,yearInView:(new Date).getFullYear(),initialLoad:!0,opts:{showWeeks:!1,formatDayTitle:"yyyy MMM",formatDay:"d",formatDayHeader:"EEE",datepickerMode:"day",maxMode:"day",minMode:"day",customClass:U}},w(),B.todaysJobsLoading=!0,B.todaysJobs=[],$(),B.rebuildTodaysJobsScrollbar=E,B.chartSelection,B.chartSelectionList=[],e.currentUser.role){case p.Admin:B.chartSelectionList=[{id:-1,label:"All customers"}],d.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then(function(e){var t=_.map(e.data.customers,function(e){return{id:e.id,label:e.name}});B.chartSelectionList=B.chartSelectionList.concat(t),B.chartSelection=B.chartSelectionList[0]},function(e){console.warn(e)});break;case p.User:B.chartSelectionList=[{id:-1,label:"All SBU"}],u.getClientUserById(e.currentUser.id).then(function(e){var t=_.map(e.data.costCentre?e.data.costCentre.split(","):[],function(e){return{id:e,label:e}});B.chartSelectionList=B.chartSelectionList.concat(t),B.chartSelection=B.chartSelectionList[0]},function(e){console.warn(e)})}B.onChartSelectionChange=function(){L()},B.spendings=[],L(),B.getTextStatus=F}angular.module("dashboard.module",["ngRoute"]).config(e).controller("DashboardController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$scope","$window","$document","$timeout","$location","$filter","systemSetting","dashboardService","dashboardConst","customerService","clientUserService","taskService","systemRole","systemRolesConfigs","jobStatus","taskStatus","adhocService","milkrunService","utilityService"]}(),function(){"use strict";function e(e){e.when("/users",{title:"User management",category:"Users",controller:"SpAdminUserController",templateUrl:"app/components/spAdminUser/users.html",controllerAs:"vm",authorize:["SuperAdmin"]}).when("/users/create",{title:"New admin",category:"Users",controller:"SpAdminUserDetailController",templateUrl:"app/components/spAdminUser/detail.html",controllerAs:"vm",authorize:["SuperAdmin"]}).when("/users/detail/:id",{title:"Admin detail",category:"Users",controller:"SpAdminUserDetailController",templateUrl:"app/components/spAdminUser/detail.html",controllerAs:"vm",authorize:["SuperAdmin"]})}function t(e,t,n){function o(){i(),r()}function i(){s.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",department:"",roles:"Finance,Admin"},s.gridConfig={onClickRowDetail:a,columns:[{name:"name",display:"Name",columnNameSort:"firstName"},{name:"email",display:"Email",columnNameSort:"email"},{name:"phoneNumber",display:"Contact number",columnNameSort:"phoneNumber"},{name:"roleName",display:"Role",preventSort:!0},{name:"departmentName",display:"Department",preventSort:!0},{name:"status",display:"Status",columnNameSort:"lockoutEnabled"}]},s.departments=[{id:"",name:"All"},n.PSS,n.Healthcare],s.roles=[{id:"Finance,Admin",name:"All"},{id:"Admin",name:"Admin"},{id:"Finance",name:"Finance"}]}function r(){s.isGridLoading=!0,t.getAdminUserByCriteria(s.options).then(function(e){s.options.totalItems=e.data.totalCount;var t=e.data.users;angular.forEach(t,function(e){e.name=e.firstName+" "+e.lastName,e.status=e.lockoutEnabled?"Inactive":"Active"}),s.users=t,s.isGridLoading=!1})}function a(t){"Finance"===t.roleName?e.path("/finance-users/detail/"+t.id):e.path("/users/detail/"+t.id)}var s=this;s.getAdminUserByCriteria=r,o()}function n(e,t,n,o,i,r){function a(){var t=e.id;t?(n.getAdminUserById(t).then(function(e){m.userDetail=e.data,m.userDetail.adminType=m.userDetail.viewOnly.toString(),m.originalEmail=m.userDetail.email}),m.viewMode=!0):m.viewMode=!1}function s(){m.viewMode=!1}function l(){m.isSaving=!0,m.userDetail.viewOnly="true"===m.userDetail.adminType,n.saveAdminUser(m.userDetail).then(function(e){m.isSaving=!1;var n=m.userDetail.id?"The admin has been updated successfully.":"The admin has been created successfully.";i.success(n),t.path("/users")},function(e){m.isSaving=!1})}function c(){var e=m.userDetail.lockoutEnabled?"Are you sure you want to activate this admin?":"Are you sure you want to deactivate this admin?";r.createWarningPopup(e,"Warning",d)}function d(){n.activateOrDeactivate(m.userDetail).then(function(e){var t=m.userDetail.lockoutEnabled?"The admin has been activated successfully.":"The admin has been deactivated successfully.";m.userDetail.lockoutEnabled=!m.userDetail.lockoutEnabled,i.success(t)})}function u(){!m.userDetail||m.userDetail.id&&m.userDetail.email===m.originalEmail||n.checkEmailExist(m.userDetail.email).then(function(e){m.emailExist=!0},function(e){m.emailExist=!1})}var m=this;m.departments=[{id:void 0,name:"Please select ..."},o.PSS,o.Healthcare],m.roles=[{text:"Please select ...",value:void 0},{text:"Full Access Admin",value:"false"},{text:"View Only Admin",value:"true"}],m.edit=s,m.save=l,m.activateOrDeactivate=c,m.checkEmailExist=u,a()}angular.module("spAdminUser.module",["ngRoute"]).config(e).controller("SpAdminUserController",t).controller("SpAdminUserDetailController",n),e.$inject=["$routeProvider"],t.$inject=["$location","adminUserService","departments"],n.$inject=["$routeParams","$location","adminUserService","departments","toastr","modalService"]}(),function(){"use strict";function e(e){e.when("/login",{title:"Login",controller:"AccountController",templateUrl:"app/components/account/login.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0}).when("/account/forgot",{title:"Forgot password",controller:"AccountController",templateUrl:"app/components/account/forgot.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0}).when("/reset",{title:"Reset password",controller:"ResetController",templateUrl:"app/components/account/reset.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0}).when("/account/activate",{title:"Activate account",controller:"AccountController",templateUrl:"app/components/account/activate.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0})}function t(e,t,n,o){function i(){return l.email&&l.password?(l.isLoginInProgress=!0,void t.login(l.email,l.password).then(function(e){l.isLoginInProgress=!1,s(e)}).catch(function(e){l.password="",l.isLoginInProgress=!1,l.wrongPassword=!0,l.errorMessage=e.data.message,"Account has been locked out"===l.errorMessage&&(l.errorMessage="This account has been deactivated")})):(l.wrongPassword=!0,void(l.errorMessage="Please enter username and password."))}function r(){n.path("/login")}function a(){return l.email?(l.isLoading=!0,void t.resetPassword(l.email).then(function(e){l.isLoading=!1,l.isSentResetPassword=!0}).catch(function(e){l.isLoading=!1,l.userNotFound=!0,l.errorMessage=e.data.message,l.isSentResetPassword=!1})):void(l.wrongPassword=!0)}function s(t){e.currentUser=t,e.indexRoute="#"+o[e.currentUser.role].defaultRoute,n.path("/"+o[e.currentUser.role].defaultRoute)}var l=this;l.login=i,l.activateAccount=r,l.resetPassword=a,l.password="",l.isLoginInProgress=!1,l.wrongPassword=!1}function n(e,t,n){function o(){i.resetModel.resetPasswordToken=t.search().token.replace(/ /g,"+"),i.resetModel.userId=t.search().userId,e.confirmResetPassword(i.resetModel).then(function(e){t.url(t.path()),t.path("/login"),n.success("Reset password successfully")}).catch(function(e){n.error(e.data.message)})}var i=this;i.updatePassword=o}angular.module("account.module",["ngRoute"]).config(e).controller("AccountController",t).controller("ResetController",n),e.$inject=["$routeProvider"],t.$inject=["$rootScope","authService","$location","systemRolesConfigs"],n.$inject=["authService","$location","toastr"]}(),function(){"use strict";function e(e){e.when("/clientUsers",{title:"User Client management",category:"Users",controller:"AdminUserController",templateUrl:"app/components/adminUser/clientUsers.html",controllerAs:"vm",authorize:["Admin","User"]})}function t(e,t,n,o,i,r){function a(){s(),e.currentUser.role===i.User?n.getClientUserById(e.currentUser.id).then(function(e){m.options.organizationCode=e.data.organizationCode,l()}):l()}function s(){m.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",department:e.currentUser.department},m.gridConfig={onClickRowDetail:c,columns:[{name:"name",display:"Name",css:"col-md-2",columnNameSort:"name"},{name:"email",display:"Email",css:"col-md-2 email",columnNameSort:"email"},{name:"phoneNumber",display:"Contact no",css:"column-user-phoneNumer",columnNameSort:"contact"},{name:"costCentres",display:"SBU",css:"column-user-costCentre",preventSort:!0},{name:"sapCode",display:"SAP",preventSort:!0},{name:"organizationCode",display:"Org code",css:"column-user-orgCode",columnNameSort:"organizationCode"},{name:"status",display:"Status",preventSort:!0}]}}function l(){m.isGridLoading=!0,n.getClientUserByCriteria(m.options).then(function(e){m.options.totalItems=e.data.totalCount,m.users=n.convertListUser(e.data.users),m.isGridLoading=!1})}function c(t){e.currentUser.role===i.User||e.currentUser.viewOnly||(m.isGridLoading=!0,r.getCustomerById(t.customerId).then(function(e){n.getClientUserById(t.id).then(function(t){m.isGridLoading=!1,m.userDetail=t.data;var n={onCreateOrUpdate:u,onActivateOrDeactivate:l},o={ngModel:m.userDetail,poNumbers:e.data.poNumbers,sapCodes:e.data.sapCodes,costCenters:e.data.costCentres};d(o,n)})}))}function d(e,n){t.createPopup({templateUrl:"app/components/customer/user/userDetail.html",size:"lg",data:e},n)}function u(){m.isGridLoading=!0,n.updateClientUser(m.userDetail).then(function(e){o.success("The user has been updated successfully."),l()})}var m=this;m.userDetail={},m.getUserByCriteria=l,m.openDetailModal=c,a()}angular.module("adminUser.module",["ngRoute"]).config(e).controller("AdminUserController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","modalService","clientUserService","toastr","systemRole","customerService"]}(),function(){"use strict";function e(e,t){e.when("/milkruns/:view?/:jobId?",{title:"Fixed Run",category:"MilkrunTransactions",controller:"MilkrunManagementController",templateUrl:"app/components/milkrun/milkruns.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]}).when("/milkrun/create",{title:"Create new Fixed Run",category:"MilkrunTransactions",controller:"MilkRunDetailController",templateUrl:"app/components/milkrun/detail.html",controllerAs:"vm",authorize:[t.Admin,t.User],preventViewOnly:!0,resolve:{checkContractDateExpire:o}}).when("/milkrun/detail/:id",{title:"Fixed Run detail",category:"MilkrunTransactions",controller:"MilkRunDetailController",templateUrl:"app/components/milkrun/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]})}function t(e,t,n,o,i,r,a,s){function l(){c(),p()}function c(){var o="undefined"!=typeof n.search().jobDate&&n.search().jobDate.length>0?new Date(n.search().jobDate):"",i="undefined"!=typeof n.search().status&&isFinite(n.search().status)?n.search().status:"";g.options={itemPerPage:20,currentPage:1,customer:"",status:i,requestType:"",hasPo:""},g.transactionOptions={itemPerPage:20,currentPage:1,customer:"",status:"",requestType:"",jobDate:o,vendor:"",jobId:t.jobId},g.gridConfig={columns:[{name:"id",display:"ID"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"frequency",display:"Frequency"},{name:"status",display:"Status"},{name:"poNumber",display:"PO"},{name:"collectionPoints",display:"Collection point"},{name:"deliveryPoints",display:"Delivery point"},{name:"createdBy",display:"Created by"}]},g.gridConfigTransation={columns:[{name:"barcode",display:"Barcode"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"frequency",display:"Frequency"},{name:"status",display:"Status"},{name:"jobDate",display:"Job date"},{name:"collectionPoints",display:"Collection point"},{name:"deliveryPoints",display:"Delivery point"},{name:"vendor",display:"Vendor name"},{name:"createdBy",display:"Created by"}]},e.currentUser&&e.currentUser.role===r.User&&(g.gridConfig.columns.splice(1,1),g.gridConfigTransation.columns.splice(1,1),g.gridConfigTransation.columns.splice(7,1))}function d(){g.isLoading=!0,o.getMilkRunByCriteria(g.options).then(function(e){g.listMilkRun=o.convertListMilkRun(e.data.milkRuns),g.options.totalItems=e.data.totalCount,g.isLoading=!1})}function u(){g.isLoading=!0,s.getMilkRunTaskByCriteria(g.transactionOptions).then(function(e){g.listMilkRunTask=s.convertListMilkRunTask(e.data.milkRunTasks),g.transactionOptions.totalItems=e.data.totalCount,g.isLoading=!1})}function m(e){g.isJob=e,p(),n.path(e?"/milkruns/jobs":"/milkruns/transactions")}function p(){g.isJob?d():u()}var g=this;g.isJob="transactions"!==t.view,g.jobStatusType=i,g.systemRole=r,g.jobGridType=a,g.getMilkRunByCriteria=d,g.getMilkRunTaskByCriteria=u,g.switchDisplayJob=m,l()}function n(e,t,n,o,i,r,a,s,l){function c(){l.loadGBizCode(),t.id?d():(p.viewMode=!1,p.milkrunDetail={milkRunType:e.oneToOne,jobBillingType:1,collectionPoints:[{editMode:!0}],deliveryPoints:[{editMode:!0}]})}function d(){p.viewMode=!0,p.loadingDetail=!0,o.getMilkRunById(t.id).then(function(e){p.milkrunDetail=o.convertMilkRun(e.data),p.originalJob=angular.copy(p.milkrunDetail),p.loadingDetail=!1,p.canEdit=p.milkrunDetail.jobStatus!==r.readyToBill.value&&p.milkrunDetail.jobStatus!==r.pendingRejection.value&&p.milkrunDetail.jobStatus!==r.billed.value},function(){i.path("/accessDeny")})}function u(){p.milkrunDetail=angular.copy(p.originalJob)}function m(){p.cancelData={jobId:p.milkrunDetail.id,cancelDate:new Date,charge:0},s.createPopup({templateUrl:"app/components/milkrun/cancelJobModal.html",size:"md",data:p.cancelData},{onCancel:function(){p.isLoading=!0,o.cancelJob(p.cancelData).then(function(e){d(),a.success("This job has been canceled successfully!"),p.isLoading=!1},function(e){a.error(e.data.message),p.isLoading=!1})}})}var p=this;p.systemRole=n,p.milkRunTypes=e,p.jobStatus=r,p.getJobDetail=d,p.cancel=u,p.cancelJob=m,c()}function o(e,t,n,o,i){e.currentUser.role===i.User&&o.checkContractExpire(e.currentUser.customerId).then(function(e){e&&(n.createWarningPopup("Unable to create new jobs, Please contact STLogs Admin.","Warning",null,!0,"OK"),t.history.back())})}angular.module("milkRun.module",["ngRoute"]).config(e).controller("MilkrunManagementController",t).controller("MilkRunDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$routeParams","$location","milkrunService","jobStatusType","systemRole","jobGridType","taskService"],n.$inject=["milkRunTypes","$routeParams","systemRole","milkrunService","$location","jobStatus","toastr","modalService","pricingService"],o.$inject=["$rootScope","$window","modalService","customerService","systemRole"]}(),function(){"use strict";function e(e){e.when("/logs",{title:"Logs management",category:"Logs",controller:"LogController",templateUrl:"app/components/log/logs.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"]})}function t(e,t){function n(){o(),i()}function o(){r.options={itemPerPage:20,currentPage:1,dateFrom:"",dateTo:"",role:"",action:"",userSearch:"",descriptionSearch:""},r.roles=[{text:"All",value:""},{text:"Super Admin",value:"SuperAdmin"},{text:"Admin",value:"Admin"},{text:"User",value:"User"},{text:"Driver",value:"Driver"},{text:"Vendor",value:"Vendor"}],r.actions=[{text:"All",value:""},{text:"Create",value:"Created"},{text:"Modify",value:"Modified"},{text:"Delete",value:"Deleted"},{text:"Cancel",value:"Cancelled"},{text:"Approve",value:"Approved"},{text:"Reject",value:"Rejected"},{text:"Login",value:"Logged In"}]}function i(){r.isLoading=!0,t.getLogByCriteria(r.options).then(function(e){r.logs=e.data.logs,r.options.totalItems=e.data.totalCount,r.isLoading=!1})}var r=this;r.setItemPerPage=e,r.getLogByCriteria=i,n()}angular.module("log.module",["ngRoute"]).config(e).controller("LogController",t),e.$inject=["$routeProvider"],t.$inject=["setItemPerPage","logService"]}(),function(){"use strict";function e(e){e.when("/reports",{title:"Report management",category:"Reports",controller:"ReportController",templateUrl:"app/components/report/reports.html",controllerAs:"vm",authorize:["SuperAdmin","Admin","User"]})}function t(e,t,n,o,i,r,a,s,l,c){function d(){g(),f(),y(),c.currentUser.role!==o.User&&v(),C(),h(),A.separators={SAPCode:",",DriverRemark:""},A.showMoreColumns=["SAPCode","DriverRemark"]}function u(e){e.stopPropagation(),A.isOpen=!A.isOpen}function m(e){var t=A.selectedColumns.find(function(t){return t===e});return!!t}function p(e,t){e.stopPropagation();for(var n=0;n<A.selectedColumns.length;n++)if(A.selectedColumns[n]===t)return A.selectedColumns.splice(n,1),void b();A.selectedColumns.push(t),b()}function g(){var e=function(){var e=!1;e=this.pageYOffset>=460,a.$apply(function(){A.stickHeader=e;var t=document.getElementById("stick-header");t&&(t.scrollLeft=document.getElementById("report").scrollLeft)})};angular.element(r).bind("scroll",e),angular.element(document.getElementById("report")).bind("scroll",function(){var e=document.getElementById("stick-header");e&&(e.scrollLeft=document.getElementById("report").scrollLeft)});var t=function(){A.isOpen=!1,a.$apply()};s.bind("click",t),a.$on("$destroy",function(){angular.element(r).off("scroll",e),angular.element(s).off("click",t)})}function v(){n.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then(function(e){A.customers=n.convertListCustomerDropDownList(e.data.customers),A.reportCustomer=e.data.customers.map(function(e){return{id:e.id,name:e.organizationCode+" "+e.name}})})}function f(){A.departments=[{id:"",name:"All"},i.PSS,i.Healthcare],A.options={itemPerPage:20,currentPage:1,fromDate:"",toDate:"",type:"0",customer:"",departmentId:"",searchTerm:""}}function h(){A.isLoading=!0,t.getReportByCriteria(A.options).then(function(e){A.listReport=t.convertListReport(e.data.reports,A.options.type),A.options.totalItems=e.data.totalCount,A.isLoading=!1})}function y(){var e={User:[5,7,9,10,20,21,29,30]};A.allColumns=D(),A.columns=Object.keys(A.allColumns).map(function(e){return{name:e,value:A.allColumns[e].value,text:A.allColumns[e].text,type:A.allColumns[e].type}});var t=e[c.currentUser.role];t&&(A.columns=A.columns.filter(function(e){return t.indexOf(e.value)===-1}))}function C(){A.selectedColumns=[],t.getColumns(A.options.type).then(function(e){A.selectedColumns=e.data})}function b(){A.isLoading=!0,t.updateColumns(A.selectedColumns).then(function(e){A.isLoading=!1})}function k(){A.exportOptions={type:"0",customerIds:[],columns:angular.copy(A.selectedColumns)},l.createPopup({templateUrl:"app/components/report/exportDetailModal.html",size:"lg",data:{ngModel:A.exportOptions,customers:A.reportCustomer,columns:angular.copy(A.columns)}},{onExport:P})}function P(){t.updateColumns(A.exportOptions.columns).then(function(e){C()}),A.isLoading=!0,t.exportCsv(A.exportOptions).then(function(e){var t=document.createElement("a");t.href="data:attachment/csv,"+encodeURIComponent(e.data),t.target="_blank",t.download="report.csv",t.click(),A.isLoading=!1})}function D(){return{BarcodeNumber:{value:1,text:"Barcode Number"},OrganizationName:{value:2,text:"Organization Name"},OrganizationCode:{value:3,text:"Organization Code"},SAPCode:{value:4,text:"SAP Code"},Department:{value:5,text:"Department"},RequestorName:{value:6,text:"Requestor Name"},RequestorContact:{value:7,text:"Requestor Contact"},CostCenter:{value:8,text:"SBU"},BillingAddress:{value:9,text:"Billing Address"},RequestDate:{value:10,text:"Request Date & Time"},JobType:{value:11,text:"Job Type"},TypeAdHoc:{value:12,text:"Type of Adhoc",type:"0"},TypeService:{value:13,text:"Type of Service",type:"0"},TypeFixedRun:{value:14,text:"Type of Fixed Run",type:"1"},Frequency:{value:15,text:"Frequency",type:"1"},CollectionAddress:{value:16,text:"Collection Address"},ScheduledCollectionDate:{value:17,text:"Schedule Collection Date"},DeliveryAddress:{value:18,text:"Delivery Address"},ScheduledDeliveryDate:{value:19,text:"Schedule Delivery Date"},NumberItems:{value:20,text:"Number of Item"},ItemDescription:{value:21,text:"Item Description"},Charge:{value:22,text:"Itemised Charge (S$)"},AdditionalCost:{value:23,text:"Additional Charge (S$)"},TotalCost:{value:24,text:"Total Charge (S$)"},Status:{value:25,text:"Status"},POCTimestamp:{value:26,text:"POC Captured"},PODTimestamp:{value:27,text:"POD Captured"},CreatedBy:{value:28,text:"Created By"},VendorName:{value:29,text:"Vendor Name"},DriverName:{value:30,text:"Driver Name"},VehicleNumber:{value:37,text:"Vehicle Number"},DriverRemark:{value:31,text:"Driver Remark"},PhotoPresent:{value:32,text:"Photo Present"},SurchargesJob:{value:33,text:"Surcharges By Job"},AdditionalSurcharges:{value:34,text:"Additional Surcharges"},Remark:{value:35,text:"Remark"},Reattempt:{value:36,text:"Reattempt"}}}var A=this;A.setItemPerPage=e,A.systemRole=o,A.getReportByCriteria=h,A.onExport=k,A.toggle=u,A.bindingCheck=m,A.onCheck=p,A.stickHeader=!1,d()}angular.module("report.module",["ngRoute"]).config(e).controller("ReportController",t),e.$inject=["$routeProvider"],t.$inject=["setItemPerPage","reportService","customerService","systemRole","departments","$window","$scope","$document","modalService","$rootScope"]}(),function(){"use strict";function e(e){function t(){a.filteredCustomers=angular.copy(a.customers),a.detail.fromDate=new Date,a.detail.fromDate.setDate(1),a.detail.toDate=new Date}function n(){a.filteredCustomers=a.customers.filter(function(e){return e.name.toLowerCase().indexOf(a.searchTerm.toLowerCase())>-1})}function o(e){e?(a.isCheckAllColumn=!a.isCheckAllColumn,a.isCheckAllColumn?a.detail.columns=a.columns.map(function(e){return e.value}):a.detail.columns=[]):(a.isCheckAll=!a.isCheckAll,a.isCheckAll?a.detail.customerIds=a.filteredCustomers.map(function(e){return e.id}):a.detail.customerIds=[])}function i(e,t){if(t){var n=a.detail.columns.find(function(t){return t===e});return!!n}var n=a.detail.customerIds.find(function(t){return t===e});return!!n}function r(e,t){if(t){a.isCheckAllColumn=!1;for(var n=0;n<a.detail.columns.length;n++)if(a.detail.columns[n]===e)return void a.detail.columns.splice(n,1);a.detail.columns.push(e)}else{a.isCheckAll=!1;for(var n=0;n<a.detail.customerIds.length;n++)if(a.detail.customerIds[n]===e)return void a.detail.customerIds.splice(n,1);a.detail.customerIds.push(e)}}var a=this;a.systemRole=e,a.searchTerm="",a.isCheckAll=!1,a.isCheckAllColumn=!1,a.bindingCheck=i,a.onCheck=r,a.selectAll=o,a.filter=n,t()}angular.module("report.module").directive("exportDetail",function(){return{restrict:"E",scope:{detail:"=?",columns:"=?",customers:"=?",onExport:"&",onCancel:"&"},templateUrl:"app/components/report/exportDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["systemRole"]}(),function(){"use strict";function e(e){e.when("/allLocations",{title:"All Locations",category:"AllLocations",controller:"AllLocationsController",templateUrl:"app/components/allLocations/allLocations.html",controllerAs:"vm",authorize:["SuperAdmin"]})}function t(e,t,n,o,i){function r(){e.downloadFile()}function a(){e.lastUpdate().then(function(e){var t=new Date(e.data);c.lastUpdate=n("date")(t,"medium","+0800")})}function s(n){c.fileUploading=!0,e.uploadFile(c.file).then(function(e){a(),c.isLoading=!1,c.file=null,c.fileUploading=!1,t.success("File processed successfully."),i(function(){c.fileUploadProgress=null},1500)},function(e){t.error("The file upload failed. Please check the format and your connection and try again."),c.isLoading=!1,c.fileUploading=!1},function(e){var n=parseInt(100*e.loaded/e.total);c.fileUploadProgress=n,100!=n||c.isLoading||(c.isLoading=!0,t.success("The file is uploaded and being processed."))})}function l(e){c.file=e,console.log("fire")}var c=this;c.downloadFile=r,c.uploadFile=s,c.file=null,c.onFileSelect=l,c.fileUploading=!1,c.fileUploadProgress=null,c.fileUploadProgressPercentage="0%",o.$watch(function(){return c.fileUploadProgress},function(e){"number"==typeof e?c.fileUploadProgressPercentage=e+"%":c.fileUploadProgressPercentage="0%"}),a()}angular.module("allLocations.module",["ngRoute"]).config(e).controller("AllLocationsController",t),e.$inject=["$routeProvider"],t.$inject=["allLocationsService","toastr","$filter","$scope","$timeout"]}(),function(){"use strict";function e(e,t){e.when("/profile",{title:"Profile",controller:"ProfileController",templateUrl:"app/components/profile/profiles.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User,t.Vendor]})}function t(e,t,n,o,i,r){function a(){s.isLoading=!0;var a;return e.currentUser.role===n.SuperAdmin?void t.path("/customers"):(e.currentUser.role===n.Admin&&(a=o.getAdminUserById),e.currentUser.role===n.User&&(a=i.getClientUserById),e.currentUser.role===n.Vendor&&(a=r.getVendorById),void a(e.currentUser.id).then(function(e){s.userDetail=e.data,s.isLoading=!1}))}var s=this;s.systemRole=n,a()}angular.module("profile.module",["ngRoute"]).config(e).controller("ProfileController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$location","systemRole","adminUserService","clientUserService","vendorService"]}(),function(){"use strict";function e(e,t){e.when("/vendors",{title:"Vendor Management",category:"VendorManagement",controller:"VendorManagementController",templateUrl:"app/components/vendor/vendors.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]}).when("/vendors/create",{title:"Create new vendor",category:"VendorManagement",controller:"VendorDetailController",templateUrl:"app/components/vendor/detail.html",controllerAs:"vm",authorize:[t.Admin],preventViewOnly:!0}).when("/vendors/detail/:id",{title:"Client detail",category:"VendorManagement",controller:"VendorDetailController",templateUrl:"app/components/vendor/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]})}function t(e,t,n,o,i){function r(){a(),s()}function a(){c.departments=[{id:"",name:"All"},o.PSS,o.Healthcare],c.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",departmentId:""},c.gridConfig={onClickRowDetail:l,columns:[{name:"organization",display:"Organization name",columnNameSort:"organizationName"},{name:"organizationCode",display:"Organization code",columnNameSort:"organizationCode"},{name:"contactPerson",display:"Contact person",columnNameSort:"contactPerson"},{name:"phoneNumber",display:"Contact number",columnNameSort:"phoneNumber"},{name:"alternativeContactPerson",display:"Alternative contact person",columnNameSort:"alternativeContactPerson"},{name:"alternativePhoneNumber",display:"Alternative contact number",columnNameSort:"alternativePhoneNumber"},{name:"workAddress",display:"Address",columnNameSort:"workAddress"},{name:"status",display:"Status",preventSort:!0}]}}function s(){c.isGridLoading=!0,n.getVendorByCriteria(c.options).then(function(e){c.options.totalItems=e.data.totalCount,c.vendors=n.convertListVendor(e.data.users),c.isGridLoading=!1})}function l(e){t.path("/vendors/detail/"+e.id)}var c=this;c.systemRole=i,c.getVendorByCriteria=s,r()}function n(e,t,n,o,i,r,a){function s(){var r=t.id;r?(p.isLoading=!0,i.getVendorById(r).then(function(e){p.vendorDetail=i.convertVendor(e.data),p.originalVendor=angular.copy(p.vendorDetail),p.isLoading=!1},function(){n.path("/accessDeny")}),p.viewMode=!0):(p.vendorDetail={department:{name:e.currentUser.department,id:o[e.currentUser.department].id},workAddress:{}},p.viewMode=!1)}function l(){p.vendorDetail.id?(p.vendorDetail=angular.copy(p.originalVendor),p.viewMode=!0):n.path("/vendors")}function c(){p.isLoading=!0,i.deactivateVendor(p.vendorDetail.id).then(function(e){p.isLoading=!1;var t="The vendor "+p.vendorDetail.name+" has been deactivated.";r.success(t),n.path("/vendors")})}function d(){p.isLoading=!0,i.activateVendor(p.vendorDetail.id).then(function(e){p.isLoading=!1;var t="The vendor "+p.vendorDetail.name+" has been activated.";r.success(t),n.path("/vendors")})}function u(){p.isLoading=!0,i.saveVendor(p.vendorDetail).then(function(e){var t=p.vendorDetail.id?"The vendor has been updated successfully.":"The vendor has been created successfully.";r.success(t),n.path("/vendors")}).catch(function(e){r.error(e.data.message)}).finally(function(){p.isLoading=!1})}function m(){!p.vendorDetail||p.vendorDetail.id&&p.vendorDetail.email===p.originalEmail||i.checkEmailExist(p.vendorDetail.email).then(function(e){p.emailExist=!0},function(e){p.emailExist=!1})}var p=this;p.systemRole=a,p.saveVendor=u,p.deactivateVendor=c,p.activateVendor=d,p.checkEmailExist=m,p.cancel=l,s()}angular.module("vendorManagement.module",["ngRoute"]).config(e).controller("VendorManagementController",t).controller("VendorDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$location","vendorService","departments","systemRole"],n.$inject=["$rootScope","$routeParams","$location","departments","vendorService","toastr","systemRole"]}(),function(){"use strict";function e(e,t){e.when("/adhocs/:view?/:jobId?",{title:"Ad Hoc",category:"AdhocTransactions",controller:"AdhocManagementController",templateUrl:"app/components/adhoc/adhocs.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]}).when("/adhoc/create",{title:"Create new Adhoc Job",category:"AdhocTransactions",controller:"AdhocDetailController",templateUrl:"app/components/adhoc/detail.html",controllerAs:"vm",authorize:[t.Admin,t.User],preventViewOnly:!0,resolve:{checkContractDateExpire:o}}).when("/adhoc/detail/:id",{title:"Adhoc Job detail",category:"AdhocTransactions",controller:"AdhocDetailController",templateUrl:"app/components/adhoc/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User,t.Finance]}).otherwise({redirectTo:"/adhocs"})}function t(e,t,n,o,i,r,a){function s(){l(),m()}function l(){var o="undefined"!=typeof n.search().jobDate&&n.search().jobDate.length>0?new Date(n.search().jobDate):"",r="undefined"!=typeof n.search().status&&isFinite(n.search().status)?n.search().status:"";p.options={itemPerPage:20,currentPage:1,
customer:"",status:r,requestType:"",hasPo:""},p.transactionOptions={itemPerPage:20,currentPage:1,customer:"",status:"",requestType:"",jobDate:o,vendor:"",jobId:t.jobId},p.gridConfig={columns:[{name:"id",display:"ID"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"requestType",display:"Request type"},{name:"status",display:"Status"},{name:"poNumber",display:"PO"},{name:"collectionPoints",display:"Pick up point"},{name:"deliveryPoints",display:"Delivery point"},{name:"createdBy",display:"Created by"}]},p.gridConfigTransation={columns:[{name:"barcode",display:"Barcode"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"requestType",display:"Request type"},{name:"status",display:"Status"},{name:"collectionPoint",display:"Collection point"},{name:"pickUpDate",display:"Pick up Date & Time"},{name:"deliveryPoint",display:"Delivery point"},{name:"deliveryDate",display:"Delivery Date & Time"},{name:"vendor",display:"Vendor Name"},{name:"createdBy",display:"Created by"},{name:"amount",display:"Amount"},{name:"POC",display:"POC"},{name:"POD",display:"POD"}]},e.currentUser&&e.currentUser.role===i.User&&(p.gridConfig.columns.splice(1,1),p.gridConfigTransation.columns.splice(1,1),p.gridConfigTransation.columns.splice(8,1))}function c(){p.isLoading=!0,r.getAdhocByCriteria(p.options).then(function(e){p.listJob=r.convertListAdhoc(e.data.jobs),p.options.totalItems=e.data.totalCount,p.isLoading=!1})}function d(){p.isLoading=!0,a.getAdhocTaskByCriteria(p.transactionOptions).then(function(e){p.listTask=a.convertListAdhocTask(e.data.jobTasks),p.transactionOptions.totalItems=e.data.totalCount,p.isLoading=!1})}function u(e){p.isJob=e,m(),n.path(e?"/adhocs/jobs":"/adhocs/transactions")}function m(){p.isJob?c():d()}var p=this;p.isJob="transactions"!==t.view,p.jobGridType=o,p.systemRole=i,p.switchDisplayJob=u,p.getJobByCriteria=c,p.getTaskByCriteria=d,s()}function n(e,t,n,o,i,r,a,s){function l(){a.loadGBizCode(),e.id?d():(u.viewMode=!1,u.adhocDetail={isMultiplePO:!1,jobType:i.oneToOne,collectionPoints:[{editMode:!0}],deliveryPoints:[{editMode:!0}]})}function c(){d()}function d(){u.viewMode=!0,u.loadingDetail=!0,n.getAdhocById(e.id).then(function(e){u.adhocDetail=n.convertAdhoc(e.data),u.originalJob=angular.copy(u.adhocDetail),u.loadingDetail=!1},function(){o.path("/accessDeny")})}var u=this;u.adhocProgress=t,u.adhocTypes=i,u.systemRole=r,u.jobStatus=s,u.getJobDetail=d,u.cancel=c,l()}function o(e,t,n,o,i){e.currentUser.role===i.User&&o.checkContractExpire(e.currentUser.customerId).then(function(e){e&&(n.createWarningPopup("Unable to create new jobs, Please contact STLogs Admin.","Warning",null,!0,"OK"),t.history.back())})}angular.module("adhoc.module",["ngRoute"]).config(e).controller("AdhocManagementController",t).controller("AdhocDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$routeParams","$location","jobGridType","systemRole","adhocService","taskService"],n.$inject=["$routeParams","adhocProgress","adhocService","$location","adhocTypes","systemRole","pricingService","jobStatus"],o.$inject=["$rootScope","$window","modalService","customerService","systemRole"]}(),function(){"use strict";function e(e){e.when("/milkrunTask/:id",{title:"Transaction job detail",category:"MilkrunTransactions",controller:"MilkRunTaskController",templateUrl:"app/components/milkrunTask/milkrunTasks.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"],preventViewOnly:!0})}function t(e,t,n,o,i,r,a,s,l,c,d){function u(){p(),m()}function m(){var e=n.id;P.isLoading=!0,i.getMilkRunTaskById(e).then(function(e){P.taskDetail=i.convertMilkrunTask(e.data),P.tasks=[{id:P.taskDetail.id,barcode:P.taskDetail.barcode}],JsBarcode("#barcode",P.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),P.taskDetail.frequency=d.convertFrequency(P.taskDetail),P.canEdit=P.taskDetail.status!==l.readyToBill.value&&P.taskDetail.status!==l.billed.value&&P.taskDetail.status!==l.pendingReject.value,P.isLoading=!1,g()},function(){t.path("/accessDeny")})}function p(){var t=e.milkrunTransaction;return t?(P.isNextJob=t.currentIndex<t.listTransaction.length-1,void(P.isPrevious=t.currentIndex>0)):(P.isNextJob=!1,void(P.isPrevious=!1))}function g(){P.isReturn=P.taskDetail.status===l.deliverFailed.value,P.isReattempt=P.taskDetail.status===l.collectionFailed.value||P.taskDetail.status===l.deliverFailed.value}function v(n){var o=e.milkrunTransaction,i=o.currentIndex;i=n?i+1:i-1;var r=o.listTransaction[i];e.milkrunTransaction.currentIndex=i,t.path("/milkrunTask/"+r)}function f(e){var t={returnReattempt:h},n={},i=P.taskDetail.status===l.collectionFailed.value;n=i?{contactPerson:P.taskDetail.collectionContactPerson,contactNumber:P.taskDetail.collectionContactNumber,postalCode:P.taskDetail.collectionPointAddress.postalCode,blockNumber:P.taskDetail.collectionPointAddress.blockNumber,streetName:P.taskDetail.collectionPointAddress.streetName,unitNumber:P.taskDetail.collectionPointAddress.unitNumber}:{contactPerson:P.taskDetail.deliveryContactNumber,contactNumber:P.taskDetail.deliveryContactPerson,postalCode:P.taskDetail.deliveryPointAddress.postalCode,blockNumber:P.taskDetail.deliveryPointAddress.blockNumber,streetName:P.taskDetail.deliveryPointAddress.streetName,unitNumber:P.taskDetail.deliveryPointAddress.unitNumber},P.dataReturnAttempt={isReturn:e,id:P.taskDetail.id,barcode:P.taskDetail.barcode,isCollection:i,address:n},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:P.dataReturnAttempt},t)}function h(){P.isLoading=!0,i.returnOrReattemptTask(P.taskDetail.id,P.dataReturnAttempt).then(function(e){P.isLoading=!1;var t=P.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";r.success(t),m()})}function y(e){var t={assignVendor:C};P.dataAssignVendor={isDriver:e,customerId:P.taskDetail.customerId},o.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:P.dataAssignVendor},t)}function C(){P.isLoading=!0,i.assignVendorInternalDriver({isMilkRun:!0,isDriver:P.dataAssignVendor.isDriver,userId:P.dataAssignVendor.user.id,targetIds:[P.taskDetail.id]}).then(function(e){m(),r.success("The Transaction has been assigned to vendor successfully."),P.isLoading=!1})}function b(e){P.unAssignData={isDriver:e};var t=e?"Are you sure you want to unassign this driver?":"Are you sure you want to unassign this vendor?";o.createWarningPopup(t,"Warning",k)}function k(){P.isLoading=!0,i.unAssignVendorDriver({isMilkRun:!1,isDriver:P.unAssignData.isDriver,targetIds:[P.taskDetail.id]}).then(function(e){m(),r.success("The transaction has been unassigned "+(P.unAssignData.isDriver?"driver":"vendor")+" successfully."),P.isLoading=!1})}var P=this;P.systemRole=c,P.milkRunTypes=a,P.departments=s,P.taskStatus=l,P.assignVendorDriver=y,P.unAssignVendorDriver=b,P.returnReattempt=f,P.nextPrevious=v,P.checkReturnReattemptButton=g,P.loadTaskById=m,u()}angular.module("milkrunTask.module",["ngRoute"]).config(e).controller("MilkRunTaskController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","$routeParams","modalService","taskService","toastr","milkRunTypes","departments","taskStatus","systemRole","milkrunService"]}(),function(){"use strict";function e(e){e.when("/adhocTask/:id",{title:"Transaction job detail",category:"AdhocTransactions",controller:"AdhocTaskController",templateUrl:"app/components/adhocTask/adhocTasks.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"]})}function t(e,t,n,o,i,r,a,s,l,c,d,u,m){function p(){m.loadGBizCode(),v(),g()}function g(){var e=t.id;S.isLoading=!0,i.getAdhocTaskById(e).then(function(e){S.taskDetail=i.convertAdhocTask(e.data),S.canEdit=S.taskDetail.status!==s.readyToBill.value&&S.taskDetail.status!==s.billed.value&&S.taskDetail.status!==s.pendingReject.value,S.tasks=[{id:S.taskDetail.id,barcode:S.taskDetail.barcode}],JsBarcode("#barcode",S.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),S.isLoading=!1,f()},function(){n.path("/accessDeny")})}function v(){var t=e.adhocTransaction;return t?(S.isNextJob=t.currentIndex<t.listTransaction.length-1,void(S.isPrevious=t.currentIndex>0)):(S.isNextJob=!1,void(S.isPrevious=!1))}function f(){S.isReturn=S.taskDetail.status===s.deliverFailed.value,S.isReattempt=S.taskDetail.status===s.collectionFailed.value||S.taskDetail.status===s.deliverFailed.value}function h(e){var t={returnReattempt:y},n={},i=S.taskDetail.status===s.collectionFailed.value;n=i?{contactPerson:S.taskDetail.collectionContactPerson,contactNumber:S.taskDetail.collectionContactNumber,postalCode:S.taskDetail.collectionPointAddress.postalCode,blockNumber:S.taskDetail.collectionPointAddress.blockNumber,streetName:S.taskDetail.collectionPointAddress.streetName,unitNumber:S.taskDetail.collectionPointAddress.unitNumber}:{contactPerson:S.taskDetail.deliveryContactNumber,contactNumber:S.taskDetail.deliveryContactPerson,postalCode:S.taskDetail.deliveryPointAddress.postalCode,blockNumber:S.taskDetail.deliveryPointAddress.blockNumber,streetName:S.taskDetail.deliveryPointAddress.streetName,unitNumber:S.taskDetail.deliveryPointAddress.unitNumber},S.dataReturnAttempt={isReturn:e,id:S.taskDetail.id,barcode:S.taskDetail.barcode,isCollection:i,address:n},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:S.dataReturnAttempt},t)}function y(){S.isLoading=!0,i.returnOrReattemptTask(S.taskDetail.id,S.dataReturnAttempt).then(function(e){S.isLoading=!1;var t=S.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";r.success(t),g()})}function C(){S.isLoading=!0,c.getCustomerById(S.taskDetail.customerId).then(function(t){S.isLoading=!1;var n=b(t.data),i=e.currentUser.department===a.PSS.name?"app/components/customer/pricing/adhocPricingModal.html":"app/components/customer/pricing/healthCarePricingModal.html";o.createPopup({templateUrl:i,size:"lg",data:{ngModel:n,viewMode:!0}},{})})}function b(e){for(var t=0;t<e.pricings.length;t++)if(e.pricings[t].pricingType===l.Adhoc)return e.pricings[t];return null}function k(t){var o=e.adhocTransaction,i=o.currentIndex;i=t?i+1:i-1;var r=o.listTransaction[i];e.adhocTransaction.currentIndex=i,n.path("/adhocTask/"+r)}function P(e){var t={assignVendor:D};S.dataAssignVendor={isDriver:e,customerId:S.taskDetail.customerId},o.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:S.dataAssignVendor},t)}function D(){S.isLoading=!0,i.assignVendorInternalDriver({isDriver:S.dataAssignVendor.isDriver,userId:S.dataAssignVendor.user.id,targetIds:[S.taskDetail.id]}).then(function(e){g(),r.success("The transaction has been assigned to "+(S.dataAssignVendor.isDriver?"driver":"vendor")+" successfully."),S.isLoading=!1})}function A(e){S.unAssignData={isDriver:e};var t=e?"Are you sure you want to unassign this driver?":"Are you sure you want to unassign this vendor?";o.createWarningPopup(t,"Warning",M)}function M(){S.isLoading=!0,i.unAssignVendorDriver({isMilkRun:!1,isDriver:S.unAssignData.isDriver,targetIds:[S.taskDetail.id]}).then(function(e){g(),r.success("The transaction has been unassigned "+(S.unAssignData.isDriver?"driver":"vendor")+" successfully."),S.isLoading=!1})}var S=this;S.departments=a,S.systemRole=d,S.taskStatus=s,S.assignVendorDriver=P,S.unAssignVendorDriver=A,S.nextPrevious=k,S.viewPricing=C,S.adhocTypes=u,S.returnReattempt=h,S.checkReturnReattemptButton=f,S.loadTaskById=g,p()}angular.module("adhocTask.module",["ngRoute"]).config(e).controller("AdhocTaskController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$routeParams","$location","modalService","taskService","toastr","departments","taskStatus","pricingType","customerService","systemRole","adhocTypes","pricingService"]}(),function(){"use strict";function e(e){e.when("/vendor/adhocs",{title:"Vendor Ad hoc Jobs",category:"AdhocVendor",controller:"VendorAdhocTaskController",templateUrl:"app/components/vendorAdhoc/vendorTasks.html",controllerAs:"vm",authorize:["Vendor"]}).when("/vendor/adhocTask/:id",{title:"Vendor Adhoc Job Detail",category:"AdhocVendor",controller:"VendorAdhocTaskDetailController",templateUrl:"app/components/vendorAdhoc/vendorTaskDetail.html",controllerAs:"vm",authorize:["Vendor"]})}function t(e,t,n,o,i,r,a,s,l){function c(){d(),p()}function d(){M.options={itemPerPage:20,currentPage:1,customer:"",driver:"",status:"",requestType:""},M.statuses=P(n,[14,15,16,17]),m(),u()}function u(){l.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then(function(e){M.customers=l.convertListCustomerDropDownList(e.data.customers)})}function m(){s.getDriverByCriteria({sortColumn:"name",sortAscending:!0}).then(function(e){M.drivers=s.convertListVendorDropDownList(e.data.users)})}function p(){M.isLoading=!0,r.getAdhocTaskByCriteria(M.options).then(function(e){M.listJob=r.convertListAdhocTask(e.data.jobTasks),M.options.totalItems=e.data.totalCount,M.isLoading=!1,M.listAssignTransaction=[]})}function g(){if(M.listAssignTransaction.length){var e={assignDriver:v};M.dataAssignDriver={},i.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:M.dataAssignDriver},e)}}function v(){M.isLoading=!0,r.assignDriverAdhoc({driverId:M.dataAssignDriver.driver.id,targetIds:M.listAssignTransaction}).then(function(e){angular.forEach(M.listJob,function(e){M.listAssignTransaction.indexOf(e.id)>=0&&(e.driverName=M.dataAssignDriver.driver.name)}),a.success("The selected transactions have been assigned to driver successfully."),M.listAssignTransaction=[],M.isCheckAll=!1,M.isLoading=!1})}function f(e){h(e),t.path("/vendor/adhocTask/"+e)}function h(t){var n=[];angular.forEach(M.listJob,function(e){n.push(e.id)}),e.vendorAdhocTransaction={listTransaction:n,currentIndex:n.indexOf(t)}}function y(){M.isCheckAll?k():M.listAssignTransaction=[]}function C(e,t){e.stopPropagation(),M.isCheckAll=!1;for(var n=!1,o=0;o<M.listAssignTransaction.length;o++)if(M.listAssignTransaction[o]==t)return n=!0,void M.listAssignTransaction.splice(o,1);M.listAssignTransaction.push(t)}function b(e){for(var t=0;t<M.listAssignTransaction.length;t++)if(M.listAssignTransaction[t]==e)return!0;return!1}function k(){M.listAssignTransaction=[],angular.forEach(M.listJob,function(e){e.status!=M.taskStatus.delivered.value&&M.listAssignTransaction.push(e.id)})}function P(e,t){var n=[{value:"",text:"All"}];for(var o in e)t&&t.indexOf(e[o].value)!==-1||n.push({value:e[o].value,text:e[o].display});return n}function D(e,t){e.preventDefault(),e.stopPropagation(),t.status!=M.taskStatus.delivered.value&&(C(e,t.id),b(t.id))}function A(){var e=[];return angular.forEach(M.listJob,function(t){M.listAssignTransaction.indexOf(t.id)>-1&&e.push({id:t.id,barcode:t.barcode})}),e}var M=this;M.setItemPerPage=o,M.taskStatus=n,M.getTaskByCriteria=p,M.listAssignTransaction=[],M.checkAllChange=y,M.bindingCheck=b,M.onCheckTransaction=C,M.assignDriver=g,M.goToDetailPage=f,M.preventClick=D,M.getListTransactionId=A,c()}function n(e,t,n,o,i,r,a,s){function l(){c(),d()}function c(){var e=t.id;y.isLoading=!0,i.getAdhocTaskById(e).then(function(e){y.taskDetail=i.convertAdhocTask(e.data),y.tasks=[{id:y.taskDetail.id,barcode:y.taskDetail.barcode}],JsBarcode("#barcode",y.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),y.isLoading=!1,h()},function(){n.path("/accessDeny")})}function d(){var t=e.vendorAdhocTransaction;return t?(y.isNextJob=t.currentIndex<t.listTransaction.length-1,void(y.isPrevious=t.currentIndex>0)):(y.isNextJob=!1,void(y.isPrevious=!1))}function u(){y.isLoading=!0,i.updateTask(y.taskDetail.id,{barcode:y.taskDetail.barcode,vendorNotes:y.taskDetail.vendorRemarks}).then(function(e){y.isLoading=!1,y.isEditVendorRemark=!1,a.success("Update vendor remark successfully.")})}function m(){var e={assignDriver:p};y.dataAssignDriver={isReassign:!!y.taskDetail.driverName},o.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:y.dataAssignDriver},e)}function p(){y.isLoading=!0,i.assignDriverAdhoc({driverId:y.dataAssignDriver.driver.id,targetIds:[y.taskDetail.id],remark:y.dataAssignDriver.remark}).then(function(e){a.success("The transactions have been assigned to driver successfully."),c()})}function g(e){var t={returnReattempt:f},n={},i=y.taskDetail.status===s.collectionFailed.value;n=i?{contactPerson:y.taskDetail.collectionContactPerson,contactNumber:y.taskDetail.collectionContactNumber,postalCode:y.taskDetail.collectionPointAddress.postalCode,blockNumber:y.taskDetail.collectionPointAddress.blockNumber,streetName:y.taskDetail.collectionPointAddress.streetName,unitNumber:y.taskDetail.collectionPointAddress.unitNumber}:{contactPerson:y.taskDetail.deliveryContactNumber,contactNumber:y.taskDetail.deliveryContactPerson,postalCode:y.taskDetail.deliveryPointAddress.postalCode,blockNumber:y.taskDetail.deliveryPointAddress.blockNumber,streetName:y.taskDetail.deliveryPointAddress.streetName,unitNumber:y.taskDetail.deliveryPointAddress.unitNumber},y.dataReturnAttempt={isReturn:e,id:y.taskDetail.id,barcode:y.taskDetail.barcode,isCollection:i,address:n},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:y.dataReturnAttempt},t)}function v(t){var o=e.vendorAdhocTransaction,i=o.currentIndex;i=t?i+1:i-1;var r=o.listTransaction[i];e.vendorAdhocTransaction.currentIndex=i,n.path("/vendor/adhocTask/"+r)}function f(){y.isLoading=!0,y.dataReturnAttempt.id=y.taskDetail.id,y.dataReturnAttempt.barcode=y.taskDetail.barcode,i.returnOrReattemptTask(y.taskDetail.id,y.dataReturnAttempt).then(function(e){y.isLoading=!1;var t=y.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";a.success(t),c()})}function h(){y.isReturn=y.taskDetail.status===s.deliverFailed.value,y.isReattempt=y.taskDetail.status===s.collectionFailed.value||y.taskDetail.status===s.deliverFailed.value}var y=this;y.departments=r,y.taskStatus=s,y.assignDriver=m,y.updateVendorRemark=u,y.returnReattempt=g,y.nextPrevious=v,y.loadTaskById=c,l()}angular.module("vendorAdhoc.module",["ngRoute"]).config(e).controller("VendorAdhocTaskController",t).controller("VendorAdhocTaskDetailController",n),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","taskStatus","setItemPerPage","modalService","taskService","toastr","driverService","customerService"],n.$inject=["$rootScope","$routeParams","$location","modalService","taskService","departments","toastr","taskStatus"]}(),function(){"use strict";function e(e){e.when("/vendor/milkruns",{title:"Vendor Fixed run Jobs",category:"MilkrunVendor",controller:"VendorMilkrunTaskController",templateUrl:"app/components/vendorMilkrun/vendorTasks.html",controllerAs:"vm",authorize:["Vendor"]}).when("/vendor/milkrunTask/:id",{title:"Vendor Adhoc Job Detail",category:"MilkrunVendor",controller:"VendorMilkrunTaskDetailController",templateUrl:"app/components/vendorMilkrun/vendorTaskDetail.html",controllerAs:"vm",authorize:["Vendor"]})}function t(e,t,n,o,i,r,a,s,l){function c(){d(),p()}function d(){M.options={itemPerPage:20,currentPage:1,customer:"",driver:"",status:"",requestType:""},M.statuses=P(n,[14,15,16,17]),m(),u()}function u(){l.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then(function(e){M.customers=l.convertListCustomerDropDownList(e.data.customers)})}function m(){s.getDriverByCriteria({sortColumn:"name",sortAscending:!0}).then(function(e){M.drivers=s.convertListVendorDropDownList(e.data.users)})}function p(){M.isLoading=!0,r.getMilkRunTaskByCriteria(M.options).then(function(e){M.listJob=r.convertListMilkRunTask(e.data.milkRunTasks),M.options.totalItems=e.data.totalCount,M.isLoading=!1,M.listAssignTransaction=[]})}function g(){if(M.listAssignTransaction.length){var e={assignDriver:v};M.dataAssignDriver={},i.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:M.dataAssignDriver},e)}}function v(){M.isLoading=!0,r.assignDriverMilkrun({driverId:M.dataAssignDriver.driver.id,targetIds:M.listAssignTransaction}).then(function(e){angular.forEach(M.listJob,function(e){M.listAssignTransaction.indexOf(e.id)>=0&&(e.driverName=M.dataAssignDriver.driver.name)}),a.success("The selected transactions have been assigned to driver successfully."),M.listAssignTransaction=[],M.isCheckAll=!1,M.isLoading=!1})}function f(e){h(e),t.path("/vendor/milkrunTask/"+e)}function h(t){var n=[];angular.forEach(M.listJob,function(e){n.push(e.id)}),e.vendorMilkrunTransaction={listTransaction:n,currentIndex:n.indexOf(t)}}function y(){M.isCheckAll?k():M.listAssignTransaction=[]}function C(e,t){e.stopPropagation(),M.isCheckAll=!1;for(var n=!1,o=0;o<M.listAssignTransaction.length;o++)if(M.listAssignTransaction[o]==t)return n=!0,void M.listAssignTransaction.splice(o,1);M.listAssignTransaction.push(t)}function b(e){for(var t=0;t<M.listAssignTransaction.length;t++)if(M.listAssignTransaction[t]==e)return!0;return!1}function k(){M.listAssignTransaction=[],angular.forEach(M.listJob,function(e){e.status!=M.taskStatus.delivered.value&&M.listAssignTransaction.push(e.id)})}function P(e,t){var n=[{value:"",text:"All"}];for(var o in e)t&&t.indexOf(e[o].value)!==-1||n.push({value:e[o].value,text:e[o].display});return n}function D(e,t){e.preventDefault(),e.stopPropagation(),t.status!=M.taskStatus.delivered.value&&(C(e,t.id),b(t.id))}function A(){var e=[];return angular.forEach(M.listJob,function(t){M.listAssignTransaction.indexOf(t.id)>-1&&e.push({id:t.id,barcode:t.barcode})}),e}var M=this;M.setItemPerPage=o,M.taskStatus=n,M.getTaskByCriteria=p,M.listAssignTransaction=[],M.checkAllChange=y,M.bindingCheck=b,M.onCheckTransaction=C,M.assignDriver=g,M.goToDetailPage=f,M.preventClick=D,M.getListTransactionId=A,c()}function n(e,t,n,o,i,r,a,s){function l(){c(),d()}function c(){var e=t.id;y.isLoading=!0,i.getMilkRunTaskById(e).then(function(e){y.taskDetail=i.convertMilkrunTask(e.data),y.tasks=[{id:y.taskDetail.id,barcode:y.taskDetail.barcode}],JsBarcode("#barcode",y.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),y.isLoading=!1,h()},function(){n.path("/accessDeny")})}function d(){var t=e.vendorMilkrunTransaction;return t?(y.isNextJob=t.currentIndex<t.listTransaction.length-1,void(y.isPrevious=t.currentIndex>0)):(y.isNextJob=!1,void(y.isPrevious=!1))}function u(){y.isLoading=!0,i.updateTask(y.taskDetail.id,{barcode:y.taskDetail.barcode,vendorNotes:y.taskDetail.vendorRemarks}).then(function(e){y.isLoading=!1,y.isEditVendorRemark=!1,a.success("Update vendor remark successfully.")})}function m(){var e={assignDriver:p};y.dataAssignDriver={isReassign:!!y.taskDetail.driverName},o.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:y.dataAssignDriver},e)}function p(){y.isLoading=!0,i.assignDriverMilkrun({driverId:y.dataAssignDriver.driver.id,targetIds:[y.taskDetail.id],remark:y.dataAssignDriver.remark}).then(function(e){a.success("The transactions have been assigned to driver successfully."),c()})}function g(e){var t={returnReattempt:f},n={},i=y.taskDetail.status===s.collectionFailed.value;n=i?{contactPerson:y.taskDetail.collectionContactPerson,contactNumber:y.taskDetail.collectionContactNumber,postalCode:y.taskDetail.collectionPointAddress.postalCode,blockNumber:y.taskDetail.collectionPointAddress.blockNumber,streetName:y.taskDetail.collectionPointAddress.streetName,unitNumber:y.taskDetail.collectionPointAddress.unitNumber}:{contactPerson:y.taskDetail.deliveryContactNumber,contactNumber:y.taskDetail.deliveryContactPerson,postalCode:y.taskDetail.deliveryPointAddress.postalCode,blockNumber:y.taskDetail.deliveryPointAddress.blockNumber,streetName:y.taskDetail.deliveryPointAddress.streetName,unitNumber:y.taskDetail.deliveryPointAddress.unitNumber},y.dataReturnAttempt={isReturn:e,id:y.taskDetail.id,barcode:y.taskDetail.barcode,isCollection:i,address:n},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:y.dataReturnAttempt},t)}function v(t){var o=e.vendorMilkrunTransaction,i=o.currentIndex;i=t?i+1:i-1;var r=o.listTransaction[i];e.vendorMilkrunTransaction.currentIndex=i,n.path("/vendor/milkrunTask/"+r)}function f(){y.isLoading=!0,y.dataReturnAttempt.id=y.taskDetail.id,y.dataReturnAttempt.barcode=y.taskDetail.barcode,i.returnOrReattemptTask(y.taskDetail.id,y.dataReturnAttempt).then(function(e){y.isLoading=!1;var t=y.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";a.success(t),c()})}function h(){y.isReturn=y.taskDetail.status===s.deliverFailed.value,y.isReattempt=y.taskDetail.status===s.collectionFailed.value||y.taskDetail.status===s.deliverFailed.value}var y=this;y.departments=r,y.taskStatus=s,y.assignDriver=m,y.updateVendorRemark=u,y.returnReattempt=g,y.nextPrevious=v,y.loadTaskById=c,l()}angular.module("vendorMilkrun.module",["ngRoute"]).config(e).controller("VendorMilkrunTaskController",t).controller("VendorMilkrunTaskDetailController",n),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","taskStatus","setItemPerPage","modalService","taskService","toastr","driverService","customerService"],n.$inject=["$rootScope","$routeParams","$location","modalService","taskService","departments","toastr","taskStatus"]}(),function(){"use strict";function e(e,t){e.when("/drivers",{title:"Driver Management",category:"Drivers",controller:"DriverManagementController",templateUrl:"app/components/driver/drivers.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.Vendor]}).when("/driver/create",{title:"Create New Driver",category:"Drivers",controller:"DriverDetailController",templateUrl:"app/components/driver/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.Vendor]}).when("/driver/detail/:id",{title:"Driver Detail",category:"Drivers",controller:"DriverDetailController",templateUrl:"app/components/driver/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.Vendor]})}function t(e,t,n,o,i){function r(){a(),s()}function a(){c.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",department:"",driverType:""};var e=[{name:"name",display:"Name",columnNameSort:"name"},{name:"userId",display:"User ID",columnNameSort:"userName"},{name:"phoneNumber",display:"Contact no",columnNameSort:"phoneNumber"},{name:"department",display:"Department",preventSort:!0},{name:"driverType",display:"Internal/External",preventSort:!0},{name:"vendorName",display:"Vendor",preventSort:!0},{name:"permission",display:"Permission",preventSort:!0},{name:"status",display:"Status",preventSort:!0}];o.currentUser.role===n.Admin&&e.splice(3,1),o.currentUser.role===n.Vendor&&(e=[{name:"name",display:"Name",columnNameSort:"name"},{name:"userId",display:"User ID",columnNameSort:"userName"},{name:"phoneNumber",display:"Contact no",columnNameSort:"phoneNumber"},{name:"status",display:"Status",preventSort:!0}]),c.gridConfig={onClickRowDetail:l,columns:e}}function s(){c.isGridLoading=!0,t.getDriverByCriteria(c.options).then(function(e){c.options.totalItems=e.data.totalCount,c.drivers=t.convertListDriver(e.data.users),c.isGridLoading=!1})}function l(t){e.path("/driver/detail/"+t.id)}var c=this;c.systemRole=n,c.departments=[{id:"",name:"All"},i.PSS,i.Healthcare],c.driverTypes=[{id:"",name:"All"},{id:1,name:"Internal Driver"},{id:2,name:"Vendor Driver"}],c.getDriverByCriteria=s,r()}function n(e,t,n,o,i,r,a,s){function l(){var n=t.id;n?(f.isLoading=!0,e.getDriverById(n).then(function(e){f.driverDetail=e.data,f.driverDetail.driverDepartments=v(f.driverDetail.driverDepartments),f.isLoading=!1})):f.driverDetail={driverDepartments:g()}}function c(){e.checkUserIdExist(f.driverDetail.userName,f.driverDetail.id).then(function(e){f.userIdExist=!1},function(e){f.userIdExist=!0})}function d(){f.isSaving=!0;var t=angular.copy(f.driverDetail);t.driverDepartments=t.driverDepartments.filter(function(e){return e.isCheck}),e.saveDriver(t).then(function(e){f.isSaving=!1;var t=f.driverDetail.id?"The driver has been updated successfully.":"The driver has been created successfully.";n.success(t),o.path("/drivers")},function(e){f.isSaving=!1;var t=e.data.message;n.error(t)})}function u(){var e=f.driverDetail.lockoutEnabled?"Are you sure you want to activate this driver?":"Are you sure you want to deactivate this driver?";i.createWarningPopup(e,"Warning",m)}function m(){e.activateOrDeactivate(f.driverDetail).then(function(e){var t=f.driverDetail.lockoutEnabled?"The driver has been activated successfully.":"The driver has been deactivated successfully.";f.driverDetail.lockoutEnabled=!f.driverDetail.lockoutEnabled,n.success(t)})}function p(){f.driverChangePassword={userId:t.id};var o={updatePassword:function(){f.isLoading=!0,e.updatePassword(f.driverChangePassword).then(function(e){f.isLoading=!1,n.success("The password has been updated successfully.")},function(){n.error("There is an error when sending the update password."),f.isLoading=!1})}};i.createPopup({templateUrl:"app/components/driver/resetPasswordModal.html",size:"lg",data:{detail:f.driverChangePassword}},o)}function g(){var e=[];return s.currentUser.role===a.SuperAdmin?e=[{isCheck:!0,departmentId:r.PSS.id,hasCreateJobPermission:!0,active:!0},{isCheck:!0,departmentId:r.Healthcare.id,hasCreateJobPermission:!0,active:!0}]:(f.index=0,e=[{isCheck:!0,departmentId:s.currentUser.department===r.PSS.name?r.PSS.id:r.Healthcare.id,hasCreateJobPermission:!0,active:!0}]),e}function v(e){if(s.currentUser.role===a.SuperAdmin){if(0===e.length)return[{isCheck:!1,departmentId:r.PSS.id,hasCreateJobPermission:!0,active:!0},{isCheck:!1,departmentId:r.Healthcare.id,hasCreateJobPermission:!0,active:!1}];if(1===e.length)return e[0].departmentId===r.PSS.id?[{isCheck:!0,departmentId:r.PSS.id,hasCreateJobPermission:e[0].hasCreateJobPermission,active:e[0].active},{isCheck:!1,departmentId:r.Healthcare.id}]:[{isCheck:!1,departmentId:r.PSS.id},{isCheck:!0,departmentId:r.Healthcare.id,hasCreateJobPermission:e[0].hasCreateJobPermission,active:e[0].active}]}else{var t=s.currentUser.department===r.PSS.name?r.PSS.id:r.Healthcare.id;f.index=e.findIndex(function(e){return e.departmentId===t})}return angular.forEach(e,function(e){e.isCheck=!0}),e}var f=this;f.systemRole=a,f.save=d,f.activateOrDeactivate=u,f.changePassword=p,f.checkUserIdExist=c,f.departments=[{id:void 0,name:"Please select ..."},r.PSS,r.Healthcare],f.permissionChange=function(e){e.isCheck?(e.hasCreateJobPermission=!0,e.active=!0):(delete e.hasCreateJobPermission,delete e.active)},l()}angular.module("driver.module",["ngRoute"]).config(e).controller("DriverManagementController",t).controller("DriverDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$location","driverService","systemRole","$rootScope","departments"],n.$inject=["driverService","$routeParams","toastr","$location","modalService","departments","systemRole","$rootScope"]}(),function(){"use strict";function e(){function e(){}var t=this;t.statusOptions=[{text:"Active",value:!0},{text:"Inactive",value:!1}],t.permissions=[{text:"Yes",value:!0},{text:"No",value:!1}],e()}angular.module("customer.module").directive("driverPermission",function(){return{restrict:"E",scope:{ngModel:"=",isEnable:"="},templateUrl:"app/components/driver/driverPermission/driverPermission.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e){e.when("/accessDeny",{title:"Access Deny",controller:"AccessDenyController",templateUrl:"app/components/accessDeny/accessDeny.html",controllerAs:"vm",hideHeader:!0,hideFooter:!0})}function t(e,t,n){function o(){if(!n.isAuthenticated())return void e.path("/login");var o=n.getCurrentUser();e.path("/"+t[o.role].defaultRoute)}var i=this;i.back=o}angular.module("accessDeny.module",["ngRoute"]).config(e).controller("AccessDenyController",t),
e.$inject=["$routeProvider"],t.$inject=["$location","systemRolesConfigs","authService"]}(),function(){"use strict";function e(e,t){e.when("/favorites/:view",{title:"Favorite management",category:"Favorites",controller:"FavoriteManagementController",templateUrl:"app/components/favorite/favorites.html",controllerAs:"vm",authorize:[t.Admin,t.User]}).when("/favorites/address/create",{title:"Create New Favorite Address",category:"Favorites",controller:"FavoriteAddressDetailController",templateUrl:"app/components/favorite/addressDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User]}).when("/favorites/address/:id",{title:"Favorite Address Detail",category:"Favorites",controller:"FavoriteAddressDetailController",templateUrl:"app/components/favorite/addressDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User]}).when("/favorites/item/create",{title:"Create New Favorite Item",category:"Favorites",controller:"FavoriteItemDetailController",templateUrl:"app/components/favorite/itemDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User]}).when("/favorites/item/:id",{title:"Favorite Address Item",category:"Favorites",controller:"FavoriteItemDetailController",templateUrl:"app/components/favorite/itemDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User]})}function t(e,t){function n(){o()}function o(){var e=[{name:"name",display:"Name",preventSort:!0},{name:"address",display:"Address",preventSort:!0},{name:"contactPerson",display:"Contact person",preventSort:!0},{name:"contactNumber",display:"Contact no",preventSort:!0},{name:"addressType",display:"Address type",preventSort:!0}],t=[{name:"name",display:"Name",preventSort:!0},{name:"description",display:"Item description",preventSort:!0},{name:"uom",display:"UOM",preventSort:!0},{name:"issueQuantity",display:"Quantity",preventSort:!0},{name:"unitMass",display:"Actual weight",preventSort:!0},{name:"unitVolume",display:"Volumetric weight",preventSort:!0}];a.addressGridConfig={onClickRowDetail:i,columns:e},a.itemGridConfig={onClickRowDetail:r,columns:t}}function i(t){e.path("/favorites/address/"+t.id)}function r(t){e.path("/favorites/item/"+t.id)}var a=this;a.isAddress=!("item"===t.view),n()}function n(e,t,n,o,i,r){function a(){var n=t.id;n?(d.isLoading=!0,e.getFavoriteAddress(n).then(function(e){d.favoriteAddress=e,d.isLoading=!1})):d.favoriteAddress={address:{},customerIds:[]}}function s(){d.isSaving=!0,e.saveFavoriteAddress(d.favoriteAddress).then(function(e){d.isSaving=!1;var t=d.favoriteAddress.id?"The favorite address has been updated successfully.":"The favorite address has been created successfully.";n.success(t),o.path("/favorites/address")},function(e){d.isSaving=!1;var t=e.data.message;n.error(t)})}function l(){r.createWarningPopup("Are you sure you want to delete this address?","Warning",c)}function c(){d.isDeleting=!0,e.deleteAddress(d.favoriteAddress.id).then(function(e){d.isDeleting=!1,n.success("The favorite address has been deleted successfully."),o.path("/favorites/address")},function(e){d.isDeleting=!1;var t=e.data.message;n.error(t)})}var d=this;d.systemRole=i,d.save=s,d.deleteAddress=l,d.addressTypes=[{id:void 0,name:"Please select ..."},{id:3,name:"Collection & Delivery"},{id:1,name:"Collection"},{id:2,name:"Delivery"}],a()}function o(e,t,n,o,i,r,a,s,l,c,d){function u(){var n=t.id;n?(v.isLoading=!0,e.getFavoriteItem(n).then(function(e){v.favoriteItem=e.data,v.isLoading=!1})):v.favoriteItem={customerIds:[]}}function m(){v.isSaving=!0,e.saveFavoriteItem(v.favoriteItem).then(function(e){v.isSaving=!1;var t=v.favoriteItem.id?"The favorite item has been updated successfully.":"The favorite item has been created successfully.";n.success(t),o.path("/favorites/item")},function(e){v.isSaving=!1;var t=e.data.message;n.error(t)})}function p(){c.createWarningPopup("Are you sure you want to delete this item?","Warning",g)}function g(){v.isDeleting=!0,e.deleteItem(v.favoriteItem.id).then(function(e){v.isDeleting=!1,n.success("The favorite item has been deleted successfully."),o.path("/favorites/item")},function(e){v.isDeleting=!1;var t=e.data.message;n.error(t)})}var v=this;v.systemRole=s,v.save=m,v.deleteItem=p,v.uoms=l.currentUser.department===a.PSS.name?r:i,v.isHealthCare=l.currentUser.department===a.Healthcare.name,v.isHealthCare&&(v.itemsHealthCare=[{id:void 0,name:"Please select ..."}],angular.forEach(d,function(e){v.itemsHealthCare.push({id:e,name:e})})),u()}angular.module("favorite.module",["ngRoute"]).config(e).controller("FavoriteManagementController",t).controller("FavoriteAddressDetailController",n).controller("FavoriteItemDetailController",o),e.$inject=["$routeProvider","systemRole"],t.$inject=["$location","$routeParams"],n.$inject=["favoriteService","$routeParams","toastr","$location","systemRole","modalService"],o.$inject=["favoriteService","$routeParams","toastr","$location","uomHealthCare","uomPSS","departments","systemRole","$rootScope","modalService","itemsHealthCare"]}(),function(){"use strict";function e(e,t){function n(){o(),i()}function o(){r.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",addressType:"",isAddress:!!r.isAddress}}function i(){r.isGridLoading=!0,e.getByCriteria(r.options).then(function(t){r.options.totalItems=t.data.total,r.items=e.convertListItem(t.data,r.isAddress),r.isGridLoading=!1})}var r=this;r.systemRole=t,r.getByCriteria=i,n()}angular.module("favorite.module").directive("favoriteTab",function(){return{restrict:"E",scope:{ngModel:"=",gridConfig:"=",isAddress:"=?"},templateUrl:"app/components/favorite/favoriteTab.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["favoriteService","systemRole"]}(),function(){"use strict";function e(e,t){e.when("/finance-users/create",{title:"Create New Finance User",category:"FinanceUsers",controller:"FinanceUserDetailController",templateUrl:"app/components/financeUser/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin]}).when("/finance-users/detail/:id",{title:"Finance User Detail",category:"FinanceUsers",controller:"FinanceUserDetailController",templateUrl:"app/components/financeUser/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin]})}function t(e,t,n,o,i,r,a){function s(){var n=t.id;n?(p.viewMode=!0,p.isLoading=!0,e.getFinanceUserById(n).then(function(e){p.financeUserDetail=e.data,p.financeUserDetail.userDepartments=m(p.financeUserDetail.userDepartments),p.isLoading=!1,p.originalEmail=p.financeUserDetail.email})):(p.viewMode=!1,p.financeUserDetail={userDepartments:u()})}function l(){p.viewMode=!1}function c(){!p.financeUserDetail||p.financeUserDetail.id&&p.financeUserDetail.email===p.originalEmail||e.checkEmailExist(p.financeUserDetail.email).then(function(e){p.emailExist=!0},function(e){p.emailExist=!1})}function d(){p.isSaving=!0;var t=angular.copy(p.financeUserDetail);t.userDepartments=t.userDepartments.filter(function(e){return e.isCheck}),e.saveFinanceUser(t).then(function(e){p.isSaving=!1;var t=p.financeUserDetail.id?"The finance user has been updated successfully.":"The finance user has been created successfully.";n.success(t),o.path("/users")},function(e){p.isSaving=!1;var t=e.data.message;n.error(t)})}function u(){var e=[];return a.currentUser.role===r.SuperAdmin?e=[{isCheck:!0,departmentId:i.PSS.id,active:!0},{isCheck:!0,departmentId:i.Healthcare.id,active:!0}]:(p.index=0,e=[{isCheck:!0,departmentId:a.currentUser.department===i.PSS.name?i.PSS.id:i.Healthcare.id,active:!0}]),e}function m(e){if(a.currentUser.role===r.SuperAdmin){if(0===e.length)return[{isCheck:!1,departmentId:i.PSS.id,active:!0},{isCheck:!1,departmentId:i.Healthcare.id,active:!1}];if(1===e.length)return e[0].departmentId===i.PSS.id?[{isCheck:!0,departmentId:i.PSS.id,active:e[0].active},{isCheck:!1,departmentId:i.Healthcare.id}]:[{isCheck:!1,departmentId:i.PSS.id},{isCheck:!0,departmentId:i.Healthcare.id,active:e[0].active}]}else{var t=a.currentUser.department===i.PSS.name?i.PSS.id:i.Healthcare.id;p.index=e.findIndex(function(e){return e.departmentId===t})}return angular.forEach(e,function(e){e.isCheck=!0}),e}var p=this;p.systemRole=r,p.save=d,p.edit=l,p.departments=[{id:void 0,name:"Please select ..."},i.PSS,i.Healthcare],p.checkEmailExist=c,p.permissionChange=function(e){e.isCheck?e.active=!0:delete e.active},s()}angular.module("financeUser.module",["ngRoute"]).config(e).controller("FinanceUserDetailController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["financeUserService","$routeParams","toastr","$location","departments","systemRole","$rootScope"]}(),function(){"use strict";function e(){function e(){}var t=this;t.statusOptions=[{text:"Active",value:!0},{text:"Inactive",value:!1}],e()}angular.module("financeUser.module").directive("financeUserPermission",function(){return{restrict:"E",scope:{ngModel:"=",isEnable:"="},templateUrl:"app/components/financeUser/financeUserPermission/financeUserPermission.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e,t){e.when("/financeBillings",{title:"Finance Billing Management",category:"Finance",controller:"FinanceBillingManagementController",templateUrl:"app/components/financeBilling/management/index.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]})}function t(e){function t(){n(o.date)}function n(t){o.isLoading=!0,e.summaryBilling(t).then(function(e){o.isLoading=!1,o.dataSummary=e.data})}var o=this;o.isBilling=!0,o.loadSummary=n,o.date=new Date,t()}angular.module("financeBilling.module",["ngRoute"]).config(e).controller("FinanceBillingManagementController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["billingService"]}(),function(){"use strict";function e(e,t,n,o,i){function r(){a(),s()}function a(){c.options={date:c.date,sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,status:"",searchTerm:"",department:""};var e=[];e=c.isBilling?[{name:"customerName",display:"Client",columnNameSort:"CustomerName",htmlDisplay:!0},{name:"costCentreName",display:"SBU",columnNameSort:"CostCentreName"},{name:"poNumber",display:"PO Number",columnNameSort:"PONumber"},{name:"totalJob",display:"No of jobs",preventSort:!0},{name:"amountBar",display:"Amount",htmlDisplay:!0,css:"amountBar",preventSort:!0},{name:"amountText",display:"",htmlDisplay:!0,preventSort:!0,css:"amountText"}]:[{name:"customerName",display:"Client",columnNameSort:"CustomerName",htmlDisplay:!0},{name:"costCentreName",display:"SBU",columnNameSort:"CostCentreName"},{name:"invoiceNumber",display:"Invoice no",preventSort:!0},{name:"poNumber",display:"PO Number",columnNameSort:"PONumber"},{name:"totalJob",display:"No of jobs",preventSort:!0},{name:"totalAmount",display:"Amount",htmlDisplay:!0,preventSort:!0,css:"amountText"}],c.statuses=[{value:"",text:"All"},{value:"true",text:"Ready"},{value:"false",text:"Not ready"}],c.gridConfig={onClickRowDetail:l,columns:e}}function s(){c.isBilling&&c.loadSummary({date:c.options.date}),c.isLoading=!0,o.getByCriteria(c.options,c.isBilling).then(function(e){c.billings=c.isBilling?o.convertBilling(e.data.billingJobs):o.convertCancelledBilling(e.data.cancelledInvoices),c.options.totalItems=e.data.totalCount,c.isLoading=!1})}function l(t){if(!t.costCentreId)return void n.warning("This job has no SBU!");if(!c.options.date)return void n.warning("Please choose month first!");var o=t.customerId+"-"+t.costCentreId+"-"+t.poNumberId+"-"+(c.options.date.getMonth()+1)+"-"+c.options.date.getFullYear()+"-"+t.billingType,i=c.isBilling?"/financeBilling/detail/"+o:"/financeBilling/cancelledDetail/"+o;e.path(i)}var c=this;c.systemRole=t,c.departments=[{id:"",name:"All"},i.PSS,i.Healthcare],c.getByCriteria=s,r()}angular.module("financeBilling.module").directive("tabDetail",function(){return{restrict:"E",scope:{ngModel:"=?",criteria:"=?",isBilling:"=?",date:"=",loadSummary:"&"},templateUrl:"app/components/financeBilling/management/tabDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$location","systemRole","toastr","billingService","departments"]}(),function(){"use strict";function e(e,t){e.when("/financeBilling/detail/:id",{title:"Finance Billing Detail",category:"Finance",controller:"FinanceBillingDetailController",templateUrl:"app/components/financeBilling/detail/billingDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]}).when("/financeBilling/cancelledDetail/:id",{title:"Finance Cancelled Billing Detail",category:"Finance",controller:"FinanceCancelledBillingDetailController",templateUrl:"app/components/financeBilling/detail/cancelledBillingDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]})}function t(e,t,n,o,i,r){function a(){v(),s()}function s(){f.isLoading=!0,i.getBillingDetail(o.id,f.searchTerm,!1).then(function(e){f.isLoading=!1,f.data=e.data},function(e){f.isLoading=!1,r.error(e.data.message)})}function l(t){var n="";n="Adhoc"===t.jobType?"/adhoc/detail/"+t.id:"/milkrun/detail/"+t.id,e.path(n)}function c(e,t){p(e,t,{apiName:"ready",confirmMessage:"Are you sure you want to set the following jobs as ready",successMessage:"Jobs have been set as ready successfully."})}function d(e,t){p(e,t,{apiName:"reject",confirmMessage:"Are you sure you want to reject following jobs",successMessage:"Jobs have been rejected successfully."},!0)}function u(e,t){p(e,t,{apiName:"requestRejection",confirmMessage:"Are you sure you want to request to reject following jobs",successMessage:"Jobs have been requested to reject successfully."},!0)}function m(e,t){p(e,t,{apiName:"verify",confirmMessage:"Are you sure you want to verify following jobs",successMessage:"Jobs have been verified successfully."})}function p(e,t,a,l){var c=[],d=[];Array.isArray(e)?(c=e,d=f.data[t].filter(function(e){return c.indexOf(e.id)>-1})):(c=[e.id],d=[e]);var u=l?"app/components/financeBilling/detail/confirmWithModal.html":"app/components/financeBilling/detail/confirmModal.html";f.actionData={message:a.confirmMessage,target:c.join(", ")},n.createPopup({templateUrl:u,size:"md",data:f.actionData},{action:function(){var e=d.map(function(e){return{id:e.id,type:e.jobType}}),t=o.id.split("-");f.isLoading=!0,i.doAction({targets:e,customerId:parseInt(t[0]),customerName:f.data.customerName,costCentreId:t.length>1?parseInt(t[1]):"",costCentreName:f.data.costCentreName,poNumberId:t.length>2?parseInt(t[2]):"",poNumber:f.data.poNumber,remark:f.actionData.remark},a.apiName).then(function(e){r.success(a.successMessage),s()},function(e){f.isLoading=!1,r.error(e.data.message)})}})}function g(){}function v(){f.sections={Admin:[{label:"Rejected",actions:[{label:"Edit",onClick:l},{label:"Ready",onClick:c}],topActions:[{label:"Set selected as ready",onClick:c}],includeRemark:!0,key:"rejectedJobs"},{label:"Pending",actions:[{label:"Edit",onClick:l},{label:"Ready",onClick:c}],topActions:[{label:"Set selected as ready",onClick:c}],includeRemark:!1,key:"pendingJobs"},{label:"Request for rejection",includeRemark:!1,key:"toBeRejectJobs"},{label:"Ready to bill",actions:[{label:"Request to reject",onClick:u}],topActions:[{label:"Request selected",onClick:u}],includeRemark:!0,key:"readyToBillJobs"}],User:[{label:"Delivered",actions:[{label:"Verify",onClick:m}],topActions:[{label:"Verify selected",onClick:m}],includeRemark:!0,key:"pendingJobs"},{type:"readyToBill",label:"Ready to bill",includeRemark:!0,key:"readyToBillJobs"},{label:"Rejected",includeRemark:!0,key:"rejectedJobs"}],Finance:[{label:"Request for rejection",actions:[{label:"Reject",onClick:d}],topActions:[{label:"Reject selected",onClick:d}],includeRemark:!1,key:"toBeRejectJobs"},{label:"Ready to bill",actions:[{label:"Reject",onClick:d},{label:"Sync",onClick:g}],topActions:[{label:"Reject selected",onClick:d},{label:"Sync selected",onClick:g}],includeRemark:!0,key:"readyToBillJobs"},{label:"Pending",includeRemark:!1,key:"pendingJobs"},{label:"Rejected",includeRemark:!0,key:"rejectedJobs"}]}}var f=this;f.systemRole=t,f.searchTerm="",f.getBillingDetail=s,f.data={},a()}function n(e,t,n){function o(){r.section={label:"Cancelled jobs",actions:[],topActions:[],includeRemark:!1,includeStatus:!0},i()}function i(){r.isLoading=!0,e.getBillingDetail(n.id,r.searchTerm,!0).then(function(e){r.isLoading=!1,r.data=e.data},function(e){r.isLoading=!1,toastr.error(e.data.message)})}var r=this;r.systemRole=t,o()}angular.module("financeBillingDetail.module",["ngRoute"]).config(e).controller("FinanceBillingDetailController",t).controller("FinanceCancelledBillingDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$location","systemRole","modalService","$routeParams","billingService","toastr"],n.$inject=["billingService","systemRole","$routeParams"]}(),function(){"use strict";function e(e,t){function n(){s.criteria={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:""},t.$watch("vm.items",function(e){a(),s.selectedItems=[]})}function o(){s.isCheckAll=!s.isCheckAll,s.isCheckAll?s.selectedItems=s.filteredItems.map(function(e){return e.id}):s.selectedItems=[]}function i(e){var t=s.selectedItems.find(function(t){return t===e});return!!t}function r(e){s.isCheckAll=!1;for(var t=0;t<s.selectedItems.length;t++)if(s.selectedItems[t]===e)return void s.selectedItems.splice(t,1);s.selectedItems.push(e)}function a(){if(s.items){var e=s.criteria.currentPage-1;s.filteredItems=s.items.slice(e*s.criteria.itemPerPage,e*s.criteria.itemPerPage+s.criteria.itemPerPage)}else s.filteredItems=[]}var s=this;s.setItemPerPage=e,s.bindingCheck=i,s.onCheck=r,s.selectAll=o,s.selectedItems=[],s.isCheckAll=!1,s.getByCriteria=a,n()}angular.module("financeBillingDetail.module").directive("jobSection",function(){return{restrict:"E",scope:{ngModel:"=",items:"="},templateUrl:"app/components/financeBilling/detail/sections/jobSection.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["setItemPerPage","$scope"]}(),function(){"use strict";function e(e,t){e.when("/financeInvoiced",{title:"Finance Invoiced Management",category:"Finance",controller:"FinanceInvoicedManagementController",templateUrl:"app/components/financeInvoiced/management/index.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]})}function t(e,t,n,o,i,r){function a(){s(),l()}function s(){d.options={date:new Date,sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,status:"",searchTerm:"",department:""};var e=[{name:"invoiceNumber",display:"Invoice no",preventSort:!0},{name:"refNumber",display:"Ref no",preventSort:!0},{name:"invoiceDate",display:"Invoice date",columnNameSort:"invoiceDate"},{name:"customerName",display:"Client",columnNameSort:"customerName"},{name:"costCentreName",display:"SBU",columnNameSort:"costCentreName"},{name:"poNumber",display:"PO number",preventSort:!0},{name:"totalJob",display:"Jobs",columnNameSort:"totalJob"},{name:"status",display:"Status",preventSort:!0},{name:"totalAmount",display:"Amount",columnNameSort:"totalAmount"}];d.statuses=[{value:"",display:"All"},o.new,o.invoiced,o.cancelled,o.creditNoted],d.gridConfig={onClickRowDetail:c,columns:e}}function l(){return d.options.date?(d.isLoading=!0,void n.getByCriteria(d.options).then(function(e){d.invoices=n.convertData(e.data.invoices),d.options.totalItems=e.data.totalCount,d.isLoading=!1})):void r.warning("Please select a valid month!")}function c(e){var t="/financeInvoiced/detail/1";i.path(t)}var d=this;d.systemRole=e,d.departments=[{id:"",name:"All"},t.PSS,t.Healthcare],d.getByCriteria=l,a()}angular.module("financeInvoiced.module",["ngRoute"]).config(e).controller("FinanceInvoicedManagementController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["systemRole","departments","invoicedService","invoiceStatus","$location","toastr"]}(),function(){"use strict";function e(e,t){e.when("/financeInvoiced/detail/:id",{title:"Finance Invoiced Detail",category:"Finance",controller:"FinanceInvoicedDetailController",templateUrl:"app/components/financeInvoiced/detail/invoicedDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]})}function t(e,t,n,o,i,r){function a(){m.isCancel=(new Date).getDate()<26,m.statuses=[{value:"",display:"All"},{value:1,display:"Invoiced"},{value:2,display:"Credit Noted"}],m.criteria={status:"",sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:""},m.items=[];for(var e=1;e<=3;e++)m.items.push({id:e,jobType:"Adhoc",requestType:"Three hour",collectionPoint:"10 collection points",deliveryPoint:"31 Maria Coastal Drier Singarpore 1337734",status:"Invoiced",amount:30});s()}function s(){var e=m.criteria.currentPage-1;m.criteria.totalItem=m.items.length,m.filteredItems=m.items.slice(e*m.criteria.itemPerPage,e*m.criteria.itemPerPage+m.criteria.itemPerPage)}function l(){m.selectedItems=[],m.isCheckAll=!1}function c(){m.isCheckAll=!m.isCheckAll,m.isCheckAll?m.selectedItems=m.filteredItems.map(function(e){return e.id}):m.selectedItems=[]}function d(e){var t=m.selectedItems.find(function(t){return t===e});return!!t}function u(e){m.isCheckAll=!1;for(var t=0;t<m.selectedItems.length;t++)if(m.selectedItems[t]===e)return void m.selectedItems.splice(t,1);m.selectedItems.push(e)}var m=this;m.systemRole=t,m.setItemPerPage=r,m.bindingCheck=d,m.onCheck=u,m.selectAll=c,m.selectedItems=[],m.isCheckAll=!1,m.cancelSelected=l,a()}angular.module("financeInvoicedDetail.module",["ngRoute"]).config(e).controller("FinanceInvoicedDetailController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["$location","systemRole","$rootScope","departments","$sce","setItemPerPage"]}(),function(){"use strict";function e(){var e=this;e.collapse=!0}angular.module("financeBillingDetail.module").directive("addressDetail",function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/components/financeBilling/detail/sections/addressDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n,o){function i(){return!!l()}function r(e){var t=l();return!!(t&&e.indexOf(t.role)>-1)}function a(i,r){var a=t.defer(),s=o.serviceUrl+"/api/account/token",l={username:i,password:r};return e.post(s,l).then(function(e){var t={access_token:e.data.accessToken,token_type:e.data.tokenType,expired_at:(new Date).getTime()+1e3*parseInt(e.data.expiresIn)},o={id:e.data.id,email:e.data.email,role:e.data.role,department:e.data.department,customerId:e.data.customerId,firstName:e.data.firstName,lastName:e.data.lastName,viewOnly:e.data.viewOnly,isMultiDepartment:e.data.isMultiDepartment};n.set("tokenInfo",t),n.set("userInfo",o),a.resolve(o)},function(e){a.reject(e)}),a.promise}function s(){n.remove("tokenInfo"),n.remove("userInfo")}function l(){return n.get("userInfo")}function c(){var e=n.get("tokenInfo"),t=(new Date).getTime();return t>e.expired_at?null:e}function d(t){var n=o.serviceUrl+"/api/account/resetpassword";return e.post(n,t)}function u(t){var n=o.serviceUrl+"/api/account/forgetpassword",i={email:t};return e.post(n,i)}var m={isAuthenticated:i,isAuthorized:r,login:a,logout:s,getCurrentUser:l,resetPassword:u,confirmResetPassword:d,getToken:c};return m}angular.module("main.module").factory("authService",e),e.$inject=["$http","$q","localStorageService","systemSetting"]}(),function(){"use strict";function e(e){function t(t,n,o){var i=e.open({animation:!0,templateUrl:t.templateUrl,controller:"ModalInstanceCtrl",controllerAs:"vm",size:t.size,backdrop:"static",resolve:{data:function(){return t.data},readOnly:function(){return t.readOnly}}});i.result.then(function(e){n[e]()},o)}function n(t,n,o,i,r){var a=e.open({animation:!0,templateUrl:"app/directives/commonControls/warningModal/warningModal.html",controller:"ModalInstanceCtrl",controllerAs:"vm",backdrop:"static",resolve:{data:function(){return{message:t,title:n,isHideActionButton:i,dismissText:r}}}});a.result.then(function(e){o&&o()})}var o={createPopup:t,createWarningPopup:n};return o}angular.module("main.module").factory("modalService",e),e.$inject=["$uibModal"]}(),function(){"use strict";function e(e,t,n){function o(e){e.headers=e.headers||{};var n=t.get("tokenInfo");return n&&(e.headers.Authorization=n.token_type+" "+n.access_token),e}function i(o){return 401===o.status&&(t.remove("tokenInfo"),t.remove("userInfo"),n.path("/accessDeny")),e.reject(o)}var r={request:o,responseError:i};return r}angular.module("main.module").factory("httpInterceptor",e),e.$inject=["$q","localStorageService","$location"]}(),function(){"use strict";function e(e,t){function n(t){return t.id?e.put(s+t.id,t):e.post(s,t)}function o(t){var n=s+"?roleNames="+t.roles+"&offset="+(t.currentPage-1)*t.itemPerPage;return n+="&limit="+t.itemPerPage,t.searchTerm&&(n+="&search="+t.searchTerm),t.department&&(n+="&departmentId="+t.department),t.sortColumn&&(n+="&sortBy="+t.sortColumn,n+="&ascending="+t.sortAscending),e.get(n)}function i(t){return e.get(s+t)}function r(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(s+n+t.id)}function a(t){return e.post(s+"userExists",{email:t})}var s=t.serviceUrl+"/api/adminusers/",l={saveAdminUser:n,getAdminUserByCriteria:o,getAdminUserById:i,activateOrDeactivate:r,checkEmailExist:a};return l}angular.module("main.module").factory("adminUserService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t){function n(t){return t.id?e.put(r+t.id,t):e.post(r,t)}function o(t){return e.get(r+t)}function i(t){return e.post(a+"userExists",{email:t})}var r=t.serviceUrl+"/api/adminusers/finance-user/",a=t.serviceUrl+"/api/adminusers/",s={saveFinanceUser:n,getFinanceUserById:o,checkEmailExist:i};return s}angular.module("main.module").factory("financeUserService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord","$rootScope","systemRole","departments"]}(),function(){"use strict";function e(e,t,n,o,i){function r(t){var n=f;return t=t||{},t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||i,"object"==typeof t&&Object.keys(t).length>0&&(n+="?offset="+(t.currentPage-1)*t.itemPerPage,n+="&limit="+t.itemPerPage,t.searchTerm&&(n+="&search="+t.searchTerm),t.sortColumn&&(n+="&sortBy="+t.sortColumn,n+="&ascending="+t.sortAscending)),e.get(n)}function a(t){return e.get(f+t)}function s(t){return t.id?e.put(f+t.id,t):e.post(f,t)}function l(t){return t.id?e.put(f+"UpdateSAPCode/"+t.id,t):e.post(f+"CreateSAPCode",t)}function c(t){return t.number=t.detailName,t.id?e.put(f+"UpdatePONumber/"+t.id,t):e.post(f+"CreatePONumber",t)}function d(t,n){return n?(t.number=t.name,e.post(f+"CreatePONumber",t)):e.post(f+"CreateCostCentre",t)}function u(t){return t.name=t.detailName,t.id?e.put(f+"UpdateCostCentre/"+t.id,t):e.post(f+"CreateCostCentre",t)}function m(e){return e.map(function(e){return{id:e.id,organizationCode:e.organizationCode,name:e.name,clientType:e.department.name,address:e.address?e.address.blockNumber+" "+e.address.streetName+" "+e.address.unitNumber+" "+e.address.postalCode:"",sapCodesText:e.sapCodesText}})}function p(e){var t=[{id:"",name:"All"}];return angular.forEach(e,function(e){t.push({id:e.id,name:e.organizationCode+" "+e.name})}),t}function g(e){return{id:e.id,name:e.name,organizationCode:e.organizationCode,sapCode:e.sapCode,contactPerson:e.contactPerson,contactNumber:e.contactNumber,contractEndDate:o.convertDate(e.contractEndDate),cutOffTimeFor3HourDelivery:o.convertDate(e.cutOffTimeFor3HourDelivery),cutOffTimeForSameDayPickupAndDelivery:o.convertDate(e.cutOffTimeForSameDayPickupAndDelivery),cutOffTimeForSameDayPickupAndNextDayDelivery:o.convertDate(e.cutOffTimeForSameDayPickupAndNextDayDelivery),address:e.address,department:e.department,clientTypeId:e.department.id,pricings:e.pricings,users:e.applicationUsers,sapCodes:e.sapCodes,poNumbers:e.poNumbers,costCentres:e.costCentres}}function v(e){var n=t.defer();return a(e).then(function(e){var t=o.convertDate(e.data.contractEndDate);t.setHours(0,0,0,0);var i=new Date;i.setHours(0,0,0,0),t<i?n.resolve(!0):n.resolve(!1)}),n.promise}var f=n.serviceUrl+"/api/customers/",h={getCustomerByCriteria:r,getCustomerById:a,saveCustomer:s,convertListCustomer:m,convertCustomer:g,convertListCustomerDropDownList:p,checkContractExpire:v,saveSapCode:l,savePoNumber:c,saveCostCenter:u,createPoOrCC:d};return h}angular.module("main.module").factory("customerService",e),e.$inject=["$http","$q","systemSetting","utilityService","maxNumberOfRecord"]}(),function(){"use strict";function e(e,t,n){function o(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var o=d+"?offset="+(t.currentPage-1)*t.itemPerPage;return o+="&limit="+t.itemPerPage,t.searchTerm&&(o+="&search="+t.searchTerm),t.department&&(o+="&departmentId="+t.department),t.organizationCode&&(o+="&organizationCode="+t.organizationCode),t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending),e.get(o)}function i(t){return e.get(d+t)}function r(t){return t.id?e.put(d+t.id,t):e.post(d,t)}function a(t){return e.put(d+t.id,t)}function s(e){return e.map(function(e){return{id:e.id,customerId:e.customerId,name:e.firstName+" "+e.lastName,email:e.email,phoneNumber:e.phoneNumber,costCentres:e.costCentres,sapCode:e.sapCode,organizationCode:e.organizationCode,status:e.lockoutEnabled?"Inactive":"Active"}})}function l(t){return e.post(d+"userExists",{email:t})}function c(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(d+n+t.id)}var d=t.serviceUrl+"/api/users/",u={getClientUserByCriteria:o,getClientUserById:i,convertListUser:s,updateClientUser:a,checkEmailExist:l,activateOrDeactivate:c,saveUser:r};return u}angular.module("main.module").factory("clientUserService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord"]}(),function(){"use strict";function e(e,t){function n(t){return e.get(i+t)}function o(){return e.get(i)}var i=t.serviceUrl+"/api/location/",r={getLocations:o,getLocationByPostalCode:n};return r}angular.module("main.module").factory("locationService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u){function m(n){var o=F+"?offset="+(n.currentPage-1)*n.itemPerPage;return o+="&limit="+n.itemPerPage,n.status&&(o+="&status="+n.status),""!==n.requestType&&(o+="&requestType="+n.requestType),n.dateFrom&&(o+="&fromCreatedDate="+t("date")(n.dateFrom,"yyyy-MM-dd")),n.dateTo&&(o+="&toCreatedDate="+t("date")(n.dateTo,"yyyy-MM-dd")),n.requestType&&(o+="&requestType="+n.requestType),n.searchTerm&&(o+="&search="+n.searchTerm),n.customer&&(o+="&customerId="+n.customer),n.hasPo&&(o+="&hasPo="+n.hasPo),e.get(o)}function p(t){return e.get(F+t)}function g(t){t.requestDate.setHours(t.requestTime.getHours(),t.requestTime.getMinutes()),v(t);var n=new FormData;n.append("data",JSON.stringify(t));var o=d.getImageItem();return o.length&&angular.forEach(o,function(e){angular.forEach(e.images,function(t){n.append(e.key,t)})}),t.id?e.put(F+t.id,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}):e.post(F,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}function v(e){f(e.collectionPoints,e.milkRunFrequency,e.days),f(e.deliveryPoints,e.milkRunFrequency,e.days)}function f(e,t,n){var i=u.getFixedRungBiz(),r=u.getGBizCodeHCFixedRun();i&&angular.forEach(e,function(a){angular.forEach(a.items,function(a){var s=a.milkRunWeightId>=18?r:i,l=s.find(function(e){return e.id==a.milkRunWeightId});if(l&&l.rows.length){var c=l.rows.find(function(t){return e.length>t.pointFrom&&e.length<=t.pointTo});t==o.twiceADay.value||t==o.threeTimesADay.value||t==o.fourTimesADay.value?a.gBizCode=c.twiceDaily:t==o.daily.value?a.gBizCode=c.daily:t==o.projectRun.value?a.gBizCode=c.projectRun:t==o.weekly.value&&(n.length>4?a.gBizCode=c.daily:n.length>=2?a.gBizCode=c.thricePerWeek:1==n.length&&(a.gBizCode=c.weekly))}})})}function h(t){return e.post(F+"assignvendor",t)}function y(t,n){return e.post(F+t+"/approve",n)}function C(t){return e.post(F+"onHold/"+t)}function b(t){return e.post(F+"unhold/"+t)}function k(t){return e.post(F+t.jobId+"/cancel",t)}function P(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,customer:e.organizationCode+" - "+e.customerName,createdDate:e.requestDate,collectionPoints:A(e.collectionPoints,e.id),deliveryPoints:A(e.deliveryPoints,e.id),frequency:D(e,!0),status:M(e.jobStatus),
createdBy:e.createdBy,poNumber:e.poNumber||"-"})}),t}function D(e,n){var a="";for(var s in o)if(o[s].value==e.milkRunFrequency){a+=o[s].display;break}if(e.milkRunFrequency===o.weekly.value){var l="";angular.forEach(e.days,function(e){for(var t in i)if(i[t].value===e){l+=i[t].display+", ";break}}),l=l.substring(0,l.length-2),a+=" ("+l+")"}var c="";return angular.forEach(e.additionals,function(e){for(var t in r)if(r[t].value===e){c+=r[t].display+", ";break}}),c&&(c=c.substring(0,c.length-2),a+=", "+c),!n&&e.milkRunFrequency===o.projectRun.value&&e.projectRunDate&&(a+=" ("+t("date")(e.projectRunDate,"dd/MM/yyyy")+")"),a}function A(e,t){var n,o="",i="";return e.length>O?(n=[e[0],e[1],e[2]],i='<a href="#milkrun/detail/'+t+'"> ... and '+(e.length-O)+" more<a/>"):n=e,angular.forEach(n,function(e){e.address&&(o+="<p>"+e.address.blockNumber+" "+e.address.streetName+" "+e.address.unitNumber+" "+e.address.postalCode+"</p>")}),o+i}function M(e){for(var t in s)if(s[t].value===e)return s[t].display;return""}function S(e){return e.requestDate=c.convertDate(e.requestDate),e.projectRunDate=c.convertDate(e.projectRunDate),e.requestDate=c.convertDate(e.requestDate),e.statusText=M(e.jobStatus),e}function T(e){e.milkRunType==l.manyToOne&&R(e.deliveryPoints)&&I(e),e.milkRunType!=l.manyToOne&&R(e.collectionPoints)&&I(e)}function R(e){return!!(e&&e[0]&&e[0].items&&e[0].items.length>0)}function I(e){var t=e.collectionPoints;e.collectionPoints=e.deliveryPoints,e.deliveryPoints=t}function N(e,t){var n=[],o=e.split(/\r\n|\n/);if(o&&o.length>1)for(var i=1;i<o.length;i++)if(o[i]){var r=o[i].split(",");n.push({address:{postalCode:r[0],blockNumber:r[1],streetName:r[2],unitNumber:r[3]},name:r[4],contactNumber:r[5],remark:r[6],surcharges:j(r[7],r[8]),items:U(r[9],r[10],r[11],t)})}return n}function w(e,t){var n=e.split(/\r\n|\n/);if(n&&n.length>1){for(var o=1;o<n.length;o++)if(n[o]){var i=n[o].split(",");if(x(i,t))return!1}return!0}return!1}function U(e,t,n,o){for(var i=e.split(";"),r=t.split(";"),a=n.split(";"),s=[],l=0;l<i.length;l++)s.push({milkRunWeightId:$(i[l],o),quantity:isNaN(r[l])?"":parseInt(r[l]),remark:a[l]||""});return s}function j(e,t){for(var n=e.split(";"),o=t.split(";"),i=[],r=0;r<n.length;r++)n[r]&&!isNaN(o[r])&&i.push({description:n[r],amount:isNaN(o[r])?"":parseInt(o[r])});return i}function x(e,t){if(!(e[0]&&e[1]&&e[2]&&e[3]&&e[4]&&e[5]&&e[9]&&e[10]&&e[11]))return!0;var n=e[7].split(";"),o=e[8].split(";"),i=e[9].split(";"),r=e[10].split(";"),a=e[11].split(";");if(n.length!==o.length)return!0;if(i.length!==r.length||i.length!==a.length||r.length!==a.length)return!0;for(var s=0;s<i.length;s++)if(!i[s]||!r[s]||!$(i[s],t))return!0;return!1}function $(e,t){if(t){for(var n in a)if(e==a[n].textImport)return a[n].id;return 0}var o=e.split("-");return o&&2===o.length?parseInt(o[1]):0}function E(e){if(!e||0===e.length)return!1;for(var t=0;t<e.length;t++)if(e[t].isInValid)return!1;return!0}function L(e,t){e.totalPrice=t.totalPrice}var F=n.serviceUrl+"/api/milkrun/",O=3,B={getMilkRunByCriteria:m,getMilkRunById:p,saveMilkRun:g,assignVendor:h,convertListMilkRun:P,convertMilkRun:S,rejectApproveMilkRun:y,switchCollectionDeliveryPoint:T,getMilkRunPointsFromText:N,checkValidCollectionPoints:E,transferPricing:L,convertFrequency:D,onHoldMilkRun:C,unholdMilkRun:b,cancelJob:k,isValidFile:w};return B}angular.module("main.module").factory("milkrunService",e),e.$inject=["$http","$filter","systemSetting","milkRunFrequency","days","milkRunAdditionals","milkRunWeight","jobStatusType","milkRunTypes","utilityService","imageService","pricingService"]}(),function(){"use strict";function e(e){function t(t,n){var o=e.defer(),r=i(o,n);return r.readAsText(t),o.promise}function n(e){var t,n,i,r=o({data:e.data});null!=r&&(n=e.filename||"export.csv",r.match(/^data:text\/csv/i)||(r="data:text/csv;charset=utf-8,"+r),t=encodeURI(r),i=document.createElement("a"),i.setAttribute("href",t),i.setAttribute("download",n),i.click())}function o(e){var t,n,o,i,r,a;return a=e.data||null,null!=a&&a.length?(i=e.columnDelimiter||",",r=e.lineDelimiter||"\n",o=Object.keys(a[0]),t="",t+=o.join(i),t+=r,a.forEach(function(e){n=0,o.forEach(function(o){n>0&&(t+=i),t+=e[o],n++}),t+=r}),t):null}function i(e,t){var n=new FileReader;return n.onload=r(n,e,t),n.onerror=a(n,e,t),n}function r(e,t,n){return function(){n.$apply(function(){t.resolve(e.result)})}}function a(e,t,n){return function(){n.$apply(function(){t.reject(e.result)})}}var s={readAsDataUrl:t,exportCsvFile:n};return s}angular.module("main.module").factory("fileReaderService",e),e.$inject=["$q"]}(),function(){"use strict";function e(e,t,n){function o(t){var o=i+"?offset="+(t.currentPage-1)*t.itemPerPage;return o+="&limit="+t.itemPerPage,t.dateFrom&&(o+="&dateFrom="+n("date")(t.dateFrom,"yyyy-MM-dd")),t.dateTo&&(o+="&dateTo="+n("date")(t.dateTo,"yyyy-MM-dd")),t.action&&(o+="&action="+t.action),t.role&&(o+="&role="+t.role),t.userSearch&&(o+="&userSearch="+encodeURIComponent(t.userSearch)),t.descriptionSearch&&(o+="&descriptionSearch="+encodeURIComponent(t.descriptionSearch)),t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending),e.get(o)}var i=t.serviceUrl+"/api/log/",r={getLogByCriteria:o};return r}angular.module("main.module").factory("logService",e),e.$inject=["$http","systemSetting","$filter"]}(),function(){"use strict";function e(e,t,n){function o(){var n=t.serviceUrl+"/api/location/getFile";e({method:"GET",url:n,responseType:"arraybuffer"}).success(function(e,t,n){n=n();var o="master_location.csv",i=n["content-type"],r=document.createElement("a");try{var a=new Blob([e],{type:i}),s=window.URL.createObjectURL(a);r.setAttribute("href",s),r.setAttribute("download",o);var l=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});r.dispatchEvent(l)}catch(e){console.warn(e)}},function(e){console.warn("fail to download"),console.warn(e)})}function i(){var n=t.serviceUrl+"/api/location/lastUpdate";return e.get(n)}function r(e,o){var i=t.serviceUrl+"/api/location/import";return n.upload({url:i,data:{file:e}})}var a={downloadFile:o,uploadFile:r,lastUpdate:i};return a}angular.module("main.module").factory("allLocationsService",e),e.$inject=["$http","systemSetting","Upload"]}(),function(){"use strict";function e(e,t){function n(t){return e.post(u+"calculate/milkrun",t)}function o(t){return e.post(u+"calculate/adhoc",t)}function i(){e.get(u+"adhocGBiz").then(function(e){m=e.data}),e.get(u+"pssGBiz").then(function(e){p=e.data}),e.get(u+"healthCareFixedRunGBiz").then(function(e){g=e.data}),e.get(u+"healthCareAdhocGBiz").then(function(e){v=e.data})}function r(){return m}function a(){return p}function s(){return g}function l(){return v}function c(e,t){e.totalPrice=t.totalPrice,d(e.collectionPoints,t.collectionPoints),d(e.deliveryPoints,t.deliveryPoints)}function d(e,t){for(var n=0;n<e.length;n++)if(e[n].chargeableWeight=t[n].chargeableWeight,e[n].subTotalPrice=t[n].subTotalPrice,e[n].items&&e[n].items.length)for(var o=0;o<e[n].items.length;o++)e[n].items[o].unitPrice=t[n].items[o].unitPrice}var u=t.serviceUrl+"/api/pricing/",m=[],p=[],g=[],v=[],f={calculateMilkRun:n,calculateAdhoc:o,transferPricing:c,getAdhocgBiz:r,getFixedRungBiz:a,getGBizCodeHCFixedRun:s,getGBizCodeHCAdhoc:l,loadGBizCode:i};return f}angular.module("main.module").factory("pricingService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n){function o(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var o={params:{offset:(t.currentPage-1)*t.itemPerPage,limit:t.itemPerPage}};return t.searchTerm&&(o.params.search=t.searchTerm),t.departmentId&&(o.params.departmentId=t.departmentId),t.organizationCode&&(o.params.organizationCode=t.organizationCode),t.sortColumn&&(o.params.sortBy=t.sortColumn,o.params.ascending=t.sortAscending),e.get(m,o)}function i(t){return e.get(m+t)}function r(t){return t.id?e.put(m+t.id,t):e.post(m,t)}function a(t){return e.post(m+"deactivate/"+t)}function s(t){return e.post(m+"activate/"+t)}function l(t){return e.post(m+"vendorExists",{email:t})}function c(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,organization:e.organization,organizationCode:e.organizationCode,contactPerson:e.contactPerson,phoneNumber:e.phoneNumber,alternativeContactPerson:e.alternativeContactPerson,alternativePhoneNumber:e.alternativePhoneNumber,workAddress:e.workAddress?e.workAddress.blockNumber+" "+e.workAddress.streetName+" "+e.workAddress.unitNumber+" "+e.workAddress.postalCode:"",status:e.lockoutEnabled?"Inactive":"Active"})}),t}function d(e){var t=[{id:"",organization:"All"}];return angular.forEach(e,function(e){t.push({id:e.id,organization:e.organizationCode+" "+e.organization})}),t}function u(e){var t={id:e.id,organization:e.organization,organizationCode:e.organizationCode,contactPerson:e.contactPerson,phoneNumber:e.phoneNumber,email:e.email,alternativeContactPerson:e.alternativeContactPerson,alternativePhoneNumber:e.alternativePhoneNumber,alternativeEmail:e.alternativeEmail,workAddress:e.workAddress,department:e.department,lockoutEnabled:e.lockoutEnabled};return t}function d(e){var t=[{id:"",name:"All"},{id:"Unassigned",name:"Unassigned"}];return angular.forEach(e,function(e){t.push({id:e.id,name:e.organization})}),t}var m=t.serviceUrl+"/api/vendors/",p={getVendorByCriteria:o,getVendorById:i,saveVendor:r,activateVendor:s,deactivateVendor:a,checkEmailExist:l,convertListVendor:c,convertVendor:u,convertListVendorDropDownList:d};return p}angular.module("main.module").factory("vendorService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord"]}(),function(){"use strict";function e(e,o,i,r,a,s,l){function c(){var t="//datamall2.mytransport.sg/ltaodataservice/TrafficIncidents",i=e.defer(),r=function(e){return _.chain(e).first(l.maxTickerItems).map(function(e){var t=e.Message.trim().split(/ (.+)?/);return{date:t[0].replace(")",") "),message:t[1]}}).value()};return s.isLocal?a(function(){i.resolve(r([{Message:"(16/11)14:24 Roadworks on Grange Road near Grange Road/Tanglin Road Junction."},{Message:"(16/11)14:10 Roadworks on Stevens Road (towards Bukit Timah Road) after Robin Close. Avoid right lane."},{Message:"(16/11)13:59 Roadworks on PIE (towards Changi Airport) after Kallang. Avoid lane 3."},{Message:"(16/11)13:56 Roadworks on AYE (towards Tuas) before Clementi Ave 2 Exit."},{Message:"(16/11)13:48 Roadworks on SLE (towards CTE) before Mandai Ave Exit with congestion till Woodlands Ave 12 Exit. Avoid lane 3."}]))},n.getRandomInt(100,1500)):o.get(t,{headers:{AccountKey:"z9/ibYLO05S7Cn8rgVyFQQ==","Content-Type":"application/json"}}).then(function(e){i.resolve(r(e.data.value))},function(e){console.warn(e)}),i.promise}function d(i,l,c){var d={params:{jobType:c}};if(i&&(d.params.fromCreatedDate=r("date")(new Date(i),s.simpleDateFormat)),l&&(d.params.toCreatedDate=r("date")(new Date(l),s.simpleDateFormat)),t&&s.isLocal){var u=e.defer();return a(function(){var e;1===n.usingSummaryCounts?(n.usingSummaryCounts=2,e=n.summaryCounts2):(n.usingSummaryCounts=1,e=n.summaryCounts),u.resolve({data:e})},n.getRandomInt(100,1500)),u.promise}return o.get(p+"summary",d)}function u(i,l){var c=e.defer(),d={params:{jobType:l,date:r("date")(i,s.simpleDateFormat)}},u=i.getFullYear()+"-"+(i.getMonth()+1);if("undefined"!=typeof v.daysOfMonthWithJobs&&"undefined"!=typeof v.daysOfMonthWithJobs[l]&&"undefined"!=typeof v.daysOfMonthWithJobs[l][u])return c.resolve(v.daysOfMonthWithJobs),c.promise;var m=function(e,t,n){return v.daysOfMonthWithJobs=v.daysOfMonthWithJobs||{},v.daysOfMonthWithJobs[e]=v.daysOfMonthWithJobs[e]||{},v.daysOfMonthWithJobs[e][t]=n,v.daysOfMonthWithJobs};return t&&s.isLocal?a(function(){c.resolve(m(l,u,n.daysWithJobs))},n.getRandomInt(100,1500)):o.get(p+"days",d).then(function(e){c.resolve(m(l,u,e.data))},function(e){console.warn(e)}),c.promise}function m(i,r,l){function c(e,t){t=t||[];var n,o,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=[];if(t.length<12){for(0===t.length?n=(new Date).getMonth():(n=_.findIndex(i,function(e){return e===t[t.length-1].month})+1,n>i.length-1&&(n=0)),o=0;o<12-t.length;++o)o+n<12?r.push(i[n+o]):r.push(i[o-(12-n)]);t=_.map(r,function(e){return{month:e,amount:0}}).concat(t)}e.resolve({data:t})}var d=e.defer(),u={params:{jobType:i}};return"undefined"!=typeof r&&(u.params.customerId=r),"undefined"!=typeof l&&(u.params.costCentre=l),t&&s.isLocal?a(function(){var e;1===n.usingSpendings?(n.usingSpendings=2,e=n.spendings2):(n.usingSpendings=1,e=n.spendings),c(d,e)},n.getRandomInt(100,1500)):o.get(p+"spending",u).then(function(e){c(d,e.data)},function(e){console.warn(e)}),d.promise}var p=s.serviceUrl+"/api/dashboard/",g={getTrafficUpdates:c,getSummary:d,getDaysOfMonthWithJobs:u,getSpending:m},v={};return g}var t=!1,n={getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},usingSummaryCounts:1,summaryCounts:{approved:12,rejected:24,completed:103,scheduled:4},summaryCounts2:{approved:25,rejected:31,completed:82,scheduled:13},usingTodaysJobs:1,todaysJobs:[{collectionPointAddress:"Blk 393 Jurong Central Street 13 #13-27, S045631",deliveryPointAddress:"5 Clementi Loop, S889970",barcode:"834976531",status:"collected"},{collectionPointAddress:"Blk 393 Jurong Central Street 13 #13-27, S045631",deliveryPointAddress:"5 Clementi Loop, S889970",barcode:"834976531",status:"completed"},{collectionPointAddress:"Blk 393 Jurong Central Street 13 #13-27, S045631",deliveryPointAddress:"5 Clementi Loop, S889970",barcode:"834976531",status:"scheduled"}],todaysJobs2:[],daysWithJobs:[1,15,16,23,26],usingSpendings:1,spendings:[{month:"Nov",amount:600},{month:"Dec",amount:1e3},{month:"Jan",amount:1500},{month:"Feb",amount:1400},{month:"Mar",amount:2500},{month:"Apr",amount:3e3},{month:"May",amount:3500},{month:"Jun",amount:800},{month:"Jul",amount:2900},{month:"Aug",amount:4300},{month:"Sep",amount:1e3},{month:"Oct",amount:1300}],spendings2:[{month:"Nov",amount:2e3},{month:"Dec",amount:200},{month:"Jan",amount:3e3},{month:"Feb",amount:300},{month:"Mar",amount:1200},{month:"Apr",amount:2600},{month:"May",amount:6e3},{month:"Jun",amount:2800},{month:"Jul",amount:600},{month:"Aug",amount:1200},{month:"Sep",amount:3500},{month:"Oct",amount:1e3}]};angular.module("main.module").factory("dashboardService",e),e.$inject=["$q","$http","$location","$filter","$timeout","systemSetting","dashboardConst"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u){function m(t){var n=J+"?offset="+(t.currentPage-1)*t.itemPerPage;return n+="&limit="+t.itemPerPage,t.status&&(n+="&status="+t.status),t.dateFrom&&(n+="&fromCreatedDate="+r("date")(t.dateFrom,"yyyy-MM-dd")),t.dateTo&&(n+="&toCreatedDate="+r("date")(t.dateTo,"yyyy-MM-dd")),t.requestType&&(n+="&requestType="+t.requestType),t.searchTerm&&(n+="&search="+t.searchTerm),t.customer&&(n+="&customerId="+t.customer),t.hasPo&&(n+="&hasPo="+t.hasPo),e.get(n)}function p(t){t.requestDate.setHours(t.requestTime.getHours(),t.requestTime.getMinutes()),v(t);var n=new FormData;n.append("data",JSON.stringify(t));var o=c.getImageItem();return o.length&&angular.forEach(o,function(e){angular.forEach(e.images,function(t){n.append(e.key,t)})}),t.id?e.put(J+t.id,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}):e.post(J,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}function g(t){return e.get(J+t)}function v(e){f(e.serviceType,e.collectionPoints),f(e.serviceType,e.deliveryPoints)}function f(e,t){var n=d.getAdhocgBiz(),o=d.getGBizCodeHCAdhoc();angular.forEach(t,function(t){angular.forEach(t.items,function(t){if(e<4){var i=h(e,t,n);i&&(t.gBizCode=i)}else{var i=y(e,t,o);i&&(t.gBizCode=i)}})})}function h(e,t,n){var o={1:"threeHour",2:"sameDay",3:"nextDay"};if(!n)return"";var i=n.find(function(e){return t.unitMass<=20?t.unitMass>e.weightFrom&&t.unitMass<=e.weightTo:20==e.weightFrom});return i?i[o[e]]:""}function y(e,t,n){var o={5:"officeHour",6:"officeHourExpress",7:"weekdayEvening",8:"weekdayEveningExpress",9:"weekend"};if(!n)return"";var i=n.find(function(e){return t.description==e.item});return i?i[o[e]]:""}function C(n){var o=t.serviceUrl+"/api",i=n.isMilkRun?"/milkrun":"/jobs",r=n.isDriver?"/assigninternaldriver":"/assignvendor";return n.isDriver?n.driverId=n.userId:n.vendorId=n.userId,e.post(o+i+r,n)}function b(n){var o=t.serviceUrl+"/api",i=n.isMilkRun?"/milkrun":"/jobs",r=n.isDriver?"/unassigninternaldriver":"/unassignvendor";return e.post(o+i+r,n)}function k(n,o,i){var r=t.serviceUrl+"/api",a=i?"/milkrun":"/jobs";return r+=a+"/"+n,e.patch(r,o)}function P(t){return e.post(J+"updateStatus",t)}function D(e){if(e){_=e.id;var t=e.pricings.find(function(e){return e.pricingType===l.Adhoc});t&&(G={"Evening, Sat, Sun & Public Holiday":t.additionalAfterOfficeHr,"Restricted Area":t.additionalRestrictedArea})}else _=0,G={};R(),I()}function A(e){return G[e]}function M(){return _}function S(e){return K[e]}function T(){return Y}function R(){u.searchFavoriteAddress("","1",_).then(function(e){K[1]=e.data.favoriteAddresses}),u.searchFavoriteAddress("","2",_).then(function(e){K[2]=e.data.favoriteAddresses})}function I(){u.searchFavoriteItem("",_).then(function(e){Y=e.data.favoriteItems})}function N(t){return e.post(J+"onHold/"+t)}function w(t){return e.post(J+"unhold/"+t)}function U(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,customer:e.customer.organizationCode+" - "+e.customer.name,createdDate:e.requestDate,collectionPoints:q(e.collectionPoints,e.id),deliveryPoints:q(e.deliveryPoints,e.id),requestType:H(e.serviceType),status:z(e.jobStatus,i),createdBy:e.createdBy,poNumber:e.poNumber||"-"})}),t}function j(e){return e.requestDate=s.convertDate(e.requestDate),e.collectionDate=s.convertDate(e.collectionDate),e.deliveryDate=s.convertDate(e.deliveryDate),e.statusText=z(e.jobStatus,i),e}function x(e,t,n){angular.forEach(e,function(e){t&&e.collectionDate<t||n&&e.collectionDate.getTime()!=n.getTime()?e.isInValid=!0:e.isInValid=!1})}function $(e){if(!e||!e.surchargeAmount)return[];for(var t=[],n=0;n<e.surcharges.length;n++)e.surcharges[n]&&e.surchargeAmount[n]&&t.push({name:E(e.surcharges[n]),amount:e.surchargeAmount[n]});return t}function E(e){return e==a.nonworkingDay.value?a.nonworkingDay.display+":":a.weekdayEvening.display+":"}function L(e,t,n){var o=[],i=e.split(/\r\n|\n/);if(i&&i.length>1)for(var r=1;r<i.length;r++)if(i[r]){var a=i[r].split(",");a[6]&&(a[6]=O(a[6])),o.push({address:{postalCode:a[0],blockNumber:a[1],streetName:a[2],unitNumber:a[3]},name:a[4],contactNumber:a[5],collectionDate:new Date(angular.copy(a[6])),collectionTime:B(angular.copy(a[6])),isInValid:F(a,t,n)})}return o}function F(e,t,n){if(!e[0]||!e[1]||!e[2]||!e[3]||!e[4]||!e[5]||isNaN(Date.parse(e[6])))return!0;if(t&&new Date(e[6])<t)return!0;if(n){var o=new Date(e[6]);if(o.getDate()!=n.getDate()||o.getMonth()!=n.getMonth()||o.getFullYear()!=n.getFullYear())return!0}return!1}function O(e){var t=e.split("/");if(t.length<2)return e;var n=t[0];return t[0]=t[1],t[1]=n,t.join("/")}function B(e){return isNaN(Date.parse(e[6]))?null:new Date(e)}function V(e){}function H(e){var t=z(e,n);return"N/A"==t&&(t=z(e,o)),t}function z(e,t){for(var n in t)if(t[n].value==e)return t[n].display;return"N/A"}function q(e,t){var n,o="",i="";return e.length>W?(n=[e[0],e[1],e[2]],i='<a href="#adhoc/detail/'+t+'"> ... and '+(e.length-W)+" more<a/>"):n=e,angular.forEach(n,function(e){e.address&&(o+="<p>"+e.address.blockNumber+" "+e.address.streetName+" "+e.address.unitNumber+" "+e.address.postalCode+"</p>")}),o+i}var J=t.serviceUrl+"/api/jobs/",W=3,G={},_=0,_=0,K={1:[],2:[]},Y=[],Q={getAdhocPointsFromText:L,getAdhocByCriteria:m,saveAdhoc:p,getAdhocById:g,assignVendor:C,unAssignVendor:b,switchCollectionDeliveryPoint:V,convertAdhoc:j,convertListAdhoc:U,rejectApproveAdhoc:P,onHoldAdhoc:N,unholdAdhoc:w,getServiceType:H,getAdditionalSurcharge:$,validateDateOfPoint:x,updatePo:k,setChosenClient:D,getSurchargeAmount:A,getClientId:M,getFavoriteAddress:S,getFavoriteItems:T};return Q}angular.module("main.module").factory("adhocService",e),e.$inject=["$http","systemSetting","adhocPSSServiceType","adhocHealthCareServiceType","jobStatus","$filter","adHocSurcharge","utilityService","pricingType","imageService","pricingService","favoriteService"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s){function l(t){var o=w+"milkrun?offset="+(t.currentPage-1)*t.itemPerPage;return o+="&limit="+t.itemPerPage,""!==t.requestType&&(o+="&requestType="+t.requestType),t.jobDate&&(o+="&jobDate="+n("date")(t.jobDate,"yyyy-MM-dd")),t.status&&(o+="&status="+t.status),t.dateFrom&&(o+="&fromCreatedDate="+n("date")(t.dateFrom,"yyyy-MM-dd")),t.dateTo&&(o+="&toCreatedDate="+n("date")(t.dateTo,"yyyy-MM-dd")),t.searchTerm&&(o+="&search="+t.searchTerm),t.customer&&(o+="&customerId="+t.customer),t.vendor&&(o+="&vendorId="+t.vendor),t.driver&&(o+="&driverId="+t.driver),t.jobId&&(o+="&jobId="+t.jobId),e.get(o)}function c(o){var i=w+"adhoc",r={params:{}};return o.currentPage&&o.itemPerPage&&(r.params.offset=(o.currentPage-1)*o.itemPerPage),o.itemPerPage&&(r.params.limit=o.itemPerPage),o.requestType&&(r.params.requestType=o.requestType),o.jobDate&&(r.params.jobDate=n("date")(o.jobDate,t.simpleDateFormat)),o.status&&(r.params.status=o.status),o.dateFrom&&(r.params.fromCreatedDate=n("date")(o.dateFrom,t.simpleDateFormat)),o.dateTo&&(r.params.toCreatedDate=n("date")(o.dateTo,t.simpleDateFormat)),o.searchTerm&&(r.params.search=o.searchTerm),o.customer&&(r.params.customerId=o.customer),o.vendor&&(r.params.vendorId=o.vendor),o.driver&&(r.params.driverId=o.driver),o.jobId&&(r.params.jobId=o.jobId),e.get(i,r)}function d(t){return e.get(w+"milkrun/"+t)}function u(t){return e.get(w+"adhoc/"+t)}function m(t){return e.post(w+"milkrun/assignvendor",t)}function p(t){return e.post(w+"adhoc/assignvendor",t)}function g(t){return e.post(w+"adhoc/ready",t)}function v(t){return e.post(w+"adhoc/assigndriver",t)}function f(t){return e.post(w+"milkrun/assigndriver",t)}function h(t){var n=w,o=t.isMilkRun?"milkrun":"adhoc",i=t.isDriver?"/assigninternaldriver":"/assignvendor";return t.isDriver?t.driverId=t.userId:t.vendorId=t.userId,e.post(n+o+i,t)}function y(t,n){var o=n.isReturn?"/return":"/reattempt";return e.post(w+t+o,n)}function C(t,n){return e.post(w+"set/"+t,n)}function b(t,n){return e.patch(w+t+"/transactionDate",n)}function k(n){return e.get(t.serviceUrl+"/api/image?name="+n)}function P(t){return e.post(w+"/proof",t,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}function D(t,n){var o=n?w+"removepoc":w+"removepod";return e.post(o,t)}function A(n){var o=t.serviceUrl+"/api/tasks",i=n.isMilkRun?"/milkrun":"/adhoc",r=n.isDriver?"/unassigninternaldriver":"/unassignvendor";return e.post(o+i+r,n)}function M(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,barcode:e.barcode,customer:e.customer,createdDate:e.createdDate,jobDate:e.jobDate,status:e.status,statusText:N(e.status,o),frequency:a.convertFrequency(e),collectionPoints:e.collectionPointAddress.blockNumber+" "+e.collectionPointAddress.streetName+" "+e.collectionPointAddress.unitNumber+" "+e.collectionPointAddress.postalCode,deliveryPoints:e.deliveryPointAddress.blockNumber+" "+e.deliveryPointAddress.streetName+" "+e.deliveryPointAddress.unitNumber+" "+e.deliveryPointAddress.postalCode,vendorText:e.vendorName?e.vendorName:e.driverName?"Internal":"-",driverName:e.driverName,createdBy:e.createdBy})}),t}function S(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,barcode:e.barcode,customer:e.customer,createdDate:e.createdDate,status:e.status,statusText:N(e.status,o),requestType:I(e.requestType),pickUpDate:e.pickUpDate,deliveryDate:e.deliveryDate,collectionPoint:e.collectionPointAddress.blockNumber+" "+e.collectionPointAddress.streetName+" "+e.collectionPointAddress.unitNumber+" "+e.collectionPointAddress.postalCode,deliveryPoint:e.deliveryPointAddress.blockNumber+" "+e.deliveryPointAddress.streetName+" "+e.deliveryPointAddress.unitNumber+" "+e.deliveryPointAddress.postalCode,vendorText:e.vendorName?e.vendorName:e.driverName?"Internal":"-",driverName:e.driverName,createdBy:e.createdBy,amount:e.amount,pocImages:e.pocImages,podImages:e.podImages})}),t}function T(e){if(e.clientName=e.organizationCode+" - "+e.customer,e.barcode=e.barcode+e.id,e.statusText=N(e.status,o),e.requestType=I(e.requestType),e.totalPrice=e.subTotalPrice+e.returnReattemptCharges,e.adminRemarks&&0===e.adminRemarks.indexOf("<br/>")){var t=e.adminRemarks.length;e.adminRemarks=e.adminRemarks.substring(5,t)}return e}function R(e){if(e.clientName=e.organizationCode+" - "+e.customer,e.barcode=e.barcode+e.id,e.statusText=N(e.status,o),e.totalPrice=e.subTotalPrice+e.returnReattemptCharges,e.adminRemarks&&0===e.adminRemarks.indexOf("<br/>")){var t=e.adminRemarks.length;e.adminRemarks=e.adminRemarks.substring(5,t)}return e}function I(e){var t=N(e,i);return"N/A"===t&&(t=N(e,r)),t}function N(e,t){for(var n in t)if(t[n].value===e)return t[n].display;return"N/A"}var w=t.serviceUrl+"/api/tasks/",U={getMilkRunTaskByCriteria:l,getAdhocTaskByCriteria:c,getMilkRunTaskById:d,getAdhocTaskById:u,assignVendorMilkrun:m,assignVendorAdhoc:p,setReadyToBillAdhoc:g,assignDriverMilkrun:f,assignDriverAdhoc:v,assignVendorInternalDriver:h,unAssignVendorDriver:A,updateTask:C,updateTaskDate:b,uploadProof:P,removeProof:D,returnOrReattemptTask:y,convertListMilkRunTask:M,convertListAdhocTask:S,convertAdhocTask:T,convertMilkrunTask:R,getImageFromFileName:k};return U}angular.module("main.module").factory("taskService",e),e.$inject=["$http","systemSetting","$filter","taskStatus","adhocPSSServiceType","adhocHealthCareServiceType","milkrunService","milkRunWeight"]}(),function(){"use strict";function e(e,t,n,o,i,r){function a(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var o=y+"?offset="+(t.currentPage-1)*t.itemPerPage;return o+="&limit="+t.itemPerPage,t.searchTerm&&(o+="&search="+t.searchTerm),t.department&&(o+="&departmentId="+t.department),t.driverType&&(o+="&driverType="+t.driverType),t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending),e.get(o)}function s(t){var o=y+"?offset=0&limit="+n+"&driverType=1&customerId="+t;return e.get(o)}function l(t){return t.id?e.put(y+t.id,t):e.post(y,t)}function c(t){return e.get(y+t)}function d(t){return e.post(y+"ChangePassword",t)}function u(t,n){var o=y+"CheckUserExists?username="+t;return n&&(o+="&id="+n),e.get(o)}function m(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(y+n+t.id)}function p(e){return e.map(function(e){return{id:e.id,name:e.firstName+" "+e.lastName,userId:e.userName,department:g(e.driverDepartments),phoneNumber:e.phoneNumber,permission:f(e.driverDepartments),status:v(e.driverDepartments)?"Active":"Inactive",vendorName:e.vendorName||"-",driverType:e.vendorId?"External":"Internal"}})}function g(e){var t=e.map(function(e){return 1===e.departmentId?"PSS":"Healthcare"});return t.join("/")}function v(e){var t=e;if(o.currentUser.role!==i.SuperAdmin){var n=o.currentUser.department===r.PSS.name?r.PSS.id:r.Healthcare.id;t=e.filter(function(e){return e.departmentId===n})}return t.some(function(e){return e.active})}function f(e){var t=e.some(function(e){return 1===e.departmentId&&e.hasCreateJobPermission}),n=e.some(function(e){return 2===e.departmentId&&e.hasCreateJobPermission}),o=[];return t&&o.push("PSS"),n&&o.push("Healthcare"),o.length?o.join("/"):"No"}function h(e){var t=[{id:"",name:"All"},{id:"Unassigned",name:"Unassigned"}];return angular.forEach(e,function(e){t.push({id:e.id,name:e.firstName+" "+e.lastName})}),t}var y=t.serviceUrl+"/api/drivers/",C={getDriverByCriteria:a,getInternalDriver:s,saveDriver:l,getDriverById:c,activateOrDeactivate:m,convertListDriver:p,convertListVendorDropDownList:h,updatePassword:d,checkUserIdExist:u};return C}angular.module("main.module").factory("driverService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord","$rootScope","systemRole","departments"]}(),function(){"use strict";function e(e,t,n,o,i,r){function a(t){var o=p;return o+="?offset="+(t.currentPage-1)*t.itemPerPage,o+="&limit="+t.itemPerPage,t.fromDate&&(o+="&fromDate="+n("date")(t.fromDate,"yyyy-MM-dd")),t.toDate&&(o+="&toDate="+n("date")(t.toDate,"yyyy-MM-dd")),t.searchTerm&&(o+="&search="+t.searchTerm),t.customer&&(o+="&customerId="+t.customer),t.departmentId&&(o+="&departmentId="+t.departmentId),o+="&type="+t.type,e.get(o)}function s(t){var o=p+"export?type="+t.type;return t.fromDate&&(o+="&fromDate="+n("date")(t.fromDate,"yyyy-MM-dd")),t.toDate&&(o+="&toDate="+n("date")(t.toDate,"yyyy-MM-dd")),t.customerIds&&(o+="&customerIds="+t.customerIds.join(",")),t.columns&&(o+="&columns="+t.columns.join(",")),e.get(o)}function l(t){t=t||0;var n=p+"columnsSetting";return e.get(n)}function c(t){return e.post(p+"updateColumnsSetting",{columnIds:t})}function d(e,t){return e.map(function(e){var a=m(e.subJobType),s="0"==t?i.getServiceType(e.serviceType):u(e.serviceType,r);return{BarcodeNumber:e.barcode+e.id,OrganizationName:e.customer,OrganizationCode:e.organizationCode,SAPCode:e.sapCode,Department:e.department,RequestorName:e.requester,RequestorContact:e.requesterContact,CostCenter:e.costCentre,BillingAddress:e.billingAddress,RequestDate:n("date")(e.requestDate,"dd/MM/yyyy HH:mm:ss"),JobType:e.jobType||"Fixed Run",TypeAdHoc:a,TypeService:s,TypeFixedRun:a,Frequency:s,CollectionAddress:e.collectionPointAddress,ScheduledCollectionDate:n("date")(e.pickUpDate,"dd/MM/yyyy"),DeliveryAddress:e.deliveryPointAddress,ScheduledDeliveryDate:n("date")(e.deliveryDate,"dd/MM/yyyy"),NumberItems:e.numberOfItems,ItemDescription:e.itemDescription,Charge:e.subTotalPrice,AdditionalCost:e.returnReattemptCharges,TotalCost:e.subTotalPrice+e.returnReattemptCharges,Status:u(e.status,o),POCTimestamp:n("date")(e.pocDate,"dd/MM/yyyy HH:mm:ss"),PODTimestamp:n("date")(e.podDate,"dd/MM/yyyy HH:mm:ss"),CreatedBy:e.createdBy||"None",VendorName:e.vendorName,DriverName:e.driverName,VehicleNumber:e.vehicleNumber,DriverRemark:e.driverRemark,PhotoPresent:e.photoPresent,SurchargesJob:"$"+e.surcharges+" (Job ID: "+e.jobId+")",AdditionalSurcharges:e.additionalCharges||0,Remark:e.additionalChargeRemark,Reattempt:e.reattempt}})}function u(e,t){for(var n in t)if(t[n].value===e)return t[n].display;return"N/A"}function m(e){return 1==e?"One To One":2==e?"One To Many":3==e?"Many To One":"N/A"}var p=t.serviceUrl+"/api/report/",g={getReportByCriteria:a,exportCsv:s,getColumns:l,convertListReport:d,updateColumns:c};return g}angular.module("main.module").factory("reportService",e),e.$inject=["$http","systemSetting","$filter","taskStatus","adhocService","milkRunFrequency"]}(),function(){"use strict";function e(e){function t(t){var n=new Date,o=n.getTimezoneOffset(),i=e+o,r=new Date(t);return r.setMinutes(r.getMinutes()-i),r}return{convertDate:t,getAbsoluteElHeight:function(e){e="string"==typeof e?document.querySelector(e):e;var t=window.getComputedStyle(e),n=parseFloat(t.marginTop)+parseFloat(t.marginBottom);return Math.ceil(e.offsetHeight+n)}}}angular.module("main.module").factory("utilityService",e),e.$inject=["defaultTimeZoneOffset"]}(),function(){"use strict";function e(e,t,n,o){function i(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var o=t.isAddress?"getFavoriteAddresses":"getFavoriteItems",i=f+o+"?offset="+(t.currentPage-1)*t.itemPerPage;return i+="&limit="+t.itemPerPage,t.searchTerm&&(i+="&search="+t.searchTerm),t.addressType&&(i+="&addressType="+t.addressType),t.sortColumn&&(i+="&sortBy="+t.sortColumn,i+="&ascending="+t.sortAscending),e.get(i)}function r(t){return t.postalCode=t.address.postalCode,t.blockNumber=t.address.blockNumber,t.streetName=t.address.streetName,t.unitNumber=t.address.unitNumber,t.id?e.put(f+"updateFavoriteAddress/"+t.id,t):e.post(f+"createFavoriteAddress",t)}function a(t){return t.id?e.put(f+"updateFavoriteItem/"+t.id,t):e.post(f+"createFavoriteItem",t)}function s(t){return e.delete(f+"deleteFavoriteAddress/"+t)}function l(t){return e.delete(f+"deleteFavoriteItem/"+t)}function c(t){var n=o.defer();return e.get(f+"favoriteAddress/"+t).then(function(e){var t=e.data;
t.address={postalCode:t.postalCode,blockNumber:t.blockNumber,streetName:t.streetName,unitNumber:t.unitNumber},n.resolve(t)}),n.promise}function d(t){return e.get(f+"favoriteItem/"+t)}function u(t,n){var o=f+"getFavoriteItems?search="+t;return n&&(o+="&customerId="+n),e.get(o)}function m(t,n,o){var i=f+"getFavoriteAddresses?search="+t;return n&&(i+="&addressType="+n),o&&(i+="&customerId="+o),e.get(i)}function p(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(f+n+t.id)}function g(e,t){return t?e.favoriteAddresses.map(function(e){return{id:e.id,name:e.name,address:e.blockNumber+" "+e.streetName+" "+e.unitNumber+" "+e.postalCode,contactPerson:e.contactPerson,contactNumber:e.contactNumber,addressType:1===e.addressType?"Collection":2===e.addressType?"Delivery":"Collection & Delivery"}}):e.favoriteItems.map(function(e){return{id:e.id,name:e.name,description:e.description,uom:e.uom,issueQuantity:e.issueQuantity,unitMass:e.unitMass?e.unitMass+" kg":"-",unitVolume:e.width&&e.height&&e.depth?e.width+"x"+e.height+"x"+e.depth+" = "+e.width*e.height*e.depth+" cm3":"-"}})}function v(e){var t=[{id:"",name:"All"},{id:"Unassigned",name:"Unassigned"}];return angular.forEach(e,function(e){t.push({id:e.id,name:e.firstName+" "+e.lastName})}),t}var f=t.serviceUrl+"/api/favorite/",h={getByCriteria:i,getFavoriteAddress:c,getFavoriteItem:d,activateOrDeactivate:p,convertListItem:g,convertListVendorDropDownList:v,saveFavoriteAddress:r,saveFavoriteItem:a,deleteAddress:s,deleteItem:l,searchFavoriteAddress:m,searchFavoriteItem:u};return h}angular.module("main.module").factory("favoriteService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord","$q"]}(),function(){"use strict";function e(e,t){function n(e,t,n){n?angular.forEach(s,function(e){e.key===t&&(e.images=e.images.filter(function(e){return e.name!==n}))}):s.push({key:t,images:e})}function o(){s=[]}function i(){return s}function r(n){return e.get(t.serviceUrl+"/api/image?name="+n)}function a(e){var t="";return angular.forEach(s,function(n){angular.forEach(n.images,function(n){n.name===e&&(t=n)})}),t}var s=[];return{setImageItem:n,getImageItem:i,clearImageItem:o,getImageFromFileName:r,getImageFromName:a}}angular.module("main.module").factory("imageService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n,o){function i(t,n){var i=n?d:d+"/cancelled";return i=i+"?offset="+(t.currentPage-1)*t.itemPerPage,i+="&limit="+t.itemPerPage,t.status&&(i+="&ready="+t.status),t.searchTerm&&(i+="&search="+t.searchTerm),t.date&&(i+="&period="+o("date")(t.date,"MM/yyyy")),t.sortColumn&&(i+="&sortBy="+t.sortColumn,i+="&ascending="+t.sortAscending),t.department&&(i+="&departmentId="+t.department),e.get(i)}function r(t,n,o,i){var r=t.split("-"),a="";o&&(a+="/cancelled");var s=d+a+"/detail?customerId="+r[0]+"&costCentreId="+r[1]+"&poNumberId="+r[2],i=r[3]+"/"+r[4];return s+="&period="+i,o||(s+="&billingType="+r[5]),n&&(s+="&search="+n),e.get(s)}function a(t){return e.get(d+"/summary?period="+o("date")(t,"MM/yyyy"))}function s(t,n){return e.post(d+"/"+n,t)}function l(e){return e.map(function(e){var t=e.readyAmount===e.totalAmount?"full":"in-progress",i=100*e.readyAmount/e.totalAmount,r=n.trustAsHtml('<div class="progress billing-progress"><div class="progress-bar '+t+'" style="width:'+i+'%"></div></div>');return{customerId:e.customerId,poNumberId:e.poNumberId,costCentreId:e.costCentreId,customerName:e.customerName||"-",costCentreName:e.costCentreName||"-",poNumber:e.poNumber||"-",totalJob:e.readyJob+"/"+e.totalJob+" ready",amountBar:r,billingType:e.billingType,amountText:"<b>"+o("currency")(e.readyAmount)+"/"+o("currency")(e.totalAmount)+"</b>"}})}function c(e){return e.map(function(e){return e.totalAmount=o("currency")(e.totalAmount),e})}var d=t.serviceUrl+"/api/billing",u={getByCriteria:i,getBillingDetail:r,doAction:s,summaryBilling:a,convertBilling:l,convertCancelledBilling:c};return u}angular.module("main.module").factory("billingService",e),e.$inject=["$http","systemSetting","$sce","$filter"]}(),function(){"use strict";function e(e,t,n,o){function i(t){var o=l+"?offset="+(t.currentPage-1)*t.itemPerPage;return o+="&limit="+t.itemPerPage,t.status&&(o+="&status="+t.status),t.searchTerm&&(o+="&search="+t.searchTerm),t.date&&(o+="&period="+n("date")(t.date,"MM/yyyy")),t.department&&(o+="&departmentId="+t.department),e.get(o)}function r(t){var n=l+"/detail?offset="+(t.currentPage-1)*t.itemPerPage;return n+="&limit="+t.itemPerPage,t.refNumber&&(n+="&refNumber="+t.refNumber),t.invoiceNumber&&(n+="&refNumber="+t.invoiceNumber),t.customerId&&(n+="&customerId="+t.customerId),t.costCentreId&&(n+="&costCentreId="+t.costCentreId),t.poNumberId&&(n+="&costCentreId="+t.poNumberId),t.searchTerm&&(n+="&search="+t.searchTerm),t.status&&(n+="&status="+t.status),e.get(n)}function a(e){return e.map(function(e){return{invoiceNumber:e.invoiceNumber||"-",refNumber:e.refNumber||"-",invoiceDate:e.invoiceDate?n("date")(e.invoiceDate,"dd/MM/yyyy"):"-",customerName:e.customerName||"-",costCentreName:e.costCentreName||"-",poNumber:e.poNumber||"-",totalJob:e.totalJob||"-",status:e.statuses?s(e.statuses[0]):"-",totalAmount:e.totalAmount||"-"}})}function s(e){for(var t in o)if(o[t].value===e)return o[t].display;return""}var l=t.serviceUrl+"/api/invoices",c={getByCriteria:i,convertData:a,getInvoiceDetail:r};return c}angular.module("main.module").factory("invoicedService",e),e.$inject=["$http","systemSetting","$filter","invoiceStatus"]}(),function(){"use strict";function e(e,t){function n(){r.showChosenColumn&&(r.isContainColumn=i,r.translationTexts={checkAll:"Show All",dynamicButtonTextSuffix:"columns"},r.chosenColumnConfig={idProp:"name",displayProp:"display",showUncheckAll:!1},r.chosenColumnModel=[],angular.forEach(r.gridConfig.columns,function(e){r.chosenColumnModel.push({id:e.name})}))}function o(e){r.options.sortColumn===e?r.options.sortAscending=!r.options.sortAscending:(r.options.sortAscending=!0,r.options.sortColumn=e),r.actionRequest()}function i(e){var t=!1;return angular.forEach(r.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}var r=this;r.setItemPerPage=e,r.sort=o,n(),r.eventsChosenColumn={onItemDeselect:function(e){1===r.chosenColumnModel.length&&r.chosenColumnModel.push(e),document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="none"},onSelectAll:function(){document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="inline"}}}angular.module("main.module").directive("grid",function(){return{restrict:"E",scope:{gridConfig:"=",options:"=",data:"=",actionRequest:"&",isLoading:"=",showChosenColumn:"=?"},templateUrl:"app/directives/commonControls/grid/grid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["setItemPerPage","$scope"]}(),function(){"use strict";function e(e,t){function n(e){l.optionsGrid.sortColumn===e?l.optionsGrid.sortAscending=!l.optionsGrid.sortAscending:(l.optionsGrid.sortAscending=!0,l.optionsGrid.sortColumn=e),l.actionRequest()}function o(e){t.path(l.gridConfig.navigationDetail+e)}function i(e){console.log("select > "+e.id),a(e.id)}function r(e){console.log("deselect : "+e.id),s(e.id)}function a(e){switch(e){case 1:l.column1=!0;break;case 2:l.column2=!0;break;case 3:l.column3=!0;break;case 4:l.column4=!0;break;case 5:l.column5=!0;break;case 6:l.column6=!0;break;case 7:l.column7=!0;break;case 8:l.column8=!0}}function s(e){switch(e){case 1:l.column1=!1;break;case 2:l.column2=!1;break;case 3:l.column3=!1;break;case 4:l.column4=!1;break;case 5:l.column5=!1;break;case 6:l.column6=!1;break;case 7:l.column7=!1;break;case 8:l.column8=!1}}var l=this;l.setItemPerPage=e,l.optionsGrid={sortColumn:"",sortAscending:!0,itemPerPage:20,totalItems:0},l.sort=n,l.navigateToDetail=o,l.columnModel=[],l.columnsData=[{id:1,label:"Collection barcode"},{id:2,label:"Customer"},{id:3,label:"Created date"},{id:4,label:"Request type"},{id:5,label:"Request status"},{id:6,label:"Status"},{id:7,label:"Pick up point"},{id:8,label:"Delivery point"}],l.defaultText={buttonDefaultText:"Default"},l.column1=!0,l.column2=!0,l.column3=!0,l.column4=!0,l.column5=!0,l.column6=!0,l.column7=!0,l.column8=!0,l.columnModel=[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8}],l.eventListeners={onItemSelect:i,onItemDeselect:r}}angular.module("main.module").directive("gridExt",function(){return{restrict:"E",scope:{gridConfig:"=",optionsGrid:"=",options:"=",data:"=",actionRequest:"&",isLoading:"="},templateUrl:"app/directives/commonControls/gridExt/gridExt.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["setItemPerPage","$location"]}(),function(){"use strict";function e(e,t){var n=this;n.data=t,n.ok=function(t){e.close(t)},n.cancel=function(){e.dismiss("cancel")}}angular.module("main.module").controller("ModalInstanceCtrl",e),e.$inject=["$uibModalInstance","data"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){function s(){return t.currentUser?a[t.currentUser.role].navigationItems:[]}function l(e){if(t.currentUser&&t.currentUser.role){var n=a[t.currentUser.role];if(n.viewOnly&&t.currentUser.viewOnly&&n.preventPage.indexOf(e)>-1)return!1}return u.indexOf(e)>-1}function c(){o.logout(),t.currentUser=null,n.path("/login")}var d=this;d.pageName=i,d.systemRole=r,d.logout=c,d.isNavItemAllowed=l,d.profileDisplayName="",t.currentUser&&(d.profileDisplayName=t.currentUser.firstName,t.currentUser.lastName&&(d.profileDisplayName+=" "+t.currentUser.lastName));var u=s()}angular.module("main.module").directive("headerPage",function(){return{restrict:"E",templateUrl:"app/directives/header/header.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$timeout","$rootScope","$location","authService","pageName","systemRole","systemRolesConfigs"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){function s(){c()}function l(){angular.element(i).off("resize",s)}function c(){if(d.doStickyCalculation){var e=0,t=m.clientHeight,n=a.getAbsoluteElHeight(footer),r=i.innerHeight,s=!1;t+n+e<r&&(s=!0),o(function(){d.stickyFooter=s})}}var d=this,u=r.footerHTML||[];d.content=_.map(u,function(t){return e(t)}),d.alignment=t.alignFooter,t.$watch("alignFooter",function(e){d.alignment=e}),d.doStickyCalculation=t.stickyFooter||!1,d.stickyFooter=!1;var m=document.getElementById("root-container");document.getElementById("footer");t.$watch("stickyFooter",function(e){d.doStickyCalculation=e,c()}),angular.element(i).on("resize",s),n.$on("$destroy",l)}angular.module("main.module").directive("footerPage",function(){return{restrict:"E",templateUrl:"app/directives/footer/footer.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$sanitize","$rootScope","$scope","$timeout","$window","userConfig","utilityService"]}(),function(){"use strict";angular.module("main.module").directive("compareTo",function(){return{restrict:"A",require:"ngModel",scope:{compareTo:"=compareTo"},link:function(e,t,n,o){t.bind("keyup",function(){e.$apply(function(){var n=t.val(),i=e.compareTo,r=n&&n===i;o.$setValidity("compareTo",r)})})}}})}(),function(){"use strict";function e(e,t){function n(){i.isOpen=!1,i.datePicker="dd/MM/yyyy",i.minDate&&e.$watch("vm.minDate",function(e){var t=angular.copy(e);t=new Date(t.setHours(0,0,0,0)),i.datepickerOptions=i.datepickerOptions?i.datepickerOptions:{},i.datepickerOptions.minDate=t}),i.monthPicker&&e.$watch("vm.monthPicker",function(e){i.datepickerOptions=i.datepickerOptions?i.datepickerOptions:{},i.datepickerOptions.minMode="month"}),i.dateFormat&&e.$watch("vm.dateFormat",function(e){i.datePicker=e})}function o(){t(function(){i.ngChange&&i.ngChange()})}var i=this;i.onChange=o,n(),i.openCalendar=function(e){e.preventDefault(),e.stopPropagation(),i.isOpen=!0}}angular.module("main.module").directive("customDatePicker",function(){return{restrict:"E",scope:{ngModel:"=",placeHolder:"@?",minDate:"=?",ngDisabled:"=?",isTouch:"=?",dateFormat:"=?",monthPicker:"=?",ngChange:"&?"},templateUrl:"app/directives/commonControls/datePicker/datePicker.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$scope","$timeout"]}(),function(){"use strict";function e(){var e=this;e.timepickerOptions={showMeridian:!1},e.isOpen=!1,e.openCalendar=function(t){t.preventDefault(),t.stopPropagation(),e.isOpen=!0}}angular.module("main.module").directive("customTimePicker",function(){return{restrict:"E",scope:{ngModel:"=",ngDisabled:"=?"},templateUrl:"app/directives/commonControls/timePicker/timePicker.html",controller:e,controllerAs:"vm",bindToController:!0}})}(),function(){"use strict";function e(e){return{restrict:"A",link:function(t,n,o){var i=e(o.fileModel),r=i.assign,a=t.$eval(o.customOnChange);n.bind("change",function(){r(t,n[0].files[0]),a()})}}}function t(e){return{restrict:"A",link:function(t,n,o){var i=e(o.filesModel),r=i.assign,a=t.$eval(o.customOnChange);n.bind("change",function(){r(t,n[0].files),a()})}}}angular.module("main.module").directive("fileModel",e).directive("filesModel",t),e.$inject=["$parse"],t.$inject=["$parse"]}(),function(){"use strict";function e(e,t,n){function o(){g.sapCodes.unshift({id:"",code:"Please select ..."}),g.userDetail.sapCodeId=g.userDetail.sapCodeId||"",g.userDetail.id&&(g.originalEmail=g.userDetail.email)}function i(){n.success("The SBU has been created successfully."),g.noCostCenterFound=!1}function r(t){return e.searchCostCenter(t).then(function(e){return[]})}function a(t){return e.searchPO(t).then(function(e){return e})}function s(e){g.userDetail.costCentre=e.name}function l(e){g.userDetail.po=e.name}function c(){g.userDetail.billingAddresses.push({postalCode:"",blockNumber:"",streetName:"",unitNumber:""})}function d(e){g.userDetail.billingAddresses.splice(e,1)}function u(){g.userDetail.id&&g.userDetail.email===g.originalEmail||e.checkEmailExist(g.userDetail.email).then(function(e){g.emailExist=!0},function(e){g.emailExist=!1})}function m(){var e=g.userDetail.lockoutEnabled?"Are you sure you want to activate this user?":"Are you sure you want to deactivate this user?";t.createWarningPopup(e,"Warning",p)}function p(){e.activateOrDeactivate(g.userDetail).then(function(e){var t=g.userDetail.lockoutEnabled?"The user has been activated successfully.":"The user has been deactivated successfully.";g.userDetail.lockoutEnabled=!g.userDetail.lockoutEnabled,n.success(t),g.onActivateOrDeactivate()})}var g=this;g.addBillingAddress=c,g.deleteBillAddress=d,g.checkEmailExist=u,g.activateOrDeactivate=m,g.searchCostCenter=r,g.onSelectCostCenter=s,g.searchPO=a,g.onSelectPO=l,g.createCostCenter=i,g.emailFormat=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,o()}angular.module("main.module").directive("userClientDetail",function(){return{restrict:"E",scope:{userDetail:"=",onCreateOrUpdate:"&",onActivateOrDeactivate:"&?",onCancel:"&",viewMode:"=",sapCodes:"=",poNumbers:"=",costCenters:"="},templateUrl:"app/directives/userClient/userClientDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["clientUserService","modalService","toastr"]}(),function(){"use strict";function e(e){function t(){i()}function n(t){return e.getLocationByPostalCode(t).then(function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]})}function o(e){r.ngModel.postalCode=e.postalCode,r.ngModel.blockNumber=e.blockNumber,r.ngModel.streetName=e.streetName}function i(){r.ngModel.postalCode&&r.ngModel.blockNumber&&r.ngModel.streetName&&r.ngModel.unitNumber||r.isDelete?r.isValid=!0:r.isValid=!1}var r=this;r.searchAddressByPostalCode=n,r.onSelect=o,r.checkValidAddress=i,t()}angular.module("main.module").directive("userAddress",function(){return{restrict:"E",scope:{ngModel:"=",isSearchable:"=",isDelete:"=?",isShowFullWidth:"=",onDelete:"&?",isValid:"=?",isShowWarning:"=?",warningMessage:"@?",viewMode:"=?",largeWidth:"=?"},templateUrl:"app/directives/userClient/userAddress.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["locationService"]}(),function(){"use strict";function e(e,t,n,o,i,r){function a(){p.ngModel.requestDate=p.ngModel.requestDate||new Date,p.ngModel.days=p.ngModel.days||[],p.ngModel.additionals=p.ngModel.additionals||[],p.ngModel.milkRunFrequency!=t.weekly.value&&(p.ngModel.days=[]),p.ngModel.milkRunFrequency!=t.projectRun.value&&(p.ngModel.projectRunDate=null),m()}function s(){return i.convertFrequency(p.ngModel)}function l(e){var t=p.ngModel.days.indexOf(e);t>-1?p.ngModel.days.splice(t,1):p.ngModel.days.push(e),p.weeklyInvalid=0===p.ngModel.days.length}function c(e){var t=p.ngModel.additionals.indexOf(e);t>-1?p.ngModel.additionals.splice(t,1):p.ngModel.additionals.push(e),m()}function d(){p.ngModel.milkRunFrequency==t.weekly.value&&0===p.ngModel.days.length?p.weeklyInvalid=!0:(p.weeklyInvalid=!1,p.ngModel.days=[]),p.ngModel.milkRunFrequency!=t.projectRun.value||p.ngModel.projectRunDate?(p.projectRunInvalid=!1,p.ngModel.projectRunDate=null):p.projectRunInvalid=!0}function u(){}function m(){p.saturdaysChecked=p.ngModel.additionals.indexOf(p.milkRunAdditionals.saturdays.value)>-1,p.sundaysChecked=p.ngModel.additionals.indexOf(p.milkRunAdditionals.sundays.value)>-1,p.afterOfficeHoursChecked=p.ngModel.additionals.indexOf(p.milkRunAdditionals.afterOfficeHours.value)>-1,p.publicHolidaysChecked=p.ngModel.additionals.indexOf(p.milkRunAdditionals.publicHolidays.value)>-1}var p=this;p.systemRole=r,p.milkRunTypes=e,p.milkRunFrequency=t,p.days=n,p.milkRunAdditionals=o,p.changeDay=l,p.changeAdditional=c,p.changeFrequency=d,p.changeMilkRunType=u,p.getFrequency=s,a()}angular.module("milkRun.module").directive("choseMilkRunType",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/milkRun/step/choseMilkrunType.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunTypes","milkRunFrequency","days","milkRunAdditionals","milkrunService","systemRole"]}(),function(){"use strict";function e(e){var t=this;t.jobStatus=e}angular.module("milkRun.module").directive("collectionPoint",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/milkRun/step/collectionPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["jobStatus"]}(),function(){"use strict";function e(e){var t=this;t.jobStatus=e}angular.module("milkRun.module").directive("deliveryPoint",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/milkRun/step/deliveryPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["jobStatus"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d){function u(){k.isLoading=!0,n.calculateMilkRun(k.ngModel).then(function(e){n.transferPricing(k.ngModel,e.data),k.isCalculated=!0,k.viewMode=!0,k.isLoading=!1}).catch(function(e){i.warning(e.data.message),k.isLoading=!1})}function m(){k.isLoading=!0,o.saveMilkRun(k.ngModel).then(function(e){k.isLoading=!1,r.clearImageItem();var t=k.ngModel.id?"The Fixed Run has been updated successfully.":"The Fixed Run has been created successfully.";i.success(t),s.path("/milkruns")},function(e){k.isLoading=!1,i.error(e.data.message)})}function p(){k.viewMode=!1,k.updateMode=!0}function g(){k.ngModel.id?(k.viewMode=!0,k.updateMode=!1,k.cancel()):k.isCalculated?(k.isCalculated=!1,k.viewMode=!1):s.path("/milkruns")}function v(e){var t={confirm:e?h:f};k.approveRejectData={isApprove:e,remark:""},a.createPopup({templateUrl:"app/directives/milkRun/step/approveRejectModal.html",size:"lg",data:k.approveRejectData},t)}function f(){k.isLoading=!0,o.rejectApproveMilkRun(k.ngModel.id,{status:0,remark:k.approveRejectData.remark}).then(function(e){k.isLoading=!1,i.success("The Fixed Run has been rejected successfully."),k.ngModel.jobStatus=t.rejected.value})}function h(){k.isLoading=!0,o.rejectApproveMilkRun(k.ngModel.id,{status:1,remark:k.approveRejectData.remark}).then(function(e){k.isLoading=!1,i.success("The Fixed Run has been approved successfully."),k.ngModel.jobStatus=t.accepted.value})}function y(){o.onHoldMilkRun(k.ngModel.id).then(function(e){i.success("The Fixed Run has been on hold successfully."),k.getJobDetail()})}function C(){o.unholdMilkRun(k.ngModel.id).then(function(e){i.success("The Fixed Run has been un hold successfully."),k.getJobDetail()})}function b(){if(k.ngModel.isMultiplePO&&!k.ngModel.remark)return!0;var e=!(!(k.ngModel.customerId&&k.ngModel.requesterId&&k.ngModel.costCentreId&&k.ngModel.milkRunType&&k.ngModel.requestDate&&k.ngModel.requestTime)||!k.ngModel.milkRunFrequency&&0!=k.ngModel.milkRunFrequency);k.ngModel.milkRunFrequency!=l.weekly.value||k.ngModel.days.length||(e=!1);var t=k.ngModel.collectionPoints.find(function(e){return e.editMode}),n=k.ngModel.deliveryPoints.find(function(e){return e.editMode});return!(e&&!t&&k.ngModel.collectionPoints.length&&!n&&k.ngModel.deliveryPoints.length)}var k=this;k.systemRole=e,k.jobStatusType=t,k.saveMilkRun=m,k.calculate=u,k.edit=p,k.onCancel=g,k.approveReject=v,k.checkJobInvalid=b,k.onHoldMilkRun=y,k.unholdMilkRun=C,k.typeOfBillings=d.currentUser.department===c.PSS.name?[{id:1,name:"Monthly fixed charges"},{id:2,name:"Monthly transaction charges"}]:[{id:1,name:"Monthly fixed charges"}],k.canEdit=k.ngModel.jobStatus!==k.jobStatusType.readyToBill.value&&k.ngModel.jobStatus!==k.jobStatusType.pendingRejection.value&&k.ngModel.jobStatus!==k.jobStatusType.billed.value}angular.module("milkRun.module").directive("milkRunConfirmPricing",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"=",isLoading:"=",getJobDetail:"&",cancel:"&"},templateUrl:"app/directives/milkRun/step/confirmPricing.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["systemRole","jobStatusType","pricingService","milkrunService","toastr","imageService","modalService","$location","milkRunFrequency","departments","$rootScope"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d){function u(){if(C.ngModel){if(C.ngModel.frequency=i.convertFrequency(C.ngModel),e.currentUser.department!==d.PSS.name)return;(!C.ngModel.id||C.ngModel.id&&y())&&(C.isLoading=!0,c.calculateMilkRun(C.ngModel).then(function(e){i.transferPricing(C.ngModel,e.data),C.isLoading=!1}).catch(function(e){s.warning("There's no pricing for calculation!"),C.isLoading=!1}))}}function m(){C.isLoading=!0,i.saveMilkRun(C.ngModel).then(function(e){C.isLoading=!1;var n=C.ngModel.id?"The Fixed Run has been updated successfully.":"The Fixed Run has been created successfully.";s.success(n),t.path("/milkruns")})}function p(e){var t={confirm:e?v:g};C.approveRejectData={isApprove:e,remark:""},a.createPopup({templateUrl:"app/directives/milkRun/step/approveRejectModal.html",size:"lg",data:C.approveRejectData},t)}function g(){C.isLoading=!0,i.rejectApproveMilkRun(C.ngModel.id,{status:0,remark:C.approveRejectData.remark}).then(function(e){C.isLoading=!1,s.success("The Fixed Run has been rejected successfully."),C.ngModel.jobStatus=l.rejected.value})}function v(){C.isLoading=!0,i.rejectApproveMilkRun(C.ngModel.id,{status:1,remark:C.approveRejectData.remark}).then(function(e){C.isLoading=!1,s.success("The Fixed Run has been approved successfully."),C.ngModel.jobStatus=l.accepted.value})}function f(){e.currentUser.role===r.Admin?C.currentProgress=n.remark:C.currentProgress=n.deliveryPoint}function h(){C.viewMode=!1,C.ngModel.originalCollectionPoints=angular.copy(C.ngModel.collectionPoints),C.ngModel.originalDeliveryPoints=angular.copy(C.ngModel.deliveryPoints),C.currentProgress=n.chosenMilkRunType,s.warning("Changing frequency, collection point or delivery point information will recalculate pricing based on current pricing table and overwrite the manual pricing edits.")}function y(){return!angular.equals(C.ngModel.collectionPoints,C.ngModel.originalCollectionPoints)||!angular.equals(C.ngModel.deliveryPoints,C.ngModel.originalDeliveryPoints)}var C=this;C.departments=d,C.milkRunTypes=o,C.systemRole=r,C.jobStatusType=l,C.back=f,C.saveMilkRun=m,C.edit=h,C.approveRejectMilkRun=p,u()}angular.module("milkRun.module").directive("confirmOrder",function(){return{restrict:"E",scope:{ngModel:"=",currentProgress:"=",viewMode:"=",isLoading:"="},templateUrl:"app/directives/milkRun/step/confirmOrder.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","$location","milkRunProgress","milkRunTypes","milkrunService","systemRole","modalService","toastr","jobStatusType","pricingService","departments"]}(),function(){"use strict";function e(e,t,n,o,i){function r(){p.canEdit=p.ngModel.jobStatus!==i.readyToBill.value&&p.ngModel.jobStatus!==i.pendingRejection.value&&p.ngModel.jobStatus!==i.billed.value;for(var e=0;e<p.ngModel.collectionPoints.length;e++)p.ngModel.collectionPoints[e].tripSequence=e+1,p.ngModel.deliveryPoints[e].tripSequence=e+1}function a(e){if(p.ngModel.jobStatus==i.pendingApproval.value)return void o.warning("Job is not approved, please approve the job first");var n={assignVendor:s};p.dataAssignVendor={isDriver:e,customerId:p.ngModel.customerId},t.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:p.dataAssignVendor},n)}function s(){p.isLoading=!0,n.assignVendor({isMilkRun:!0,isDriver:p.dataAssignVendor.isDriver,userId:p.dataAssignVendor.user.id,targetIds:p.ngModel.deliveryPoints.map(function(e){return e.id})}).then(function(e){o.success("The selected points have been assigned to "+(p.dataAssignVendor.isDriver?"driver":"vendor")+" successfully."),p.listCheckPoint=[],p.isCheckAll=!1,p.isLoading=!1})}function l(){var e=p.ngModel.collectionPoints.some(function(e){return e.editMode});return!e}function c(e){p.ngModel.collectionPoints.splice(e,1),p.ngModel.deliveryPoints.splice(e,1)}function d(){var e=p.ngModel.collectionPoints.length+1;p.ngModel.collectionPoints.push({editMode:!0,tripSequence:e}),p.ngModel.deliveryPoints.push({editMode:!0,tripSequence:e})}function u(){var e=p.ngModel.collectionPoints.length+1;p.ngModel.collectionPoints.push(m(p.ngModel.deliveryPoints[p.ngModel.deliveryPoints.length-1],e)),p.ngModel.deliveryPoints.push(m(p.ngModel.collectionPoints[0],e))}function m(e,t){return{name:e.name,contactNumber:e.contactNumber,address:angular.copy(e.address),editMode:!0,tripSequence:t,items:[]}}var p=this;p.systemRole=e,p.addNewTrip=d,p.addRoundTrip=u,p.isAddNewTrip=l,p.assignVendorDriver=a,p.removeTrip=c,r()}angular.module("milkRun.module").directive("milkRunRoundTrip",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/milkRun/step/roundTrip.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["systemRole","modalService","adhocService","toastr","jobStatus"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){function s(t){for(var n in e)if(e[n].id==t)return e[n].text;return""}function l(e,t){f.ngModel.splice(t,1),f.validatePoint(),e.stopPropagation()}function c(e){f.isCheckAll=!1;for(var t=!1,n=0;n<f.listCheckPoint.length;n++)if(f.listCheckPoint[n]==e)return t=!0,void f.listCheckPoint.splice(n,1);f.listCheckPoint.push(e)}function d(e){for(var t=0;t<f.listCheckPoint.length;t++)if(f.listCheckPoint[t]==e)return!0;return!1}function u(){f.isCheckAll?(f.listCheckPoint=[],angular.forEach(f.ngModel,function(e){f.listCheckPoint.push(e.id)})):f.listCheckPoint=[]}function m(){var e={updatePricing:p};f.dataPricing={},o.createPopup({templateUrl:"app/directives/jobCommon/editPrice/editPriceModal.html",size:"lg",data:f.dataPricing},e)}function p(){var e=0;angular.forEach(f.ngModel,function(t){f.listCheckPoint.indexOf(t.id)>=0&&(t.subTotalPrice=f.dataPricing.price),e+=t.subTotalPrice}),f.totalPrice=e,f.listCheckPoint=[],f.isCheckAll=!1}function g(){var e={assignVendor:v};f.dataAssignVendor={},o.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:f.dataAssignVendor},e)}function v(){f.isLoading=!0,i.assignVendor({vendorId:f.dataAssignVendor.vendor.id,targetIds:f.listCheckPoint}).then(function(e){r.success("The selected points have been assigned to vendor successfully."),angular.forEach(f.ngModel,function(e){f.listCheckPoint.indexOf(e.id)>=0&&(e.vendorName=f.dataAssignVendor.vendor.name)}),f.listCheckPoint=[],f.isCheckAll=!1,f.isLoading=!1})}var f=this;f.systemRole=a,f.milkRunTypes=t,f.departments=n,f.getMilkRunText=s,f.removePoint=l,f.checkAllChange=u,f.onCheckPoint=c,f.bindingCheck=d,f.assignVendor=g,f.editPrice=m,f.listCheckPoint=[]}angular.module("milkRun.module").directive("listPoint",function(){return{restrict:"E",scope:{ngModel:"=",allowRemove:"=",milkRunType:"=?",onDetailClick:"&?",validatePoint:"&?",viewMode:"=?",isLoading:"=?",totalPrice:"=?"},templateUrl:"app/directives/milkRun/listPoint/listPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunWeight","milkRunTypes","departments","modalService","milkrunService","toastr","systemRole"]}(),function(){"use strict";function e(e){function t(t){return e.getLocationByPostalCode(t).then(function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]})}function n(e){o.ngModel.address.postalCode=e.postalCode,o.ngModel.address.blockNumber=e.blockNumber,o.ngModel.address.streetName=e.streetName}var o=this;o.form=o.form||{},o.searchAddressByPostalCode=t,o.onSelect=n}angular.module("milkRun.module").directive("milkrunContact",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?"},templateUrl:"app/directives/milkRun/contact/milkrunContact.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["locationService"]}(),function(){"use strict";function e(e){var t=this;t.milkRunWeight=e,t.ngModel=t.ngModel||[{}],t.form=t.form||{}}angular.module("milkRun.module").directive("milkrunItem",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?"},templateUrl:"app/directives/milkRun/milkrunItem/milkrunItem.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunWeight"]}(),function(){"use strict";function e(e,t,n,o,i,r){function a(){g.isValid=i.checkValidCollectionPoints(g.ngModel)}function s(){g.dataModal={point:{items:angular.copy(g.templateItem)||[]},index:g.ngModel.length+1,isOneToMany:g.milkRunType==t.oneToMany,applyTemplateItem:!1,isAddNew:!0},d()}function l(){g.dataModal.applyTemplateItem&&(g.templateItem=g.dataModal.point.items),g.dataModal.isAddNew?g.ngModel.push(g.dataModal.point):(g.dataModal.point.isInValid=!1,g.ngModel[g.dataModal.index-1]=g.dataModal.point),m()}function c(e,n){g.dataModal={point:angular.copy(e),index:n,isOneToMany:g.milkRunType==t.oneToMany,applyTemplateItem:!1},d()}function d(){var e={updatePoint:l};n.createPopup({templateUrl:"app/directives/milkRun/point/newPointModal.html",size:"lg",data:g.dataModal},e)}function u(){r(function(){document.getElementById("uploadFile").click()})}function m(){g.isValid=i.checkValidCollectionPoints(g.ngModel)}function p(){var e=[{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",FixedRunWeight:"<5",Quantity:2},{PostalCode:"551234",BlockNumber:"234A",StreetName:"Serangoon Avenue 2",UnitNumber:"07-08",ContactPerson:"Mr John",ContactNumber:"98769876",FixedRunWeight:"5to10",Quantity:3},{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",FixedRunWeight:"10to30",Quantity:2},{PostalCode:"551234",BlockNumber:"234A",StreetName:"Serangoon Avenue 2",UnitNumber:"07-08",ContactPerson:"Mr John",ContactNumber:"98769876",FixedRunWeight:"30to60",Quantity:3},{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",FixedRunWeight:"60to100",Quantity:2}],n=g.milkRunType==t.oneToMany?"MilkRunDeliveryTemplate.csv":"MilkRunCollectionTemplate.csv";o.exportCsvFile({data:e,filename:n})}var g=this;g.ngModel=g.ngModel||[],g.milkRunTypes=t,g.addNewPoint=s,g.editPoint=c,g.openFile=u,g.validatePoint=m,
g.downloadSampleCsv=p,a(),g.uploadFile=function(){g.csvFile&&o.readAsDataUrl(g.csvFile,e).then(function(e){var t=i.getMilkRunPointsFromText(e);g.ngModel=g.ngModel.concat(t),m(),angular.element(document.getElementById("uploadFile")).val(null)})}}angular.module("milkRun.module").directive("manyPoint",function(){return{restrict:"E",scope:{ngModel:"=",milkRunType:"=",isValid:"="},templateUrl:"app/directives/milkRun/point/manyPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$scope","milkRunTypes","modalService","fileReaderService","milkrunService","$timeout"]}(),function(){"use strict";function e(){var e=this;e.ngModel=e.ngModel||[]}angular.module("milkRun.module").directive("onePoint",function(){return{restrict:"E",scope:{ngModel:"=",contactForm:"=?",milkRunItemForm:"=?"},templateUrl:"app/directives/milkRun/point/onePoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(){var e=this;e.ngModel=e.ngModel||[]}angular.module("milkRun.module").directive("pointDetail",function(){return{restrict:"E",scope:{ngModel:"=",milkRunType:"=",viewMode:"=?",isLoading:"=?",totalPrice:"=?"},templateUrl:"app/directives/milkRun/point/pointDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n){function o(){var e=r.find(function(e){return e.id==i.weightId});if(e){var t=e.rows.find(function(e){return e.text==i.label});t&&(i.twiceDaily=t.twiceDaily,i.daily=t.daily,i.thricePerWeek=t.thricePerWeek,i.weekly=t.weekly,i.projectRun=t.projectRun)}}var i=this,r=[];r=t.currentUser.department===n.PSS.name?e.getFixedRungBiz():e.getGBizCodeHCFixedRun(),o()}angular.module("main.module").directive("milkrunPricingRow",function(){return{restrict:"E",scope:{ngModel:"=",label:"@",isValidate:"=",viewMode:"=?",weightId:"=?"},templateUrl:"app/directives/advanceMilkRunPricing/milkRunPricingRow.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["pricingService","$rootScope","departments"]}(),function(){"use strict";function e(e){function t(){r.ngModel&&0!==r.ngModel.length?o():n()}function n(){r.ngModel=[];for(var t in e)r.ngModel.push({category:e[t].value,label:e[t].display})}function o(){angular.forEach(r.ngModel,function(e){e.label=i(e.category)})}function i(t){for(var n in e)if(e[n].value===t)return e[n].display}var r=this;t()}angular.module("main.module").directive("milkrunPricingTab",function(){return{restrict:"E",scope:{ngModel:"=",isValidate:"=",viewMode:"=?",weightId:"=?"},templateUrl:"app/directives/advanceMilkRunPricing/milkRunPricingTab.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["deliveryPointCategory"]}(),function(){"use strict";function e(e,t,n,o){function i(){m.ngModel.weightCategories&&0!==m.ngModel.weightCategories?a():r()}function r(){m.ngModel.weightCategories=[];var i=o.currentUser.department===t.PSS.name?e:n;for(var r in i)m.ngModel.weightCategories.push({weightCategoryId:i[r].value,label:i[r].display})}function a(){angular.forEach(m.ngModel.weightCategories,function(e){e.label=s(e.weightCategoryId)})}function s(i){var r=o.currentUser.department===t.PSS.name?e:n;for(var a in r)if(r[a].value===i)return r[a].display}function l(e){m.activateMilkRunTab=e}function c(){m.isValidate=!0;for(var e=!0,t=0;t<m.ngModel.weightCategories.length;t++){var n=d(m.ngModel.weightCategories[t].deliveryPointCategories);m.ngModel.weightCategories[t].isValid=n,e=!!n&&e}e&&m.setPrice()}function d(e){if(!e)return!1;for(var t=0;t<e.length;t++)if(!u(e[t]))return!1;return!0}function u(e){return!!(e.twiceDaily&&e.daily&&e.thricePerWeek&&e.weekly&&e.projectRun)}var m=this;m.departments=t,m.activateMilkRunTab=o.currentUser.department===t.PSS.name?e.milkrunUptoFiveKg.value:n.document.value,m.changeMilkRunTab=l,m.setPricing=c,i()}angular.module("main.module").directive("milkrunPricingAdvance",function(){return{restrict:"E",scope:{ngModel:"=?",cancel:"&",setPrice:"&",viewMode:"=?"},templateUrl:"app/directives/advanceMilkRunPricing/milkRunPricingAdvance.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["milkRunWeightCategory","departments","healthCareFixedRunWeightCategory","$rootScope"]}(),function(){"use strict";function e(e,t,n,o){t.bind("change",function(t){var n=t.target.files,i=n[0];o.$setViewValue(i),e.$apply()})}angular.module("main.module").directive("fileUpload",function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,o){t.bind("change",function(t){var n=t.target.files,i=n[0];o.$setViewValue(i),e.$apply()})}}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n){function o(){r(),i(),a(),s()}function i(){if(!l.ngModel.deliveryTimings||0===l.ngModel.deliveryTimings.length){l.ngModel.deliveryTimings=[];for(var e in t)l.ngModel.deliveryTimings.push({deliveryTimingId:t[e].value,label:t[e].display})}}function r(){if(!l.ngModel.label)for(var t in e)if(e[t].value===l.ngModel.weightCategoryId)return void(l.ngModel.label=e[t].display)}function a(){l.rowLabels=[];for(var e in t)l.rowLabels.push(t[e].display)}function s(){var e=c.find(function(e){return e.text==l.ngModel.label});e&&(l.codes={0:e.officeHour,1:e.officeHourExpress,2:e.weekdayEvening,3:e.weekdayEveningExpress,4:e.weekend})}var l=this,c=n.getGBizCodeHCAdhoc();o()}angular.module("main.module").directive("healthCarePricingRow",function(){return{restrict:"E",scope:{ngModel:"=",isValidate:"=",viewMode:"=?"},templateUrl:"app/directives/healthCarePricing/healthCarePricingRow.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["healthCareWeightCategory","healthCareDeliveryTiming","pricingService"]}(),function(){"use strict";function e(e){function t(){n()}function n(){if(!r.ngModel.weightCategories||0===r.ngModel.weightCategories.length){r.ngModel.weightCategories=[];for(var t in e)r.ngModel.weightCategories.push({weightCategoryId:e[t].value,label:e[t].display})}}function o(){r.isValidate=!0;for(var e=0;e<r.ngModel.weightCategories.length;e++)if(!i(r.ngModel.weightCategories[e]))return!1;r.setPrice()}function i(e){for(var t=0;t<e.deliveryTimings.length;t++)if(!e.deliveryTimings[t].rate||e.deliveryTimings[t].rate<=0)return!1;return!0}var r=this;r.validateAndSave=o,t()}angular.module("main.module").directive("healthCarePricing",function(){return{restrict:"E",scope:{ngModel:"=",cancel:"&",setPrice:"&",viewMode:"=?"},templateUrl:"app/directives/healthCarePricing/healthCarePricing.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["healthCareWeightCategory"]}(),function(){"use strict";function e(){var e={restrict:"AE",templateUrl:"app/directives/dashboard/dashboardSpinner/dashboardSpinner.html",scope:{spinnerClasses:"@"},controller:t,controllerAs:"vm",bindToController:!0};return e}function t(){}angular.module("main.module").directive("dashboardSpinner",e),t.$inject=[]}(),function(){"use strict";function e(){var e={restrict:"AE",templateUrl:"app/directives/dashboard/ticker/ticker.html",scope:{tickerItems:"=",tickerShowCta:"=",tickerCtaLink:"="},controller:t,controllerAs:"vm",bindToController:!0};return e}function t(e,t,n){function o(){i.tickerItemsLooped=JSON.parse(angular.toJson([].concat(i.tickerItems,i.tickerItems))),i.tickerDataLoaded=!0}var i=this;i.showCta="boolean"!=typeof i.tickerShowCta||i.tickerShowCta,i.ctaLink=i.tickerCtaLink||t.indexRoute,i.tickerDataLoaded=!1,i.tickerItemsLooped=[],e.$watch(function(){return i.tickerItems},function(){i.tickerItems&&i.tickerItems.length>0&&o()})}angular.module("main.module").directive("ticker",e),t.$inject=["$scope","$rootScope","$element"]}(),function(){"use strict";function e(){var e={restrict:"AE",templateUrl:"app/directives/dashboard/spendingsGraph/spendingsGraph.html",scope:{data:"=",spendingsGraphHeight:"="},controller:t,controllerAs:"vm",bindToController:!0};return e}function t(e,t,i){function r(){var e=m.spendingsGraphHeight?m.spendingsGraphHeight:"270";m.graphHeight=e+"px"}function a(){m.maxY=l(),m.xAxis=c(),m.yAxis=d(),m.chartData=u()}function s(){m.maxY=l(),m.xAxis=c(),m.yAxis=d(),m.chartData=v,i(function(){m.chartData=u()},g)}function l(e){var t=_.max(m.data,function(e){return e.amount}).amount;t=t<7?7:t;var o=1;o=t<=100*p?10:100;var i=n(t,p*o);return e?void e(i):i}function c(){return _.map(m.data,function(e){return e.month})}function d(){for(var e=[],t=0;t<p;++t)e.push(m.maxY/p*(p-t));return e}function u(){return _.map(m.data,function(e){return e.height=e.amount/m.maxY*100+"%",e})}var m=this,p=7,g=200,v=o(),f=!1;m.maxY=0,m.xAxis=[],m.yAxis=[],m.chartData=[],m.graphHeight="270px",r(),e.$watch("vm.spendingsGraphHeight",r),e.$watch("vm.data",function(){m.data&&(f?a():(s(),f=!0))})}function n(e,t){return Math.ceil(e/t)*t}function o(){for(var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=(new Date).getMonth(),n=[],o=0;o<12;++o)o+t<12?n.push(e[t+o]):n.push(e[o-(12-t)]);return _.map(n,function(e){return{month:e,amount:0,height:0}})}angular.module("main.module").directive("spendingsGraph",e),t.$inject=["$scope","$element","$timeout"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u){function m(){p(),e.currentUser.department!==o.PSS.name?(T.ngModel.collectBy=T.ngModel.collectBy||R,T.ngModel.collectByValid=!0,T.ngModel.requestDate=T.ngModel.requestDate||new Date,T.ngModel.requestTime=T.ngModel.requestTime||new Date,T.ngModel.collectionDate=T.ngModel.collectionDate||new Date,T.ngModel.deliveryDate=T.ngModel.deliveryDate||new Date,y()):(T.ngModel.collectBy=T.ngModel.collectBy||R,T.ngModel.deliveryBy=T.ngModel.deliveryBy||R,T.ngModel.collectByValid=!0,T.ngModel.deliveryByValid=!0),f()}function p(){var i=e.currentUser.department===o.PSS.name?t:n;T.serviceTypes=[];for(var r in i)T.serviceTypes.push({value:i[r].value,display:i[r].display,notes:s[r]?s[r].notes:null})}function g(){var e=!(l("date")(T.ngModel.requestDate,"yyyy-MM-dd")!==l("date")(new Date,"yyyy-MM-dd")||l("date")(T.ngModel.collectionDate,"yyyy-MM-dd")!==l("date")(new Date,"yyyy-MM-dd")||l("date")(T.ngModel.deliveryDate,"yyyy-MM-dd")!==l("date")(new Date,"yyyy-MM-dd"));if(e){if(T.ngModel.serviceType==t.threeHour.value&&T.clientDetail.cutOffTimeFor3HourDelivery){var n=d.convertDate(T.clientDetail.cutOffTimeFor3HourDelivery),o=l("date")(n,"HH:mm"),i=l("date")(T.ngModel.requestTime,"HH:mm");if(D(i,o)){T.ngModel.serviceType="";var r="Cut-off time for today's delivery is "+o+", please select next working day or contact our coordinators at: 6867 8012/ 6867 8313";u.error(r)}}if(T.ngModel.serviceType==t.sameDay.value&&T.clientDetail.cutOffTimeForSameDayPickupAndDelivery){var a=d.convertDate(T.clientDetail.cutOffTimeForSameDayPickupAndDelivery),o=l("date")(a,"HH:mm"),i=l("date")(T.ngModel.requestTime,"HH:mm");if(D(i,o)){T.ngModel.serviceType="";var r="Cut-off time for same day delivery is "+o+", please select 3 hours or contact our coordinators at: 6867 8012/ 6867 8313";u.error(r)}}if(T.ngModel.serviceType==t.nextDay.value&&T.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery){var s=d.convertDate(T.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery),o=l("date")(s,"HH:mm"),i=l("date")(T.ngModel.requestTime,"HH:mm");D(i,o)&&u.warning("Please select other dates or contact our coordinators at: 6867 8012/ 6867 8313")}}}function v(){r.switchCollectionDeliveryPoint(T.ngModel)}function f(){e.currentUser.department!==o.PSS.name&&(c.$watch("vm.ngModel.requestDate",function(e){y()}),c.$watch("vm.ngModel.requestTime",function(e){y()}),c.$watch("vm.ngModel.deliveryDate",function(e){y()}),c.$watch("vm.ngModel.deliveryBy",function(e){M()}))}function h(){return T.ngModel&&T.ngModel.serviceType?r.getServiceType(T.ngModel.serviceType):""}function y(){if(!T.ngModel.requestDate||!T.ngModel.deliveryDate)return[];var e=!(l("date")(T.ngModel.requestDate,"yyyy-MM-dd")!==l("date")(T.ngModel.deliveryDate,"yyyy-MM-dd"));if(T.ngModel.requestTime){var t=A(l("date")(T.ngModel.requestTime,"HH:mm"));T.currentOptions=S(t,e)}}function C(e,n){if(T.ngModel.collectBy==R&&T.ngModel.deliveryBy==R)return void(T.ngModel[n]=!0);var o=e.split("-");return!e||!o.length||o.length>2?void(T.ngModel[n]=!1):(T.ngModel[n]=o.every(b),T.ngModel[n]&&"collectByValid"===n&&T.ngModel.serviceType==t.threeHour.value&&k(),void(T.ngModel[n]&&"deliveryByValid"===n&&P()))}function b(e){var t=e.split(":");if(!e||!t.length||t.length>2)return!1;var n=t[0],o=t[1];return!(!n||2!==n.length||parseInt(n)<0||parseInt(n)>23)&&!(!o||2!==o.length||parseInt(o)<0||parseInt(o)>59)}function k(){var e=A(T.ngModel.collectBy.split("-")[0]),t=e.hour+3;t=t>=24?t-24:t;var n=t<10?"0"+t:t,o=0===e.minute?"00":e.minute<10?"0"+e.minute:e.minute;T.ngModel.deliveryBy=n+":"+o}function P(){if((T.ngModel.serviceType==t.sameDay.value||T.ngModel.serviceType==t.threeHour.value)&&T.ngModel.collectByValid&&T.ngModel.deliveryByValid&&D(T.ngModel.collectBy,T.ngModel.deliveryBy))return T.ngModel.deliveryByValid=!1,void(T.deliveryWarningMessage="Delivery by must be after collect by.");if(T.ngModel.serviceType==t.nextDay.value){var e="12:00";D(e,T.ngModel.deliveryBy)&&u.warning("Your Type of Service can not choose Next Day Delivery, please select Same-Day Delivery due to the time limit")}}function D(e,t){e=e.split("-")[0],t=t.split("-")[0];var n=A(e),o=A(t);return n.hour>o.hour||n.hour===o.hour&&n.minute>=o.minute}function A(e){var t=e.split(":");return{hour:parseInt(t[0]),minute:parseInt(t[1])}}function M(){if(!(T.ngModel.requestDate&&T.ngModel.deliveryDate&&T.ngModel.deliveryBy||T.ngModel.id))return void(T.ngModel.serviceType="");T.ngModel.deliveryByValid=!0;var e=T.currentOptions.find(function(e){return e.value===T.ngModel.deliveryBy});e&&(T.ngModel.serviceType=e.typeOfService)}function S(e,t){var o=60*e.hour+e.minute;if(t)return o<750?[{text:"08:30-17:30",value:"08:30-17:30",typeOfService:n.hCOfficeHour.value},{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEvening.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]:o<900?[{text:"17:30",value:"17:30",typeOfService:n.hCOfficeHourExpress.value},{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEvening.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]:o<1020?[{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEvening.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]:[{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEveningExpress.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}];var i=T.ngModel.deliveryDate.getDay();return i>0&&i<5?[{text:"08:30-17:30",value:"08:30-17:30",typeOfService:n.hCOfficeHour.value},{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEvening.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]:6===i?5===T.ngModel.requestDate.getDay()&&60*e.hour+e.minute>1020?[{text:"08:30-12:00",value:"08:30-12:00",typeOfService:n.hCOfficeHourExpress.value},{text:"12:00-22:00",value:"12:00-22:00",typeOfService:n.hCWeekdayEveningExpress.value}]:[{text:"08:30-12:00",value:"08:30-12:00",typeOfService:n.hCOfficeHour.value},{text:"12:00-22:00",value:"12:00-22:00",typeOfService:n.hCWeekdayEvening.value}]:[{text:"08:30-17:30",value:"08:30-17:30",typeOfService:n.hCWeekend.value},{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekend.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]}var T=this;T.departments=o,T.adhocTypes=i,T.adHocSurcharge=a,T.changeAdhocType=v,T.getServiceName=h,T.validateSlotTime=C,T.getDeliverySlot=y,T.setTypeOfService=M,T.changeTypeOfDelivery=g,T.clientDetail={},T.currentOptions=[];var R="09:00-17:30";m()}angular.module("adhoc.module").directive("choseAdhocType",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/choseAdhocType.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","adhocPSSServiceType","adhocHealthCareServiceType","departments","adhocTypes","adhocService","adHocSurcharge","healthCareServiceNote","$filter","$scope","utilityService","toastr"]}(),function(){"use strict";function e(e,t){var n=this;n.adhocTypes=e,n.jobStatus=t}angular.module("adhoc.module").directive("adhocCollectionPoint",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/collectionPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocTypes","jobStatus"]}(),function(){"use strict";function e(e,t){function n(){}var o=this;o.adhocTypes=t,o.jobStatus=e,n()}angular.module("adhoc.module").directive("adhocDeliveryPoint",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/deliveryPoint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["jobStatus","adhocTypes"]}(),function(){"use strict";function e(e){var t=this;t.systemRole=e}angular.module("adhoc.module").directive("adhocRemark",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/remark.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["systemRole"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s){function l(){C.canEdit=C.ngModel.jobStatus!==C.jobStatusType.readyToBill.value&&C.ngModel.jobStatus!==C.jobStatusType.pendingRejection.value&&C.ngModel.jobStatus!==C.jobStatusType.billed.value}function c(){C.isLoading=!0,t.saveAdhoc(C.ngModel).then(function(t){C.isLoading=!1,s.clearImageItem();var n=C.ngModel.id?"The Ad Hoc has been updated successfully.":"The Ad Hoc has been created successfully.";i.success(n),e.path("/adhocs")},function(e){C.isLoading=!1,i.error(e.data.message)})}function d(){C.isLoading=!0,a.calculateAdhoc(C.ngModel).then(function(e){a.transferPricing(C.ngModel,e.data),C.isCalculated=!0,C.viewMode=!0,C.isLoading=!1}).catch(function(e){i.warning(e.data.message),C.isLoading=!1})}function u(){C.ngModel.id?(C.viewMode=!0,C.updateMode=!1,C.cancel()):C.isCalculated?(C.isCalculated=!1,C.viewMode=!1):e.path("/adhocs")}function m(e){var t={confirm:e?g:p};C.approveRejectData={isApprove:e,remark:""},o.createPopup({templateUrl:"app/directives/milkRun/step/approveRejectModal.html",size:"lg",data:C.approveRejectData},t)}function p(){C.isLoading=!0,t.rejectApproveAdhoc({id:C.ngModel.id,jobStatus:r.rejected.value,remark:C.approveRejectData.remark}).then(function(e){C.isLoading=!1,i.success("The Adhoc has been rejected successfully."),C.ngModel.jobStatus=r.rejected.value})}function g(){C.isLoading=!0,t.rejectApproveAdhoc({id:C.ngModel.id,jobStatus:r.accepted.value,remark:C.approveRejectData.remark}).then(function(e){C.isLoading=!1,i.success("The Adhoc has been approved successfully."),C.ngModel.jobStatus=r.accepted.value})}function v(){t.onHoldAdhoc(C.ngModel.id).then(function(e){i.success("The Adhoc has been on hold successfully."),C.getJobDetail()})}function f(){t.unholdAdhoc(C.ngModel.id).then(function(e){i.success("The Adhoc has been un hold successfully."),C.getJobDetail()})}function h(){C.viewMode=!1,C.updateMode=!0}function y(){if(C.ngModel.isMultiplePO&&!C.ngModel.remark)return!0;var e=!!(C.ngModel.customerId&&C.ngModel.requesterId&&C.ngModel.costCentreId&&C.ngModel.requestDate&&C.ngModel.requestTime&&C.ngModel.collectionDate&&C.ngModel.deliveryDate&&C.ngModel.collectBy&&C.ngModel.deliveryBy&&C.ngModel.collectByValid&&C.ngModel.deliveryByValid),t=C.ngModel.collectionPoints.find(function(e){return e.editMode}),n=C.ngModel.deliveryPoints.find(function(e){return e.editMode});return!(e&&!t&&C.ngModel.collectionPoints.length&&!n&&C.ngModel.deliveryPoints.length)}var C=this;C.systemRole=n,C.jobStatusType=r,C.saveAdhoc=c,C.calculate=d,C.edit=h,C.onCancel=u,C.approveReject=m,C.checkJobInvalid=y,C.onHoldAdhoc=v,C.unholdAdhoc=f,l()}angular.module("adhoc.module").directive("adhocConfirmPricing",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"=",isLoading:"=",getJobDetail:"&",cancel:"&"},templateUrl:"app/directives/adhoc/step/confirmPricing.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$location","adhocService","systemRole","modalService","toastr","jobStatusType","pricingService","imageService"]}(),function(){"use strict";function e(e,t,n,o,i){function r(){p.canEdit=p.ngModel.jobStatus!==i.readyToBill.value&&p.ngModel.jobStatus!==i.pendingRejection.value&&p.ngModel.jobStatus!==i.billed.value;for(var e=0;e<p.ngModel.collectionPoints.length;e++)p.ngModel.collectionPoints[e].tripSequence=e+1,p.ngModel.deliveryPoints[e]&&(p.ngModel.deliveryPoints[e].tripSequence=e+1)}function a(e){if(p.ngModel.jobStatus==i.pendingApproval.value)return void o.warning("Job is not approved, please approve the job first");var n={assignVendor:l};p.dataAssignVendor={isDriver:e,customerId:p.ngModel.customerId},t.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:p.dataAssignVendor},n)}function s(e){p.ngModel.collectionPoints.splice(e,1),p.ngModel.deliveryPoints.splice(e,1)}function l(){p.isLoading=!0,n.assignVendor({isDriver:p.dataAssignVendor.isDriver,userId:p.dataAssignVendor.user.id,targetIds:p.ngModel.deliveryPoints.map(function(e){return e.id})}).then(function(e){o.success("The selected points have been assigned to "+(p.dataAssignVendor.isDriver?"driver":"vendor")+" successfully."),p.listCheckPoint=[],p.isCheckAll=!1,p.isLoading=!1})}function c(){var e=p.ngModel.collectionPoints.some(function(e){return e.editMode});return!e}function d(){var e=p.ngModel.collectionPoints.length+1;p.ngModel.collectionPoints.push(m(p.ngModel.deliveryPoints[p.ngModel.deliveryPoints.length-1],e)),p.ngModel.deliveryPoints.push({editMode:!0,tripSequence:e})}function u(){var e=p.ngModel.collectionPoints.length+1;p.ngModel.collectionPoints.push(m(p.ngModel.deliveryPoints[p.ngModel.deliveryPoints.length-1],e)),p.ngModel.deliveryPoints.push(m(p.ngModel.collectionPoints[0],e))}function m(e,t){return{name:e.name,contactNumber:e.contactNumber,address:angular.copy(e.address),editMode:!0,tripSequence:t,items:[]}}var p=this;p.systemRole=e,p.addNewTrip=d,p.addRoundTrip=u,p.isAddNewTrip=c,p.assignVendorDriver=a,p.removeTrip=s,r()}angular.module("adhoc.module").directive("adhocRoundTrip",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/roundTrip.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["systemRole","modalService","adhocService","toastr","jobStatus"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l){function c(){r.setChosenClient(null),D.ngModel.requestDate=D.ngModel.requestDate||new Date,D.ngModel.requestTime=D.ngModel.requestTime||angular.copy(D.ngModel.requestDate),u()}function d(){D.isMilkRun||e.currentUser.department===o.PSS.name||(D.ngModel.collectionDate=angular.copy(D.ngModel.deliveryDate),i.success("Collection date is changed to "+n("date")(D.ngModel.deliveryDate,"dd/MM/yyyy")+" according to Delivery"))}function u(){D.ngModel.customerId&&e.currentUser.role!==t.User&&g(D.ngModel.customerId,!0),e.currentUser.role===t.User&&(D.ngModel.customerId=e.currentUser.customerId,D.ngModel.requesterId=e.currentUser.id,g(e.currentUser.customerId,!0))}function m(t){return a.getCustomerByCriteria({currentPage:1,itemPerPage:20,searchTerm:t,sortColumn:"organizationCode",sortAscending:!0},e.currentUser.department).then(function(e){return e.data.customers})}function p(e){var t=s.convertDate(e.contractEndDate);t.setHours(0,0,0,0);var n=new Date;n.setHours(0,0,0,0),t<n?(l.createWarningPopup("This customers contract has expired. Please extend the contract date.","Warning",null,!0,"OK"),y(),D.ngModel.clientName=""):g(e.id)}function g(e,t){a.getCustomerById(e).then(function(n){D.client=n.data,D.ngModel.customerId=e,D.ngModel.clientName=D.client.organizationCode+" - "+D.client.name,D.users=n.data.applicationUsers.filter(function(e){return 0==e.lockoutEnabled}),D.users.unshift({id:"",firstName:"Please",lastName:"select ..."}),t&&h(D.client),r.setChosenClient(n.data)})}function v(e){D.ngModel.isMultiplePO=e}function f(){D.ngModel.requesterId&&D.users?h(D.client):(D.ngModel.costCentreId="",D.ngModel.poNumberId="",D.ngModel.billingAddress="",D.costCenters=[],D.poNumbers=[])}function h(e){var t=D.users.find(function(e){return e.id===D.ngModel.requesterId});D.ngModel.requesterName=t.firstName+" "+t.lastName,D.costCenters=e.costCentres.filter(function(e){return t.costCentreIds.indexOf(e.id)>-1}),D.costCenters.unshift({id:"",name:"Please select ..."}),D.poNumbers=e.poNumbers.filter(function(e){return t.poNumberIds.indexOf(e.id)>-1}),D.poNumbers.unshift({id:"",number:"Please select ..."});var n=e.sapCodes.find(function(e){return t.sapCodeId===e.id});D.ngModel.billingAddress=n?n.blockNumber+" "+n.streetName+" "+n.unitNumber+" "+n.postalCode:""}function y(){r.setChosenClient(null),D.users=[],D.costCenters=[],D.poNumbers=[],D.ngModel.requesterId="",D.ngModel.billingAddress=""}function C(){if(D.ngModel.costCentreId&&D.costCenters){var e=D.costCenters.find(function(e){return e.id==D.ngModel.costCentreId});return e?e.name:""}return""}function b(){if(D.ngModel.poNumberId&&D.poNumbers){var e=D.poNumbers.find(function(e){return e.id==D.ngModel.poNumberId});return e?e.number:""}return""}function k(){if(D.ngModel.requesterId&&D.users){var e=D.users.find(function(e){return e.id==D.ngModel.requesterId});return e?e.firstName+" "+e.lastName:""}return""}function P(){D.dataUpdatePo={poNumbers:D.poNumbers,poNumberId:D.ngModel.poNumberId},l.createPopup({templateUrl:"app/directives/jobCommon/jobChoseCustomerEditPoModal.html",size:"md",data:D.dataUpdatePo},{updatePo:function(){D.isLoading=!0,r.updatePo(D.ngModel.id,{poNumberId:D.dataUpdatePo.poNumberId},D.isMilkRun).then(function(e){D.ngModel.poNumberId=D.dataUpdatePo.poNumberId,i.success("Update PO number successfully!"),D.isLoading=!1})}})}var D=this;D.systemRole=t,D.searchClient=m,D.onSelectClient=p,D.changeUser=f,D.clientChange=y,D.getCostCenterName=C,D.getPoNumberName=b,D.getRequesterName=k,D.editPo=P,D.deliveryDateChange=d,D.clickPoOption=v,c()}angular.module("adhoc.module").directive("jobChoseCustomer",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"=",isMilkRun:"=?",client:"=?"},templateUrl:"app/directives/jobCommon/jobChoseCustomer.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","systemRole","$filter","departments","toastr","adhocService","customerService","utilityService","modalService"]}(),function(){"use strict";function e(e,t,n,o){function i(e){t.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:e}},{})}function r(e){for(var t in n)if(n[t].id==e)return n[t].text;for(var t in o)if(o[t].value==e)return o[t].display;return"N/A"}var a=this;a.departments=e,a.viewPhotos=i,a.getMilkRunWeight=r}angular.module("main.module").directive("listItem",function(){return{restrict:"E",scope:{ngModel:"=",isLoading:"=",isMilkRun:"=?"},templateUrl:"app/directives/jobCommon/pointItem/listItem.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["departments","modalService","milkRunWeight","healthCareFixedRunWeightCategory"]}(),function(){"use strict";function e(e){function t(){if(o.isValidate=!0,!(!o.ngModel.additionalRestrictedArea||o.ngModel.additionalRestrictedArea<=0||!o.ngModel.additionalAfterOfficeHr||o.ngModel.additionalAfterOfficeHr<=0)){for(var e=0;e<o.ngModel.weightCategories.length;e++)if(!n(o.ngModel.weightCategories[e]))return;o.setPrice()}}function n(e){for(var t=0;t<e.deliveryTimings.length;t++)if(!e.deliveryTimings[t].rate||e.deliveryTimings[t].rate<=0)return!1;return!0}var o=this;o.validateAndSave=t,o.gBizCodePSSAdhoc=e.getAdhocgBiz()}angular.module("main.module").directive("adhocPssPricing",function(){return{restrict:"E",scope:{ngModel:"=",cancel:"&",setPrice:"&",viewMode:"=?"},templateUrl:"app/directives/adhocPSSPricing/adhocPSSPricing.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["pricingService"]}(),function(){"use strict";function e(e){function t(){n()}function n(){var e=i.find(function(e){return e.text==o.text});e&&(o.threeHourCode=e.threeHour,o.sameDayCode=e.sameDay,o.nextDayCode=e.nextDay)}var o=this,i=e.getAdhocgBiz();t()}angular.module("main.module").directive("adhocPssPricingRow",function(){return{restrict:"E",scope:{ngModel:"=",isValidate:"=",viewMode:"=?",text:"@?"},templateUrl:"app/directives/adhocPSSPricing/adhocPSSPricingRow.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["pricingService"]}(),function(){"use strict";function e(e){function t(e){var t=!1;return angular.forEach(o.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}function n(t){e.path("/milkrun/detail/"+t)}var o=this;o.isContainColumn=t,o.goToDetailPage=n}angular.module("milkRun.module").directive("milkrunJobGrid",function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"="},templateUrl:"app/directives/milkRun/jobs/milkRunJobGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$location"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){function s(){if(y.listAssignTransaction.length){var e={assignVendor:l};y.dataAssignVendor={},i.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:y.dataAssignVendor},e)}}function l(){y.isLoading=!0,n.assignVendorInternalDriver({isMilkRun:!0,userId:y.dataAssignVendor.user.id,targetIds:y.listAssignTransaction}).then(function(e){angular.forEach(y.ngModel,function(e){y.listAssignTransaction.indexOf(e.id)>=0&&(e.vendorText=y.dataAssignVendor.user.name)}),o.success("The selected transactions have been assigned to vendor successfully."),y.listAssignTransaction=[],y.isCheckAll=!1,y.isLoading=!1})}function c(){o.success("Upload successfully for the selected transactions."),y.listAssignTransaction=[],y.isCheckAll=!1}function d(t){u(t),e.path("/milkrunTask/"+t)}function u(e){var n=[];angular.forEach(y.ngModel,function(e){n.push(e.id)}),t.milkrunTransaction={listTransaction:n,currentIndex:n.indexOf(e)}}function m(){y.isCheckAll?v():y.listAssignTransaction=[]}function p(e,t){e.stopPropagation(),y.isCheckAll=!1;for(var n=!1,o=0;o<y.listAssignTransaction.length;o++)if(y.listAssignTransaction[o]==t)return n=!0,void y.listAssignTransaction.splice(o,1);y.listAssignTransaction.push(t)}function g(e){for(var t=0;t<y.listAssignTransaction.length;t++)if(y.listAssignTransaction[t]==e)return!0;return!1}function v(){y.listAssignTransaction=[],angular.forEach(y.ngModel,function(e){e.status!=y.taskStatus.delivered.value&&y.listAssignTransaction.push(e.id)})}function f(e){var t=!1;return angular.forEach(y.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}function h(e,t){e.preventDefault(),e.stopPropagation(),t.status!=y.taskStatus.delivered.value&&(p(e,t.id),g(t.id))}var y=this;y.systemRole=r,y.taskStatus=a,y.isContainColumn=f,y.checkAllChange=m,y.bindingCheck=g,y.onCheckTransaction=p,y.goToDetailPage=d,y.assignVendorFunc=s,y.preventClick=h,y.resetGridCheckingFunc=c,y.listAssignTransaction=[],y.listTransactionId=y.listAssignTransaction}angular.module("milkRun.module").directive("milkrunTransactionGrid",function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"=",assignVendorFunc:"=",isLoading:"=?",listTransactionId:"=",resetGridCheckingFunc:"="},templateUrl:"app/directives/milkRun/jobs/milkRunTransactionGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$location","$rootScope","taskService","toastr","modalService","systemRole","taskStatus"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d){function u(){h.poOptions=[{value:"",text:"All"},{value:"true",text:"Yes"},{value:"false",text:"No"}],e.currentUser.role!==n.User&&e.currentUser.role!==n.Vendor&&(m(),h.isTransaction&&p()),g();var t=[];h.statuses=h.isTransaction?v(i,t):v(o)}function m(){t.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then(function(e){h.customers=t.convertListCustomerDropDownList(e.data.customers)})}function p(){var t=0;e.currentUser.role==n.Admin&&(t=e.currentUser.department===s.PSS.name?s.PSS.id:s.Healthcare.id),
d.getVendorByCriteria({departmentId:t,sortColumn:"organizationName",sortAscending:!0}).then(function(e){h.vendors=d.convertListVendorDropDownList(e.data.users)})}function g(){h.gridType===r.milkRunJob||h.gridType===r.milkRunTransaction?h.requestTypes=v(a):e.currentUser.role==n.SuperAdmin?h.requestTypes=f():e.currentUser.department===s.PSS.name?h.requestTypes=v(l):h.requestTypes=v(c)}function v(e,t){var n=[{value:"",text:"All"}];for(var o in e)t&&t.indexOf(e[o].value)!==-1||n.push({value:e[o].value,text:e[o].display});return n}function f(){var e=[{value:"",text:"All"}];for(var t in l)e.push({value:l[t].value,text:l[t].display});for(var t in c)e.push({value:c[t].value,text:c[t].display});return e}var h=this;h.systemRole=n,h.jobGridType=r,u()}angular.module("main.module").directive("jobFilter",function(){return{restrict:"E",scope:{options:"=",actionRequest:"&",isTransaction:"@",gridType:"@"},templateUrl:"app/directives/jobCommon/jobFilter.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","customerService","systemRole","jobStatus","taskStatus","jobGridType","milkRunFrequency","departments","adhocPSSServiceType","adhocHealthCareServiceType","vendorService"]}(),function(){"use strict";function e(e,t,n,o){function i(){c.assignVendorFunc={},c.setReadyToBillFunc={},c.resetGrid={},c.listTransactionId=[],c.translationTexts={checkAll:"Show All",dynamicButtonTextSuffix:"columns"},c.chosenColumnConfig={idProp:"name",displayProp:"display",showUncheckAll:!1},c.chosenColumnModel=[],angular.forEach(c.gridConfig.columns,function(e){c.chosenColumnModel.push({id:e.name})})}function r(){c.assignVendorFunc()}function a(){c.actionRequest(),c.resetGrid()}function s(){o.createWarningPopup("Are you sure you want to set as ready to bill","Warning",function(){c.setReadyToBillFunc()})}function l(){var e=window.location.hostname,t='<link rel="stylesheet" type="text/css" href="../bower_components/bootstrap/dist/css/bootstrap.css"><link href="./css/custom.css" rel="stylesheet" type="text/css">';"localhost"!==e&&(t='<link rel="stylesheet" href="css/styles.min.css">');var n=document.getElementById("printOrderTable").innerHTML,o=window.open("","_blank");o.document.open(),o.document.write("<html><head>"+t+'</head><body onload="setTimeout(function(){ window.print(); }, 1000)">'+n+"</html>"),o.document.close()}var c=this;c.systemRole=n,c.setItemPerPage=e,c.jobGridType=t,c.printOrder=l,c.assignVendor=r,c.uploadCallback=a,c.setReadyToBill=s,i(),c.getListTransactionId=function(){var e=[];return angular.forEach(c.ngModel,function(t){c.listTransactionId.indexOf(t.id)>-1&&e.push({id:t.id,barcode:t.barcode})}),e},c.eventsChosenColumn={onItemDeselect:function(e){1===c.chosenColumnModel.length&&c.chosenColumnModel.push(e),document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="none"},onSelectAll:function(){document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="inline"}}}angular.module("main.module").directive("jobGrid",function(){return{restrict:"E",scope:{ngModel:"=",options:"=",gridConfig:"=",actionRequest:"&",isLoading:"=",gridType:"@"},templateUrl:"app/directives/jobCommon/jobGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["setItemPerPage","jobGridType","systemRole","modalService"]}(),function(){"use strict";function e(e){function t(e){var t=!1;return angular.forEach(o.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}function n(t){e.path("/adhoc/detail/"+t)}var o=this;o.isContainColumn=t,o.goToDetailPage=n}angular.module("adhoc.module").directive("adhocJobGrid",function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"="},templateUrl:"app/directives/adhoc/jobs/adhocJobGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$location"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){function s(){if(b.listAssignTransaction.length){var e={assignVendor:d};b.dataAssignVendor={},n.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:b.dataAssignVendor},e)}}function l(){b.isLoading=!0,o.setReadyToBillAdhoc({targetIds:b.listAssignTransaction}).then(function(e){i.success("The selected transactions have been set as ready to bill successfully."),angular.forEach(b.ngModel,function(e){b.listAssignTransaction.indexOf(e.id)>=0&&(e.statusText="Ready to Bill")}),b.listAssignTransaction=[],b.isCheckAll=!1,b.isLoading=!1}).catch(function(e){b.listAssignTransaction=[],b.isCheckAll=!1,i.warning(e.data.message),b.isLoading=!1})}function c(e,t){e.stopPropagation(),n.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:t.map(function(e){return{imageUrl:e}})}},{})}function d(){b.isLoading=!0,o.assignVendorInternalDriver({userId:b.dataAssignVendor.user.id,targetIds:b.listAssignTransaction}).then(function(e){angular.forEach(b.ngModel,function(e){b.listAssignTransaction.indexOf(e.id)>=0&&(e.vendorText=b.dataAssignVendor.user.name)}),i.success("The selected transactions have been assigned to vendor successfully."),b.listAssignTransaction=[],b.isCheckAll=!1,b.isLoading=!1})}function u(){i.success("Upload successfully for the selected transactions."),b.listAssignTransaction=[],b.isCheckAll=!1}function m(){b.isCheckAll?h():b.listAssignTransaction=[]}function p(e){g(e),t.path("/adhocTask/"+e)}function g(t){var n=[];angular.forEach(b.ngModel,function(e){n.push(e.id)}),e.adhocTransaction={listTransaction:n,currentIndex:n.indexOf(t)}}function v(e,t){e.stopPropagation(),b.isCheckAll=!1;for(var n=0;n<b.listAssignTransaction.length;n++)if(b.listAssignTransaction[n]==t)return void b.listAssignTransaction.splice(n,1);b.listAssignTransaction.push(t)}function f(e){for(var t=0;t<b.listAssignTransaction.length;t++)if(b.listAssignTransaction[t]==e)return!0;return!1}function h(){b.listAssignTransaction=[],angular.forEach(b.ngModel,function(e){b.listAssignTransaction.push(e.id)})}function y(e){var t=!1;return angular.forEach(b.chosenColumnModel,function(n){n.id===e&&(t=!0)}),t}function C(e,t){e.preventDefault(),e.stopPropagation(),t.status!=b.taskStatus.delivered.value&&(v(e,t.id),f(t.id))}var b=this;b.systemRole=r,b.taskStatus=a,b.isContainColumn=y,b.listAssignTransaction=[],b.listTransactionId=b.listAssignTransaction,b.checkAllChange=m,b.bindingCheck=f,b.onCheckTransaction=v,b.assignVendorFunc=s,b.setReadyToBillFunc=l,b.goToDetailPage=p,b.preventClick=C,b.resetGridCheckingFunc=u,b.viewPhoto=c}angular.module("adhoc.module").directive("adhocTransactionGrid",function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"=",assignVendorFunc:"=",listTransactionId:"=",resetGridCheckingFunc:"=",setReadyToBillFunc:"="},templateUrl:"app/directives/adhoc/jobs/adhocTransactionGrid.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$rootScope","$location","modalService","taskService","toastr","systemRole","taskStatus"]}(),function(){"use strict";function e(e,t,n,o){function i(){if(a.isLoading=!0,a.ngModel.isDriver){var i=a.ngModel.customerId;t.getInternalDriver(i).then(function(e){a.isLoading=!1;var t=n.currentUser.department===o.PSS.name?o.PSS.id:o.Healthcare.id;a.users=e.data.users.filter(function(e){return e.driverDepartments.some(function(e){return e.departmentId==t&&e.active})}).map(function(e){return{id:e.id,name:e.firstName+" "+e.lastName}}),a.users.unshift({id:void 0,name:"Please select ..."})})}else e.getVendorByCriteria({}).then(function(e){a.isLoading=!1,a.users=e.data.users.filter(function(e){return e.lockoutEnabled===!1}).map(function(e){return{id:e.id,name:e.organization}}),a.users.unshift({id:void 0,name:"Please select ..."})})}function r(){angular.forEach(a.users,function(e){a.ngModel.user.id===e.id&&(a.ngModel.user.name=e.name)})}var a=this;a.userChange=r,i()}angular.module("main.module").directive("assignVendor",function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&",onAction:"&"},templateUrl:"app/directives/jobCommon/assignVendor/assignVendor.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["vendorService","driverService","$rootScope","departments"]}(),function(){"use strict";function e(e){function t(){e.getDriverByCriteria({}).then(function(e){o.drivers=e.data.users.filter(function(e){return e.driverDepartments.length&&e.driverDepartments[0]&&e.driverDepartments[0].active}),o.drivers.unshift({id:void 0,firstName:"Please",lastName:"select ..."})})}function n(){angular.forEach(o.drivers,function(e){o.ngModel.driver.id===e.id&&(o.ngModel.driver.name=e.firstName+" "+e.lastName)})}var o=this;o.driverChange=n,t()}angular.module("main.module").directive("assignDriver",function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&",onAction:"&"},templateUrl:"app/directives/jobCommon/assignDriver/assignDriver.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["driverService"]}(),function(){"use strict";function e(e){function t(e){o.ngModel.proofOfCollections.splice(e,1)}function n(e){o.ngModel.proofOfDeliveries.splice(e,1)}var o=this;o.removePoC=t,o.removePoD=n,o.taskStatus=e}angular.module("main.module").directive("proofOfCollectionAndDelivery",function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/directives/jobCommon/proofOfCollectionAndDelivery/proofOfCollectionAndDelivery.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["taskStatus"]}(),function(){"use strict";function e(e,t,n){function o(){i()}function i(){s.ngModel&&s.ngModel.imageUrl&&e.getImageFromFileName(s.ngModel.imageUrl).then(function(e){s.ngModel.src="data:image/png;base64,"+e.data})}function r(){t.createWarningPopup("Are you sure you want to remove this proof?","Warning",function(){e.removeProof({id:s.taskId,barcode:s.barcode,proofId:s.ngModel.id},s.poc).then(function(e){s.callback({index:s.index})})})}function a(){t.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:[{imageUrl:s.ngModel.imageUrl}]}},{})}var s=this;s.remove=r,s.viewPhoto=a,s.systemRole=n,o()}angular.module("main.module").directive("proofDetail",function(){return{restrict:"E",scope:{ngModel:"=",taskId:"=",barcode:"=",poc:"=?",callback:"&?",index:"=",canEdit:"=?"},templateUrl:"app/directives/jobCommon/proofOfCollectionAndDelivery/proofDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["taskService","modalService","systemRole"]}(),function(){"use strict";function e(e){function t(t){e.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:[{imageUrl:t}]}},{})}var n=this;n.viewPhoto=t}angular.module("main.module").directive("driverRemarks",function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/directives/jobCommon/driverRemarks/driverRemarks.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["modalService"]}(),function(){"use strict";function e(e,t,n,o){function i(){a.status=a.ngModel.status,a.statuses=[];for(var t in e)a.statuses.push({value:e[t].value,display:e[t].display})}function r(){n.updateTask(a.ngModel.id,{barcode:a.ngModel.barcode,status:a.status}).then(function(t){a.ngModel.status=a.status;for(var n in e)if(e[n].value==a.status){a.ngModel.statusText=e[n].display;break}a.callback(),o.success("The Transaction has been updated status successfully.")})}var a=this;a.systemRole=t,a.changeStatus=r,i()}angular.module("main.module").directive("changeStatus",function(){return{restrict:"E",scope:{ngModel:"=",callback:"&"},templateUrl:"app/directives/jobCommon/changeStatus/changeStatus.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["taskStatus","systemRole","taskService","toastr"]}(),function(){"use strict";function e(e){var t=this;e(function(){JsBarcode("#transaction"+t.transactionId,t.ngModel,{width:1,height:30})})}angular.module("main.module").directive("barcodePrint",function(){return{restrict:"E",scope:{ngModel:"=",transactionId:"="},templateUrl:"app/directives/jobCommon/barcodePrint/barcodePrint.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$timeout"]}(),function(){"use strict";function e(e){function t(){}function n(){o.tasks=o.getTransactionId?o.getTransactionId():o.tasks,o.tasks.length&&(o.data={isPOC:o.poc,tasks:o.tasks,callback:o.callback},e.createPopup({templateUrl:"app/directives/jobCommon/uploadProof/uploadProofModal.html",size:"lg",data:o.data},{}))}var o=this;o.uploadProof=n,t()}angular.module("main.module").directive("uploadProof",function(){return{restrict:"E",scope:{label:"@",poc:"=",tasks:"=?",getTransactionId:"&?",callback:"&?"},templateUrl:"app/directives/jobCommon/uploadProof/uploadProof.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["modalService"]}(),function(){"use strict";function e(e,t){function n(){r.proofDetail={},r.isFileChoosen=!1,r.dataFile=null}function o(){var e=r.proofDetail.signedAtDate,n=r.proofDetail.signedAtTime;e.setHours(n.getHours()),e.setMinutes(n.getMinutes());var o=new FormData;o.append("file",r.dataFile);var i={type:r.ngModel.isPOC?"poc":"pod",remark:r.proofDetail.signedBy,signedDate:e,tasks:r.ngModel.tasks};o.append("data",JSON.stringify(i)),t.uploadProof(o).then(function(e){r.onCancel(),r.ngModel.callback&&r.ngModel.callback()})}function i(){e(function(){r.isFileChoosen=!0;var e=new FileReader;e.onload=function(e){document.getElementById("image-proof").src=e.target.result},e.readAsDataURL(r.dataFile)})}var r=this;r.onFileChange=i,r.uploadProof=o,n()}angular.module("main.module").directive("uploadProofDetail",function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&"},templateUrl:"app/directives/jobCommon/uploadProof/uploadProofDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$timeout","taskService"]}(),function(){"use strict";function e(e,t,n,o){function i(){u.ngModel=u.ngModel||{},u.surchargeList=["Evening, Sat, Sun & Public Holiday","Restricted Area"]}function r(e){u.unAssignData={isDriver:e};var t=e?"Are you sure you want to unassign this driver?":"Are you sure you want to unassign this vendor?";o.createWarningPopup(t,"Warning",a)}function a(){u.isLoading=!0,t.unAssignVendor({isMilkRun:u.isMilkRun,isDriver:u.unAssignData.isDriver,targetIds:[u.ngModel.id]}).then(function(e){n.success("The point has been unassigned "+(u.unAssignData.isDriver?"driver":"vendor")+" successfully."),u.unAssignData.isDriver?u.ngModel.hasInternalDriverAssigned=!1:u.ngModel.vendorName="",u.isLoading=!1})}function s(){u.ngModel.surchargeAmount=t.getSurchargeAmount(u.ngModel.surchargeDescription)||0}function l(){return!u.includeItems||u.ngModel.items&&u.ngModel.items.length?(u.ngModel.id||u.ngModel.elementId||(u.ngModel.elementId=(new Date).getTime()),void delete u.ngModel.editMode):void n.warning("At least one item should be added to this point!")}function c(){u.ngModel.editMode=!0,u.isCollapse=!1}function d(){var e=u.index-1;u.canRemove?u.removePoint({index:e}):(delete u.ngModel.address,delete u.ngModel.contactNumber,delete u.ngModel.name,delete u.ngModel.surchargeDescription,delete u.ngModel.surchargeAmount,delete u.ngModel.remark)}var u=this;u.systemRole=e,u.save=l,u.cancel=d,u.edit=c,u.surchargeDescriptionChange=s,u.unAssignVendorDriver=r,i()}angular.module("main.module").directive("pointContact",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?",includeItems:"=?",isCollection:"=?",index:"=",canRemove:"=?",removePoint:"&?",viewMode:"=",onCheckPoint:"&?",bindingCheck:"&?",isMilkRun:"=?",canEdit:"=?",getAllPoints:"&?"},templateUrl:"app/directives/jobCommon/points/pointContact.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["systemRole","adhocService","toastr","modalService"]}(),function(){"use strict";function e(e,t,n,o,i){function r(){s(),p.ngModel=p.ngModel||{}}function a(e){var n=p.isCollection?1:2;return t.searchFavoriteAddress(e,n,i.getClientId()).then(function(e){return e.data.favoriteAddresses})}function s(){var e=p.isCollection?1:2;return i.getFavoriteAddress(e)}function l(){var e=s(),t=e.find(function(e){return e.id==p.selectedAddress});u(t)}function c(t){return e.getLocationByPostalCode(t).then(function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]})}function d(e){p.ngModel.address.postalCode=e.postalCode,p.ngModel.address.blockNumber=e.blockNumber,p.ngModel.address.streetName=e.streetName}function u(e){p.ngModel.address=p.ngModel.address||{},p.ngModel.address.postalCode=e.postalCode,p.ngModel.address.blockNumber=e.blockNumber,p.ngModel.address.streetName=e.streetName,p.ngModel.address.unitNumber=e.unitNumber,p.ngModel.contactNumber=e.contactNumber,p.ngModel.name=e.contactPerson,p.searchTerm=""}function m(){var e=i.getClientId();p.favoriteAddress={address:p.ngModel.address,contactNumber:p.ngModel.contactNumber,contactPerson:p.ngModel.name,addressType:p.isCollection?1:2,customerIds:e?[e]:[]},n.createPopup({templateUrl:"app/directives/jobCommon/points/pointAddFavorite.html",size:"lg",data:{favoriteAddress:p.favoriteAddress}},{onCreate:function(){p.isLoadingAddress=!0,t.saveFavoriteAddress(p.favoriteAddress).then(function(e){p.isLoadingAddress=!1,o.success("The favorite address has been created successfully.")},function(e){o.error(e.data.message),p.isLoadingAddress=!1})}})}var p=this;p.searchFavoriteAddress=a,p.changeFavoriteAddress=l,p.searchAddressByPostalCode=c,p.onSelect=d,p.onSelectAddress=u,p.addFavorite=m,p.loadFavoriteAddress=s,r()}angular.module("main.module").directive("pointContactInfo",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?",isCollection:"=?"},templateUrl:"app/directives/jobCommon/points/pointContactInfo.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["locationService","favoriteService","modalService","toastr","adhocService"]}(),function(){"use strict";function e(e){function t(){i.surchargeList=["Evening, Sat, Sun & Public Holiday","Restricted Area"],i.ngModel=i.ngModel||{}}function n(){delete i.ngModel.editMode}function o(){i.ngModel.surchargeAmount=e.getSurchargeAmount(i.ngModel.surchargeDescription)||0}var i=this;i.save=n,i.surchargeDescriptionChange=o,t()}angular.module("main.module").directive("pointContactTrip",function(){return{restrict:"E",scope:{ngModel:"=",index:"=",canRemove:"=?",removePoint:"&?",viewMode:"=",label:"@",isCollection:"=?",isMilkRun:"=?"},templateUrl:"app/directives/jobCommon/points/pointContactTrip.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocService"]}(),function(){"use strict";function e(){function e(){a.ngModel=a.ngModel||{}}function t(){a.orgCollectionPoint=angular.copy(a.collectionPoint),a.orgDeliveryPoint=angular.copy(a.deliveryPoint),a.collectionPoint.editMode=!0,a.deliveryPoint.editMode=!0,a.collectionPoint.isCollapse=!1,a.deliveryPoint.isCollapse=!1}function n(){i()&&(delete a.collectionPoint.editMode,delete a.deliveryPoint.editMode,a.collectionPoint.isCollapse=!0,a.deliveryPoint.isCollapse=!0)}function o(){if(a.canRemove)a.removeTrip({index:a.index});else{var e=a.collectionPoint.tripSequence;a.collectionPoint={editMode:!0,tripSequence:e,items:[]},a.deliveryPoint={editMode:!0,tripSequence:e,items:[]}}}function i(){var e=r(a.collectionPoint),t=r(a.deliveryPoint)&&a.deliveryPoint.items.length;return e&&t}function r(e){return!!(e.contactNumber&&e.name&&e.address&&e.address.blockNumber&&e.address.postalCode&&e.address.unitNumber&&e.address.streetName)}var a=this;a.save=n,a.onEdit=t,a.cancel=o,e()}angular.module("main.module").directive("pointTrip",function(){return{restrict:"E",scope:{collectionPoint:"=",deliveryPoint:"=",index:"=",canRemove:"=?",canEdit:"=?",removeTrip:"&?",viewMode:"=",isMilkRun:"=?"},templateUrl:"app/directives/jobCommon/points/pointTrip.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e,t,n,o){function i(){u.editMode=!0,u.ngModel.items.push({editMode:!0})}function r(e){u.relatedPoints=l(u.ngModel.items[e]),u.selectedPoints=angular.copy(u.relatedPoints),u.currentIndex=e,u.relatedPoints.length?t.createPopup({templateUrl:"app/directives/jobCommon/items/applyRelatedPointModal.html",size:"lg",data:{relatedPoints:u.relatedPoints,selectedPoints:u.selectedPoints,isCollection:u.isCollection}},{yes:function(){u.selectedPoints.forEach(function(e){u.points[e].items=u.points[e].items.filter(function(e){return e.elementId&&e.elementId!==u.ngModel.items[u.currentIndex].elementId})}),u.ngModel.items.splice(u.currentIndex,1)},no:function(){u.ngModel.items.splice(u.currentIndex,1)}}):u.ngModel.items.splice(u.currentIndex,1)}function a(e){u.editMode=!0,e.editMode=!0}function s(){u.editMode=!1}function l(e){u.points=u.getAllPoints?u.getAllPoints():[];for(var t=[],n=0;n<u.points.length;n++)if(n!==u.index-1){var o=u.points[n].items.some(function(t){return t.elementId&&t.elementId===e.elementId});o&&t.push(n)}return t}function c(e){for(var t in n)if(n[t].id==e)return n[t].text;for(var t in o)if(o[t].value==e)return o[t].display;return"N/A"}function d(e){t.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:e}},{})}var u=this;u.departments=e,u.removeItem=r,u.editItem=a,u.addItem=i,u.editMode=!1,u.changeMode=s,u.viewPhotos=d,u.getMilkRunWeight=c,u.ngModel.items=u.ngModel.items||[]}angular.module("main.module").directive("itemList",function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"=?",isRoundTrip:"=?",isMilkRun:"=?",isExist:"=?",getAllPoints:"&?",index:"=?",isCollection:"=?"},templateUrl:"app/directives/jobCommon/items/itemList.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["departments","modalService","milkRunWeight","healthCareFixedRunWeightCategory"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u,m,p,g){function v(){if(R.isNew=!(R.ngModel.elementId||R.ngModel.id),R.ngModel.elementId=R.ngModel.elementId||(new Date).getTime(),R.getAllPoints&&void 0!==R.getAllPoints()&&f(),R.form=R.form||{},R.addNewItemReference=e,R.isAddItemSubmitted=!1,R.uoms=t.currentUser.department===a.PSS.name?o:i,R.isHealthCare=t.currentUser.department===a.Healthcare.name,R.isHealthCare){R.itemsHealthCare=[{id:void 0,name:"Please select ..."}],angular.forEach(n,function(e){R.itemsHealthCare.push({id:e,name:e})}),R.healthCareFixedRunWeightCategories=[];for(var r in g)R.healthCareFixedRunWeightCategories.push({id:g[r].value,name:g[r].display})}}function f(){var e=R.getAllPoints();if(R.isLastPoint=R.indexPoint===e.length,R.relatedPoints=[],R.isNew){for(var t=0;t<e.length;t++)t!==R.indexPoint-1&&R.relatedPoints.push(t);R.selectedPoints=[]}else{for(var t=0;t<e.length;t++)if(t!==R.indexPoint-1){var n=e[t].items.some(function(e){return e.elementId&&e.elementId===R.ngModel.elementId});n&&R.relatedPoints.push(t)}R.selectedPoints=angular.copy(R.relatedPoints)}}function h(e){return s.searchFavoriteItem(e,r.getClientId()).then(function(e){return e.data.favoriteItems})}function y(){return r.getFavoriteItems()}function C(){var e=y().find(function(e){return e.id==R.selectedItem});b(e)}function b(e){R.ngModel.description=e.description,R.ngModel.issueQuantity=e.issueQuantity,R.ngModel.unitMass=e.unitMass,R.ngModel.uom=e.uom,R.ngModel.depth=e.depth||"",R.ngModel.height=e.height||"",R.ngModel.width=e.width||"",R.ngModel.width&&R.ngModel.height&&R.ngModel.depth?R.ngModel.unitVolume=R.ngModel.width*R.ngModel.height*R.ngModel.depth/5e3:R.ngModel.unitVolume="",R.searchTerm=""}function k(){if(delete R.ngModel.editMode,R.isNew){if(R.selectedPoints&&R.selectedPoints.length){var e=R.getAllPoints();R.selectedPoints.forEach(function(t){e[t].items.push(angular.copy(R.ngModel))})}}else if(R.selectedPoints&&R.selectedPoints.length){var e=R.getAllPoints();R.selectedPoints.forEach(function(t){e[t].items.forEach(function(n,o){if(n.elementId&&n.elementId===R.ngModel.elementId){var i=n.id;e[t].items[o]=angular.copy(R.ngModel),e[t].items[o].id=i}})})}R.changeMode()}function P(){R.index>0?(R.changeMode(),R.remove({index:R.index})):(delete R.ngModel.description,delete R.ngModel.issueQuantity,delete R.ngModel.unitMass,delete R.ngModel.uom,delete R.ngModel.depth,delete R.ngModel.height,delete R.ngModel.width,delete R.ngModel.milkRunWeightId,R.ngModel.itemImages=[])}function D(){c(function(){document.getElementById("uploadFile-"+R.uniqueElement).click()})}function A(e){R.ngModel.itemImages[e].imageUrl?R.ngModel.itemImages[e].isDeleted=!0:(d.setImageItem(R.ngModel.itemImages,R.ngModel.elementId,R.ngModel.itemImages[e].name),R.ngModel.itemImages.splice(e,1))}function M(){var e=Array.from(R.itemImages);R.ngModel.itemImages=R.ngModel.itemImages||[],R.ngModel.itemImages=R.ngModel.itemImages.concat(e.map(function(e){return{name:e.name}})),d.setImageItem(e,R.ngModel.elementId),l.$apply()}function S(e){u.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:[e]}},{})}function T(){R.favoriteItem=angular.copy(R.ngModel);var e=r.getClientId();R.favoriteItem.customerIds=e?[e]:[],u.createPopup({templateUrl:"app/directives/jobCommon/items/addFavorite.html",size:"lg",data:{favoriteItem:R.favoriteItem}},{onCreate:function(){R.isLoadingItem=!0,delete R.favoriteItem.id,s.saveFavoriteItem(R.favoriteItem).then(function(e){R.isLoadingItem=!1,m.success("The favorite item has been created successfully.")},function(e){m.error(e.data.message),R.isLoadingItem=!1})}})}var R=this;R.departments=a,R.searchFavoriteItem=h,R.onSelectItem=b,R.save=k,R.cancel=P,R.openUploadFile=D,R.uploadFileComplete=M,R.addFavorite=T,R.milkRunWeight=p,R.uniqueElement=(new Date).getTime(),R.onRemove=A,R.viewPhoto=S,R.changeFavoriteItem=C,R.loadFavoriteAddress=y,v()}angular.module("main.module").directive("itemDetail",function(){return{restrict:"E",scope:{ngModel:"=",changeMode:"&",isMilkRun:"=?",index:"=?",remove:"&?",isExist:"=?",getAllPoints:"&?",indexPoint:"=?",isCollection:"=?"},templateUrl:"app/directives/jobCommon/items/itemDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["addNewItemReference","$rootScope","itemsHealthCare","uomPSS","uomHealthCare","adhocService","departments","favoriteService","$scope","$timeout","imageService","modalService","toastr","milkRunWeight","healthCareFixedRunWeightCategory"]}(),function(){"use strict";function e(e,t){function n(){if(i.ngModel.imageUrl&&e.getImageFromFileName(i.ngModel.imageUrl).then(function(e){i.base64Image="data:image/png;base64,"+e.data}),!i.ngModel.imageUrl&&i.ngModel.name){var t=e.getImageFromName(i.ngModel.name),n=new FileReader;n.readAsDataURL(t),n.onload=function(e){document.getElementById(i.elementId).src=e.target.result}}}function o(e){i.angle=(i.angle+e)%360;var e=Math.abs(i.angle);i.width=i.width||document.getElementById(i.elementId).clientWidth,i.height=i.height||document.getElementById(i.elementId).clientHeight,i.className="rotate"+e,90===e||270===e?i.containerStyle={width:i.height+"px",height:i.width+"px"}:i.containerStyle={width:i.width+"px",height:i.height+"px"}}var i=this;i.elementId="image-detail-"+t.$id,i.rotate=o,i.angle=0,i.className="",i.containerStyle={},n()}angular.module("main.module").directive("imageDetail",function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/directives/jobCommon/items/imageDetail.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["imageService","$scope"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u){function m(){return M.ngModel}function p(e){M.isCheckAll=!1;for(var t=0;t<M.listCheckPoint.length;t++)if(M.listCheckPoint[t]==e)return void M.listCheckPoint.splice(t,1);M.listCheckPoint.push(e)}function g(e){return M.listCheckPoint.some(function(t){return t==e})}function v(){M.isCheckAll?M.listCheckPoint=M.ngModel.map(function(e){return e.id}):M.listCheckPoint=[]}function f(e){if(!M.canAssign)return void i.warning("Job is not approved, please approve the job first");var t={assignVendor:h};M.dataAssignVendor={isDriver:e,customerId:M.customerId},n.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:M.dataAssignVendor},t)}function h(){M.isLoading=!0,o.assignVendor({isMilkRun:M.isMilkRun,isDriver:M.dataAssignVendor.isDriver,userId:M.dataAssignVendor.user.id,targetIds:M.listCheckPoint}).then(function(e){i.success("The selected points have been assigned to "+(M.dataAssignVendor.isDriver?"driver":"vendor")+" successfully."),D(M.dataAssignVendor.isDriver,M.dataAssignVendor.user.name),M.listCheckPoint=[],M.isCheckAll=!1,M.isLoading=!1})}function y(){if(b()){var e=[];angular.forEach(M.ngModel[M.ngModel.length-1].items,function(t){if(t.isApplyToNext){var n=angular.copy(t);delete n.id,e.push(n)}}),M.ngModel.push({editMode:!0,items:e})}else i.warning("Please save all points before adding new point!")}function C(e){M.ngModel.splice(e,1)}function b(){var e=M.ngModel.find(function(e){if(e.editMode)return!0;var t=e.items;if(!t.length)return!0;var n=t.find(function(e){return e.editMode});return!!n||void 0});return!e}function k(){s(function(){document.getElementById("uploadFile").click()})}function P(){M.csvFile&&r.readAsDataUrl(M.csvFile,l).then(function(e){var t=d.currentUser.department===u.PSS.name;if(angular.element(document.getElementById("uploadFile")).val(null),a.isValidFile(e,t)){var n=a.getMilkRunPointsFromText(e,t);M.ngModel=M.ngModel.concat(n),i.success("The csv file is uploaded successfully!")}else i.warning("The csv file is missing data or invalid format!")})}function D(e,t){angular.forEach(M.listCheckPoint,function(n){var o=M.ngModel.find(function(e){return e.id===n});e?(o.hasInternalDriverAssigned=!0,o.vendorName=""):(o.vendorName=t,o.hasInternalDriverAssigned=!1)})}function A(){var e=d.currentUser.department===u.PSS.name,t=[];t=e?[{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",Remark:"Avoid lunch time",SurchargeDescription:"Restricted area;Public Holiday",SurchargeAmount:"2;1",FixedRunWeight:"<5;5to10;10to30;30to60;60to100",Quantity:"1;2;3;4;5",ItemRemark:"Careful;;Careful;;"}]:[{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",Remark:"Avoid lunch time",SurchargeDescription:"Restricted area;Public Holiday",SurchargeAmount:"2;1",ItemDescription:"Documents-18;Pharmaceutical-19;Blood-20",Quantity:"1;2;3",ItemRemark:"Careful;Careful;Careful"}];var n=M.isCollection?"Collection":"Delivery",o="FixedRun"+n+d.currentUser.department+"Template.csv";r.exportCsvFile({data:t,filename:o})}var M=this;M.adhocTypes=e,M.addPoint=y,M.removePoint=C,M.systemRole=t,M.checkAllChange=v,M.onCheckPoint=p,M.bindingCheck=g,M.assignVendorDriver=f,M.downloadSampleCsv=A,M.openFile=k,M.uploadFile=P,M.getAllPoints=m,M.listCheckPoint=[],M.isBatchUpload=M.isMilkRun&&(M.jobType==M.adhocTypes.oneToMany&&!M.isCollection||M.jobType==M.adhocTypes.manyToOne&&M.isCollection),M.canEdit=M.jobStatus!==c.readyToBill.value&&M.jobStatus!==c.pendingRejection.value&&M.jobStatus!==c.billed.value}angular.module("main.module").directive("jobPoints",function(){return{restrict:"E",scope:{ngModel:"=",isCollection:"=?",jobType:"=",viewMode:"=",label:"@",isMilkRun:"=?",jobId:"=?",customerId:"=?",canAssign:"=?",jobStatus:"=?"},templateUrl:"app/directives/jobCommon/points/jobPoints.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocTypes","systemRole","modalService","adhocService","toastr","fileReaderService","milkrunService","$timeout","$scope","jobStatusType","$rootScope","departments"]}(),function(){"use strict";function e(e,t){function n(t){return e.searchFavoriteAddress(t).then(function(e){return e.data.favoriteAddresses})}function o(e){return t.getLocationByPostalCode(e).then(function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]})}function i(e){a.ngModel.address.postalCode=e.postalCode,a.ngModel.address.blockNumber=e.blockNumber,a.ngModel.address.streetName=e.streetName;
}function r(e){a.ngModel.address=a.ngModel.address||{},a.ngModel.address.postalCode=e.postalCode,a.ngModel.address.blockNumber=e.blockNumber,a.ngModel.address.streetName=e.streetName,a.ngModel.address.unitNumber=e.unitNumber,a.ngModel.address.contactPerson=e.contactPerson,a.ngModel.address.contactNumber=e.contactNumber,a.searchTerm=""}var a=this;a.searchFavoriteAddress=n,a.searchAddressByPostalCode=o,a.onSelect=i,a.onSelectAddress=r}angular.module("main.module").directive("contactReattempt",function(){return{restrict:"E",scope:{ngModel:"=",form:"=?"},templateUrl:"app/directives/jobCommon/contactReattempt/contactReattempt.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["favoriteService","locationService"]}(),function(){"use strict";function e(e,t,n,o){function i(){a.viewMode=!1,a.value=e.convertDate(a.ngModel)}function r(){n.updateTaskDate(a.task.id,{barcode:a.task.barcode,date:a.value,dateType:a.isCollection?1:2}).then(function(e){a.viewMode=!0,a.callback(),o.success("The date has been updated successfully.")})}var a=this;a.systemRole=t,a.viewMode=!0,a.edit=i,a.update=r}angular.module("main.module").directive("updateTaskDate",function(){return{restrict:"E",scope:{ngModel:"=",task:"=",callback:"&",isCollection:"=?",canEdit:"=?"},templateUrl:"app/directives/jobCommon/updateDate/updateTaskDate.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["utilityService","systemRole","taskService","toastr"]}(),function(){"use strict";function e(e){function t(){o.viewMode=!1,o.value=o.ngModel}function n(){o.viewMode=!0,o.ngModel=o.value}var o=this;o.systemRole=e,o.viewMode=!0,o.edit=t,o.save=n}angular.module("main.module").directive("updatePrice",function(){return{restrict:"E",scope:{ngModel:"=",isMilkRun:"=?",canEdit:"=?"},templateUrl:"app/directives/jobCommon/updatePrice/updatePrice.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["systemRole"]}(),function(){"use strict";function e(e){function t(){r.ngModel=r.ngModel||[]}function n(){r.ngModel.push({})}function o(e){r.ngModel.splice(e,1)}function i(t){r.ngModel[t].amount=e.getSurchargeAmount(r.ngModel[t].description)||0}var r=this;r.addSurcharge=n,r.removeSurcharge=o,r.surchargeDescriptionChange=i,r.surchargeList=["Evening, Sat, Sun & Public Holiday","Restricted Area"],t()}angular.module("main.module").directive("surchargePoint",function(){return{restrict:"E",scope:{ngModel:"=",editMode:"="},templateUrl:"app/directives/jobCommon/points/surcharge.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["adhocService"]}(),function(){"use strict";function e(e,t){function n(){l.detail.customerIds=l.detail.customerIds||[],o(),l.departments&&t.$watch("vm.departments",function(e){var t=e.filter(function(e){return e.isCheck}).map(function(e){return e.departmentId});l.filteredUsers=l.users.filter(function(e){return t.indexOf(e.departmentId)>-1})},!0)}function o(){l.users=[],e.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then(function(e){l.users=e.data.customers.map(function(e){return{id:e.id,name:e.organizationCode+" "+e.name,departmentId:e.department.id}}),l.filteredUsers=angular.copy(l.users)})}function i(){l.filteredUsers=l.users.filter(function(e){return e.name.toLowerCase().indexOf(l.searchTerm.toLowerCase())>-1})}function r(){l.isCheckAll=!l.isCheckAll,l.isCheckAll?l.detail.customerIds=l.filteredUsers.map(function(e){return e.id}):l.detail.customerIds=[]}function a(e){var t=l.detail.customerIds.find(function(t){return t===e});return!!t}function s(e){l.isCheckAll=!1;for(var t=0;t<l.detail.customerIds.length;t++)if(l.detail.customerIds[t]===e)return void l.detail.customerIds.splice(t,1);l.detail.customerIds.push(e)}var l=this,l=this;l.isCheckAll=!1,l.searchTerm="",l.bindingCheck=a,l.onCheck=s,l.selectAll=r,l.filter=i,l.filteredUsers=[],n()}angular.module("main.module").directive("clientsSelection",function(){return{restrict:"E",scope:{detail:"=?",departments:"=?"},templateUrl:"app/directives/clientsSelection/clientSelection.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["customerService","$scope"]}(),function(){"use strict";function e(){function e(e){e.stopPropagation(),t.collapse=!1}var t=this;t.collapse=!0,t.separator=t.separator||/\r?\n/g,t.values=t.ngModel?t.ngModel.split(t.separator):"",t.finalValues=[],angular.forEach(t.values,function(e){t.finalValues=t.finalValues.concat(e.split("<br/>"))}),t.showMore=e}angular.module("main.module").directive("showMore",function(){return{restrict:"E",scope:{ngModel:"=",separator:"=?"},templateUrl:"app/directives/showMore/showMore.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=[]}(),function(){"use strict";function e(e,t){function n(){a.isCheckAll=!a.isCheckAll,a.isCheckAll?a.selected=angular.copy(a.source):a.selected=[]}function o(e){e.stopPropagation(),a.isOpen=!a.isOpen}function i(e){return a.selected.indexOf(e)>=0}function r(e,t){e.stopPropagation(),a.isCheckAll=!1;for(var n=0;n<a.selected.length;n++)if(a.selected[n]===t)return void a.selected.splice(n,1);a.selected.push(t)}var a=this;a.toggle=o,a.bindingCheck=i,a.onCheck=r,a.selectAll=n,a.isCheckAll=!!a.selected.length;var s=function(){a.isOpen=!1,e.$apply()};t.bind("click",s),e.$on("$destroy",function(){angular.element(t).off("click",s)})}angular.module("main.module").directive("multiSelectCheckbox",function(){return{restrict:"E",scope:{source:"=?",selected:"=?",isCollection:"=?"},templateUrl:"app/directives/multiSelectCheckbox/multiSelectCheckbox.html",controller:e,controllerAs:"vm",bindToController:!0}}),e.$inject=["$scope","$document"]}();