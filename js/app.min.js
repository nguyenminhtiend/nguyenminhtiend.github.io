!function(){"use strict";function e(e,t){t.isLocal||e.debugInfoEnabled(!1)}function t(e){e.interceptors.push("httpInterceptor")}function n(e){e.when("/",{redirectTo:"/dashboard"}).otherwise({redirectTo:"/"})}function o(e,t,n,o,i){var r=o.getCurrentUser();if(r)e.currentUser=r,e.indexRoute="#"+i[e.currentUser.role].defaultRoute;else{var a=n.path(),s=t.routes[a];s&&s.authorize&&n.path("/login")}e.$on("$locationChangeStart",(function(e,i,r){var a=n.path();a.indexOf("milkruns")>-1&&(a+="/:view?");var s=t.routes[a];if(s&&s.authorize)if(o.isAuthenticated()){if(!o.getToken())return o.logout(),void n.path("/login");var l=o.getCurrentUser();(!o.isAuthorized(s.authorize)||s.preventViewOnly&&l.viewOnly)&&(o.logout(),n.path("/accessDeny"))}else n.path("/login")})),e.$on("$routeChangeSuccess",(function(){t.current&&(e.hideHeader=t.current.hideHeader,e.hideFooter=t.current.hideFooter,e.alignFooter=t.current.alignFooter||"center",e.stickyFooter=t.current.stickyFooter,e.hideNavbar=t.current.hideNavbar,e.showHeaderDashboardControls=t.current.showHeaderDashboardControls,e.noContainer=t.current.noContainer,e.darkBg=t.current.darkBg,e.category=t.current.category,e.headerSelectedJob="0"),t.current.title?document.title="Sitadel eCMS - "+t.current.title:document.title="Sitadel eCMS"}))}angular.module("main.module",["constants.module","ngRoute","ngAnimate","ui.bootstrap","LocalStorageModule","ui.bootstrap.datetimepicker","toastr","ngTouch","ngSanitize","angularjs-dropdown-multiselect","hljs","ngFileUpload","ngScrollbar","customer.module","spAdminUser.module","adminUser.module","account.module","milkRun.module","log.module","report.module","allLocations.module","dashboard.module","profile.module","ui.odometer","adhoc.module","milkrunTask.module","adhocTask.module","vendorAdhoc.module","vendorMilkrun.module","vendorManagement.module","driver.module","accessDeny.module","favorite.module","financeUser.module","financeBilling.module","financeBillingDetail.module","financeInvoiced.module","financeInvoicedDetail.module"]).config(e).config(t).config(n).run(o),e.$inject=["$compileProvider","systemSetting"],t.$inject=["$httpProvider"],n.$inject=["$routeProvider"],o.$inject=["$rootScope","$route","$location","authService","systemRolesConfigs"]}(),function(){"use strict";var e={};window&&_.assign(e,window.env);var t={ADHOC_TRANSACTIONS:"AdhocTransactions",MILKRUN_TRANSACTIONS:"MilkrunTransactions",USERS:"Users",CLIENTS:"Customers",JOBTYPES:"Jobtypes",REPORTS:"Reports",LOGS:"Logs",DASHBOARD:"Dashboard",ALL_LOCATIONS:"AllLocations",VENDORS:"VendorManagement",DRIVERS:"Drivers",ADHOC_VENDOR:"AdhocVendor",MILKRUN_VENDOR:"MilkrunVendor",FAVORITES:"Favorites",FINANCE:"Finance"};angular.module("constants.module",[]).constant("systemSetting",{serviceUrl:e.apiUrl,simpleDateFormat:"yyyy-MM-dd",isLocal:["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.hostname)>-1}).constant("userConfig",e).constant("defaultTimeZoneOffset",e.defaultTimeZoneOffset).constant("creditNoteDate",e.creditNoteDate).constant("maxNumberOfRecord",2147483647).constant("systemRole",{SuperAdmin:"SuperAdmin",Admin:"Admin",User:"User",Vendor:"Vendor",Driver:"Driver",Finance:"Finance"}).constant("systemRolesConfigs",{SuperAdmin:{navigationItems:[t.ADHOC_TRANSACTIONS,t.MILKRUN_TRANSACTIONS,t.USERS,t.CLIENTS,t.REPORTS,t.LOGS,t.ALL_LOCATIONS,t.VENDORS,t.DRIVERS],defaultRoute:"users"},Admin:{navigationItems:[t.ADHOC_TRANSACTIONS,t.MILKRUN_TRANSACTIONS,t.USERS,t.CLIENTS,t.REPORTS,t.FAVORITES,t.LOGS,t.DASHBOARD,t.VENDORS,t.DRIVERS,t.FINANCE],defaultRoute:"dashboard",cmsRoute:"adhocs/transactions",viewOnly:!0,preventPage:[]},User:{navigationItems:[t.ADHOC_TRANSACTIONS,t.MILKRUN_TRANSACTIONS,t.USERS,t.FAVORITES,t.DASHBOARD,t.FINANCE,t.REPORTS],defaultRoute:"dashboard",cmsRoute:"adhocs/transactions"},Vendor:{navigationItems:[t.ADHOC_VENDOR,t.MILKRUN_VENDOR,t.DRIVERS],defaultRoute:"vendor/adhocs"},Finance:{navigationItems:[],defaultRoute:"financeBillings"}}).constant("setItemPerPage",[{value:10,text:"10 entities"},{value:20,text:"20 entities"},{value:50,text:"50 entities"},{value:100,text:"100 entities"}]).constant("pageName",t).constant("departments",{PSS:{id:1,name:"PSS"},Healthcare:{id:2,name:"Healthcare"}}).constant("pricingType",{Adhoc:1,AdhocExpres:2,MilkRun:3}).constant("weightCategory",{ThreeKg:0,FourKg:1,FiveKg:2,TenKg:3,TwentyKg:4,Extra:5}).constant("milkRunTypes",{none:0,oneToOne:1,oneToMany:2,manyToOne:3,roundTrip:4}).constant("adhocTypes",{none:0,oneToOne:1,oneToMany:2,manyToOne:3,roundTrip:4}).constant("milkRunFrequency",{daily:{value:0,display:"Daily"},twiceADay:{value:1,display:"Twice a day"},weekly:{value:2,display:"Weekly"},projectRun:{value:3,display:"Project run"},threeTimesADay:{value:4,display:"3 times a day"},fourTimesADay:{value:5,display:"4 times a day"}}).constant("days",{monday:{text:"M",value:1,display:"Monday"},tuesday:{text:"T",value:2,display:"Tuesday"},wednesday:{text:"W",value:3,display:"Wednesday"},thursday:{text:"T",value:4,display:"Thursday"},friday:{text:"F",value:5,display:"Friday"}}).constant("milkRunAdditionals",{saturdays:{value:6,display:"Saturdays"},sundays:{value:0,display:"Sundays"},afterOfficeHours:{value:2,display:"After Office Hours"},publicHolidays:{value:3,display:"Public Holidays"}}).constant("milkRunWeight",{upTo5kg:{id:7,text:"Up to 5kg",textImport:"<5"},from5To10kg:{id:8,text:"5 - 10kg",textImport:"5to10"},from10To30kg:{id:9,text:"10 - 30kg",textImport:"10to30"},from30To60kg:{id:10,text:"30 - 60kg",textImport:"30to60"},from60To100kg:{id:11,text:"60 - 100kg",textImport:"60to100"}}).constant("milkRunProgress",{chosenMilkRunType:1,collectionPoint:2,deliveryPoint:3,remark:4,confirmOrder:5}).constant("jobStatusType",{pendingApproval:{value:1,display:"Pending Acceptance"},rejected:{value:2,display:"Rejected"},accepted:{value:3,display:"Accepted"},ongoing:{value:4,display:"On going"},completed:{value:5,display:"Delivered"},deactivated:{value:6,display:"Deactivated"},onHold:{value:7,display:"On hold"},cancelled:{value:8,display:"Cancelled"},readyToBill:{value:9,display:"Ready to Bill"},pendingRejection:{value:10,display:"Pending Rejection"},financeRejected:{value:11,display:"Finance Rejected"},billed:{value:12,display:"Billed"}}).constant("invoiceStatus",{new:{value:1,display:"New"},invoiced:{value:2,display:"Invoiced"},cancelled:{value:3,display:"Cancelled"},creditNoted:{value:4,display:"Credit Noted"},invoicing:{value:5,display:"Invoicing"},cancelling:{value:6,display:"Cancelling"},creditNoteRequesting:{value:7,display:"Credit Note Requesting"}}).constant("deliveryPointCategory",{one:{value:1,display:"A to 1 point"},two:{value:2,display:"A to 2 point"},five:{value:3,display:"A to 5 point"},ten:{value:4,display:"A to 10 point"},twenty:{value:5,display:"A to 20 point"},fifty:{value:6,display:"A to 50 point"},oneHundred:{value:7,display:"A to 100 point"},fourHundred:{value:8,display:"A to 400 point"}}).constant("adhocWeightCategory",{adhocUptoThreeKg:{value:1,display:"Up to 3kg"},adhocThreeToFourKg:{value:2,display:">3 - 4kg"},adhocFourToFiveKg:{value:3,display:">4 - 5kg"},adhocFiveToTenKg:{value:4,display:">5 - 10kg"},adhocTenToTwentyKg:{value:5,display:">10 - 20kg"},adhocAboveTwenty:{value:6,display:">20kg"}}).constant("milkRunWeightCategory",{milkrunUptoFiveKg:{value:7,display:"Up to 5kg"},milkrunFiveToTenKg:{value:8,display:"> 5 - 10kg"},milkrunThirtyToSixty:{value:9,display:"> 10 - 30kg"},milkrunTenToThirtyKg:{value:10,display:"> 30 - 60kg"},milkrunSixtyToHundred:{value:11,display:"> 60 - 100kg"}}).constant("defaultFixedRunPricing",e.defaultFixedRunPricing).constant("addNewItemReference",e.addNewItemReference).constant("healthCareWeightCategory",{adhocDocument:{value:12,display:"DOCUMENTS (X-Rays, case notes, medical records etc)"},adhocPharmaceutical:{value:13,display:"HOME DELIVERY (Pharmaceutical items)"},adhocSingpostMail:{value:14,display:"SINGPOST MAILS"},adhocParcel:{value:15,display:"PARCELS"},adhocInstrument:{value:16,display:"SOLID INSTRUMENTS"},adhocSpecimen:{value:17,display:"BLOOD SPECIMEN, HUMAN/ANIMAL SPECIMEN"}}).constant("healthCareFixedRunWeightCategory",{document:{value:18,display:"Documents / Parcel & Solid Instruments"},pharmaceutical:{value:19,display:"Pharmaceutical items / Home Delivery / TPN / PPI"},blood:{value:20,display:"Blood / Human Specimens"}}).constant("healthCareDeliveryTiming",{officeHour:{value:4,display:"Office Hours"},officeHourExpress:{value:5,display:"Office Hours (Express)"},weekdayEvening:{value:6,display:"After Office Hours"},weekdayEveningExpress:{value:7,display:"After Office Hours (Express)"},weekend:{value:8,display:"Late Night, Sun & PH"}}).constant("dashboardConst",{maxTickerItems:5}).constant("adhocProgress",{chosenAdhocType:1,collectionPoint:2,deliveryPoint:3,addItem:4,remark:5,confirmOrder:6}).constant("adhocPSSServiceType",{sameDay:{value:2,display:"Same Day Delivery"},nextDay:{value:3,display:"Next Day Delivery"},threeHour:{value:1,display:"3 Hour Delivery"}}).constant("adHocSurcharge",{weekdayEvening:{value:1,display:"Evening, Sat, Sun & Public Holiday"},nonworkingDay:{value:2,display:"Restricted Area"}}).constant("healthCareServiceNote",e.healthCareServiceNote).constant("adhocHealthCareServiceType",{hCOfficeHour:{value:5,display:"Office Hours"},hCOfficeHourExpress:{value:6,display:"Office Hours (Express)"},hCWeekdayEvening:{value:7,display:"After Office Hours"},hCWeekdayEveningExpress:{value:8,display:"After Office Hours (Express)"},hCWeekend:{value:9,display:"Late Night, Sun & PH"}}).constant("uomPSS",["Each","Carton","Bag","Box","Pallet"]).constant("uomHealthCare",["Each","Carton","Bag","Box","Pallet"]).constant("itemsHealthCare",["Documents (X-Rays, case notes, medical records etc)","Home delivery: Pharmaceutical items","Singpost Mails","Parcels","Solid Instruments","Blood/Blood Specimen/Human or Animal Specimen"]).constant("jobGridType",{milkRunJob:"milkRunJob",milkRunTransaction:"milkRunTransaction",adhocJob:"adhocJob",adhocTransaction:"adhocTransaction"}).constant("jobStatus",{pendingApproval:{value:1,display:"Pending Acceptance"},rejected:{value:2,display:"Rejected"},accepted:{value:3,display:"Accepted"},ongoing:{value:4,display:"On going"},delivered:{value:5,display:"Delivered"},deactivated:{value:6,display:"Deactivated"},onHold:{value:7,display:"OnHold"},cancelled:{value:8,display:"Cancelled"},readyToBill:{value:9,display:"Ready to Bill"},pendingRejection:{value:10,display:"Pending Rejection"},financeRejected:{value:11,display:"Finance Rejected"},billed:{value:12,display:"Billed"}}).constant("taskStatus",{pendingCollection:{value:1,display:"Pending Collection"},collecting:{value:2,display:"Collecting"},collected:{value:3,display:"Collected"},collectionFailed:{value:4,display:"Collection Failed"},delivering:{value:5,display:"Delivering"},delivered:{value:6,display:"Delivered"},deliverFailed:{value:7,display:"Delivery Failed"},pendingReturn:{value:8,display:"Pending Return"},returning:{value:9,display:"Returning"},returned:{value:10,display:"Returned"},pendingAssignment:{value:11,display:"Pending Assignment"},pendingDriverAssignment:{value:12,display:"Pending Driver Assignment"},onHold:{value:13,display:"On Hold"},readyToBill:{value:14,display:"Ready to Bill"},financeReject:{value:15,display:"Finance Reject"},billed:{value:16,display:"Billed"},pendingReject:{value:17,display:"To be rejected"}}).constant("cutOffTime",{case1:"case1",case2:"case2",case3:"case3"}).constant("customerDetailMode",{po:"po",sap:"sap",user:"user",cc:"cc"})}(),function(){"use strict";function e(e,t){e.when("/customers",{title:"Client Management",category:"Customers",controller:"CustomerController",templateUrl:"app/components/customer/customers.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]}).when("/customers/create",{title:"Create new client",category:"Customers",controller:"CustomerDetailController",templateUrl:"app/components/customer/detail.html",controllerAs:"vm",authorize:[t.Admin],preventViewOnly:!0}).when("/customers/detail/:id",{title:"Client detail",category:"Customers",controller:"CustomerDetailController",templateUrl:"app/components/customer/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]}).when("/example",{title:"Client detail",category:"Customers",controller:"ExampleController",templateUrl:"app/components/customer/example.html",controllerAs:"vm"})}function t(e,t,n,o){var i=this;function r(){i.isGridLoading=!0,n.getCustomerByCriteria(i.options).then((function(e){i.options.totalItems=e.data.totalCount,i.customers=n.convertListCustomer(e.data.customers),i.isGridLoading=!1}))}function a(e){t.path("/customers/detail/"+e.id)}i.systemRole=o,i.getCustomerByCriteria=r,i.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:""},i.gridConfig={onClickRowDetail:a,columns:[{name:"organizationCode",display:"Org Code",columnNameSort:"organizationCode",css:"col-md-2"},{name:"name",display:"Org Name",columnNameSort:"name",css:"col-md-2"},{name:"clientType",display:"Client Type",columnNameSort:"departmentId",css:"col-md-2"},{name:"address",display:"Address",columnNameSort:"address",css:"col-md-4"},{name:"sapCodesText",display:"SAP Code",columnNameSort:"sap",css:"col-md-2",isShowMore:!0}]},e.currentUser.role===o.Admin&&i.gridConfig.columns.splice(2,1),r()}function n(e,t,n,o,i,r,a,s,l){var c=this;c.systemRole=a,c.cancel=function(){c.clientDetail.id?(c.clientDetail=angular.copy(c.originalClient),c.viewMode=!0,c.orgCode=!1):n.path("/customers")},c.departments=o,c.pssAdhocPricing={},c.healthCareAdhocPricing={},c.newUser={},c.ids=[],c.saveCustomer=function(){var t=!!c.clientDetail.contractEndDate;e.currentUser.department===o.PSS.name&&(t=t&&c.clientDetail.cutOffTimeFor3HourDelivery&&c.clientDetail.cutOffTimeForSameDayPickupAndDelivery&&c.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery);t&&(c.isLoading=!0,c.orgCode=!1,i.saveCustomer(c.clientDetail).then((function(e){c.isLoading=!1;var t=c.clientDetail.id?"The client has been updated successfully.":"The client has been created successfully.";r.success(t),n.path("/customers")}),(function(e){c.isLoading=!1,"Organization code has been used already"==e.data.message?(c.orgCode=!0,s.createWarningPopup("Organization code has been used already","Warning",null,!0,"OK")):r.error(e.data.message)})))},c.addUserToCustomer=function(){c.clientDetail.id&&c.clientDetail.contractEndDate&&c.clientDetail.cutOffTimeForSameDayPickupAndDelivery&&c.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery&&(c.isLoading=!0,i.saveCustomer(c.clientDetail).then((function(e){r.success("The user has been added to this customer successfully."),i.getCustomerById(c.clientDetail.id).then((function(e){c.clientDetail=i.convertCustomer(e.data),c.isLoading=!1}),(function(){n.path("/accessDeny")}))})))},c.checkOrgCode=function(){i.checkOrgCodeExists(c.clientDetail.id||0,c.clientDetail.organizationCode).then((function(){c.orgCode=!1}),(function(){c.orgCode=!0}))},function(){l.loadGBizCode();var r=t.id;r?(c.isLoading=!0,i.getCustomerById(r).then((function(e){c.clientDetail=i.convertCustomer(e.data),c.originalClient=angular.copy(c.clientDetail),c.isLoading=!1}),(function(){n.path("/accessDeny")})),c.viewMode=!0):(c.clientDetail={address:{},department:{name:e.currentUser.department},clientTypeId:o[e.currentUser.department].id,sapCodes:[],pricings:[],cutOffTimeFor3HourDelivery:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),11,30,0,0),cutOffTimeForSameDayPickupAndDelivery:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),13,30,0,0),cutOffTimeForSameDayPickupAndNextDayDelivery:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),15,0,0,0)},c.viewMode=!1)}()}function o(e,t){var n=this;n.items=["Barcode","Organisation name","Organisation code","SAP code","Department","Requestor name","Requestor contact","Cost centre","Created date"],n.ngModel=["Organisation name","Organisation code","SAP code","Department","Requestor name","Requestor contact","Cost centre","Created date"],n.toggle=function(){n.isOpen=!n.isOpen},n.bindingCheck=function(e){return!!n.ngModel.find((function(t){return t===e}))},n.onCheck=function(e){for(var t=0;t<n.ngModel.length;t++)if(n.ngModel[t]===e)return void n.ngModel.splice(t,1);n.ngModel.push(id)}}angular.module("customer.module",["ngRoute"]).config(e).controller("CustomerController",t).controller("CustomerDetailController",n).controller("ExampleController",o),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$location","customerService","systemRole"],n.$inject=["$rootScope","$routeParams","$location","departments","customerService","toastr","systemRole","modalService","pricingService"],o.$inject=["fileReaderService","$timeout"]}(),function(){"use strict";function e(e,t,n,o,i,r){var a=this;function s(){a.milkRunPricingExist=l(t.MilkRun)>=0,a.adhocPricingExist=l(t.Adhoc)>=0,a.adhocExpresPricingExist=l(t.AdhocExpres)>=0}function l(e){for(var t=0;t<a.listPricing.length;t++)if(a.listPricing[t].pricingType===e)return t;return-1}function c(){g(a.adhocPricingModel)}function d(){g(a.adhocHealthCarePricingModel)}function u(){g(a.milkRunPricingModel)}function m(n){var i=l(n);return i>=0?angular.copy(a.listPricing[i]):n==t.MilkRun&&e.currentUser.department===o.PSS.name?{pricingType:t.MilkRun,weightCategories:r}:{pricingType:n}}function p(e,t,o){var i={setPricing:e};n.createPopup({templateUrl:o,size:"lg",data:t},i)}function g(e){var t=l(e.pricingType);t>=0?a.listPricing[t]=e:a.listPricing.push(e),s()}a.viewMode=a.viewMode||!1,a.pricingType=t,a.setPricing=function(t){e.currentUser.department===o.PSS.name?function(e){a.adhocPricingModel=m(e),l(e)<0&&function(e){for(var t in e.weightCategories=[],i)e.weightCategories.push({weightCategoryId:i[t].value,deliveryTimings:[{deliveryTimingId:1},{deliveryTimingId:2},{deliveryTimingId:3}]})}(a.adhocPricingModel);p(c,{ngModel:a.adhocPricingModel,viewMode:a.viewMode},"app/components/customer/pricing/adhocPricingModal.html")}(t):function(e){a.adhocHealthCarePricingModel=m(e),p(d,{ngModel:a.adhocHealthCarePricingModel,viewMode:a.viewMode},"app/components/customer/pricing/healthCarePricingModal.html")}(t)},a.setMilkRunPricing=function(){a.milkRunPricingModel=m(t.MilkRun),a.milkRunPricingModel.viewMode=a.viewMode,p(u,a.milkRunPricingModel,"app/components/customer/pricing/milkRunPricingAdvanceModal.html")},a.checkSetPricing=function(e,t){if(a[t])a[t]=!1,n.createWarningPopup("Please set pricing for this service first!","Warning",null,!0);else{var o=l(e);o>=0&&a.listPricing.splice(o,1)}},a.listPricing=a.listPricing||[],s()}angular.module("customer.module").directive("customerPricing",(function(){return{restrict:"E",scope:{viewMode:"=",listPricing:"="},templateUrl:"app/components/customer/pricing/customerPricing.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$rootScope","pricingType","modalService","departments","adhocWeightCategory","defaultFixedRunPricing"]}(),function(){"use strict";function e(e,t){var n=this;function o(){n.listSap.push(n.newSap)}function i(){n.listSap[n.currentIndex]=n.sapDetail}function r(t,n){e.createPopup({templateUrl:"app/components/customer/sap/sapDetail.html",size:"lg",data:{ngModel:t}},n)}n.listSap=n.listSap||[],n.addNewSap=function(){n.newSap={userIds:[]};var e={onCreateOrUpdate:o};r(n.newSap,e)},n.removeSap=function(e){n.listSap.splice(e,1)},n.viewSapDetail=function(e){var t={onCreateOrUpdate:i};n.currentIndex=n.listSap.indexOf(e),n.sapDetail=angular.copy(e),r(n.sapDetail,t)},n.systemRole=t,n.currentIndex=-1}angular.module("customer.module").directive("customerSap",(function(){return{restrict:"E",scope:{listSap:"="},templateUrl:"app/components/customer/sap/customerSap.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["modalService","systemRole"]}(),function(){"use strict";function e(e){var t=this;t.systemRole=e,t.viewMode=!!t.sapDetail.id}angular.module("customer.module").directive("sapDetail",(function(){return{restrict:"E",scope:{sapDetail:"=",onCreateOrUpdate:"&",onCancel:"&"},templateUrl:"app/components/customer/sap/sapDetail/sapDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["systemRole"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s){var l=this;l.listUser=l.listUser||[],l.addNew=function(){c[l.displayMode]()},l.viewUserDetail=function(e){l.userDetail=angular.copy(e),l.userDetail.customerId=l.clientDetail.id,g(l.userDetail,!0)},l.viewSapDetail=function(e){l.sapDetail=angular.copy(e),l.sapDetail.customerId=l.clientDetail.id,f(l.sapDetail)},l.viewPoDetail=function(e){l.poDetail=angular.copy(e),l.poDetail.detailName=e.number,l.poDetail.customerId=l.clientDetail.id,h(l.poDetail)},l.viewCostCenterDetail=function(e){l.costCenterDetail=angular.copy(e),l.costCenterDetail.detailName=e.name,l.costCenterDetail.customerId=l.clientDetail.id,y(l.costCenterDetail)},l.systemRole=t,l.customerDetailMode=n,l.displayMode=n.user,l.switchDisplay=function(e){l.displayMode=e,l.onSearch[l.displayMode]()},l.searchTerm="",l.placeHolder={po:"Search by PO number",sap:"Search by SAP code",user:"Search by name, SBU, SAP and contact no",cc:"Search by SBU"},l.search=function(){a((function(){l.onSearch[l.displayMode](!0)}))},l.onSearch={};var c={po:function(){l.poDetail={customerId:l.clientDetail.id,userIds:[]},h(l.poDetail)},sap:function(){l.sapDetail={customerId:l.clientDetail.id,userIds:[]},f(l.sapDetail)},cc:function(){l.costCenterDetail={customerId:l.clientDetail.id,userIds:[]},y(l.costCenterDetail)},user:function(){l.userDetail={customerId:l.clientDetail.id},g(l.userDetail,!1)}};function d(){l.isLoading=!0,o.saveSapCode(l.sapDetail).then((function(e){var t=l.sapDetail.id?"The sap code has been updated successfully.":"The sap code has been created successfully.";C(),i.success(t)}),(function(e){l.isLoading=!1,i.error(e.data.message)}))}function u(){l.isLoading=!0,r.saveUser(l.userDetail).then((function(e){var t=l.userDetail.id?"The user has been updated successfully.":"The user has been created successfully.";C(),i.success(t)}),(function(e){l.isLoading=!1,i.error(e.data.message)}))}function m(){l.isLoading=!0,o.savePoNumber(l.poDetail).then((function(e){var t=l.poDetail.id?"The PO number has been updated successfully.":"The PO number has been created successfully.";C(),i.success(t)}),(function(e){l.isLoading=!1,i.error(e.data.message)}))}function p(){l.isLoading=!0,o.saveCostCenter(l.costCenterDetail).then((function(e){var t=l.costCenterDetail.id?"The SBU has been updated successfully.":"The SBU has been created successfully.";C(),i.success(t)}),(function(e){l.isLoading=!1,i.error(e.data.message)}))}function g(t,n){var o={onCreateOrUpdate:u,onActivateOrDeactivate:v};e.createPopup({templateUrl:"app/components/customer/user/userDetail.html",size:"lg",data:{ngModel:t,poNumbers:l.clientDetail.poNumbers,sapCodes:angular.copy(l.clientDetail.sapCodes),costCenters:l.clientDetail.costCentres,viewMode:n}},o)}function v(){for(var e=0;e<l.clientDetail.users.length;e++)if(l.clientDetail.users[e].id===l.userDetail.id){l.clientDetail.users[e].lockoutEnabled=!l.clientDetail.users[e].lockoutEnabled;break}l.onSearch[l.displayMode](!0)}function f(n){var o={onCreateOrUpdate:d};e.createPopup({templateUrl:"app/components/customer/sap/sapDetail.html",size:"lg",data:{ngModel:n,viewMode:s.currentUser.role===t.SuperAdmin}},o)}function h(n){var o={onCreateOrUpdate:m};e.createPopup({templateUrl:"app/components/customer/poCc/poModal.html",size:"lg",data:{ngModel:n,users:l.clientDetail.users,isPo:!0,viewMode:s.currentUser.role===t.SuperAdmin}},o)}function y(n){var o={onCreateOrUpdate:p};e.createPopup({templateUrl:"app/components/customer/poCc/poModal.html",size:"lg",data:{ngModel:n,users:l.clientDetail.users,isPo:!1,viewMode:s.currentUser.role===t.SuperAdmin}},o)}function C(){o.getCustomerById(l.clientDetail.id).then((function(e){l.clientDetail.users=e.data.applicationUsers,l.clientDetail.sapCodes=e.data.sapCodes,l.clientDetail.poNumbers=e.data.poNumbers,l.clientDetail.costCentres=e.data.costCentres,l.isLoading=!1,l.onSearch[l.displayMode](!0)}))}}angular.module("customer.module").directive("sectionDetail",(function(){return{restrict:"E",scope:{clientDetail:"="},templateUrl:"app/components/customer/sectionDetail/sectionDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["modalService","systemRole","customerDetailMode","customerService","toastr","clientUserService","$timeout","$rootScope"]}(),function(){"use strict";function e(e,t){var n=this;function o(e){n.listUser=i(e,"userCriteria",n.clientDetail.users,(function(e){return(e.firstName+" "+e.lastName).toLowerCase().indexOf(n.searchTerm.toLowerCase())>-1||e.phoneNumber.indexOf(n.searchTerm)>-1||e.sapCode&&e.sapCode.toLowerCase().indexOf(n.searchTerm.toLowerCase())>-1||e.costCentres&&e.costCentres.toLowerCase().indexOf(n.searchTerm.toLowerCase())>-1}))}function i(e,t,o,i){e&&(n[t].currentPage=1);var r=n[t].currentPage-1,a=o.filter(i);n[t].totalItem=a.length;var s=n[t].sortAscending?1:-1,l=n[t].sortColumn;return l&&a.sort((function(e,t){var n=e[l]?e[l].toLowerCase():e[l],o=t[l]?t[l].toLowerCase():t[l];return n>o?1*s:n<o?-1*s:0})),a=a.slice(r*n[t].itemPerPage,r*n[t].itemPerPage+n[t].itemPerPage)}n.setItemPerPage=t,n.poColumns=[{display:"PO",columnNameSort:"number"},{display:"Users",preventSort:!0}],n.sbuColumns=[{display:"SBU",columnNameSort:"name"},{display:"Users",preventSort:!0}],n.sapColumns=[{display:"SAP code",columnNameSort:"code"},{display:"Billing address",preventSort:!0},{display:"Attention to",preventSort:!0},{display:"Users",preventSort:!0}],n.userColumns=[{display:"Name",columnNameSort:"firstName"},{display:"Email",columnNameSort:"email"},{display:"Contact no",columnNameSort:"phoneNumber"},{display:"Billing address",preventSort:!0},{display:"Working address",preventSort:!0},{display:"SBU",columnNameSort:"costCentres"},{display:"SAP",columnNameSort:"sapCode"},{display:"Status",preventSort:!0}],n.userCriteria={currentPage:1,itemPerPage:20,sortColumn:"",sortAscending:!0},n.ccCriteria={currentPage:1,itemPerPage:20},n.poCriteria={currentPage:1,itemPerPage:20,sortColumn:"",sortAscending:!0},n.sapCriteria={currentPage:1,itemPerPage:20,sortColumn:"",sortAscending:!0},n.customerDetailMode=e,n.getBillingAddress=function(e){var t=n.clientDetail.sapCodes.find((function(t){return t.id===e}));return t?t.blockNumber+" "+t.streetName+" "+t.unitNumber+" "+t.postalCode:""},n.getUserByCriteria=n.onSearch[e.user]=o,n.getPoByCriteria=n.onSearch[e.po]=function(e){n.listPo=i(e,"poCriteria",n.clientDetail.poNumbers,(function(e){return e.number.toLowerCase().indexOf(n.searchTerm.toLowerCase())>-1}))},n.getSapByCriteria=n.onSearch[e.sap]=function(e){n.listSap=i(e,"sapCriteria",n.clientDetail.sapCodes,(function(e){return e.code.toLowerCase().indexOf(n.searchTerm.toLowerCase())>-1}))},n.getCcByCriteria=n.onSearch[e.cc]=function(e){n.listCc=i(e,"ccCriteria",n.clientDetail.costCentres,(function(e){return e.name.toLowerCase().indexOf(n.searchTerm.toLowerCase())>-1}))},o()}angular.module("customer.module").directive("detailUserSap",(function(){return{restrict:"E",scope:{displayMode:"=",viewSapDetail:"&",viewPoDetail:"&",viewUserDetail:"&",viewCostCenterDetail:"&",clientDetail:"=",searchTerm:"=",onSearch:"="},templateUrl:"app/components/customer/sectionDetail/detailUserSap.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["customerDetailMode","setItemPerPage"]}(),function(){"use strict";function e(e){var t=this;t.systemRole=e,t.isCheckAll=!1,t.searchTerm="",t.bindingCheck=function(e){return!!t.detail.userIds.find((function(t){return t===e}))},t.onCheck=function(e){t.isCheckAll=!1;for(var n=0;n<t.detail.userIds.length;n++)if(t.detail.userIds[n]===e)return void t.detail.userIds.splice(n,1);t.detail.userIds.push(e)},t.selectAll=function(){t.isCheckAll=!t.isCheckAll,t.isCheckAll?t.filteredUsers.forEach((function(e){-1===t.detail.userIds.indexOf(e.id)&&t.detail.userIds.push(e.id)})):t.filteredUsers.forEach((function(e){var n=t.detail.userIds.indexOf(e.id);n>-1&&t.detail.userIds.splice(n,1)}))},t.filter=function(){t.isCheckAll=!1,t.filteredUsers=t.users.filter((function(e){return(e.firstName+" "+e.lastName).toLowerCase().indexOf(t.searchTerm.toLowerCase())>-1}))},t.isJob||(t.viewMode=!!t.detail.id,t.filteredUsers=angular.copy(t.users))}angular.module("customer.module").directive("poCc",(function(){return{restrict:"E",scope:{detail:"=?",users:"=?",onCreateOrUpdate:"&",onCancel:"&",isPo:"=",isJob:"="},templateUrl:"app/components/customer/poCc/poCcDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["systemRole"]}(),function(){"use strict";function e(e,t,n){var o=this;function i(){o.filterItems=o.source.filter((function(e){return!!(e[o.fieldKey].toLowerCase().indexOf(o.searchTerm.toLowerCase())>-1&&-1===o.ngModel.indexOf(e.id))}))}function r(e){o.ngModel.push(e.id),o.searchTerm="",o.isOpen=!1}o.search=i,o.onSelect=r,o.onRemove=function(e){o.ngModel.splice(e,1)},o.getValue=function(e){var t=o.source.find((function(t){return t.id===e}));return t?t[o.fieldKey]:""},o.setFocus=function(){i(),o.isOpen=!0,o.isFocus=!0,document.getElementById("input-"+e.$id).focus()},o.onBlur=function(){o.isOpen=!1,o.isFocus=!1},o.onCreate=function(){o.isLoading=!0,t.createPoOrCC({name:o.searchTerm,customerId:o.customerId,userIds:[]},o.isPo).then((function(e){o.isLoading=!1,o.source.push(e.data),r(e.data),n.success("The "+(o.isPo?"PO":"SBU")+" has been created successfully.")}),(function(e){o.isLoading=!1,n.error(e.data.message)}))},o.searchTerm="",o.ngModel=o.ngModel||[],o.source=o.source||[]}angular.module("customer.module").directive("multiSelect",(function(){return{restrict:"E",scope:{source:"=?",ngModel:"=?",isError:"=?",fieldName:"=?",fieldKey:"=?",isPo:"=?",customerId:"="},templateUrl:"app/components/customer/multiselect/multiselect.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$scope","customerService","toastr"]}(),function(){"use strict";function e(e){e.when("/dashboard",{title:"Dashboard",category:"Dashboard",controller:"DashboardController",templateUrl:"app/components/dashboard/dashboard.html",controllerAs:"vm",authorize:["Admin","User"],hideNavbar:!0,showHeaderDashboardControls:!0,hideFooter:!0,noContainer:!0,darkBg:!0})}function t(e,t,n,o,i,r,a,s,l,c,d,u,m,p,g,v,f,h,y,C){var b=this,k=function(){return document.querySelector(".header")},D=document.querySelector(".dashboard__schedule-calendar-wrap"),M=document.querySelector(".dashboard__heading"),P=document.querySelector(".dashboard__donuts-container"),A=document.querySelector(".dashboard__chart-heading");function S(){i((function(){N()}))}function T(e){var t=e.target,n=angular.element(t),o=D.contains(t)&&n.hasClass("uib-left"),l=D.contains(t)&&n.hasClass("uib-right"),c=n.parent().hasClass("dashboard__schedule-calendar-date");o?$("prev"):l?$("next"):c&&i((function(){var e=0===b.jobType?"adhocs/transactions":"milkruns/transactions";r.path(e).search({jobDate:a("date")(new Date(b.calendar.model),s.simpleDateFormat)})}))}function R(){var e=k(),t=e?e.clientHeight:0;b.scheduleHeight=n.innerHeight-t-34-10}function I(){b.scheduleJobsStyles={height:b.scheduleHeight-D.clientHeight-52+"px"}}function N(){var e,t;R(),I(),e=k(),t=e?e.clientHeight:0,b.spendingsGraphHeight=n.innerHeight-t-34-C.getAbsoluteElHeight(M)-C.getAbsoluteElHeight(P)-C.getAbsoluteElHeight(A)-10,O()}function w(e,t){e.isOpen="boolean"==typeof t||"true"===t||"false"===t?t:!e.isOpen}function U(){l.getSummary(b.dateRange.startDate.model,b.dateRange.endDate.model,b.jobType).then((function(e){b.summaryCounts=e.data}),(function(e){console.warn(e)}))}function j(){var e={status:v.pendingApproval.value};switch(b.jobType){case 0:h.getAdhocByCriteria(e).then((function(e){b.pendingJobsCount=e.data.totalCount}),(function(e){console.warn(e)})).finally((function(){b.pendingJobsLoading=!1,i((function(){N()}))}));break;case 1:y.getMilkRunByCriteria(e).then((function(e){b.pendingJobsCount=e.data.totalCount}),(function(e){console.warn(e)})).finally((function(){b.pendingJobsLoading=!1,i((function(){N()}))}))}}function x(){var e=new Date(b.calendar.yearInView+"-"+b.calendar.monthInView+"-01");b.daysWithJobsLoading=!0,l.getDaysOfMonthWithJobs(e,b.jobType).then((function(e){b.daysWithJobs=e}),(function(e){console.warn(e)})).finally((function(){b.daysWithJobsLoading=!1,i((function(){R(),I(),angular.element(document.querySelector(".dashboard__schedule-calendar tbody .uib-weeks:nth-child(2) .btn")).triggerHandler("click")}))}))}function $(e){i((function(){"prev"===e?b.calendar.monthInView-=1:b.calendar.monthInView+=1,b.calendar.monthInView<1?(b.calendar.yearInView-=1,b.calendar.monthInView=12):b.calendar.monthInView>12&&(b.calendar.yearInView+=1,b.calendar.monthInView=1),x()}))}function E(){b.todaysJobsLoading=!0;var e={jobDate:new Date};switch(b.jobType){case 0:m.getAdhocTaskByCriteria(e).then((function(e){b.todaysJobs=e.data.jobTasks}),(function(e){console.warn(e)})).finally((function(){b.todaysJobsLoading=!1,i(O,100)}));break;case 1:m.getMilkRunTaskByCriteria(e).then((function(e){b.todaysJobs=e.data.milkRunTasks}),(function(e){console.warn(e)})).finally((function(){b.todaysJobsLoading=!1,i(O,100)}))}}function O(){e.$broadcast("dashboard:scrollbar:rebuild")}switch(b.jobType=parseInt(e.headerSelectedJob),b.jobTypeNames=["Ad Hoc","Fixed Run"],b.goToJobDetail=function(e){var t=0===b.jobType?"adhocTask/":"milkrunTask/";r.path(t+e)},e.$watch("headerSelectedJob",(function(t,n){void 0!==t&&parseInt(e.headerSelectedJob)!==b.jobType&&(b.jobType=parseInt(e.headerSelectedJob),L(),E(),U(),x(),j())})),i((function(){N()})),angular.element(n).on("resize",S),angular.element(o).on("click",T),t.$on("$destroy",(function(){angular.element(n).off("resize",S),angular.element(o).off("click",T)})),b.tickerShowCta="Admin"===e.currentUser.role,b.tickerCtaLink=g[e.currentUser.role].cmsRoute?"#"+g[e.currentUser.role].cmsRoute:"#"+e.indexRoute,b.tickerItems=[],l.getTrafficUpdates().then((function(e){b.tickerItems=e}),(function(e){console.warn(e)})),b.datepickerConfig={showWeeks:!1},b.dateRange={startDate:{model:null,isOpen:!1,toggleOpen:function(e){w(this,e)},onChange:U},endDate:{model:null,isOpen:!1,toggleOpen:function(e){w(this,e)},onChange:U}},b.summaryCountsConfig={duration:1500},b.summaryCounts={approved:0,rejected:0,completed:0,scheduled:0},U(),b.pendingJobsLoading=e.currentUser.role===p.Admin,b.pendingJobsCount=0,b.clickPendingBarButton=function(){var e=0===b.jobType?"adhocs/jobs":"milkruns/jobs";r.path(e).search({status:v.pendingApproval.value})},j(),b.daysWithJobsLoading=!0,b.daysWithJobs={},b.calendar={model:"",monthInView:(new Date).getMonth()+1,yearInView:(new Date).getFullYear(),initialLoad:!0,opts:{showWeeks:!1,formatDayTitle:"yyyy MMM",formatDay:"d",formatDayHeader:"EEE",datepickerMode:"day",maxMode:"day",minMode:"day",customClass:function(e){var t=e.date;if("day"===e.mode){var n=["dashboard__schedule-calendar-date"],o=new Date,i=new Date(t),r=i.getFullYear()+"-"+(i.getMonth()+1);return void 0!==b.daysWithJobs[b.jobType]&&void 0!==b.daysWithJobs[b.jobType][r]&&b.daysWithJobs[b.jobType][r].indexOf(i.getDate())>-1&&n.push("date-has-jobs"),i.setHours(0,0,0,0)===o.setHours(0,0,0,0)&&n.push("date-today"),n.push("date-y-"+i.getFullYear()+"-m-"+(i.getMonth()+1)+"-d-"+i.getDate()),n.join(" ")}return""}}},x(),b.todaysJobsLoading=!0,b.todaysJobs=[],E(),b.rebuildTodaysJobsScrollbar=O,b.chartSelection,b.chartSelectionList=[],e.currentUser.role){case p.Admin:b.chartSelectionList=[{id:-1,label:"All customers"}],d.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then((function(e){var t=_.map(e.data.customers,(function(e){return{id:e.id,label:e.name}}));b.chartSelectionList=b.chartSelectionList.concat(t),b.chartSelection=b.chartSelectionList[0]}),(function(e){console.warn(e)}));break;case p.User:b.chartSelectionList=[{id:-1,label:"All SBU"}],u.getClientUserById(e.currentUser.id).then((function(e){var t=_.map(e.data.costCentre?e.data.costCentre.split(","):[],(function(e){return{id:e,label:e}}));b.chartSelectionList=b.chartSelectionList.concat(t),b.chartSelection=b.chartSelectionList[0]}),(function(e){console.warn(e)}))}function L(){var t=void 0===b.chartSelection||-1===b.chartSelection.id?void 0:b.chartSelection.id;switch(e.currentUser.role){case"Admin":l.getSpending(b.jobType,t).then((function(e){b.spendings=e.data}),(function(e){console.warn(e)}));break;case"User":l.getSpending(b.jobType,e.currentUser.id,t).then((function(e){b.spendings=e.data}),(function(e){console.warn(e)}))}}b.onChartSelectionChange=function(){L()},b.spendings=[],L(),b.getTextStatus=function(e){for(var t in f)if(f[t].value===e)return f[t].display;return"N/A"}}angular.module("dashboard.module",["ngRoute"]).config(e).controller("DashboardController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$scope","$window","$document","$timeout","$location","$filter","systemSetting","dashboardService","dashboardConst","customerService","clientUserService","taskService","systemRole","systemRolesConfigs","jobStatus","taskStatus","adhocService","milkrunService","utilityService"]}(),function(){"use strict";function e(e){e.when("/users",{title:"User management",category:"Users",controller:"SpAdminUserController",templateUrl:"app/components/spAdminUser/users.html",controllerAs:"vm",authorize:["SuperAdmin"]}).when("/users/create",{title:"New admin",category:"Users",controller:"SpAdminUserDetailController",templateUrl:"app/components/spAdminUser/detail.html",controllerAs:"vm",authorize:["SuperAdmin"]}).when("/users/detail/:id",{title:"Admin detail",category:"Users",controller:"SpAdminUserDetailController",templateUrl:"app/components/spAdminUser/detail.html",controllerAs:"vm",authorize:["SuperAdmin"]})}function t(e,t,n){var o=this;function i(){o.isGridLoading=!0,t.getAdminUserByCriteria(o.options).then((function(e){o.options.totalItems=e.data.totalCount;var t=e.data.users;angular.forEach(t,(function(e){e.name=e.firstName+" "+e.lastName,e.status=e.lockoutEnabled?"Inactive":"Active"})),o.users=t,o.isGridLoading=!1}))}function r(t){"Finance"===t.roleName?e.path("/finance-users/detail/"+t.id):e.path("/users/detail/"+t.id)}o.getAdminUserByCriteria=i,o.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",department:"",roles:"Finance,Admin"},o.gridConfig={onClickRowDetail:r,columns:[{name:"name",display:"Name",columnNameSort:"firstName"},{name:"email",display:"Email",columnNameSort:"email"},{name:"phoneNumber",display:"Contact number",columnNameSort:"phoneNumber"},{name:"roleName",display:"Role",preventSort:!0},{name:"departmentName",display:"Department",preventSort:!0},{name:"status",display:"Status",columnNameSort:"lockoutEnabled"}]},o.departments=[{id:"",name:"All"},n.PSS,n.Healthcare],o.roles=[{id:"Finance,Admin",name:"All"},{id:"Admin",name:"Admin"},{id:"Finance",name:"Finance"}],i()}function n(e,t,n,o,i,r){var a=this;function s(){n.activateOrDeactivate(a.userDetail).then((function(e){var t=a.userDetail.lockoutEnabled?"The admin has been activated successfully.":"The admin has been deactivated successfully.";a.userDetail.lockoutEnabled=!a.userDetail.lockoutEnabled,i.success(t)}))}a.departments=[{id:void 0,name:"Please select ..."},o.PSS,o.Healthcare],a.roles=[{text:"Please select ...",value:void 0},{text:"Full Access Admin",value:"false"},{text:"View Only Admin",value:"true"}],a.edit=function(){a.viewMode=!1},a.save=function(){a.isSaving=!0,a.userDetail.viewOnly="true"===a.userDetail.adminType,n.saveAdminUser(a.userDetail).then((function(e){a.isSaving=!1;var n=a.userDetail.id?"The admin has been updated successfully.":"The admin has been created successfully.";i.success(n),t.path("/users")}),(function(e){a.isSaving=!1}))},a.activateOrDeactivate=function(){var e=a.userDetail.lockoutEnabled?"Are you sure you want to activate this admin?":"Are you sure you want to deactivate this admin?";r.createWarningPopup(e,"Warning",s)},a.checkEmailExist=function(){if(!a.userDetail||a.userDetail.id&&a.userDetail.email===a.originalEmail)return;n.checkEmailExist(a.userDetail.email).then((function(e){a.emailExist=!0}),(function(e){a.emailExist=!1}))},function(){var t=e.id;t?(n.getAdminUserById(t).then((function(e){a.userDetail=e.data,a.userDetail.adminType=a.userDetail.viewOnly.toString(),a.originalEmail=a.userDetail.email})),a.viewMode=!0):a.viewMode=!1}()}angular.module("spAdminUser.module",["ngRoute"]).config(e).controller("SpAdminUserController",t).controller("SpAdminUserDetailController",n),e.$inject=["$routeProvider"],t.$inject=["$location","adminUserService","departments"],n.$inject=["$routeParams","$location","adminUserService","departments","toastr","modalService"]}(),function(){"use strict";function e(e){e.when("/login",{title:"Login",controller:"AccountController",templateUrl:"app/components/account/login.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0}).when("/account/forgot",{title:"Forgot password",controller:"AccountController",templateUrl:"app/components/account/forgot.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0}).when("/reset",{title:"Reset password",controller:"ResetController",templateUrl:"app/components/account/reset.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0}).when("/account/activate",{title:"Activate account",controller:"AccountController",templateUrl:"app/components/account/activate.html",controllerAs:"vm",hideHeader:!0,alignFooter:"left",stickyFooter:!0})}function t(e,t,n,o){var i=this;i.login=function(){if(!i.email||!i.password)return i.wrongPassword=!0,void(i.errorMessage="Please enter username and password.");i.isLoginInProgress=!0,t.login(i.email,i.password).then((function(t){var r;i.isLoginInProgress=!1,r=t,e.currentUser=r,e.indexRoute="#"+o[e.currentUser.role].defaultRoute,n.path("/"+o[e.currentUser.role].defaultRoute)})).catch((function(e){i.password="",i.isLoginInProgress=!1,i.wrongPassword=!0,i.errorMessage=e.data.message,"Account has been locked out"===i.errorMessage&&(i.errorMessage="This account has been deactivated")}))},i.activateAccount=function(){n.path("/login")},i.resetPassword=function(){if(!i.email)return void(i.wrongPassword=!0);i.isLoading=!0,t.resetPassword(i.email).then((function(e){i.isLoading=!1,i.isSentResetPassword=!0})).catch((function(e){i.isLoading=!1,i.userNotFound=!0,i.errorMessage=e.data.message,i.isSentResetPassword=!1}))},i.password="",i.isLoginInProgress=!1,i.wrongPassword=!1}function n(e,t,n){var o=this;o.updatePassword=function(){o.resetModel.resetPasswordToken=t.search().token.replace(/ /g,"+"),o.resetModel.userId=t.search().userId,e.confirmResetPassword(o.resetModel).then((function(e){t.url(t.path()),t.path("/login"),n.success("Reset password successfully")})).catch((function(e){n.error(e.data.message)}))}}angular.module("account.module",["ngRoute"]).config(e).controller("AccountController",t).controller("ResetController",n),e.$inject=["$routeProvider"],t.$inject=["$rootScope","authService","$location","systemRolesConfigs"],n.$inject=["authService","$location","toastr"]}(),function(){"use strict";function e(e){e.when("/clientUsers",{title:"User Client management",category:"Users",controller:"AdminUserController",templateUrl:"app/components/adminUser/clientUsers.html",controllerAs:"vm",authorize:["Admin","User"]})}function t(e,t,n,o,i,r){var a=this;function s(){a.isGridLoading=!0,n.getClientUserByCriteria(a.options).then((function(e){a.options.totalItems=e.data.totalCount,a.users=n.convertListUser(e.data.users),a.isGridLoading=!1}))}function l(o){e.currentUser.role===i.User||e.currentUser.viewOnly||(a.isGridLoading=!0,r.getCustomerById(o.customerId).then((function(e){n.getClientUserById(o.id).then((function(n){a.isGridLoading=!1,a.userDetail=n.data;var o={onCreateOrUpdate:c,onActivateOrDeactivate:s};!function(e,n){t.createPopup({templateUrl:"app/components/customer/user/userDetail.html",size:"lg",data:e},n)}({ngModel:a.userDetail,poNumbers:e.data.poNumbers,sapCodes:e.data.sapCodes,costCenters:e.data.costCentres,viewMode:!0},o)}))})))}function c(){a.isGridLoading=!0,n.updateClientUser(a.userDetail).then((function(e){o.success("The user has been updated successfully."),s()}))}a.userDetail={},a.getUserByCriteria=s,a.openDetailModal=l,a.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",department:e.currentUser.department},a.gridConfig={onClickRowDetail:l,class:"user-client-table",columns:[{name:"name",display:"Name",columnNameSort:"name"},{name:"email",display:"Email",columnNameSort:"email"},{name:"phoneNumber",display:"Contact no",columnNameSort:"contact"},{name:"costCentres",display:"SBU",columnNameSort:"sbu"},{name:"sapCode",display:"SAP",columnNameSort:"sap"},{name:"organizationCode",display:"Org code",columnNameSort:"organizationCode"},{name:"status",display:"Status",preventSort:!0}]},e.currentUser.role===i.User?n.getClientUserById(e.currentUser.id).then((function(e){a.options.organizationCode=e.data.organizationCode,s()})):s()}angular.module("adminUser.module",["ngRoute"]).config(e).controller("AdminUserController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","modalService","clientUserService","toastr","systemRole","customerService"]}(),function(){"use strict";function e(e,t){e.when("/milkruns/:view?/:jobId?",{title:"Fixed Run",category:"MilkrunTransactions",controller:"MilkrunManagementController",templateUrl:"app/components/milkrun/milkruns.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]}).when("/milkrun/create",{title:"Create new Fixed Run",category:"MilkrunTransactions",controller:"MilkRunDetailController",templateUrl:"app/components/milkrun/detail.html",controllerAs:"vm",authorize:[t.Admin,t.User],preventViewOnly:!0,resolve:{checkContractDateExpire:o}}).when("/milkrun/detail/:id",{title:"Fixed Run detail",category:"MilkrunTransactions",controller:"MilkRunDetailController",templateUrl:"app/components/milkrun/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]})}function t(e,t,n,o,i,r,a,s){var l,c,d=this;function u(){d.isLoading=!0,o.getMilkRunByCriteria(d.options).then((function(e){d.listMilkRun=o.convertListMilkRun(e.data.milkRuns),d.options.totalItems=e.data.totalCount,d.isLoading=!1}))}function m(){d.isLoading=!0,s.getMilkRunTaskByCriteria(d.transactionOptions).then((function(e){d.listMilkRunTask=s.convertListMilkRunTask(e.data.milkRunTasks),d.transactionOptions.totalItems=e.data.totalCount,d.isLoading=!1}))}function p(){d.isJob?u():m()}d.isJob="transactions"!==t.view,d.jobStatusType=i,d.systemRole=r,d.jobGridType=a,d.getMilkRunByCriteria=u,d.getMilkRunTaskByCriteria=m,d.switchDisplayJob=function(e){d.isJob=e,p(),n.path(e?"/milkruns/jobs":"/milkruns/transactions")},l=void 0!==n.search().jobDate&&n.search().jobDate.length>0?new Date(n.search().jobDate):"",c=void 0!==n.search().status&&isFinite(n.search().status)?n.search().status:"",d.options={itemPerPage:20,currentPage:1,customer:"",status:c,requestType:"",hasPo:""},d.transactionOptions={itemPerPage:20,currentPage:1,customer:"",status:"",requestType:"",jobDate:l,vendor:"",jobId:t.jobId},d.gridConfig={columns:[{name:"id",display:"ID"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"frequency",display:"Frequency"},{name:"status",display:"Status"},{name:"poNumber",display:"PO"},{name:"collectionPoints",display:"Collection point"},{name:"deliveryPoints",display:"Delivery point"},{name:"createdBy",display:"Created by"}]},d.gridConfigTransation={columns:[{name:"barcode",display:"Barcode"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"frequency",display:"Frequency"},{name:"status",display:"Status"},{name:"jobDate",display:"Job date"},{name:"collectionPoints",display:"Collection point"},{name:"deliveryPoints",display:"Delivery point"},{name:"vendor",display:"Vendor name"},{name:"createdBy",display:"Created by"}]},e.currentUser&&e.currentUser.role===r.User&&(d.gridConfig.columns.splice(1,1),d.gridConfigTransation.columns.splice(1,1),d.gridConfigTransation.columns.splice(7,1)),p()}function n(e,t,n,o,i,r,a,s,l){var c=this;function d(){c.viewMode=!0,c.loadingDetail=!0,o.getMilkRunById(t.id).then((function(e){c.milkrunDetail=o.convertMilkRun(e.data),c.originalJob=angular.copy(c.milkrunDetail),c.loadingDetail=!1,c.canEdit=c.milkrunDetail.jobStatus!==r.readyToBill.value&&c.milkrunDetail.jobStatus!==r.pendingRejection.value&&c.milkrunDetail.jobStatus!==r.billed.value}),(function(){i.path("/accessDeny")}))}c.systemRole=n,c.milkRunTypes=e,c.jobStatus=r,c.getJobDetail=d,c.cancel=function(){c.milkrunDetail=angular.copy(c.originalJob)},c.cancelJob=function(){c.cancelData={jobId:c.milkrunDetail.id,cancelDate:new Date,charge:0},s.createPopup({templateUrl:"app/components/milkrun/cancelJobModal.html",size:"md",data:c.cancelData},{onCancel:function(){c.isLoading=!0,o.cancelJob(c.cancelData).then((function(e){d(),a.success("This job has been canceled successfully!"),c.isLoading=!1}),(function(e){a.error(e.data.message),c.isLoading=!1}))}})},l.loadGBizCode(),t.id?d():(c.viewMode=!1,c.milkrunDetail={milkRunType:e.oneToOne,jobBillingType:1,collectionPoints:[{editMode:!0}],deliveryPoints:[{editMode:!0}]})}function o(e,t,n,o,i){e.currentUser.role===i.User&&o.checkContractExpire(e.currentUser.customerId).then((function(e){e&&(n.createWarningPopup("Unable to create new jobs, Please contact STLogs Admin.","Warning",null,!0,"OK"),t.history.back())}))}angular.module("milkRun.module",["ngRoute"]).config(e).controller("MilkrunManagementController",t).controller("MilkRunDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$routeParams","$location","milkrunService","jobStatusType","systemRole","jobGridType","taskService"],n.$inject=["milkRunTypes","$routeParams","systemRole","milkrunService","$location","jobStatus","toastr","modalService","pricingService"],o.$inject=["$rootScope","$window","modalService","customerService","systemRole"]}(),function(){"use strict";function e(e){e.when("/logs",{title:"Logs management",category:"Logs",controller:"LogController",templateUrl:"app/components/log/logs.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"]})}function t(e,t){var n=this;function o(){n.isLoading=!0,t.getLogByCriteria(n.options).then((function(e){n.logs=e.data.logs,n.options.totalItems=e.data.totalCount,n.isLoading=!1}))}n.setItemPerPage=e,n.getLogByCriteria=o,n.options={itemPerPage:20,currentPage:1,dateFrom:"",dateTo:"",role:"",action:"",userSearch:"",descriptionSearch:""},n.roles=[{text:"All",value:""},{text:"Super Admin",value:"SuperAdmin"},{text:"Admin",value:"Admin"},{text:"User",value:"User"},{text:"Driver",value:"Driver"},{text:"Vendor",value:"Vendor"}],n.actions=[{text:"All",value:""},{text:"Create",value:"Created"},{text:"Modify",value:"Modified"},{text:"Delete",value:"Deleted"},{text:"Cancel",value:"Cancelled"},{text:"Approve",value:"Approved"},{text:"Reject",value:"Rejected"},{text:"Login",value:"Logged In"}],o()}angular.module("log.module",["ngRoute"]).config(e).controller("LogController",t),e.$inject=["$routeProvider"],t.$inject=["setItemPerPage","logService"]}(),function(){"use strict";function e(e){e.when("/reports",{title:"Report management",category:"Reports",controller:"ReportController",templateUrl:"app/components/report/reports.html",controllerAs:"vm",authorize:["SuperAdmin","Admin","User"]})}function t(e,t,n,o,i,r,a,s,l,c){var d=this;function u(){d.isLoading=!0,t.getReportByCriteria(d.options).then((function(e){d.listReport=t.convertListReport(e.data.reports,d.options.type),d.options.totalItems=e.data.totalCount,d.isLoading=!1}))}function m(){d.selectedColumns=[],t.getColumns(d.options.type).then((function(e){d.selectedColumns=e.data}))}function p(){d.isLoading=!0,t.updateColumns(d.selectedColumns).then((function(e){d.isLoading=!1}))}function g(){t.updateColumns(d.exportOptions.columns).then((function(e){m()})),d.isLoading=!0,t.exportCsv(d.exportOptions).then((function(e){var t=document.createElement("a");t.href="data:attachment/csv,"+encodeURIComponent(e.data),t.target="_blank",t.download="report.csv",t.click(),d.isLoading=!1}))}d.setItemPerPage=e,d.systemRole=o,d.getReportByCriteria=u,d.onExport=function(){d.exportOptions={type:"0",customerIds:[],columns:angular.copy(d.selectedColumns)},l.createPopup({templateUrl:"app/components/report/exportDetailModal.html",size:"lg",data:{ngModel:d.exportOptions,customers:d.reportCustomer,columns:angular.copy(d.columns)}},{onExport:g})},d.toggle=function(e){e.stopPropagation(),d.isOpen=!d.isOpen},d.bindingCheck=function(e){return!!d.selectedColumns.find((function(t){return t===e}))},d.onCheck=function(e,t){e.stopPropagation();for(var n=0;n<d.selectedColumns.length;n++)if(d.selectedColumns[n]===t)return d.selectedColumns.splice(n,1),void p();d.selectedColumns.push(t),p()},d.stickHeader=!1,function(){(function(){var e=function(){var e=!1;e=this.pageYOffset>=460,a.$apply((function(){d.stickHeader=e;var t=document.getElementById("stick-header");t&&(t.scrollLeft=document.getElementById("report").scrollLeft)}))};angular.element(r).bind("scroll",e),angular.element(document.getElementById("report")).bind("scroll",(function(){var e=document.getElementById("stick-header");e&&(e.scrollLeft=document.getElementById("report").scrollLeft)}));var t=function(){d.isOpen=!1,a.$apply()};s.bind("click",t),a.$on("$destroy",(function(){angular.element(r).off("scroll",e),angular.element(s).off("click",t)}))})(),d.departments=[{id:"",name:"All"},i.PSS,i.Healthcare],void(d.options={itemPerPage:20,currentPage:1,fromDate:"",toDate:"",type:"0",customer:"",departmentId:"",searchTerm:""}),function(){d.allColumns={BarcodeNumber:{value:1,text:"Barcode Number"},OrganizationName:{value:2,text:"Organization Name"},OrganizationCode:{value:3,text:"Organization Code"},SAPCode:{value:4,text:"SAP Code"},Department:{value:5,text:"Department"},RequestorName:{value:6,text:"Requestor Name"},RequestorContact:{value:7,text:"Requestor Contact"},CostCenter:{value:8,text:"SBU"},BillingAddress:{value:9,text:"Billing Address"},RequestDate:{value:10,text:"Request Date & Time"},JobType:{value:11,text:"Job Type"},TypeAdHoc:{value:12,text:"Type of Adhoc",type:"0"},TypeService:{value:13,text:"Type of Service",type:"0"},TypeFixedRun:{value:14,text:"Type of Fixed Run",type:"1"},Frequency:{value:15,text:"Frequency",type:"1"},CollectionAddress:{value:16,text:"Collection Address"},ScheduledCollectionDate:{value:17,text:"Schedule Collection Date"},DeliveryAddress:{value:18,text:"Delivery Address"},ScheduledDeliveryDate:{value:19,text:"Schedule Delivery Date"},NumberItems:{value:20,text:"Number of Item"},ItemDescription:{value:21,text:"Item Description"},Charge:{value:22,text:"Itemised Charge (S$)"},AdditionalCost:{value:23,text:"Additional Charge (S$)"},TotalCost:{value:24,text:"Total Charge (S$)"},Status:{value:25,text:"Status"},POCTimestamp:{value:26,text:"POC Captured"},PODTimestamp:{value:27,text:"POD Captured"},CreatedBy:{value:28,text:"Created By"},VendorName:{value:29,text:"Vendor Name"},DriverName:{value:30,text:"Driver Name"},VehicleNumber:{value:37,text:"Vehicle Number"},DriverRemark:{value:31,text:"Driver Remark"},PhotoPresent:{value:32,text:"Photo Present"},SurchargesJob:{value:33,text:"Surcharges By Job"},AdditionalSurcharges:{value:34,text:"Additional Surcharges"},Remark:{value:35,text:"Remark"},Reattempt:{value:36,text:"Reattempt"}},d.columns=Object.keys(d.allColumns).map((function(e){return{name:e,value:d.allColumns[e].value,text:d.allColumns[e].text,type:d.allColumns[e].type}}));var e={User:[5,7,9,10,20,21,29,30]}[c.currentUser.role];e&&(d.columns=d.columns.filter((function(t){return-1===e.indexOf(t.value)})))}(),c.currentUser.role!==o.User&&n.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then((function(e){d.customers=n.convertListCustomerDropDownList(e.data.customers),d.reportCustomer=e.data.customers.map((function(e){return{id:e.id,name:e.organizationCode+" "+e.name}}))}));m(),u(),d.separators={SAPCode:",",DriverRemark:""},d.showMoreColumns=["SAPCode","DriverRemark"]}()}angular.module("report.module",["ngRoute"]).config(e).controller("ReportController",t),e.$inject=["$routeProvider"],t.$inject=["setItemPerPage","reportService","customerService","systemRole","departments","$window","$scope","$document","modalService","$rootScope"]}(),function(){"use strict";function e(e){var t=this;t.systemRole=e,t.searchTerm="",t.isCheckAll=!1,t.isCheckAllColumn=!1,t.bindingCheck=function(e,n){if(n){return!!t.detail.columns.find((function(t){return t===e}))}return!!t.detail.customerIds.find((function(t){return t===e}))},t.onCheck=function(e,n){if(n){t.isCheckAllColumn=!1;for(var o=0;o<t.detail.columns.length;o++)if(t.detail.columns[o]===e)return void t.detail.columns.splice(o,1);t.detail.columns.push(e)}else{t.isCheckAll=!1;for(o=0;o<t.detail.customerIds.length;o++)if(t.detail.customerIds[o]===e)return void t.detail.customerIds.splice(o,1);t.detail.customerIds.push(e)}},t.selectAll=function(e){e?(t.isCheckAllColumn=!t.isCheckAllColumn,t.isCheckAllColumn?t.detail.columns=t.columns.map((function(e){return e.value})):t.detail.columns=[]):(t.isCheckAll=!t.isCheckAll,t.isCheckAll?t.detail.customerIds=t.filteredCustomers.map((function(e){return e.id})):t.detail.customerIds=[])},t.filter=function(){t.filteredCustomers=t.customers.filter((function(e){return e.name.toLowerCase().indexOf(t.searchTerm.toLowerCase())>-1}))},t.filteredCustomers=angular.copy(t.customers),t.detail.fromDate=new Date,t.detail.fromDate.setDate(1),t.detail.toDate=new Date}angular.module("report.module").directive("exportDetail",(function(){return{restrict:"E",scope:{detail:"=?",columns:"=?",customers:"=?",onExport:"&",onCancel:"&"},templateUrl:"app/components/report/exportDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["systemRole"]}(),function(){"use strict";function e(e){e.when("/allLocations",{title:"All Locations",category:"AllLocations",controller:"AllLocationsController",templateUrl:"app/components/allLocations/allLocations.html",controllerAs:"vm",authorize:["SuperAdmin"]})}function t(e,t,n,o,i){var r=this;function a(){e.lastUpdate().then((function(e){var t=new Date(e.data);r.lastUpdate=n("date")(t,"medium","+0800")}))}r.downloadFile=function(){e.downloadFile()},r.uploadFile=function(n){r.fileUploading=!0,e.uploadFile(r.file).then((function(e){a(),r.isLoading=!1,r.file=null,r.fileUploading=!1,t.success("File processed successfully."),i((function(){r.fileUploadProgress=null}),1500)}),(function(e){t.error("The file upload failed. Please check the format and your connection and try again."),r.isLoading=!1,r.fileUploading=!1}),(function(e){var n=parseInt(100*e.loaded/e.total);r.fileUploadProgress=n,100!=n||r.isLoading||(r.isLoading=!0,t.success("The file is uploaded and being processed."))}))},r.file=null,r.onFileSelect=function(e){r.file=e,console.log("fire")},r.fileUploading=!1,r.fileUploadProgress=null,r.fileUploadProgressPercentage="0%",o.$watch((function(){return r.fileUploadProgress}),(function(e){r.fileUploadProgressPercentage="number"==typeof e?e+"%":"0%"})),a()}angular.module("allLocations.module",["ngRoute"]).config(e).controller("AllLocationsController",t),e.$inject=["$routeProvider"],t.$inject=["allLocationsService","toastr","$filter","$scope","$timeout"]}(),function(){"use strict";function e(e,t){e.when("/profile",{title:"Profile",controller:"ProfileController",templateUrl:"app/components/profile/profiles.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User,t.Vendor]})}function t(e,t,n,o,i,r){var a=this;a.systemRole=n,function(){var s;if(a.isLoading=!0,e.currentUser.role===n.SuperAdmin)return void t.path("/customers");e.currentUser.role===n.Admin&&(s=o.getAdminUserById);e.currentUser.role===n.User&&(s=i.getClientUserById);e.currentUser.role===n.Vendor&&(s=r.getVendorById);s(e.currentUser.id).then((function(e){a.userDetail=e.data,a.isLoading=!1}))}()}angular.module("profile.module",["ngRoute"]).config(e).controller("ProfileController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$location","systemRole","adminUserService","clientUserService","vendorService"]}(),function(){"use strict";function e(e,t){e.when("/vendors",{title:"Vendor Management",category:"VendorManagement",controller:"VendorManagementController",templateUrl:"app/components/vendor/vendors.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]}).when("/vendors/create",{title:"Create new vendor",category:"VendorManagement",controller:"VendorDetailController",templateUrl:"app/components/vendor/detail.html",controllerAs:"vm",authorize:[t.Admin],preventViewOnly:!0}).when("/vendors/detail/:id",{title:"Client detail",category:"VendorManagement",controller:"VendorDetailController",templateUrl:"app/components/vendor/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin]})}function t(e,t,n,o,i){var r=this;function a(){r.isGridLoading=!0,n.getVendorByCriteria(r.options).then((function(e){r.options.totalItems=e.data.totalCount,r.vendors=n.convertListVendor(e.data.users),r.isGridLoading=!1}))}function s(e){t.path("/vendors/detail/"+e.id)}r.systemRole=i,r.getVendorByCriteria=a,r.departments=[{id:"",name:"All"},o.PSS,o.Healthcare],r.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",departmentId:""},r.gridConfig={onClickRowDetail:s,columns:[{name:"organization",display:"Organization name",columnNameSort:"organizationName"},{name:"organizationCode",display:"Organization code",columnNameSort:"organizationCode"},{name:"contactPerson",display:"Contact person",columnNameSort:"contactPerson"},{name:"phoneNumber",display:"Contact number",columnNameSort:"phoneNumber"},{name:"alternativeContactPerson",display:"Alternative contact person",columnNameSort:"alternativeContactPerson"},{name:"alternativePhoneNumber",display:"Alternative contact number",columnNameSort:"alternativePhoneNumber"},{name:"workAddress",display:"Address",columnNameSort:"workAddress"},{name:"status",display:"Status",preventSort:!0}]},a()}function n(e,t,n,o,i,r,a){var s=this;s.systemRole=a,s.saveVendor=function(){s.isLoading=!0,i.saveVendor(s.vendorDetail).then((function(e){var t=s.vendorDetail.id?"The vendor has been updated successfully.":"The vendor has been created successfully.";r.success(t),n.path("/vendors")})).catch((function(e){r.error(e.data.message)})).finally((function(){s.isLoading=!1}))},s.deactivateVendor=function(){s.isLoading=!0,i.deactivateVendor(s.vendorDetail.id).then((function(e){s.isLoading=!1;var t="The vendor "+s.vendorDetail.name+" has been deactivated.";r.success(t),n.path("/vendors")}))},s.activateVendor=function(){s.isLoading=!0,i.activateVendor(s.vendorDetail.id).then((function(e){s.isLoading=!1;var t="The vendor "+s.vendorDetail.name+" has been activated.";r.success(t),n.path("/vendors")}))},s.checkEmailExist=function(){if(!s.vendorDetail||s.vendorDetail.id&&s.vendorDetail.email===s.originalEmail)return;i.checkEmailExist(s.vendorDetail.email).then((function(e){s.emailExist=!0}),(function(e){s.emailExist=!1}))},s.cancel=function(){s.vendorDetail.id?(s.vendorDetail=angular.copy(s.originalVendor),s.viewMode=!0):n.path("/vendors")},function(){var r=t.id;r?(s.isLoading=!0,i.getVendorById(r).then((function(e){s.vendorDetail=i.convertVendor(e.data),s.originalVendor=angular.copy(s.vendorDetail),s.isLoading=!1}),(function(){n.path("/accessDeny")})),s.viewMode=!0):(s.vendorDetail={department:{name:e.currentUser.department,id:o[e.currentUser.department].id},workAddress:{}},s.viewMode=!1)}()}angular.module("vendorManagement.module",["ngRoute"]).config(e).controller("VendorManagementController",t).controller("VendorDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$location","vendorService","departments","systemRole"],n.$inject=["$rootScope","$routeParams","$location","departments","vendorService","toastr","systemRole"]}(),function(){"use strict";function e(e,t){e.when("/adhocs/:view?/:jobId?",{title:"Ad Hoc",category:"AdhocTransactions",controller:"AdhocManagementController",templateUrl:"app/components/adhoc/adhocs.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User]}).when("/adhoc/create",{title:"Create new Adhoc Job",category:"AdhocTransactions",controller:"AdhocDetailController",templateUrl:"app/components/adhoc/detail.html",controllerAs:"vm",authorize:[t.Admin,t.User],preventViewOnly:!0,resolve:{checkContractDateExpire:o}}).when("/adhoc/detail/:id",{title:"Adhoc Job detail",category:"AdhocTransactions",controller:"AdhocDetailController",templateUrl:"app/components/adhoc/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.User,t.Finance]}).otherwise({redirectTo:"/adhocs"})}function t(e,t,n,o,i,r,a){var s,l,c=this;function d(){c.isLoading=!0,r.getAdhocByCriteria(c.options).then((function(e){c.listJob=r.convertListAdhoc(e.data.jobs),c.options.totalItems=e.data.totalCount,c.isLoading=!1}))}function u(){c.isLoading=!0,a.getAdhocTaskByCriteria(c.transactionOptions).then((function(e){c.listTask=a.convertListAdhocTask(e.data.jobTasks),c.transactionOptions.totalItems=e.data.totalCount,c.isLoading=!1}))}function m(){c.isJob?d():u()}c.isJob="transactions"!==t.view,c.jobGridType=o,c.systemRole=i,c.switchDisplayJob=function(e){c.isJob=e,m(),n.path(e?"/adhocs/jobs":"/adhocs/transactions")},c.getJobByCriteria=d,c.getTaskByCriteria=u,s=void 0!==n.search().jobDate&&n.search().jobDate.length>0?new Date(n.search().jobDate):"",l=void 0!==n.search().status&&isFinite(n.search().status)?n.search().status:"",c.options={itemPerPage:20,currentPage:1,customer:"",status:l,requestType:"",hasPo:""},c.transactionOptions={itemPerPage:20,currentPage:1,customer:"",status:"",requestType:"",jobDate:s,vendor:"",jobId:t.jobId},c.gridConfig={columns:[{name:"id",display:"ID"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"requestType",display:"Request type"},{name:"status",display:"Status"},{name:"poNumber",display:"PO"},{name:"collectionPoints",display:"Pick up point"},{name:"deliveryPoints",display:"Delivery point"},{name:"createdBy",display:"Created by"}]},c.gridConfigTransation={columns:[{name:"barcode",display:"Barcode"},{name:"customer",display:"Customer"},{name:"createdDate",display:"Created date"},{name:"requestType",display:"Request type"},{name:"status",display:"Status"},{name:"collectionPoint",display:"Collection point"},{name:"pickUpDate",display:"Pick up Date & Time"},{name:"deliveryPoint",display:"Delivery point"},{name:"deliveryDate",display:"Delivery Date & Time"},{name:"vendor",display:"Vendor Name"},{name:"createdBy",display:"Created by"},{name:"amount",display:"Amount"},{name:"POC",display:"POC"},{name:"POD",display:"POD"},{name:"Driver",display:"Driver"}]},e.currentUser&&e.currentUser.role===i.User&&(c.gridConfig.columns.splice(1,1),c.gridConfigTransation.columns.splice(1,1),c.gridConfigTransation.columns.splice(8,1)),m()}function n(e,t,n,o,i,r,a,s){var l=this;function c(){l.viewMode=!0,l.loadingDetail=!0,n.getAdhocById(e.id).then((function(e){l.adhocDetail=n.convertAdhoc(e.data),l.originalJob=angular.copy(l.adhocDetail),l.loadingDetail=!1}),(function(){o.path("/accessDeny")}))}l.adhocProgress=t,l.adhocTypes=i,l.systemRole=r,l.jobStatus=s,l.getJobDetail=c,l.cancel=function(){c()},a.loadGBizCode(),e.id?c():(l.viewMode=!1,l.adhocDetail={isMultiplePO:!1,jobType:i.oneToOne,collectionPoints:[{editMode:!0}],deliveryPoints:[{editMode:!0}]})}function o(e,t,n,o,i){e.currentUser.role===i.User&&o.checkContractExpire(e.currentUser.customerId).then((function(e){e&&(n.createWarningPopup("Unable to create new jobs, Please contact STLogs Admin.","Warning",null,!0,"OK"),t.history.back())}))}angular.module("adhoc.module",["ngRoute"]).config(e).controller("AdhocManagementController",t).controller("AdhocDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$routeParams","$location","jobGridType","systemRole","adhocService","taskService"],n.$inject=["$routeParams","adhocProgress","adhocService","$location","adhocTypes","systemRole","pricingService","jobStatus"],o.$inject=["$rootScope","$window","modalService","customerService","systemRole"]}(),function(){"use strict";function e(e){e.when("/milkrunTask/:id",{title:"Transaction job detail",category:"MilkrunTransactions",controller:"MilkRunTaskController",templateUrl:"app/components/milkrunTask/milkrunTasks.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"],preventViewOnly:!0})}function t(e,t,n,o,i,r,a,s,l,c,d){var u=this;function m(){var e=n.id;u.isLoading=!0,i.getMilkRunTaskById(e).then((function(e){u.taskDetail=i.convertMilkrunTask(e.data),u.tasks=[{id:u.taskDetail.id,barcode:u.taskDetail.barcode}],JsBarcode("#barcode",u.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),u.taskDetail.frequency=d.convertFrequency(u.taskDetail),u.canEdit=u.taskDetail.status!==l.readyToBill.value&&u.taskDetail.status!==l.billed.value&&u.taskDetail.status!==l.pendingReject.value,u.isLoading=!1,p()}),(function(){t.path("/accessDeny")}))}function p(){u.isReturn=u.taskDetail.status===l.deliverFailed.value,u.isReattempt=u.taskDetail.status===l.collectionFailed.value||u.taskDetail.status===l.deliverFailed.value}function g(){u.isLoading=!0,i.returnOrReattemptTask(u.taskDetail.id,u.dataReturnAttempt).then((function(e){u.isLoading=!1;var t=u.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";r.success(t),m()}))}function v(){u.isLoading=!0,i.assignVendorInternalDriver({isMilkRun:!0,isDriver:u.dataAssignVendor.isDriver,userId:u.dataAssignVendor.user.id,targetIds:[u.taskDetail.id]}).then((function(e){m(),r.success("The Transaction has been assigned to vendor successfully."),u.isLoading=!1}))}function f(){u.isLoading=!0,i.unAssignVendorDriver({isMilkRun:!1,isDriver:u.unAssignData.isDriver,targetIds:[u.taskDetail.id]}).then((function(e){m(),r.success("The transaction has been unassigned "+(u.unAssignData.isDriver?"driver":"vendor")+" successfully."),u.isLoading=!1}))}u.systemRole=c,u.milkRunTypes=a,u.departments=s,u.taskStatus=l,u.assignVendorDriver=function(e){var t={assignVendor:v};u.dataAssignVendor={isDriver:e,customerId:u.taskDetail.customerId},o.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:u.dataAssignVendor},t)},u.unAssignVendorDriver=function(e){u.unAssignData={isDriver:e};var t=e?"Are you sure you want to unassign this driver?":"Are you sure you want to unassign this vendor?";o.createWarningPopup(t,"Warning",f)},u.returnReattempt=function(e){var t={returnReattempt:g},n={},i=u.taskDetail.status===l.collectionFailed.value;n=i?{contactPerson:u.taskDetail.collectionContactPerson,contactNumber:u.taskDetail.collectionContactNumber,postalCode:u.taskDetail.collectionPointAddress.postalCode,blockNumber:u.taskDetail.collectionPointAddress.blockNumber,streetName:u.taskDetail.collectionPointAddress.streetName,unitNumber:u.taskDetail.collectionPointAddress.unitNumber}:{contactPerson:u.taskDetail.deliveryContactNumber,contactNumber:u.taskDetail.deliveryContactPerson,postalCode:u.taskDetail.deliveryPointAddress.postalCode,blockNumber:u.taskDetail.deliveryPointAddress.blockNumber,streetName:u.taskDetail.deliveryPointAddress.streetName,unitNumber:u.taskDetail.deliveryPointAddress.unitNumber};u.dataReturnAttempt={isReturn:e,id:u.taskDetail.id,barcode:u.taskDetail.barcode,isCollection:i,address:n},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:u.dataReturnAttempt},t)},u.nextPrevious=function(n){var o=e.milkrunTransaction,i=o.currentIndex;i=n?i+1:i-1;var r=o.listTransaction[i];e.milkrunTransaction.currentIndex=i,t.path("/milkrunTask/"+r)},u.checkReturnReattemptButton=p,u.loadTaskById=m,function(){var t=e.milkrunTransaction;if(!t)return u.isNextJob=!1,void(u.isPrevious=!1);u.isNextJob=t.currentIndex<t.listTransaction.length-1,u.isPrevious=t.currentIndex>0}(),m()}angular.module("milkrunTask.module",["ngRoute"]).config(e).controller("MilkRunTaskController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","$routeParams","modalService","taskService","toastr","milkRunTypes","departments","taskStatus","systemRole","milkrunService"]}(),function(){"use strict";function e(e){e.when("/adhocTask/:id",{title:"Transaction job detail",category:"AdhocTransactions",controller:"AdhocTaskController",templateUrl:"app/components/adhocTask/adhocTasks.html",controllerAs:"vm",authorize:["SuperAdmin","Admin"]})}function t(e,t,n,o,i,r,a,s,l,c,d,u,m){var p=this;function g(){var e=t.id;p.isLoading=!0,i.getAdhocTaskById(e).then((function(e){p.taskDetail=i.convertAdhocTask(e.data),p.canEdit=p.taskDetail.status!==s.readyToBill.value&&p.taskDetail.status!==s.billed.value&&p.taskDetail.status!==s.pendingReject.value,p.tasks=[{id:p.taskDetail.id,barcode:p.taskDetail.barcode}],JsBarcode("#barcode",p.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),p.isLoading=!1,v()}),(function(){n.path("/accessDeny")}))}function v(){p.isReturn=p.taskDetail.status===s.deliverFailed.value,p.isReattempt=p.taskDetail.status===s.collectionFailed.value||p.taskDetail.status===s.deliverFailed.value}function f(){p.isLoading=!0,i.returnOrReattemptTask(p.taskDetail.id,p.dataReturnAttempt).then((function(e){p.isLoading=!1;var t=p.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";r.success(t),g()}))}function h(){p.isLoading=!0,i.assignVendorInternalDriver({isDriver:p.dataAssignVendor.isDriver,userId:p.dataAssignVendor.user.id,targetIds:[p.taskDetail.id]}).then((function(e){g(),r.success("The transaction has been assigned to "+(p.dataAssignVendor.isDriver?"driver":"vendor")+" successfully."),p.isLoading=!1}))}function y(){p.isLoading=!0,i.unAssignVendorDriver({isMilkRun:!1,isDriver:p.unAssignData.isDriver,targetIds:[p.taskDetail.id]}).then((function(e){g(),r.success("The transaction has been unassigned "+(p.unAssignData.isDriver?"driver":"vendor")+" successfully."),p.isLoading=!1}))}p.departments=a,p.systemRole=d,p.taskStatus=s,p.assignVendorDriver=function(e){var t={assignVendor:h};p.dataAssignVendor={isDriver:e,customerId:p.taskDetail.customerId},o.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:p.dataAssignVendor},t)},p.unAssignVendorDriver=function(e){p.unAssignData={isDriver:e};var t=e?"Are you sure you want to unassign this driver?":"Are you sure you want to unassign this vendor?";o.createWarningPopup(t,"Warning",y)},p.nextPrevious=function(t){var o=e.adhocTransaction,i=o.currentIndex;i=t?i+1:i-1;var r=o.listTransaction[i];e.adhocTransaction.currentIndex=i,n.path("/adhocTask/"+r)},p.viewPricing=function(){p.isLoading=!0,c.getCustomerById(p.taskDetail.customerId).then((function(t){p.isLoading=!1;var n=function(e){for(var t=0;t<e.pricings.length;t++)if(e.pricings[t].pricingType===l.Adhoc)return e.pricings[t];return null}(t.data),i=e.currentUser.department===a.PSS.name?"app/components/customer/pricing/adhocPricingModal.html":"app/components/customer/pricing/healthCarePricingModal.html";o.createPopup({templateUrl:i,size:"lg",data:{ngModel:n,viewMode:!0}},{})}))},p.adhocTypes=u,p.returnReattempt=function(e){var t={returnReattempt:f},n={},i=p.taskDetail.status===s.collectionFailed.value;n=i?{contactPerson:p.taskDetail.collectionContactPerson,contactNumber:p.taskDetail.collectionContactNumber,postalCode:p.taskDetail.collectionPointAddress.postalCode,blockNumber:p.taskDetail.collectionPointAddress.blockNumber,streetName:p.taskDetail.collectionPointAddress.streetName,unitNumber:p.taskDetail.collectionPointAddress.unitNumber}:{contactPerson:p.taskDetail.deliveryContactNumber,contactNumber:p.taskDetail.deliveryContactPerson,postalCode:p.taskDetail.deliveryPointAddress.postalCode,blockNumber:p.taskDetail.deliveryPointAddress.blockNumber,streetName:p.taskDetail.deliveryPointAddress.streetName,unitNumber:p.taskDetail.deliveryPointAddress.unitNumber};p.dataReturnAttempt={isReturn:e,id:p.taskDetail.id,barcode:p.taskDetail.barcode,isCollection:i,address:n},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:p.dataReturnAttempt},t)},p.checkReturnReattemptButton=v,p.loadTaskById=g,m.loadGBizCode(),function(){var t=e.adhocTransaction;if(!t)return p.isNextJob=!1,void(p.isPrevious=!1);p.isNextJob=t.currentIndex<t.listTransaction.length-1,p.isPrevious=t.currentIndex>0}(),g()}angular.module("adhocTask.module",["ngRoute"]).config(e).controller("AdhocTaskController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$routeParams","$location","modalService","taskService","toastr","departments","taskStatus","pricingType","customerService","systemRole","adhocTypes","pricingService"]}(),function(){"use strict";function e(e){e.when("/vendor/adhocs",{title:"Vendor Ad hoc Jobs",category:"AdhocVendor",controller:"VendorAdhocTaskController",templateUrl:"app/components/vendorAdhoc/vendorTasks.html",controllerAs:"vm",authorize:["Vendor"]}).when("/vendor/adhocTask/:id",{title:"Vendor Adhoc Job Detail",category:"AdhocVendor",controller:"VendorAdhocTaskDetailController",templateUrl:"app/components/vendorAdhoc/vendorTaskDetail.html",controllerAs:"vm",authorize:["Vendor"]})}function t(e,t,n,o,i,r,a,s,l){var c=this;function d(){c.isLoading=!0,r.getAdhocTaskByCriteria(c.options).then((function(e){c.listJob=r.convertListAdhocTask(e.data.jobTasks),c.options.totalItems=e.data.totalCount,c.isLoading=!1,c.listAssignTransaction=[]}))}function u(){c.isLoading=!0,r.assignDriverAdhoc({driverId:c.dataAssignDriver.driver.id,targetIds:c.listAssignTransaction}).then((function(e){angular.forEach(c.listJob,(function(e){c.listAssignTransaction.indexOf(e.id)>=0&&(e.driverName=c.dataAssignDriver.driver.name)})),a.success("The selected transactions have been assigned to driver successfully."),c.listAssignTransaction=[],c.isCheckAll=!1,c.isLoading=!1}))}function m(e,t){e.stopPropagation(),c.isCheckAll=!1;for(var n=0;n<c.listAssignTransaction.length;n++)if(c.listAssignTransaction[n]==t)return!0,void c.listAssignTransaction.splice(n,1);c.listAssignTransaction.push(t)}function p(e){for(var t=0;t<c.listAssignTransaction.length;t++)if(c.listAssignTransaction[t]==e)return!0;return!1}c.setItemPerPage=o,c.taskStatus=n,c.getTaskByCriteria=d,c.listAssignTransaction=[],c.checkAllChange=function(){c.isCheckAll?(c.listAssignTransaction=[],angular.forEach(c.listJob,(function(e){e.status!=c.taskStatus.delivered.value&&c.listAssignTransaction.push(e.id)}))):c.listAssignTransaction=[]},c.bindingCheck=p,c.onCheckTransaction=m,c.assignDriver=function(){if(!c.listAssignTransaction.length)return;var e={assignDriver:u};c.dataAssignDriver={},i.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:c.dataAssignDriver},e)},c.goToDetailPage=function(n){(function(t){var n=[];angular.forEach(c.listJob,(function(e){n.push(e.id)})),e.vendorAdhocTransaction={listTransaction:n,currentIndex:n.indexOf(t)}})(n),t.path("/vendor/adhocTask/"+n)},c.preventClick=function(e,t){e.preventDefault(),e.stopPropagation(),t.status!=c.taskStatus.delivered.value&&(m(e,t.id),p(t.id))},c.getListTransactionId=function(){var e=[];return angular.forEach(c.listJob,(function(t){c.listAssignTransaction.indexOf(t.id)>-1&&e.push({id:t.id,barcode:t.barcode})})),e},c.printOrder=function(){var e=window.location.hostname,t='<link rel="stylesheet" type="text/css" href="../bower_components/bootstrap/dist/css/bootstrap.css"><link rel="stylesheet" type="text/css" href="./css/app.css">';"localhost"!==e&&(t='<link rel="stylesheet" href="css/styles.min.css">');var n=document.getElementById("printOrderTable").innerHTML,o=window.open("","_blank");o.document.open(),o.document.write("<html><head>"+t+'</head><body onload="setTimeout(function(){ window.print(); }, 500)">'+n+"</html>"),o.document.close()},c.columns=[{display:"Collection barcode",columnNameSort:"barcode"},{display:"Customer",columnNameSort:"customer"},{display:"Status",columnNameSort:"status"},{display:"Collection date",columnNameSort:"pickUpDate"},{display:"Collection point",columnNameSort:"collectionPointAddress"},{display:"Delivery date",columnNameSort:"deliveryDate"},{display:"Delivery point",columnNameSort:"deliveryPointAddress"},{display:"Driver name",columnNameSort:"driverName"},{display:"Job type",columnNameSort:"jobType"}],c.options={itemPerPage:20,currentPage:1,customer:"",driver:"",status:"",requestType:""},c.statuses=function(e,t){var n=[{value:"",text:"All"}];for(var o in e)t&&-1!==t.indexOf(e[o].value)||n.push({value:e[o].value,text:e[o].display});return n}(n,[14,15,16,17]),s.getDriverByCriteria({sortColumn:"name",sortAscending:!0}).then((function(e){c.drivers=s.convertListVendorDropDownList(e.data.users)})),l.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then((function(e){c.customers=l.convertListCustomerDropDownList(e.data.customers)})),d()}function n(e,t,n,o,i,r,a,s){var l=this;function c(){var e=t.id;l.isLoading=!0,i.getAdhocTaskById(e).then((function(e){l.taskDetail=i.convertAdhocTask(e.data),l.tasks=[{id:l.taskDetail.id,barcode:l.taskDetail.barcode}],JsBarcode("#barcode",l.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),l.isLoading=!1,l.isReturn=l.taskDetail.status===s.deliverFailed.value,l.isReattempt=l.taskDetail.status===s.collectionFailed.value||l.taskDetail.status===s.deliverFailed.value}),(function(){n.path("/accessDeny")}))}function d(){l.isLoading=!0,i.assignDriverAdhoc({driverId:l.dataAssignDriver.driver.id,targetIds:[l.taskDetail.id],remark:l.dataAssignDriver.remark}).then((function(e){a.success("The transactions have been assigned to driver successfully."),c()}))}function u(){l.isLoading=!0,l.dataReturnAttempt.id=l.taskDetail.id,l.dataReturnAttempt.barcode=l.taskDetail.barcode,i.returnOrReattemptTask(l.taskDetail.id,l.dataReturnAttempt).then((function(e){l.isLoading=!1;var t=l.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";a.success(t),c()}))}l.departments=r,l.taskStatus=s,l.assignDriver=function(){var e={assignDriver:d};l.dataAssignDriver={isReassign:!!l.taskDetail.driverName},o.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:l.dataAssignDriver},e)},l.updateVendorRemark=function(){l.isLoading=!0,i.updateTask(l.taskDetail.id,{barcode:l.taskDetail.barcode,vendorNotes:l.taskDetail.vendorRemarks}).then((function(e){l.isLoading=!1,l.isEditVendorRemark=!1,a.success("Update vendor remark successfully.")}))},l.returnReattempt=function(e){var t={returnReattempt:u},n={},i=l.taskDetail.status===s.collectionFailed.value;n=i?{contactPerson:l.taskDetail.collectionContactPerson,contactNumber:l.taskDetail.collectionContactNumber,postalCode:l.taskDetail.collectionPointAddress.postalCode,blockNumber:l.taskDetail.collectionPointAddress.blockNumber,streetName:l.taskDetail.collectionPointAddress.streetName,unitNumber:l.taskDetail.collectionPointAddress.unitNumber}:{contactPerson:l.taskDetail.deliveryContactNumber,contactNumber:l.taskDetail.deliveryContactPerson,postalCode:l.taskDetail.deliveryPointAddress.postalCode,blockNumber:l.taskDetail.deliveryPointAddress.blockNumber,streetName:l.taskDetail.deliveryPointAddress.streetName,unitNumber:l.taskDetail.deliveryPointAddress.unitNumber};l.dataReturnAttempt={isReturn:e,id:l.taskDetail.id,barcode:l.taskDetail.barcode,isCollection:i,address:n},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:l.dataReturnAttempt},t)},l.nextPrevious=function(t){var o=e.vendorAdhocTransaction,i=o.currentIndex;i=t?i+1:i-1;var r=o.listTransaction[i];e.vendorAdhocTransaction.currentIndex=i,n.path("/vendor/adhocTask/"+r)},l.loadTaskById=c,c(),function(){var t=e.vendorAdhocTransaction;if(!t)return l.isNextJob=!1,void(l.isPrevious=!1);l.isNextJob=t.currentIndex<t.listTransaction.length-1,l.isPrevious=t.currentIndex>0}()}angular.module("vendorAdhoc.module",["ngRoute"]).config(e).controller("VendorAdhocTaskController",t).controller("VendorAdhocTaskDetailController",n),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","taskStatus","setItemPerPage","modalService","taskService","toastr","driverService","customerService"],n.$inject=["$rootScope","$routeParams","$location","modalService","taskService","departments","toastr","taskStatus"]}(),function(){"use strict";function e(e){e.when("/vendor/milkruns",{title:"Vendor Fixed run Jobs",category:"MilkrunVendor",controller:"VendorMilkrunTaskController",templateUrl:"app/components/vendorMilkrun/vendorTasks.html",controllerAs:"vm",authorize:["Vendor"]}).when("/vendor/milkrunTask/:id",{title:"Vendor Adhoc Job Detail",category:"MilkrunVendor",controller:"VendorMilkrunTaskDetailController",templateUrl:"app/components/vendorMilkrun/vendorTaskDetail.html",controllerAs:"vm",authorize:["Vendor"]})}function t(e,t,n,o,i,r,a,s,l){var c=this;function d(){c.isLoading=!0,r.getMilkRunTaskByCriteria(c.options).then((function(e){c.listJob=r.convertListMilkRunTask(e.data.milkRunTasks),c.options.totalItems=e.data.totalCount,c.isLoading=!1,c.listAssignTransaction=[]}))}function u(){c.isLoading=!0,r.assignDriverMilkrun({driverId:c.dataAssignDriver.driver.id,targetIds:c.listAssignTransaction}).then((function(e){angular.forEach(c.listJob,(function(e){c.listAssignTransaction.indexOf(e.id)>=0&&(e.driverName=c.dataAssignDriver.driver.name)})),a.success("The selected transactions have been assigned to driver successfully."),c.listAssignTransaction=[],c.isCheckAll=!1,c.isLoading=!1}))}function m(e,t){e.stopPropagation(),c.isCheckAll=!1;for(var n=0;n<c.listAssignTransaction.length;n++)if(c.listAssignTransaction[n]==t)return!0,void c.listAssignTransaction.splice(n,1);c.listAssignTransaction.push(t)}function p(e){for(var t=0;t<c.listAssignTransaction.length;t++)if(c.listAssignTransaction[t]==e)return!0;return!1}c.setItemPerPage=o,c.taskStatus=n,c.getTaskByCriteria=d,c.listAssignTransaction=[],c.checkAllChange=function(){c.isCheckAll?(c.listAssignTransaction=[],angular.forEach(c.listJob,(function(e){e.status!=c.taskStatus.delivered.value&&c.listAssignTransaction.push(e.id)}))):c.listAssignTransaction=[]},c.bindingCheck=p,c.onCheckTransaction=m,c.assignDriver=function(){if(!c.listAssignTransaction.length)return;var e={assignDriver:u};c.dataAssignDriver={},i.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:c.dataAssignDriver},e)},c.goToDetailPage=function(n){(function(t){var n=[];angular.forEach(c.listJob,(function(e){n.push(e.id)})),e.vendorMilkrunTransaction={listTransaction:n,currentIndex:n.indexOf(t)}})(n),t.path("/vendor/milkrunTask/"+n)},c.preventClick=function(e,t){e.preventDefault(),e.stopPropagation(),t.status!=c.taskStatus.delivered.value&&(m(e,t.id),p(t.id))},c.getListTransactionId=function(){var e=[];return angular.forEach(c.listJob,(function(t){c.listAssignTransaction.indexOf(t.id)>-1&&e.push({id:t.id,barcode:t.barcode})})),e},c.printOrder=function(){var e=window.location.hostname,t='<link rel="stylesheet" type="text/css" href="../bower_components/bootstrap/dist/css/bootstrap.css"><link rel="stylesheet" type="text/css" href="./css/app.css">';"localhost"!==e&&(t='<link rel="stylesheet" href="css/styles.min.css">');var n=document.getElementById("printOrderTable").innerHTML,o=window.open("","_blank");o.document.open(),o.document.write("<html><head>"+t+'</head><body onload="setTimeout(function(){ window.print(); }, 500)">'+n+"</html>"),o.document.close()},c.options={itemPerPage:20,currentPage:1,customer:"",driver:"",status:"",requestType:""},c.statuses=function(e,t){var n=[{value:"",text:"All"}];for(var o in e)t&&-1!==t.indexOf(e[o].value)||n.push({value:e[o].value,text:e[o].display});return n}(n,[14,15,16,17]),s.getDriverByCriteria({sortColumn:"name",sortAscending:!0}).then((function(e){c.drivers=s.convertListVendorDropDownList(e.data.users)})),l.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then((function(e){c.customers=l.convertListCustomerDropDownList(e.data.customers)})),d()}function n(e,t,n,o,i,r,a,s){var l=this;function c(){var e=t.id;l.isLoading=!0,i.getMilkRunTaskById(e).then((function(e){l.taskDetail=i.convertMilkrunTask(e.data),l.tasks=[{id:l.taskDetail.id,barcode:l.taskDetail.barcode}],JsBarcode("#barcode",l.taskDetail.barcode,{height:30,font:"Lato",fontSize:14}),l.isLoading=!1,l.isReturn=l.taskDetail.status===s.deliverFailed.value,l.isReattempt=l.taskDetail.status===s.collectionFailed.value||l.taskDetail.status===s.deliverFailed.value}),(function(){n.path("/accessDeny")}))}function d(){l.isLoading=!0,i.assignDriverMilkrun({driverId:l.dataAssignDriver.driver.id,targetIds:[l.taskDetail.id],remark:l.dataAssignDriver.remark}).then((function(e){a.success("The transactions have been assigned to driver successfully."),c()}))}function u(){l.isLoading=!0,l.dataReturnAttempt.id=l.taskDetail.id,l.dataReturnAttempt.barcode=l.taskDetail.barcode,i.returnOrReattemptTask(l.taskDetail.id,l.dataReturnAttempt).then((function(e){l.isLoading=!1;var t=l.dataReturnAttempt.isReturn?"The Transaction has been returned successfully.":"The Transaction has been reattempted successfully.";a.success(t),c()}))}l.departments=r,l.taskStatus=s,l.assignDriver=function(){var e={assignDriver:d};l.dataAssignDriver={isReassign:!!l.taskDetail.driverName},o.createPopup({templateUrl:"app/directives/jobCommon/assignDriver/assignDriverModal.html",size:"lg",data:l.dataAssignDriver},e)},l.updateVendorRemark=function(){l.isLoading=!0,i.updateTask(l.taskDetail.id,{barcode:l.taskDetail.barcode,vendorNotes:l.taskDetail.vendorRemarks}).then((function(e){l.isLoading=!1,l.isEditVendorRemark=!1,a.success("Update vendor remark successfully.")}))},l.returnReattempt=function(e){var t={returnReattempt:u},n={},i=l.taskDetail.status===s.collectionFailed.value;n=i?{contactPerson:l.taskDetail.collectionContactPerson,contactNumber:l.taskDetail.collectionContactNumber,postalCode:l.taskDetail.collectionPointAddress.postalCode,blockNumber:l.taskDetail.collectionPointAddress.blockNumber,streetName:l.taskDetail.collectionPointAddress.streetName,unitNumber:l.taskDetail.collectionPointAddress.unitNumber}:{contactPerson:l.taskDetail.deliveryContactNumber,contactNumber:l.taskDetail.deliveryContactPerson,postalCode:l.taskDetail.deliveryPointAddress.postalCode,blockNumber:l.taskDetail.deliveryPointAddress.blockNumber,streetName:l.taskDetail.deliveryPointAddress.streetName,unitNumber:l.taskDetail.deliveryPointAddress.unitNumber};l.dataReturnAttempt={isReturn:e,id:l.taskDetail.id,barcode:l.taskDetail.barcode,isCollection:i,address:n},o.createPopup({templateUrl:"app/directives/jobCommon/returnReattemptModal.html",size:"lg",data:l.dataReturnAttempt},t)},l.nextPrevious=function(t){var o=e.vendorMilkrunTransaction,i=o.currentIndex;i=t?i+1:i-1;var r=o.listTransaction[i];e.vendorMilkrunTransaction.currentIndex=i,n.path("/vendor/milkrunTask/"+r)},l.loadTaskById=c,c(),function(){var t=e.vendorMilkrunTransaction;if(!t)return l.isNextJob=!1,void(l.isPrevious=!1);l.isNextJob=t.currentIndex<t.listTransaction.length-1,l.isPrevious=t.currentIndex>0}()}angular.module("vendorMilkrun.module",["ngRoute"]).config(e).controller("VendorMilkrunTaskController",t).controller("VendorMilkrunTaskDetailController",n),e.$inject=["$routeProvider"],t.$inject=["$rootScope","$location","taskStatus","setItemPerPage","modalService","taskService","toastr","driverService","customerService"],n.$inject=["$rootScope","$routeParams","$location","modalService","taskService","departments","toastr","taskStatus"]}(),function(){"use strict";function e(e,t){e.when("/drivers",{title:"Driver Management",category:"Drivers",controller:"DriverManagementController",templateUrl:"app/components/driver/drivers.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.Vendor]}).when("/driver/create",{title:"Create New Driver",category:"Drivers",controller:"DriverDetailController",templateUrl:"app/components/driver/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.Vendor]}).when("/driver/detail/:id",{title:"Driver Detail",category:"Drivers",controller:"DriverDetailController",templateUrl:"app/components/driver/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Admin,t.Vendor]})}function t(e,t,n,o,i){var r=this;function a(){r.isGridLoading=!0,t.getDriverByCriteria(r.options).then((function(e){r.options.totalItems=e.data.totalCount,r.drivers=t.convertListDriver(e.data.users),r.isGridLoading=!1}))}function s(t){e.path("/driver/detail/"+t.id)}r.systemRole=n,r.departments=[{id:"",name:"All"},i.PSS,i.Healthcare],r.driverTypes=[{id:"",name:"All"},{id:1,name:"Internal Driver"},{id:2,name:"Vendor Driver"}],r.getDriverByCriteria=a,function(){r.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",department:"",driverType:""};var e=[{name:"name",display:"Name",columnNameSort:"name"},{name:"userId",display:"User ID",columnNameSort:"userName"},{name:"phoneNumber",display:"Contact no",columnNameSort:"phoneNumber"},{name:"department",display:"Department",preventSort:!0},{name:"driverType",display:"Internal/External",preventSort:!0},{name:"vendorName",display:"Vendor",preventSort:!0},{name:"permission",display:"Permission",preventSort:!0},{name:"status",display:"Status",preventSort:!0}];o.currentUser.role===n.Admin&&e.splice(3,1),o.currentUser.role===n.Vendor&&(e=[{name:"name",display:"Name",columnNameSort:"name"},{name:"userId",display:"User ID",columnNameSort:"userName"},{name:"phoneNumber",display:"Contact no",columnNameSort:"phoneNumber"},{name:"status",display:"Status",preventSort:!0}]),r.gridConfig={onClickRowDetail:s,columns:e}}(),a()}function n(e,t,n,o,i,r,a,s){var l=this;function c(){e.activateOrDeactivate(l.driverDetail).then((function(e){var t=l.driverDetail.lockoutEnabled?"The driver has been activated successfully.":"The driver has been deactivated successfully.";l.driverDetail.lockoutEnabled=!l.driverDetail.lockoutEnabled,n.success(t)}))}function d(){var e=[];return s.currentUser.role===a.SuperAdmin?e=[{isCheck:!0,departmentId:r.PSS.id,hasCreateJobPermission:!0,active:!0},{isCheck:!0,departmentId:r.Healthcare.id,hasCreateJobPermission:!0,active:!0}]:(l.index=0,e=[{isCheck:!0,departmentId:s.currentUser.department===r.PSS.name?r.PSS.id:r.Healthcare.id,hasCreateJobPermission:!0,active:!0}]),e}l.systemRole=a,l.save=function(){l.isSaving=!0;var t=angular.copy(l.driverDetail);t.driverDepartments=t.driverDepartments.filter((function(e){return e.isCheck})),e.saveDriver(t).then((function(e){l.isSaving=!1;var t=l.driverDetail.id?"The driver has been updated successfully.":"The driver has been created successfully.";n.success(t),o.path("/drivers")}),(function(e){l.isSaving=!1;var t=e.data.message;n.error(t)}))},l.activateOrDeactivate=function(){var e=l.driverDetail.lockoutEnabled?"Are you sure you want to activate this driver?":"Are you sure you want to deactivate this driver?";i.createWarningPopup(e,"Warning",c)},l.changePassword=function(){l.driverChangePassword={userId:t.id};var o={updatePassword:function(){l.isLoading=!0,e.updatePassword(l.driverChangePassword).then((function(e){l.isLoading=!1,n.success("The password has been updated successfully.")}),(function(){n.error("There is an error when sending the update password."),l.isLoading=!1}))}};i.createPopup({templateUrl:"app/components/driver/resetPasswordModal.html",size:"lg",data:{detail:l.driverChangePassword}},o)},l.checkUserIdExist=function(){e.checkUserIdExist(l.driverDetail.userName,l.driverDetail.id).then((function(e){l.userIdExist=!1}),(function(e){l.userIdExist=!0}))},l.departments=[{id:void 0,name:"Please select ..."},r.PSS,r.Healthcare],l.permissionChange=function(e){e.isCheck?(e.hasCreateJobPermission=!0,e.active=!0):(delete e.hasCreateJobPermission,delete e.active)},function(){var n=t.id;n?(l.isLoading=!0,e.getDriverById(n).then((function(e){l.driverDetail=e.data,l.driverDetail.driverDepartments=function(e){if(s.currentUser.role===a.SuperAdmin){if(0===e.length)return[{isCheck:!1,departmentId:r.PSS.id,hasCreateJobPermission:!0,active:!0},{isCheck:!1,departmentId:r.Healthcare.id,hasCreateJobPermission:!0,active:!1}];if(1===e.length)return e[0].departmentId===r.PSS.id?[{isCheck:!0,departmentId:r.PSS.id,hasCreateJobPermission:e[0].hasCreateJobPermission,active:e[0].active},{isCheck:!1,departmentId:r.Healthcare.id}]:[{isCheck:!1,departmentId:r.PSS.id},{isCheck:!0,departmentId:r.Healthcare.id,hasCreateJobPermission:e[0].hasCreateJobPermission,active:e[0].active}]}else{var t=s.currentUser.department===r.PSS.name?r.PSS.id:r.Healthcare.id;l.index=e.findIndex((function(e){return e.departmentId===t}))}return angular.forEach(e,(function(e){e.isCheck=!0})),e}(l.driverDetail.driverDepartments),l.isLoading=!1}))):l.driverDetail={driverDepartments:d()}}()}angular.module("driver.module",["ngRoute"]).config(e).controller("DriverManagementController",t).controller("DriverDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$location","driverService","systemRole","$rootScope","departments"],n.$inject=["driverService","$routeParams","toastr","$location","modalService","departments","systemRole","$rootScope"]}(),function(){"use strict";function e(){this.statusOptions=[{text:"Active",value:!0},{text:"Inactive",value:!1}],this.permissions=[{text:"Yes",value:!0},{text:"No",value:!1}]}angular.module("customer.module").directive("driverPermission",(function(){return{restrict:"E",scope:{ngModel:"=",isEnable:"="},templateUrl:"app/components/driver/driverPermission/driverPermission.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(e){e.when("/accessDeny",{title:"Access Deny",controller:"AccessDenyController",templateUrl:"app/components/accessDeny/accessDeny.html",controllerAs:"vm",hideHeader:!0,hideFooter:!0})}function t(e,t,n){this.back=function(){if(!n.isAuthenticated())return void e.path("/login");var o=n.getCurrentUser();e.path("/"+t[o.role].defaultRoute)}}angular.module("accessDeny.module",["ngRoute"]).config(e).controller("AccessDenyController",t),e.$inject=["$routeProvider"],t.$inject=["$location","systemRolesConfigs","authService"]}(),function(){"use strict";function e(e,t){e.when("/favorites/:view",{title:"Favorite management",category:"Favorites",controller:"FavoriteManagementController",templateUrl:"app/components/favorite/favorites.html",controllerAs:"vm",authorize:[t.Admin,t.User]}).when("/favorites/address/create",{title:"Create New Favorite Address",category:"Favorites",controller:"FavoriteAddressDetailController",templateUrl:"app/components/favorite/addressDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User]}).when("/favorites/address/:id",{title:"Favorite Address Detail",category:"Favorites",controller:"FavoriteAddressDetailController",templateUrl:"app/components/favorite/addressDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User]}).when("/favorites/item/create",{title:"Create New Favorite Item",category:"Favorites",controller:"FavoriteItemDetailController",templateUrl:"app/components/favorite/itemDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User]}).when("/favorites/item/:id",{title:"Favorite Address Item",category:"Favorites",controller:"FavoriteItemDetailController",templateUrl:"app/components/favorite/itemDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User]})}function t(e,t){var n=this;function o(t){e.path("/favorites/address/"+t.id)}function i(t){e.path("/favorites/item/"+t.id)}n.isAddress=!("item"===t.view),n.addressGridConfig={onClickRowDetail:o,columns:[{name:"name",display:"Name",preventSort:!0},{name:"address",display:"Address",preventSort:!0},{name:"contactPerson",display:"Contact person",preventSort:!0},{name:"contactNumber",display:"Contact no",preventSort:!0},{name:"addressType",display:"Address type",preventSort:!0}]},n.itemGridConfig={onClickRowDetail:i,columns:[{name:"name",display:"Name",preventSort:!0},{name:"description",display:"Item description",preventSort:!0},{name:"uom",display:"UOM",preventSort:!0},{name:"issueQuantity",display:"Quantity",preventSort:!0},{name:"unitMass",display:"Actual weight",preventSort:!0},{name:"unitVolume",display:"Volumetric Weight (W x H x D / 5000)",preventSort:!0}]}}function n(e,t,n,o,i,r){var a=this;function s(){a.isDeleting=!0,e.deleteAddress(a.favoriteAddress.id).then((function(e){a.isDeleting=!1,n.success("The favorite address has been deleted successfully."),o.path("/favorites/address")}),(function(e){a.isDeleting=!1;var t=e.data.message;n.error(t)}))}a.systemRole=i,a.save=function(){a.isSaving=!0,e.saveFavoriteAddress(a.favoriteAddress).then((function(e){a.isSaving=!1;var t=a.favoriteAddress.id?"The favorite address has been updated successfully.":"The favorite address has been created successfully.";n.success(t),o.path("/favorites/address")}),(function(e){a.isSaving=!1;var t=e.data.message;n.error(t)}))},a.deleteAddress=function(){r.createWarningPopup("Are you sure you want to delete this address?","Warning",s)},a.addressTypes=[{id:void 0,name:"Please select ..."},{id:3,name:"Collection & Delivery"},{id:1,name:"Collection"},{id:2,name:"Delivery"}],function(){var n=t.id;n?(a.isLoading=!0,e.getFavoriteAddress(n).then((function(e){a.favoriteAddress=e,a.isLoading=!1}))):a.favoriteAddress={address:{},customerIds:[]}}()}function o(e,t,n,o,i,r,a,s,l,c,d){var u=this;function m(){u.isDeleting=!0,e.deleteItem(u.favoriteItem.id).then((function(e){u.isDeleting=!1,n.success("The favorite item has been deleted successfully."),o.path("/favorites/item")}),(function(e){u.isDeleting=!1;var t=e.data.message;n.error(t)}))}u.systemRole=s,u.save=function(){u.isSaving=!0,e.saveFavoriteItem(u.favoriteItem).then((function(e){u.isSaving=!1;var t=u.favoriteItem.id?"The favorite item has been updated successfully.":"The favorite item has been created successfully.";n.success(t),o.path("/favorites/item")}),(function(e){u.isSaving=!1;var t=e.data.message;n.error(t)}))},u.deleteItem=function(){c.createWarningPopup("Are you sure you want to delete this item?","Warning",m)},u.uoms=l.currentUser.department===a.PSS.name?r:i,u.isHealthCare=l.currentUser.department===a.Healthcare.name,u.isHealthCare&&(u.itemsHealthCare=[{id:void 0,name:"Please select ..."}],angular.forEach(d,(function(e){u.itemsHealthCare.push({id:e,name:e})}))),function(){var n=t.id;n?(u.isLoading=!0,e.getFavoriteItem(n).then((function(e){u.favoriteItem=e.data,u.isLoading=!1}))):u.favoriteItem={customerIds:[]}}()}angular.module("favorite.module",["ngRoute"]).config(e).controller("FavoriteManagementController",t).controller("FavoriteAddressDetailController",n).controller("FavoriteItemDetailController",o),e.$inject=["$routeProvider","systemRole"],t.$inject=["$location","$routeParams"],n.$inject=["favoriteService","$routeParams","toastr","$location","systemRole","modalService"],o.$inject=["favoriteService","$routeParams","toastr","$location","uomHealthCare","uomPSS","departments","systemRole","$rootScope","modalService","itemsHealthCare"]}(),function(){"use strict";function e(e,t){var n=this;function o(){n.isGridLoading=!0,e.getByCriteria(n.options).then((function(t){n.options.totalItems=t.data.total,n.items=e.convertListItem(t.data,n.isAddress),n.isGridLoading=!1}))}n.systemRole=t,n.getByCriteria=o,n.options={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",addressType:"",isAddress:!!n.isAddress},o()}angular.module("favorite.module").directive("favoriteTab",(function(){return{restrict:"E",scope:{ngModel:"=",gridConfig:"=",isAddress:"=?"},templateUrl:"app/components/favorite/favoriteTab.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["favoriteService","systemRole"]}(),function(){"use strict";function e(e,t){e.when("/finance-users/create",{title:"Create New Finance User",category:"FinanceUsers",controller:"FinanceUserDetailController",templateUrl:"app/components/financeUser/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin]}).when("/finance-users/detail/:id",{title:"Finance User Detail",category:"FinanceUsers",controller:"FinanceUserDetailController",templateUrl:"app/components/financeUser/detail.html",controllerAs:"vm",authorize:[t.SuperAdmin]})}function t(e,t,n,o,i,r,a){var s=this;function l(){var e=[];return a.currentUser.role===r.SuperAdmin?e=[{isCheck:!0,departmentId:i.PSS.id,active:!0},{isCheck:!0,departmentId:i.Healthcare.id,active:!0}]:(s.index=0,e=[{isCheck:!0,departmentId:a.currentUser.department===i.PSS.name?i.PSS.id:i.Healthcare.id,active:!0}]),e}s.systemRole=r,s.save=function(){s.isSaving=!0;var t=angular.copy(s.financeUserDetail);t.userDepartments=t.userDepartments.filter((function(e){return e.isCheck})),e.saveFinanceUser(t).then((function(e){s.isSaving=!1;var t=s.financeUserDetail.id?"The finance user has been updated successfully.":"The finance user has been created successfully.";n.success(t),o.path("/users")}),(function(e){s.isSaving=!1;var t=e.data.message;n.error(t)}))},s.edit=function(){s.viewMode=!1},s.departments=[{id:void 0,name:"Please select ..."},i.PSS,i.Healthcare],s.checkEmailExist=function(){if(!s.financeUserDetail||s.financeUserDetail.id&&s.financeUserDetail.email===s.originalEmail)return;e.checkEmailExist(s.financeUserDetail.email).then((function(e){s.emailExist=!0}),(function(e){s.emailExist=!1}))},s.permissionChange=function(e){e.isCheck?e.active=!0:delete e.active},function(){var n=t.id;n?(s.viewMode=!0,s.isLoading=!0,e.getFinanceUserById(n).then((function(e){s.financeUserDetail=e.data,s.financeUserDetail.userDepartments=function(e){if(a.currentUser.role===r.SuperAdmin){if(0===e.length)return[{isCheck:!1,departmentId:i.PSS.id,active:!0},{isCheck:!1,departmentId:i.Healthcare.id,active:!1}];if(1===e.length)return e[0].departmentId===i.PSS.id?[{isCheck:!0,departmentId:i.PSS.id,active:e[0].active},{isCheck:!1,departmentId:i.Healthcare.id}]:[{isCheck:!1,departmentId:i.PSS.id},{isCheck:!0,departmentId:i.Healthcare.id,active:e[0].active}]}else{var t=a.currentUser.department===i.PSS.name?i.PSS.id:i.Healthcare.id;s.index=e.findIndex((function(e){return e.departmentId===t}))}return angular.forEach(e,(function(e){e.isCheck=!0})),e}(s.financeUserDetail.userDepartments),s.isLoading=!1,s.originalEmail=s.financeUserDetail.email}))):(s.viewMode=!1,s.financeUserDetail={userDepartments:l()})}()}angular.module("financeUser.module",["ngRoute"]).config(e).controller("FinanceUserDetailController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["financeUserService","$routeParams","toastr","$location","departments","systemRole","$rootScope"]}(),function(){"use strict";function e(){this.statusOptions=[{text:"Active",value:!0},{text:"Inactive",value:!1}]}angular.module("financeUser.module").directive("financeUserPermission",(function(){return{restrict:"E",scope:{ngModel:"=",isEnable:"="},templateUrl:"app/components/financeUser/financeUserPermission/financeUserPermission.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(e,t){e.when("/financeBillings",{title:"Finance Billing Management",category:"Finance",controller:"FinanceBillingManagementController",templateUrl:"app/components/financeBilling/management/index.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]})}function t(e){var t=this;function n(n){t.isLoading=!0,e.summaryBilling(n).then((function(e){t.isLoading=!1,t.dataSummary=e.data}))}t.isBilling=!0,t.loadSummary=n,t.date=new Date,n(t.date)}angular.module("financeBilling.module",["ngRoute"]).config(e).controller("FinanceBillingManagementController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["billingService"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;function a(){r.isBilling&&r.loadSummary({date:r.options.date}),r.isLoading=!0,o.getByCriteria(r.options,r.isBilling).then((function(e){r.billings=r.isBilling?o.convertBilling(e.data.billingJobs):o.convertCancelledBilling(e.data.cancelledInvoices),r.options.totalItems=e.data.totalCount,r.isLoading=!1}))}function s(t){if(t.costCentreId)if(r.options.date){var o=t.customerId+"-"+t.costCentreId+"-"+t.poNumberId+"-"+(r.options.date.getMonth()+1)+"-"+r.options.date.getFullYear()+"-"+t.billingType,i=r.isBilling?"/financeBilling/detail/"+o:"/financeBilling/cancelledDetail/"+o;e.path(i)}else n.warning("Please choose month first!");else n.warning("This job has no SBU!")}r.systemRole=t,r.departments=[{id:"",name:"All"},i.PSS,i.Healthcare],r.getByCriteria=a,function(){r.options={date:r.date,sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,status:"",searchTerm:"",department:""};var e=[];e=r.isBilling?[{name:"customerName",display:"Client",columnNameSort:"CustomerName",htmlDisplay:!0},{name:"costCentreName",display:"SBU",columnNameSort:"CostCentreName"},{name:"poNumber",display:"PO Number",columnNameSort:"PONumber"},{name:"totalJob",display:"No of jobs",preventSort:!0},{name:"billingTypeText",display:"Billing Type",preventSort:!0},{name:"amountBar",display:"Amount",htmlDisplay:!0,css:"amountBar",preventSort:!0},{name:"amountText",display:"",htmlDisplay:!0,preventSort:!0,css:"amountText"}]:[{name:"customerName",display:"Client",columnNameSort:"CustomerName",htmlDisplay:!0},{name:"costCentreName",display:"SBU",columnNameSort:"CostCentreName"},{name:"invoiceNumber",display:"Invoice no",preventSort:!0},{name:"poNumber",display:"PO Number",columnNameSort:"PONumber"},{name:"totalJob",display:"No of jobs",preventSort:!0},{name:"billingTypeText",display:"Billing Type",preventSort:!0},{name:"totalAmount",display:"Amount",htmlDisplay:!0,preventSort:!0,css:"amountText"}],r.statuses=[{value:"",text:"All"},{value:"true",text:"Ready"},{value:"false",text:"Not ready"}],r.gridConfig={onClickRowDetail:s,columns:e}}(),a()}angular.module("financeBilling.module").directive("tabDetail",(function(){return{restrict:"E",scope:{ngModel:"=?",criteria:"=?",isBilling:"=?",date:"=",loadSummary:"&"},templateUrl:"app/components/financeBilling/management/tabDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$location","systemRole","toastr","billingService","departments"]}(),function(){"use strict";function e(e,t){e.when("/financeBilling/detail/:id",{title:"Finance Billing Detail",category:"Finance",controller:"FinanceBillingDetailController",templateUrl:"app/components/financeBilling/detail/billingDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]}).when("/financeBilling/cancelledDetail/:id",{title:"Finance Cancelled Billing Detail",category:"Finance",controller:"FinanceCancelledBillingDetailController",templateUrl:"app/components/financeBilling/detail/cancelledBillingDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]})}function t(e,t,n,o,i,r){var a=this;function s(){a.isLoading=!0,i.getBillingDetail(o.id,a.searchTerm,!1).then((function(e){a.isLoading=!1,a.data=e.data}),(function(e){a.isLoading=!1,r.error(e.data.message)}))}function l(t){var n="";n="Adhoc"===t.jobType?"/adhoc/detail/"+t.id:"/milkrun/detail/"+t.id,e.path(n)}function c(e,t){g(e,t,{apiName:"ready",confirmMessage:"Are you sure you want to set the following jobs as ready",successMessage:"Jobs have been set as ready successfully."})}function d(e,t){g(e,t,{apiName:"reject",confirmMessage:"Are you sure you want to reject following jobs",successMessage:"Jobs have been rejected successfully."},!0)}function u(e,t){g(e,t,{apiName:"requestRejection",confirmMessage:"Are you sure you want to request to reject following jobs",successMessage:"Jobs have been requested to reject successfully."},!0)}function m(e,t){g(e,t,{apiName:"verify",confirmMessage:"Are you sure you want to verify following jobs",successMessage:"Jobs have been verified successfully."})}function p(e,t){g(e,t,{apiName:"sync",confirmMessage:"Are you sure you want to sync following jobs",successMessage:"Jobs have been synchronized successfully."},!1)}function g(e,t,l,c){var d=Array.isArray(e)?e:[e.id],u=c?"app/components/financeBilling/detail/confirmWithModal.html":"app/components/financeBilling/detail/confirmModal.html";a.actionData={message:l.confirmMessage,target:d.join(", ")},n.createPopup({templateUrl:u,size:"md",data:a.actionData},{action:function(){var e=o.id.split("-");a.isLoading=!0;var t={targets:d,customerId:parseInt(e[0]),customerName:a.data.customerName,costCentreId:e.length>1?parseInt(e[1]):"",costCentreName:a.data.costCentreName,poNumberId:e.length>2?parseInt(e[2]):"",poNumber:a.data.poNumber,remark:a.actionData.remark,period:e.length>3?e[3]+"-"+e[4]:"",billingType:e.length>4?parseInt(e[5]):""};i.doAction(t,l.apiName).then((function(e){r.success(l.successMessage),s()}),(function(e){a.isLoading=!1,r.error(e.data.message)}))}})}a.systemRole=t,a.searchTerm="",a.getBillingDetail=s,a.data={},a.sections={Admin:[{label:"Rejected",actions:[{label:"Edit",onClick:l},{label:"Ready",onClick:c}],topActions:[{label:"Set selected as ready",onClick:c}],includeRemark:!0,key:"rejectedJobs"},{label:"Pending",actions:[{label:"Edit",onClick:l},{label:"Ready",onClick:c}],topActions:[{label:"Set selected as ready",onClick:c}],includeRemark:!1,key:"pendingJobs"},{label:"Request for rejection",includeRemark:!1,key:"toBeRejectJobs"},{label:"Ready to bill",actions:[{label:"Request to reject",onClick:u}],topActions:[{label:"Request selected",onClick:u}],includeRemark:!0,key:"readyToBillJobs"}],User:[{label:"Delivered",actions:[{label:"Verify",onClick:m}],topActions:[{label:"Verify selected",onClick:m}],includeRemark:!0,key:"pendingJobs"},{type:"readyToBill",label:"Ready to bill",includeRemark:!0,key:"readyToBillJobs"},{label:"Rejected",includeRemark:!0,key:"rejectedJobs"}],Finance:[{label:"Request for rejection",actions:[{label:"Reject",onClick:d}],topActions:[{label:"Reject selected",onClick:d}],includeRemark:!1,key:"toBeRejectJobs"},{label:"Ready to bill",actions:[{label:"Reject",onClick:d},{label:"Sync",onClick:p}],topActions:[{label:"Reject selected",onClick:d},{label:"Sync selected",onClick:p}],includeRemark:!0,key:"readyToBillJobs"},{label:"Pending",includeRemark:!1,key:"pendingJobs"},{label:"Rejected",includeRemark:!0,key:"rejectedJobs"}]},s()}function n(e,t,n){var o=this;o.systemRole=t,o.section={label:"Cancelled jobs",actions:[],topActions:[],includeRemark:!1,includeStatus:!0},o.isLoading=!0,e.getBillingDetail(n.id,o.searchTerm,!0).then((function(e){o.isLoading=!1,o.data=e.data}),(function(e){o.isLoading=!1,toastr.error(e.data.message)}))}angular.module("financeBillingDetail.module",["ngRoute"]).config(e).controller("FinanceBillingDetailController",t).controller("FinanceCancelledBillingDetailController",n),e.$inject=["$routeProvider","systemRole"],t.$inject=["$location","systemRole","modalService","$routeParams","billingService","toastr"],n.$inject=["billingService","systemRole","$routeParams"]}(),function(){"use strict";function e(e,t,n){var o=this;function i(){if(o.items){var e=o.criteria.currentPage-1;o.filteredItems=o.items.slice(e*o.criteria.itemPerPage,e*o.criteria.itemPerPage+o.criteria.itemPerPage)}else o.filteredItems=[]}o.setItemPerPage=e,o.bindingCheck=function(e){return!!o.selectedItems.find((function(t){return t===e}))},o.onCheck=function(e){o.isCheckAll=!1;for(var t=0;t<o.selectedItems.length;t++)if(o.selectedItems[t]===e)return void o.selectedItems.splice(t,1);o.selectedItems.push(e)},o.selectAll=function(){o.isCheckAll=!o.isCheckAll,o.isCheckAll?o.selectedItems=o.filteredItems.map((function(e){return e.id})):o.selectedItems=[]},o.selectedItems=[],o.isCheckAll=!1,o.getByCriteria=i,o.getStatusText=function(e){for(var t in n)if(n[t].value===e)return n[t].display;return""},o.criteria={sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:""},t.$watch("vm.items",(function(e){i(),o.selectedItems=[]}))}angular.module("financeBillingDetail.module").directive("jobSection",(function(){return{restrict:"E",scope:{ngModel:"=",items:"="},templateUrl:"app/components/financeBilling/detail/sections/jobSection.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["setItemPerPage","$scope","invoiceStatus"]}(),function(){"use strict";function e(e,t){e.when("/financeInvoiced",{title:"Finance Invoiced Management",category:"Finance",controller:"FinanceInvoicedManagementController",templateUrl:"app/components/financeInvoiced/management/index.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]})}function t(e,t,n,o,i,r){var a=this;function s(){a.options.date?(a.summaryLoading=!0,n.getSummary(a.options.date).then((function(e){a.summaryLoading=!1,a.summaryData=e.data})),a.isLoading=!0,n.getByCriteria(a.options).then((function(e){a.invoices=n.convertData(e.data.invoices),a.options.totalItems=e.data.totalCount,a.isLoading=!1}))):r.warning("Please select a valid month!")}function l(e){var t="/financeInvoiced/detail/"+e.refNumber+"-"+e.invoiceNumber+"-"+e.soNumber;i.path(t)}a.systemRole=e,a.departments=[{id:"",name:"All"},t.PSS,t.Healthcare],a.getByCriteria=s,a.options={date:new Date,sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,status:"",searchTerm:"",department:""},a.statuses=[{value:"",display:"All"},o.new,o.invoiced,o.cancelled,o.creditNoted,o.invoicing],a.gridConfig={onClickRowDetail:l,columns:[{name:"invoiceNumber",display:"Invoice no",preventSort:!0},{name:"refNumber",display:"Ref no",preventSort:!0},{name:"invoiceDate",display:"Invoice date",columnNameSort:"invoiceDate"},{name:"customerName",display:"Client",columnNameSort:"customerName"},{name:"costCentreName",display:"SBU",columnNameSort:"costCentreName"},{name:"poNumber",display:"PO number",preventSort:!0},{name:"totalJob",display:"Jobs",columnNameSort:"totalJob"},{name:"status",display:"Status",preventSort:!0},{name:"totalAmount",display:"Amount",columnNameSort:"totalAmount"}]},s()}angular.module("financeInvoiced.module",["ngRoute"]).config(e).controller("FinanceInvoicedManagementController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["systemRole","departments","invoicedService","invoiceStatus","$location","toastr"]}(),function(){"use strict";function e(e,t){e.when("/financeInvoiced/detail/:id",{title:"Finance Invoiced Detail",category:"Finance",controller:"FinanceInvoicedDetailController",templateUrl:"app/components/financeInvoiced/detail/invoicedDetail.html",controllerAs:"vm",authorize:[t.Admin,t.User,t.Finance]})}function t(e,t,n,o,i,r,a){var s=this;function l(){s.isLoading=!0,o.getInvoiceDetail(s.criteria).then((function(e){s.isLoading=!1,s.invoiceDetail=e.data}))}function c(){s.isLoading=!0,o.creditNoteOrCancel("creditnote",s.creditNoteData).then((function(e){d(),l()}))}function d(){s.selectedItems=[],s.isCheckAll=!1}s.systemRole=t,s.setItemPerPage=n,s.bindingCheck=function(e){return!!s.selectedItems.find((function(t){return t===e}))},s.onCheck=function(e){s.isCheckAll=!1;for(var t=0;t<s.selectedItems.length;t++)if(s.selectedItems[t]===e)return void s.selectedItems.splice(t,1);s.selectedItems.push(e)},s.selectAll=function(){s.isCheckAll=!s.isCheckAll,s.isCheckAll?s.selectedItems=s.invoiceDetail.jobs.map((function(e){return e.id})):s.selectedItems=[]},s.selectedItems=[],s.isCheckAll=!1,s.cancelSelected=d,s.loadInvoiceDetail=l,s.cancel=function(){i.createWarningPopup("Are you sure you want to cancel this invoice?","Warning",(function(){s.isLoading=!0,o.creditNoteOrCancel("cancel",{refNumber:s.criteria.refNumber,soNumber:s.criteria.soNumber,invoiceNumber:s.criteria.invoiceNumber,amount:s.invoiceDetail.totalAmount}).then((function(e){l()}))}))},s.creditNote=function(){var e={creditNote:c};s.creditNoteData={targetIds:s.selectedItems,refNumber:s.criteria.refNumber,soNumber:s.criteria.soNumber,invoiceNumber:s.criteria.invoiceNumber,amount:s.invoiceDetail.totalAmount},i.createPopup({templateUrl:"app/components/financeInvoiced/detail/creditNote/creditNoteModal.html",size:"lg",data:s.creditNoteData},e)},s.getStatusText=function(e){for(var t in a)if(a[t].value===e)return a[t].display;return""},function(){s.isCancel=(new Date).getDate()<r,s.statuses=[{value:"",display:"All"},{value:1,display:"Invoiced"},{value:2,display:"Credit Noted"}];var t=e.id.split("-");s.criteria={refNumber:t[0],invoiceNumber:t[1],soNumber:t[2],status:"",sortColumn:"",sortAscending:!0,itemPerPage:20,currentPage:1,searchTerm:"",totalItem:0},l()}()}angular.module("financeInvoicedDetail.module",["ngRoute"]).config(e).controller("FinanceInvoicedDetailController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["$routeParams","systemRole","setItemPerPage","invoicedService","modalService","creditNoteDate","invoiceStatus"]}(),function(){"use strict";function e(){this.collapse=!0}angular.module("financeBillingDetail.module").directive("addressDetail",(function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/components/financeBilling/detail/sections/addressDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("main.module").directive("creditNote",(function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&",onAction:"&"},templateUrl:"app/components/financeInvoiced/detail/creditNote/creditNote.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(e,t,n,o){return{isAuthenticated:function(){if(i())return!0;return!1},isAuthorized:function(e){var t=i();if(t&&e.indexOf(t.role)>-1)return!0;return!1},login:function(i,r){var a=t.defer(),s=o.serviceUrl+"/api/account/token",l={username:i,password:r};return e.post(s,l).then((function(e){var t={access_token:e.data.accessToken,token_type:e.data.tokenType,expired_at:(new Date).getTime()+1e3*parseInt(e.data.expiresIn)},o={id:e.data.id,email:e.data.email,role:e.data.role,department:e.data.department,customerId:e.data.customerId,firstName:e.data.firstName,lastName:e.data.lastName,viewOnly:e.data.viewOnly,isMultiDepartment:e.data.isMultiDepartment};n.set("tokenInfo",t),n.set("userInfo",o),a.resolve(o)}),(function(e){a.reject(e)})),a.promise},logout:function(){n.remove("tokenInfo"),n.remove("userInfo")},getCurrentUser:i,resetPassword:function(t){var n=o.serviceUrl+"/api/account/forgetpassword",i={email:t};return e.post(n,i)},confirmResetPassword:function(t){var n=o.serviceUrl+"/api/account/resetpassword";return e.post(n,t)},getToken:function(){var e=n.get("tokenInfo");if((new Date).getTime()>e.expired_at)return null;return e}};function i(){return n.get("userInfo")}}angular.module("main.module").factory("authService",e),e.$inject=["$http","$q","localStorageService","systemSetting"]}(),function(){"use strict";function e(e){return{createPopup:function(t,n,o){e.open({animation:!0,templateUrl:t.templateUrl,controller:"ModalInstanceCtrl",controllerAs:"vm",size:t.size,backdrop:"static",resolve:{data:function(){return t.data},readOnly:function(){return t.readOnly}}}).result.then((function(e){n[e]()}),o)},createWarningPopup:function(t,n,o,i,r){e.open({animation:!0,templateUrl:"app/directives/commonControls/warningModal/warningModal.html",controller:"ModalInstanceCtrl",controllerAs:"vm",backdrop:"static",resolve:{data:function(){return{message:t,title:n,isHideActionButton:i,dismissText:r}}}}).result.then((function(e){o&&o()}))}}}angular.module("main.module").factory("modalService",e),e.$inject=["$uibModal"]}(),function(){"use strict";function e(e,t,n){return{request:function(e){e.headers=e.headers||{};var n=t.get("tokenInfo");n&&(e.headers.Authorization=n.token_type+" "+n.access_token);return e},responseError:function(o){401===o.status&&(t.remove("tokenInfo"),t.remove("userInfo"),n.path("/accessDeny"));return e.reject(o)}}}angular.module("main.module").factory("httpInterceptor",e),e.$inject=["$q","localStorageService","$location"]}(),function(){"use strict";function e(e,t){var n=t.serviceUrl+"/api/adminusers/";return{saveAdminUser:function(t){return t.id?e.put(n+t.id,t):e.post(n,t)},getAdminUserByCriteria:function(t){var o=n+"?roleNames="+t.roles+"&offset="+(t.currentPage-1)*t.itemPerPage;o+="&limit="+t.itemPerPage,t.searchTerm&&(o+="&search="+t.searchTerm);t.department&&(o+="&departmentId="+t.department);t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending);return e.get(o)},getAdminUserById:function(t){return e.get(n+t)},activateOrDeactivate:function(t){var o=t.lockoutEnabled?"activate/":"deactivate/";return e.post(n+o+t.id)},checkEmailExist:function(t){return e.post(n+"userExists",{email:t})}}}angular.module("main.module").factory("adminUserService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t){var n=t.serviceUrl+"/api/adminusers/finance-user/",o=t.serviceUrl+"/api/adminusers/";return{saveFinanceUser:function(t){return t.id?e.put(n+t.id,t):e.post(n,t)},getFinanceUserById:function(t){return e.get(n+t)},checkEmailExist:function(t){return e.post(o+"userExists",{email:t})}}}angular.module("main.module").factory("financeUserService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord","$rootScope","systemRole","departments"]}(),function(){"use strict";function e(e,t,n,o,i){var r=n.serviceUrl+"/api/customers/";return{getCustomerByCriteria:function(t){var n=r;(t=t||{}).currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||i,"object"==typeof t&&Object.keys(t).length>0&&(n+="?offset="+(t.currentPage-1)*t.itemPerPage,n+="&limit="+t.itemPerPage,t.searchTerm&&(n+="&search="+t.searchTerm),t.sortColumn&&(n+="&sortBy="+t.sortColumn,n+="&ascending="+t.sortAscending));return e.get(n)},getCustomerById:a,saveCustomer:function(t){return t.id?e.put(r+t.id,t):e.post(r,t)},convertListCustomer:function(e){return e.map((function(e){return{id:e.id,organizationCode:e.organizationCode,name:e.name,clientType:e.department.name,address:e.address?e.address.blockNumber+" "+e.address.streetName+" "+e.address.unitNumber+" "+e.address.postalCode:"",sapCodesText:e.sapCodesText}}))},convertCustomer:function(e){return{id:e.id,name:e.name,organizationCode:e.organizationCode,sapCode:e.sapCode,contactPerson:e.contactPerson,contactNumber:e.contactNumber,contractEndDate:o.convertDate(e.contractEndDate),cutOffTimeFor3HourDelivery:o.convertDate(e.cutOffTimeFor3HourDelivery),cutOffTimeForSameDayPickupAndDelivery:o.convertDate(e.cutOffTimeForSameDayPickupAndDelivery),cutOffTimeForSameDayPickupAndNextDayDelivery:o.convertDate(e.cutOffTimeForSameDayPickupAndNextDayDelivery),address:e.address,department:e.department,clientTypeId:e.department.id,pricings:e.pricings,users:e.applicationUsers,sapCodes:e.sapCodes,poNumbers:e.poNumbers,costCentres:e.costCentres}},convertListCustomerDropDownList:function(e){var t=[{id:"",name:"All"}];return angular.forEach(e,(function(e){t.push({id:e.id,name:e.organizationCode+" "+e.name})})),t},checkContractExpire:function(e){var n=t.defer();return a(e).then((function(e){var t=o.convertDate(e.data.contractEndDate);t.setHours(0,0,0,0);var i=new Date;i.setHours(0,0,0,0),t<i?n.resolve(!0):n.resolve(!1)})),n.promise},saveSapCode:function(t){return t.id?e.put(r+"UpdateSAPCode/"+t.id,t):e.post(r+"CreateSAPCode",t)},savePoNumber:function(t){return t.number=t.detailName,t.id?e.put(r+"UpdatePONumber/"+t.id,t):e.post(r+"CreatePONumber",t)},saveCostCenter:function(t){return t.name=t.detailName,t.id?e.put(r+"UpdateCostCentre/"+t.id,t):e.post(r+"CreateCostCentre",t)},createPoOrCC:function(t,n){if(n)return t.number=t.name,e.post(r+"CreatePONumber",t);return e.post(r+"CreateCostCentre",t)},checkOrgCodeExists:function(t,n){return e.get(r+"CheckOrgCodeExists/?customerId="+t+"&orgCode="+n)}};function a(t){return e.get(r+t)}}angular.module("main.module").factory("customerService",e),e.$inject=["$http","$q","systemSetting","utilityService","maxNumberOfRecord"]}(),function(){"use strict";function e(e,t,n){var o=t.serviceUrl+"/api/users/";return{getClientUserByCriteria:function(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var i=o+"?offset="+(t.currentPage-1)*t.itemPerPage;i+="&limit="+t.itemPerPage,t.searchTerm&&(i+="&search="+t.searchTerm);t.department&&(i+="&departmentId="+t.department);t.organizationCode&&(i+="&organizationCode="+t.organizationCode);t.sortColumn&&(i+="&sortBy="+t.sortColumn,i+="&ascending="+t.sortAscending);return e.get(i)},getClientUserById:function(t){return e.get(o+t)},convertListUser:function(e){return e.map((function(e){return{id:e.id,customerId:e.customerId,name:e.firstName+" "+e.lastName,email:e.email,phoneNumber:e.phoneNumber,costCentres:e.costCentres,sapCode:e.sapCode,organizationCode:e.organizationCode,status:e.lockoutEnabled?"Inactive":"Active"}}))},updateClientUser:function(t){return e.put(o+t.id,t)},checkEmailExist:function(t){return e.post(o+"userExists",{email:t})},activateOrDeactivate:function(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(o+n+t.id)},saveUser:function(t){return t.id?e.put(o+t.id,t):e.post(o,t)}}}angular.module("main.module").factory("clientUserService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord"]}(),function(){"use strict";function e(e,t){var n=t.serviceUrl+"/api/location/";return{getLocations:function(){return e.get(n)},getLocationByPostalCode:function(t){return e.get(n+t)}}}angular.module("main.module").factory("locationService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u){var m=n.serviceUrl+"/api/milkrun/";return{getMilkRunByCriteria:function(n){var o=m+"?offset="+(n.currentPage-1)*n.itemPerPage;o+="&limit="+n.itemPerPage,n.status&&(o+="&status="+n.status);""!==n.requestType&&(o+="&requestType="+n.requestType);n.dateFrom&&(o+="&fromCreatedDate="+t("date")(n.dateFrom,"yyyy-MM-dd"));n.dateTo&&(o+="&toCreatedDate="+t("date")(n.dateTo,"yyyy-MM-dd"));n.requestType&&(o+="&requestType="+n.requestType);n.searchTerm&&(o+="&search="+n.searchTerm);n.customer&&(o+="&customerId="+n.customer);n.hasPo&&(o+="&hasPo="+n.hasPo);return e.get(o)},getMilkRunById:function(t){return e.get(m+t)},saveMilkRun:function(t){t.requestDate.setHours(t.requestTime.getHours(),t.requestTime.getMinutes()),function(e){p(e.collectionPoints,e.milkRunFrequency,e.days),p(e.deliveryPoints,e.milkRunFrequency,e.days)}(t);var n=new FormData;n.append("data",JSON.stringify(t));var o=d.getImageItem();o.length&&angular.forEach(o,(function(e){angular.forEach(e.images,(function(t){n.append(e.key,t)}))}));return t.id?e.put(m+t.id,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}):e.post(m,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},assignVendor:function(t){return e.post(m+"assignvendor",t)},convertListMilkRun:function(e){var t=[];return angular.forEach(e,(function(e){t.push({id:e.id,customer:e.organizationCode+" - "+e.customerName,createdDate:e.requestDate,collectionPoints:v(e.collectionPoints,e.id),deliveryPoints:v(e.deliveryPoints,e.id),frequency:g(e,!0),status:f(e.jobStatus),createdBy:e.createdBy,poNumber:e.poNumber||"-"})})),t},convertMilkRun:function(e){return e.requestDate=c.convertDate(e.requestDate),e.projectRunDate=c.convertDate(e.projectRunDate),e.requestDate=c.convertDate(e.requestDate),e.statusText=f(e.jobStatus),e},rejectApproveMilkRun:function(t,n){return e.post(m+t+"/approve",n)},switchCollectionDeliveryPoint:function(e){e.milkRunType==l.manyToOne&&h(e.deliveryPoints)&&y(e);e.milkRunType!=l.manyToOne&&h(e.collectionPoints)&&y(e)},getMilkRunPointsFromText:function(e,t){var n=[],o=e.split(/\r\n|\n/);if(o&&o.length>1)for(var i=1;i<o.length;i++)if(o[i]){var r=o[i].split(",");n.push({address:{postalCode:r[0],blockNumber:r[1],streetName:r[2],unitNumber:r[3]},name:r[4],contactNumber:r[5],remark:r[6],surcharges:b(r[7],r[8]),items:C(r[9],r[10],r[11],t)})}return n},checkValidCollectionPoints:function(e){if(!e||0===e.length)return!1;for(var t=0;t<e.length;t++)if(e[t].isInValid)return!1;return!0},transferPricing:function(e,t){e.totalPrice=t.totalPrice},convertFrequency:g,onHoldMilkRun:function(t){return e.post(m+"onHold/"+t)},unholdMilkRun:function(t){return e.post(m+"unhold/"+t)},cancelJob:function(t){return e.post(m+t.jobId+"/cancel",t)},isValidFile:function(e,t){var n=e.split(/\r\n|\n/);if(n&&n.length>1){for(var o=1;o<n.length;o++){if(n[o])if(k(n[o].split(","),t))return!1}return!0}return!1}};function p(e,t,n){var i=u.getFixedRungBiz(),r=u.getGBizCodeHCFixedRun();i&&angular.forEach(e,(function(a){angular.forEach(a.items,(function(a){var s=(a.milkRunWeightId>=18?r:i).find((function(e){return e.id==a.milkRunWeightId}));if(s&&s.rows.length){var l=s.rows.find((function(t){return e.length>t.pointFrom&&e.length<=t.pointTo}));t==o.twiceADay.value||t==o.threeTimesADay.value||t==o.fourTimesADay.value?a.gBizCode=l.twiceDaily:t==o.daily.value?a.gBizCode=l.daily:t==o.projectRun.value?a.gBizCode=l.projectRun:t==o.weekly.value&&(n.length>4?a.gBizCode=l.daily:n.length>=2?a.gBizCode=l.thricePerWeek:1==n.length&&(a.gBizCode=l.weekly))}}))}))}function g(e,n){var a="";for(var s in o)if(o[s].value==e.milkRunFrequency){a+=o[s].display;break}if(e.milkRunFrequency===o.weekly.value){var l="";angular.forEach(e.days,(function(e){for(var t in i)if(i[t].value===e){l+=i[t].display+", ";break}})),a+=" ("+(l=l.substring(0,l.length-2))+")"}var c="";return angular.forEach(e.additionals,(function(e){for(var t in r)if(r[t].value===e){c+=r[t].display+", ";break}})),c&&(a+=", "+(c=c.substring(0,c.length-2))),!n&&e.milkRunFrequency===o.projectRun.value&&e.projectRunDate&&(a+=" ("+t("date")(e.projectRunDate,"dd/MM/yyyy")+")"),a}function v(e,t){var n,o="",i="";return e.length>3?(n=[e[0],e[1],e[2]],i='<a href="#milkrun/detail/'+t+'"> ... and '+(e.length-3)+" more<a/>"):n=e,angular.forEach(n,(function(e){e.address&&(o+="<p>"+e.address.blockNumber+" "+e.address.streetName+" "+e.address.unitNumber+" "+e.address.postalCode+"</p>")})),o+i}function f(e){for(var t in s)if(s[t].value===e)return s[t].display;return""}function h(e){return!!(e&&e[0]&&e[0].items&&e[0].items.length>0)}function y(e){var t=e.collectionPoints;e.collectionPoints=e.deliveryPoints,e.deliveryPoints=t}function C(e,t,n,o){for(var i=e.split(";"),r=t.split(";"),a=n.split(";"),s=[],l=0;l<i.length;l++)s.push({milkRunWeightId:D(i[l],o),quantity:isNaN(r[l])?"":parseInt(r[l]),remark:a[l]||""});return s}function b(e,t){for(var n=e.split(";"),o=t.split(";"),i=[],r=0;r<n.length;r++)n[r]&&!isNaN(o[r])&&i.push({description:n[r],amount:isNaN(o[r])?"":parseInt(o[r])});return i}function k(e,t){if(!(e[0]&&e[1]&&e[2]&&e[3]&&e[4]&&e[5]&&e[9]&&e[10]&&e[11]))return!0;var n=e[7].split(";"),o=e[8].split(";"),i=e[9].split(";"),r=e[10].split(";"),a=e[11].split(";");if(n.length!==o.length)return!0;if(i.length!==r.length||i.length!==a.length||r.length!==a.length)return!0;for(var s=0;s<i.length;s++)if(!i[s]||!r[s]||!D(i[s],t))return!0;return!1}function D(e,t){if(t){for(var n in a)if(e==a[n].textImport)return a[n].id;return 0}var o=e.split("-");return o&&2===o.length?parseInt(o[1]):0}}angular.module("main.module").factory("milkrunService",e),e.$inject=["$http","$filter","systemSetting","milkRunFrequency","days","milkRunAdditionals","milkRunWeight","jobStatusType","milkRunTypes","utilityService","imageService","pricingService"]}(),function(){"use strict";function e(e){return{readAsDataUrl:function(n,o){var i=e.defer();return t(i,o).readAsText(n),i.promise},exportCsvFile:function(e){var t,n,o,i=function(e){var t,n,o,i,r,a;if(null==(a=e.data||null)||!a.length)return null;return i=e.columnDelimiter||",",r=e.lineDelimiter||"\n",o=Object.keys(a[0]),t="",t+=o.join(i),t+=r,a.forEach((function(e){n=0,o.forEach((function(o){n>0&&(t+=i),t+=e[o],n++})),t+=r})),t}({data:e.data});if(null==i)return;n=e.filename||"export.csv",i.match(/^data:text\/csv/i)||(i="data:text/csv;charset=utf-8,"+i);t=encodeURI(i),(o=document.createElement("a")).setAttribute("href",t),o.setAttribute("download",n),o.click()}};function t(e,t){var n=new FileReader;return n.onload=function(e,t,n){return function(){n.$apply((function(){t.resolve(e.result)}))}}(n,e,t),n.onerror=function(e,t,n){return function(){n.$apply((function(){t.reject(e.result)}))}}(n,e,t),n}}angular.module("main.module").factory("fileReaderService",e),e.$inject=["$q"]}(),function(){"use strict";function e(e,t,n){var o=t.serviceUrl+"/api/log/";return{getLogByCriteria:function(t){var i=o+"?offset="+(t.currentPage-1)*t.itemPerPage;i+="&limit="+t.itemPerPage,t.dateFrom&&(i+="&dateFrom="+n("date")(t.dateFrom,"yyyy-MM-dd"));t.dateTo&&(i+="&dateTo="+n("date")(t.dateTo,"yyyy-MM-dd"));t.action&&(i+="&action="+t.action);t.role&&(i+="&role="+t.role);t.userSearch&&(i+="&userSearch="+encodeURIComponent(t.userSearch));t.descriptionSearch&&(i+="&descriptionSearch="+encodeURIComponent(t.descriptionSearch));t.sortColumn&&(i+="&sortBy="+t.sortColumn,i+="&ascending="+t.sortAscending);return e.get(i)}}}angular.module("main.module").factory("logService",e),e.$inject=["$http","systemSetting","$filter"]}(),function(){"use strict";function e(e,t,n){return{downloadFile:function(){var n=t.serviceUrl+"/api/location/getFile";e({method:"GET",url:n,responseType:"arraybuffer"}).success((function(e,t,n){var o=(n=n())["content-type"],i=document.createElement("a");try{var r=new Blob([e],{type:o}),a=window.URL.createObjectURL(r);i.setAttribute("href",a),i.setAttribute("download","master_location.csv");var s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});i.dispatchEvent(s)}catch(e){console.warn(e)}}),(function(e){console.warn("fail to download"),console.warn(e)}))},uploadFile:function(e,o){var i=t.serviceUrl+"/api/location/import";return n.upload({url:i,data:{file:e}})},lastUpdate:function(){var n=t.serviceUrl+"/api/location/lastUpdate";return e.get(n)}}}angular.module("main.module").factory("allLocationsService",e),e.$inject=["$http","systemSetting","Upload"]}(),function(){"use strict";function e(e,t){var n=t.serviceUrl+"/api/pricing/",o=[],i=[],r=[],a=[];return{calculateMilkRun:function(t){return e.post(n+"calculate/milkrun",t)},calculateAdhoc:function(t){return e.post(n+"calculate/adhoc",t)},transferPricing:function(e,t){e.totalPrice=t.totalPrice,s(e.collectionPoints,t.collectionPoints),s(e.deliveryPoints,t.deliveryPoints)},getAdhocgBiz:function(){return o},getFixedRungBiz:function(){return i},getGBizCodeHCFixedRun:function(){return r},getGBizCodeHCAdhoc:function(){return a},loadGBizCode:function(){e.get(n+"adhocGBiz").then((function(e){o=e.data})),e.get(n+"pssGBiz").then((function(e){i=e.data})),e.get(n+"healthCareFixedRunGBiz").then((function(e){r=e.data})),e.get(n+"healthCareAdhocGBiz").then((function(e){a=e.data}))}};function s(e,t){for(var n=0;n<e.length;n++)if(e[n].chargeableWeight=t[n].chargeableWeight,e[n].subTotalPrice=t[n].subTotalPrice,e[n].items&&e[n].items.length)for(var o=0;o<e[n].items.length;o++)e[n].items[o].unitPrice=t[n].items[o].unitPrice}}angular.module("main.module").factory("pricingService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n){var o=t.serviceUrl+"/api/vendors/";return{getVendorByCriteria:function(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var i={params:{offset:(t.currentPage-1)*t.itemPerPage,limit:t.itemPerPage}};t.searchTerm&&(i.params.search=t.searchTerm);t.departmentId&&(i.params.departmentId=t.departmentId);t.organizationCode&&(i.params.organizationCode=t.organizationCode);t.sortColumn&&(i.params.sortBy=t.sortColumn,i.params.ascending=t.sortAscending);return e.get(o,i)},getVendorById:function(t){return e.get(o+t)},saveVendor:function(t){return t.id?e.put(o+t.id,t):e.post(o,t)},activateVendor:function(t){return e.post(o+"activate/"+t)},deactivateVendor:function(t){return e.post(o+"deactivate/"+t)},checkEmailExist:function(t){return e.post(o+"vendorExists",{email:t})},convertListVendor:function(e){var t=[];return angular.forEach(e,(function(e){t.push({id:e.id,organization:e.organization,organizationCode:e.organizationCode,contactPerson:e.contactPerson,phoneNumber:e.phoneNumber,alternativeContactPerson:e.alternativeContactPerson,alternativePhoneNumber:e.alternativePhoneNumber,workAddress:e.workAddress?e.workAddress.blockNumber+" "+e.workAddress.streetName+" "+e.workAddress.unitNumber+" "+e.workAddress.postalCode:"",status:e.lockoutEnabled?"Inactive":"Active"})})),t},convertVendor:function(e){return{id:e.id,organization:e.organization,organizationCode:e.organizationCode,contactPerson:e.contactPerson,phoneNumber:e.phoneNumber,email:e.email,alternativeContactPerson:e.alternativeContactPerson,alternativePhoneNumber:e.alternativePhoneNumber,alternativeEmail:e.alternativeEmail,workAddress:e.workAddress,department:e.department,lockoutEnabled:e.lockoutEnabled}},convertListVendorDropDownList:function(e){var t=[{id:"",name:"All"},{id:"Unassigned",name:"Unassigned"}];return angular.forEach(e,(function(e){t.push({id:e.id,name:e.organization})})),t}}}angular.module("main.module").factory("vendorService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord"]}(),function(){"use strict";var e={getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},usingSummaryCounts:1,summaryCounts:{approved:12,rejected:24,completed:103,scheduled:4},summaryCounts2:{approved:25,rejected:31,completed:82,scheduled:13},usingTodaysJobs:1,todaysJobs:[{collectionPointAddress:"Blk 393 Jurong Central Street 13 #13-27, S045631",deliveryPointAddress:"5 Clementi Loop, S889970",barcode:"834976531",status:"collected"},{collectionPointAddress:"Blk 393 Jurong Central Street 13 #13-27, S045631",deliveryPointAddress:"5 Clementi Loop, S889970",barcode:"834976531",status:"completed"},{collectionPointAddress:"Blk 393 Jurong Central Street 13 #13-27, S045631",deliveryPointAddress:"5 Clementi Loop, S889970",barcode:"834976531",status:"scheduled"}],todaysJobs2:[],daysWithJobs:[1,15,16,23,26],usingSpendings:1,spendings:[{month:"Nov",amount:600},{month:"Dec",amount:1e3},{month:"Jan",amount:1500},{month:"Feb",amount:1400},{month:"Mar",amount:2500},{month:"Apr",amount:3e3},{month:"May",amount:3500},{month:"Jun",amount:800},{month:"Jul",amount:2900},{month:"Aug",amount:4300},{month:"Sep",amount:1e3},{month:"Oct",amount:1300}],spendings2:[{month:"Nov",amount:2e3},{month:"Dec",amount:200},{month:"Jan",amount:3e3},{month:"Feb",amount:300},{month:"Mar",amount:1200},{month:"Apr",amount:2600},{month:"May",amount:6e3},{month:"Jun",amount:2800},{month:"Jul",amount:600},{month:"Aug",amount:1200},{month:"Sep",amount:3500},{month:"Oct",amount:1e3}]};function t(t,n,o,i,r,a,s){var l=a.serviceUrl+"/api/dashboard/",c={getTrafficUpdates:function(){var o=t.defer(),i=function(e){return _.chain(e).first(s.maxTickerItems).map((function(e){var t=e.Message.trim().split(/ (.+)?/);return{date:t[0].replace(")",") "),message:t[1]}})).value()};a.isLocal?r((function(){o.resolve(i([{Message:"(16/11)14:24 Roadworks on Grange Road near Grange Road/Tanglin Road Junction."},{Message:"(16/11)14:10 Roadworks on Stevens Road (towards Bukit Timah Road) after Robin Close. Avoid right lane."},{Message:"(16/11)13:59 Roadworks on PIE (towards Changi Airport) after Kallang. Avoid lane 3."},{Message:"(16/11)13:56 Roadworks on AYE (towards Tuas) before Clementi Ave 2 Exit."},{Message:"(16/11)13:48 Roadworks on SLE (towards CTE) before Mandai Ave Exit with congestion till Woodlands Ave 12 Exit. Avoid lane 3."}]))}),e.getRandomInt(100,1500)):n.get("//datamall2.mytransport.sg/ltaodataservice/TrafficIncidents",{headers:{AccountKey:"z9/ibYLO05S7Cn8rgVyFQQ==","Content-Type":"application/json"}}).then((function(e){o.resolve(i(e.data.value))}),(function(e){console.warn(e)}));return o.promise},getSummary:function(e,t,o){var r={params:{jobType:o}};e&&(r.params.fromCreatedDate=i("date")(new Date(e),a.simpleDateFormat));t&&(r.params.toCreatedDate=i("date")(new Date(t),a.simpleDateFormat));return n.get(l+"summary",r)},getDaysOfMonthWithJobs:function(e,o){var r=t.defer(),s={params:{jobType:o,date:i("date")(e,a.simpleDateFormat)}},c=e.getFullYear()+"-"+(e.getMonth()+1);if(void 0!==d.daysOfMonthWithJobs&&void 0!==d.daysOfMonthWithJobs[o]&&void 0!==d.daysOfMonthWithJobs[o][c])return r.resolve(d.daysOfMonthWithJobs),r.promise;var u=function(e,t,n){return d.daysOfMonthWithJobs=d.daysOfMonthWithJobs||{},d.daysOfMonthWithJobs[e]=d.daysOfMonthWithJobs[e]||{},d.daysOfMonthWithJobs[e][t]=n,d.daysOfMonthWithJobs};n.get(l+"days",s).then((function(e){r.resolve(u(o,c,e.data))}),(function(e){console.warn(e)}));return r.promise},getSpending:function(e,o,i){var r=t.defer(),a={params:{jobType:e}};void 0!==o&&(a.params.customerId=o);void 0!==i&&(a.params.costCentre=i);n.get(l+"spending",a).then((function(e){s(r,e.data)}),(function(e){console.warn(e)}));return r.promise;function s(e,t){var n,o,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=[];if((t=t||[]).length<12){for(0===t.length?n=(new Date).getMonth():(n=_.findIndex(i,(function(e){return e===t[t.length-1].month}))+1)>i.length-1&&(n=0),o=0;o<12-t.length;++o)o+n<12?r.push(i[n+o]):r.push(i[o-(12-n)]);t=_.map(r,(function(e){return{month:e,amount:0}})).concat(t)}e.resolve({data:t})}}},d={};return c}angular.module("main.module").factory("dashboardService",t),t.$inject=["$q","$http","$location","$filter","$timeout","systemSetting","dashboardConst"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u){var m=t.serviceUrl+"/api/jobs/",p={},g=0,v=(g=0,{1:[],2:[]}),f=[];return{getAdhocPointsFromText:function(e,t,n){var o=[],i=e.split(/\r\n|\n/);if(i&&i.length>1)for(var r=1;r<i.length;r++)if(i[r]){var a=i[r].split(",");a[6]&&(a[6]=b(a[6])),o.push({address:{postalCode:a[0],blockNumber:a[1],streetName:a[2],unitNumber:a[3]},name:a[4],contactNumber:a[5],collectionDate:new Date(angular.copy(a[6])),collectionTime:k(angular.copy(a[6])),isInValid:C(a,t,n)})}return o},getAdhocByCriteria:function(t){var n=m+"?offset="+(t.currentPage-1)*t.itemPerPage;n+="&limit="+t.itemPerPage,t.status&&(n+="&status="+t.status);t.dateFrom&&(n+="&fromCreatedDate="+r("date")(t.dateFrom,"yyyy-MM-dd"));t.dateTo&&(n+="&toCreatedDate="+r("date")(t.dateTo,"yyyy-MM-dd"));t.requestType&&(n+="&requestType="+t.requestType);t.searchTerm&&(n+="&search="+t.searchTerm);t.customer&&(n+="&customerId="+t.customer);t.hasPo&&(n+="&hasPo="+t.hasPo);return e.get(n)},saveAdhoc:function(t){t.requestDate.setHours(t.requestTime.getHours(),t.requestTime.getMinutes()),function(e){h(e.serviceType,e.collectionPoints),h(e.serviceType,e.deliveryPoints)}(t);var n=new FormData;n.append("data",JSON.stringify(t));var o=c.getImageItem();o.length&&angular.forEach(o,(function(e){angular.forEach(e.images,(function(t){n.append(e.key,t)}))}));return t.id?e.put(m+t.id,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}):e.post(m,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},getAdhocById:function(t){return e.get(m+t)},assignVendor:function(n){var o=t.serviceUrl+"/api",i=n.isMilkRun?"/milkrun":"/jobs",r=n.isDriver?"/assigninternaldriver":"/assignvendor";n.isDriver?n.driverId=n.userId:n.vendorId=n.userId;return e.post(o+i+r,n)},unAssignVendor:function(n){var o=t.serviceUrl+"/api",i=n.isMilkRun?"/milkrun":"/jobs",r=n.isDriver?"/unassigninternaldriver":"/unassignvendor";return e.post(o+i+r,n)},switchCollectionDeliveryPoint:function(e){},convertAdhoc:function(e){return e.requestDate=s.convertDate(e.requestDate),e.collectionDate=s.convertDate(e.collectionDate),e.deliveryDate=s.convertDate(e.deliveryDate),e.statusText=M(e.jobStatus,i),e},convertListAdhoc:function(e){var t=[];return angular.forEach(e,(function(e){t.push({id:e.id,customer:e.customer.organizationCode+" - "+e.customer.name,createdDate:e.requestDate,collectionPoints:P(e.collectionPoints,e.id),deliveryPoints:P(e.deliveryPoints,e.id),requestType:D(e.serviceType),status:M(e.jobStatus,i),createdBy:e.createdBy,poNumber:e.poNumber||"-"})})),t},rejectApproveAdhoc:function(t){return e.post(m+"updateStatus",t)},onHoldAdhoc:function(t){return e.post(m+"onHold/"+t)},unholdAdhoc:function(t){return e.post(m+"unhold/"+t)},getServiceType:D,getAdditionalSurcharge:function(e){if(!e||!e.surchargeAmount)return[];for(var t=[],n=0;n<e.surcharges.length;n++)e.surcharges[n]&&e.surchargeAmount[n]&&t.push({name:y(e.surcharges[n]),amount:e.surchargeAmount[n]});return t},validateDateOfPoint:function(e,t,n){angular.forEach(e,(function(e){t&&e.collectionDate<t||n&&e.collectionDate.getTime()!=n.getTime()?e.isInValid=!0:e.isInValid=!1}))},updatePo:function(n,o,i){var r=t.serviceUrl+"/api";return r+=(i?"/milkrun":"/jobs")+"/"+n,e.patch(r,o)},setChosenClient:function(e){if(e){g=e.id;var t=e.pricings.find((function(e){return e.pricingType===l.Adhoc}));t&&(p={"Evening, Sat, Sun & Public Holiday":t.additionalAfterOfficeHr,"Restricted Area":t.additionalRestrictedArea})}else g=0,p={};u.searchFavoriteAddress("","1",g).then((function(e){v[1]=e.data.favoriteAddresses})),u.searchFavoriteAddress("","2",g).then((function(e){v[2]=e.data.favoriteAddresses})),u.searchFavoriteItem("",g).then((function(e){f=e.data.favoriteItems}))},getSurchargeAmount:function(e){return p[e]},getClientId:function(){return g},getFavoriteAddress:function(e){return v[e]},getFavoriteItems:function(){return f}};function h(e,t){var n=d.getAdhocgBiz(),o=d.getGBizCodeHCAdhoc();angular.forEach(t,(function(t){angular.forEach(t.items,(function(t){var i;e<4?(i=function(e,t,n){var o={1:"threeHour",2:"sameDay",3:"nextDay"};if(!n)return"";var i=n.filter((function(e){var n=t.unitMass*t.issueQuantity;return n<=20?n>e.weightFrom&&n<=e.weightTo:10==e.weightFrom||20==e.weightFrom}));if(i.length){return i.map((function(t){return t[o[e]]})).join(",")}return""}(e,t,n))&&(t.gBizCode=i):(i=function(e,t,n){if(!n)return"";var o=n.find((function(e){return t.description==e.item}));if(o)return o[{5:"officeHour",6:"officeHourExpress",7:"weekdayEvening",8:"weekdayEveningExpress",9:"weekend"}[e]];return""}(e,t,o))&&(t.gBizCode=i)}))}))}function y(e){return e==a.nonworkingDay.value?a.nonworkingDay.display+":":a.weekdayEvening.display+":"}function C(e,t,n){if(!e[0]||!e[1]||!e[2]||!e[3]||!e[4]||!e[5]||isNaN(Date.parse(e[6])))return!0;if(t&&new Date(e[6])<t)return!0;if(n){var o=new Date(e[6]);if(o.getDate()!=n.getDate()||o.getMonth()!=n.getMonth()||o.getFullYear()!=n.getFullYear())return!0}return!1}function b(e){var t=e.split("/");if(t.length<2)return e;var n=t[0];return t[0]=t[1],t[1]=n,t.join("/")}function k(e){return isNaN(Date.parse(e[6]))?null:new Date(e)}function D(e){var t=M(e,n);return"N/A"==t&&(t=M(e,o)),t}function M(e,t){for(var n in t)if(t[n].value==e)return t[n].display;return"N/A"}function P(e,t){var n,o="",i="";return e.length>3?(n=[e[0],e[1],e[2]],i='<a href="#adhoc/detail/'+t+'"> ... and '+(e.length-3)+" more<a/>"):n=e,angular.forEach(n,(function(e){e.address&&(o+="<p>"+e.address.blockNumber+" "+e.address.streetName+" "+e.address.unitNumber+" "+e.address.postalCode+"</p>")})),o+i}}angular.module("main.module").factory("adhocService",e),e.$inject=["$http","systemSetting","adhocPSSServiceType","adhocHealthCareServiceType","jobStatus","$filter","adHocSurcharge","utilityService","pricingType","imageService","pricingService","favoriteService"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l){var c=t.serviceUrl+"/api/tasks/";return{getMilkRunTaskByCriteria:function(t){var o=c+"milkrun?offset="+(t.currentPage-1)*t.itemPerPage;o+="&limit="+t.itemPerPage,""!==t.requestType&&(o+="&requestType="+t.requestType);t.jobDate&&(o+="&jobDate="+n("date")(t.jobDate,"yyyy-MM-dd"));t.status&&(o+="&status="+t.status);t.dateFrom&&(o+="&fromCreatedDate="+n("date")(t.dateFrom,"yyyy-MM-dd"));t.dateTo&&(o+="&toCreatedDate="+n("date")(t.dateTo,"yyyy-MM-dd"));t.searchTerm&&(o+="&search="+t.searchTerm);t.customer&&(o+="&customerId="+t.customer);t.vendor&&(o+="&vendorId="+t.vendor);t.driver&&(o+="&driverId="+t.driver);t.jobId&&(o+="&jobId="+t.jobId);t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending);return e.get(o)},getAdhocTaskByCriteria:function(o){var i=c+"adhoc",r={params:{}};o.currentPage&&o.itemPerPage&&(r.params.offset=(o.currentPage-1)*o.itemPerPage);o.itemPerPage&&(r.params.limit=o.itemPerPage);o.requestType&&(r.params.requestType=o.requestType);o.jobDate&&(r.params.jobDate=n("date")(o.jobDate,t.simpleDateFormat));o.status&&(r.params.status=o.status);o.dateFrom&&(r.params.fromCreatedDate=n("date")(o.dateFrom,t.simpleDateFormat));o.dateTo&&(r.params.toCreatedDate=n("date")(o.dateTo,t.simpleDateFormat));o.searchTerm&&(r.params.search=o.searchTerm);o.customer&&(r.params.customerId=o.customer);o.vendor&&(r.params.vendorId=o.vendor);o.driver&&(r.params.driverId=o.driver);o.jobId&&(r.params.jobId=o.jobId);o.sortColumn&&(r.params.sortBy=o.sortColumn,r.params.ascending=o.sortAscending);return e.get(i,r)},getMilkRunTaskById:function(t){return e.get(c+"milkrun/"+t)},getAdhocTaskById:function(t){return e.get(c+"adhoc/"+t)},assignVendorMilkrun:function(t){return e.post(c+"milkrun/assignvendor",t)},assignVendorAdhoc:function(t){return e.post(c+"adhoc/assignvendor",t)},setReadyToBillAdhoc:function(t){return e.post(c+"adhoc/ready",t)},assignDriverMilkrun:function(t){return e.post(c+"milkrun/assigndriver",t)},assignDriverAdhoc:function(t){return e.post(c+"adhoc/assigndriver",t)},assignVendorInternalDriver:function(t){var n=c,o=t.isMilkRun?"milkrun":"adhoc",i=t.isDriver?"/assigninternaldriver":"/assignvendor";t.isDriver?t.driverId=t.userId:t.vendorId=t.userId;return e.post(n+o+i,t)},unAssignVendorDriver:function(n){var o=t.serviceUrl+"/api/tasks",i=n.isMilkRun?"/milkrun":"/adhoc",r=n.isDriver?"/unassigninternaldriver":"/unassignvendor";return e.post(o+i+r,n)},updateTask:function(t,n){return e.post(c+"set/"+t,n)},updateTaskDate:function(t,n){return e.patch(c+t+"/transactionDate",n)},uploadProof:function(t){return e.post(c+"/proof",t,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},removeProof:function(t,n){var o=n?c+"removepoc":c+"removepod";return e.post(o,t)},returnOrReattemptTask:function(t,n){var o=n.isReturn?"/return":"/reattempt";return e.post(c+t+o,n)},convertListMilkRunTask:function(e){var t=[];return angular.forEach(e,(function(e){t.push({id:e.id,barcode:e.barcode,customer:e.customer,createdDate:e.createdDate,jobDate:e.jobDate,status:e.status,statusText:m(e.status,o),frequency:a.convertFrequency(e),collectionPoints:e.collectionPointAddress.blockNumber+" "+e.collectionPointAddress.streetName+" "+e.collectionPointAddress.unitNumber+" "+e.collectionPointAddress.postalCode,deliveryPoints:e.deliveryPointAddress.blockNumber+" "+e.deliveryPointAddress.streetName+" "+e.deliveryPointAddress.unitNumber+" "+e.deliveryPointAddress.postalCode,vendorText:e.vendorName?e.vendorName:e.driverName?"Internal":"-",driverName:e.driverName,createdBy:e.createdBy})})),t},convertListAdhocTask:function(e){var t=[];return angular.forEach(e,(function(e){t.push({id:e.id,barcode:e.barcode,customer:e.customer,createdDate:e.createdDate,status:e.status,statusText:m(e.status,o),requestType:d(e.requestType),jobType:u(e.jobType),pickUpDate:e.pickUpDate,deliveryDate:e.deliveryDate,collectionPoint:e.collectionPointAddress.blockNumber+" "+e.collectionPointAddress.streetName+" "+e.collectionPointAddress.unitNumber+" "+e.collectionPointAddress.postalCode,deliveryPoint:e.deliveryPointAddress.blockNumber+" "+e.deliveryPointAddress.streetName+" "+e.deliveryPointAddress.unitNumber+" "+e.deliveryPointAddress.postalCode,vendorText:e.vendorName?e.vendorName:e.driverName?"Internal":"-",driverName:e.driverName,createdBy:e.createdBy,amount:e.amount,pocImages:e.pocImages,podImages:e.podImages})})),t},convertAdhocTask:function(e){if(e.clientName=e.organizationCode+" - "+e.customer,e.barcode=e.barcode+e.id,e.statusText=m(e.status,o),e.requestType=d(e.requestType),e.totalPrice=e.subTotalPrice+e.returnReattemptCharges,e.adminRemarks&&0===e.adminRemarks.indexOf("<br/>")){var t=e.adminRemarks.length;e.adminRemarks=e.adminRemarks.substring(5,t)}return e},convertMilkrunTask:function(e){if(e.clientName=e.organizationCode+" - "+e.customer,e.barcode=e.barcode+e.id,e.statusText=m(e.status,o),e.totalPrice=e.subTotalPrice+e.returnReattemptCharges,e.adminRemarks&&0===e.adminRemarks.indexOf("<br/>")){var t=e.adminRemarks.length;e.adminRemarks=e.adminRemarks.substring(5,t)}return e},getImageFromFileName:function(n){return e.get(t.serviceUrl+"/api/image?name="+n)}};function d(e){var t=m(e,i);return"N/A"===t&&(t=m(e,r)),t}function u(e){let t="None",n={none:"None",oneToMany:"ONE pickup point to MANY delivery points",manyToOne:"MANY pickup points to ONE delivery point",oneToOne:"ONE pickup point to ONE delivery point",roundTrip:"Round Trip / Sequence"};for(var o in l)l[o]===e&&(t=n[o]);return t}function m(e,t){for(var n in t)if(t[n].value===e)return t[n].display;return"N/A"}}angular.module("main.module").factory("taskService",e),e.$inject=["$http","systemSetting","$filter","taskStatus","adhocPSSServiceType","adhocHealthCareServiceType","milkrunService","milkRunWeight","adhocTypes"]}(),function(){"use strict";function e(e,t,n,o,i,r){var a=t.serviceUrl+"/api/drivers/";return{getDriverByCriteria:function(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var o=a+"?offset="+(t.currentPage-1)*t.itemPerPage;o+="&limit="+t.itemPerPage,t.searchTerm&&(o+="&search="+t.searchTerm);t.department&&(o+="&departmentId="+t.department);t.driverType&&(o+="&driverType="+t.driverType);t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending);return e.get(o)},getInternalDriver:function(t){var o=a+"?offset=0&limit="+n+"&driverType=1&customerId="+t;return e.get(o)},saveDriver:function(t){return t.id?e.put(a+t.id,t):e.post(a,t)},getDriverById:function(t){return e.get(a+t)},activateOrDeactivate:function(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(a+n+t.id)},convertListDriver:function(e){return e.map((function(e){return{id:e.id,name:e.firstName+" "+e.lastName,userId:e.userName,department:s(e.driverDepartments),phoneNumber:e.phoneNumber,permission:c(e.driverDepartments),status:l(e.driverDepartments)?"Active":"Inactive",vendorName:e.vendorName||"-",driverType:e.vendorId?"External":"Internal"}}))},convertListVendorDropDownList:function(e){var t=[{id:"",name:"All"},{id:"Unassigned",name:"Unassigned"}];return angular.forEach(e,(function(e){t.push({id:e.id,name:e.firstName+" "+e.lastName})})),t},updatePassword:function(t){return e.post(a+"ChangePassword",t)},checkUserIdExist:function(t,n){var o=a+"CheckUserExists?username="+t;n&&(o+="&id="+n);return e.get(o)}};function s(e){return e.map((function(e){return 1===e.departmentId?"PSS":"Healthcare"})).join("/")}function l(e){var t=e;if(o.currentUser.role!==i.SuperAdmin){var n=o.currentUser.department===r.PSS.name?r.PSS.id:r.Healthcare.id;t=e.filter((function(e){return e.departmentId===n}))}return t.some((function(e){return e.active}))}function c(e){var t=e.some((function(e){return 1===e.departmentId&&e.hasCreateJobPermission})),n=e.some((function(e){return 2===e.departmentId&&e.hasCreateJobPermission})),o=[];return t&&o.push("PSS"),n&&o.push("Healthcare"),o.length?o.join("/"):"No"}}angular.module("main.module").factory("driverService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord","$rootScope","systemRole","departments"]}(),function(){"use strict";function e(e,t,n,o,i,r){var a=t.serviceUrl+"/api/report/";return{getReportByCriteria:function(t){var o=a;o+="?offset="+(t.currentPage-1)*t.itemPerPage,o+="&limit="+t.itemPerPage,t.fromDate&&(o+="&fromDate="+n("date")(t.fromDate,"yyyy-MM-dd"));t.toDate&&(o+="&toDate="+n("date")(t.toDate,"yyyy-MM-dd"));t.searchTerm&&(o+="&search="+t.searchTerm);t.customer&&(o+="&customerId="+t.customer);t.departmentId&&(o+="&departmentId="+t.departmentId);return o+="&type="+t.type,e.get(o)},exportCsv:function(t){var o=a+"export?type="+t.type;t.fromDate&&(o+="&fromDate="+n("date")(t.fromDate,"yyyy-MM-dd"));t.toDate&&(o+="&toDate="+n("date")(t.toDate,"yyyy-MM-dd"));t.customerIds&&(o+="&customerIds="+t.customerIds.join(","));t.columns&&(o+="&columns="+t.columns.join(","));return e.get(o)},getColumns:function(t){t=t||0;var n=a+"columnsSetting";return e.get(n)},convertListReport:function(e,t){return e.map((function(e){var a=l(e.subJobType),c="0"==t?i.getServiceType(e.serviceType):s(e.serviceType,r);return{BarcodeNumber:e.barcode+e.id,OrganizationName:e.customer,OrganizationCode:e.organizationCode,SAPCode:e.sapCode,Department:e.department,RequestorName:e.requester,RequestorContact:e.requesterContact,CostCenter:e.costCentre,BillingAddress:e.billingAddress,RequestDate:n("date")(e.requestDate,"dd/MM/yyyy HH:mm:ss"),JobType:e.jobType||"Fixed Run",TypeAdHoc:a,TypeService:c,TypeFixedRun:a,Frequency:c,CollectionAddress:e.collectionPointAddress,ScheduledCollectionDate:n("date")(e.pickUpDate,"dd/MM/yyyy"),DeliveryAddress:e.deliveryPointAddress,ScheduledDeliveryDate:n("date")(e.deliveryDate,"dd/MM/yyyy"),NumberItems:e.numberOfItems,ItemDescription:e.itemDescription,Charge:e.subTotalPrice,AdditionalCost:e.returnReattemptCharges,TotalCost:e.subTotalPrice+e.returnReattemptCharges,Status:s(e.status,o),POCTimestamp:n("date")(e.pocDate,"dd/MM/yyyy HH:mm:ss"),PODTimestamp:n("date")(e.podDate,"dd/MM/yyyy HH:mm:ss"),CreatedBy:e.createdBy||"None",VendorName:e.vendorName,DriverName:e.driverName,VehicleNumber:e.vehicleNumber,DriverRemark:e.driverRemark,PhotoPresent:e.photoPresent,SurchargesJob:"$"+e.surcharges+" (Job ID: "+e.jobId+")",AdditionalSurcharges:e.additionalCharges||0,Remark:e.additionalChargeRemark,Reattempt:e.reattempt}}))},updateColumns:function(t){return e.post(a+"updateColumnsSetting",{columnIds:t})}};function s(e,t){for(var n in t)if(t[n].value===e)return t[n].display;return"N/A"}function l(e){return 1==e?"One To One":2==e?"One To Many":3==e?"Many To One":"N/A"}}angular.module("main.module").factory("reportService",e),e.$inject=["$http","systemSetting","$filter","taskStatus","adhocService","milkRunFrequency"]}(),function(){"use strict";function e(e){return{convertDate:function(t){var n=(new Date).getTimezoneOffset(),o=e+n,i=new Date(t);return i.setMinutes(i.getMinutes()-o),i},getAbsoluteElHeight:function(e){e="string"==typeof e?document.querySelector(e):e;var t=window.getComputedStyle(e),n=parseFloat(t.marginTop)+parseFloat(t.marginBottom);return Math.ceil(e.offsetHeight+n)}}}angular.module("main.module").factory("utilityService",e),e.$inject=["defaultTimeZoneOffset"]}(),function(){"use strict";function e(e,t,n,o){var i=t.serviceUrl+"/api/favorite/";return{getByCriteria:function(t){t.currentPage=t.currentPage||1,t.itemPerPage=t.itemPerPage||n;var o=t.isAddress?"getFavoriteAddresses":"getFavoriteItems",r=i+o+"?offset="+(t.currentPage-1)*t.itemPerPage;r+="&limit="+t.itemPerPage,t.searchTerm&&(r+="&search="+t.searchTerm);t.addressType&&(r+="&addressType="+t.addressType);t.sortColumn&&(r+="&sortBy="+t.sortColumn,r+="&ascending="+t.sortAscending);return e.get(r)},getFavoriteAddress:function(t){var n=o.defer();return e.get(i+"favoriteAddress/"+t).then((function(e){var t=e.data;t.address={postalCode:t.postalCode,blockNumber:t.blockNumber,streetName:t.streetName,unitNumber:t.unitNumber},n.resolve(t)})),n.promise},getFavoriteItem:function(t){return e.get(i+"favoriteItem/"+t)},activateOrDeactivate:function(t){var n=t.lockoutEnabled?"activate/":"deactivate/";return e.post(i+n+t.id)},convertListItem:function(e,t){if(t)return e.favoriteAddresses.map((function(e){return{id:e.id,name:e.name,address:e.blockNumber+" "+e.streetName+" "+e.unitNumber+" "+e.postalCode,contactPerson:e.contactPerson,contactNumber:e.contactNumber,addressType:1===e.addressType?"Collection":2===e.addressType?"Delivery":"Collection & Delivery"}}));return e.favoriteItems.map((function(e){return{id:e.id,name:e.name,description:e.description,uom:e.uom,issueQuantity:e.issueQuantity,unitMass:e.unitMass?e.unitMass+" kg":"-",unitVolume:e.width&&e.height&&e.depth?e.width+"x"+e.height+"x"+e.depth+" = "+Math.round(e.width*e.height*e.depth/5e3*100)/100+" cm3":"-"}}))},convertListVendorDropDownList:function(e){var t=[{id:"",name:"All"},{id:"Unassigned",name:"Unassigned"}];return angular.forEach(e,(function(e){t.push({id:e.id,name:e.firstName+" "+e.lastName})})),t},saveFavoriteAddress:function(t){return t.postalCode=t.address.postalCode,t.blockNumber=t.address.blockNumber,t.streetName=t.address.streetName,t.unitNumber=t.address.unitNumber,t.id?e.put(i+"updateFavoriteAddress/"+t.id,t):e.post(i+"createFavoriteAddress",t)},saveFavoriteItem:function(t){return t.id?e.put(i+"updateFavoriteItem/"+t.id,t):e.post(i+"createFavoriteItem",t)},deleteAddress:function(t){return e.delete(i+"deleteFavoriteAddress/"+t)},deleteItem:function(t){return e.delete(i+"deleteFavoriteItem/"+t)},searchFavoriteAddress:function(t,n,o){var r=i+"getFavoriteAddresses?search="+t;n&&(r+="&addressType="+n);o&&(r+="&customerId="+o);return e.get(r)},searchFavoriteItem:function(t,n){var o=i+"getFavoriteItems?search="+t;n&&(o+="&customerId="+n);return e.get(o)}}}angular.module("main.module").factory("favoriteService",e),e.$inject=["$http","systemSetting","maxNumberOfRecord","$q"]}(),function(){"use strict";function e(e,t){var n=[];return{setImageItem:function(e,t,o){o?angular.forEach(n,(function(e){e.key===t&&(e.images=e.images.filter((function(e){return e.name!==o})))})):n.push({key:t,images:e})},getImageItem:function(){return n},clearImageItem:function(){n=[]},getImageFromFileName:function(n){return e.get(t.serviceUrl+"/api/image?name="+n)},getImageFromName:function(e){var t="";return angular.forEach(n,(function(n){angular.forEach(n.images,(function(n){n.name===e&&(t=n)}))})),t}}}angular.module("main.module").factory("imageService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";angular.module("main.module").factory("billingService",t),t.$inject=["$http","systemSetting","$sce","$filter"];var e={0:"Adhoc",1:"Fixed Job",2:"Fixed Transaction"};function t(t,n,o,i){var r=n.serviceUrl+"/api/billing";return{getByCriteria:function(e,n){var o=n?r:r+"/cancelled";o=o+"?offset="+(e.currentPage-1)*e.itemPerPage,o+="&limit="+e.itemPerPage,e.status&&(o+="&ready="+e.status);e.searchTerm&&(o+="&search="+e.searchTerm);e.date&&(o+="&period="+i("date")(e.date,"MM/yyyy"));e.sortColumn&&(o+="&sortBy="+e.sortColumn,o+="&ascending="+e.sortAscending);e.department&&(o+="&departmentId="+e.department);return t.get(o)},getBillingDetail:function(e,n,o,i){var a=e.split("-"),s="";o&&(s+="/cancelled");var l=r+s+"/detail?customerId="+a[0]+"&costCentreId="+a[1]+"&poNumberId="+a[2];i=a[3]+"/"+a[4];l+="&period="+i,l+="&billingType="+a[5],n&&(l+="&search="+n);return t.get(l)},doAction:function(e,n){return t.post(r+"/"+n,e)},summaryBilling:function(e){return t.get(r+"/summary?period="+i("date")(e,"MM/yyyy"))},convertBilling:function(t){return t.map((function(t){var n=t.readyAmount===t.totalAmount?"full":"in-progress",r=100*t.readyAmount/t.totalAmount,a=o.trustAsHtml('<div class="progress billing-progress"><div class="progress-bar '+n+'" style="width:'+r+'%"></div></div>');return{customerId:t.customerId,poNumberId:t.poNumberId,costCentreId:t.costCentreId,customerName:t.customerName||"-",costCentreName:t.costCentreName||"-",poNumber:t.poNumber||"-",totalJob:t.readyJob+"/"+t.totalJob+" ready",amountBar:a,billingType:t.billingType,billingTypeText:e[t.billingType],amountText:"<b>"+i("currency")(t.readyAmount)+"/"+i("currency")(t.totalAmount)+"</b>"}}))},convertCancelledBilling:function(t){return t.map((function(t){return t.totalAmount=i("currency")(t.totalAmount),t.billingTypeText=e[t.billingType],t}))}}}}(),function(){"use strict";function e(e,t,n,o){var i=t.serviceUrl+"/api/invoices";return{getByCriteria:function(t){var o=i+"?offset="+(t.currentPage-1)*t.itemPerPage;o+="&limit="+t.itemPerPage,t.status&&(o+="&status="+t.status);t.searchTerm&&(o+="&search="+t.searchTerm);t.date&&(o+="&period="+n("date")(t.date,"MM/yyyy"));t.department&&(o+="&departmentId="+t.department);t.sortColumn&&(o+="&sortBy="+t.sortColumn,o+="&ascending="+t.sortAscending);return e.get(o)},convertData:function(e){return e.map((function(e){return{invoiceNumber:e.invoiceNumber||"-",refNumber:e.refNumber||"-",invoiceDate:e.invoiceDate?n("date")(e.invoiceDate,"dd/MM/yyyy"):"-",soNumber:e.soNumber,customerName:e.customerName||"-",costCentreName:e.costCentreName||"-",poNumber:e.poNumber||"-",totalJob:e.totalJob||"-",status:e.status?r(e.status):"-",totalAmount:n("currency")(e.totalAmount)||"-"}}))},getInvoiceDetail:function(t){var n=i+"/detail?offset="+(t.currentPage-1)*t.itemPerPage;n+="&limit="+t.itemPerPage,t.refNumber&&(n+="&refNumber="+t.refNumber);t.invoiceNumber&&(n+="&invoiceNumber="+t.invoiceNumber);t.soNumber&&(n+="&soNumber="+t.soNumber);t.searchTerm&&(n+="&search="+t.searchTerm);t.status&&(n+="&status="+t.status);return e.get(n)},getSummary:function(t){var o=i+"/summary?period="+n("date")(t,"MM/yyyy");return e.get(o)},creditNoteOrCancel:function(t,n){return e.post(i+"/"+t,n)}};function r(e){for(var t in o)if(o[t].value===e)return o[t].display;return""}}angular.module("main.module").factory("invoicedService",e),e.$inject=["$http","systemSetting","$filter","invoiceStatus"]}(),function(){"use strict";function e(e,t){var n=this;function o(e){var t=!1;return angular.forEach(n.chosenColumnModel,(function(n){n.id===e&&(t=!0)})),t}n.setItemPerPage=e,n.sort=function(e){n.options.sortColumn===e?n.options.sortAscending=!n.options.sortAscending:(n.options.sortAscending=!0,n.options.sortColumn=e);n.actionRequest()},n.showChosenColumn&&(n.isContainColumn=o,n.translationTexts={checkAll:"Show All",dynamicButtonTextSuffix:"columns"},n.chosenColumnConfig={idProp:"name",displayProp:"display",showUncheckAll:!1},n.chosenColumnModel=[],angular.forEach(n.gridConfig.columns,(function(e){n.chosenColumnModel.push({id:e.name})}))),n.eventsChosenColumn={onItemDeselect:function(e){1===n.chosenColumnModel.length&&n.chosenColumnModel.push(e),document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="none"},onSelectAll:function(){document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="inline"}}}angular.module("main.module").directive("grid",(function(){return{restrict:"E",scope:{gridConfig:"=",options:"=",data:"=",actionRequest:"&",isLoading:"=",showChosenColumn:"=?"},templateUrl:"app/directives/commonControls/grid/grid.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["setItemPerPage","$scope"]}(),function(){"use strict";function e(e,t){var n=this;n.setItemPerPage=e,n.optionsGrid={sortColumn:"",sortAscending:!0,itemPerPage:20,totalItems:0},n.sort=function(e){n.optionsGrid.sortColumn===e?n.optionsGrid.sortAscending=!n.optionsGrid.sortAscending:(n.optionsGrid.sortAscending=!0,n.optionsGrid.sortColumn=e);n.actionRequest()},n.navigateToDetail=function(e){t.path(n.gridConfig.navigationDetail+e)},n.columnModel=[],n.columnsData=[{id:1,label:"Collection barcode"},{id:2,label:"Customer"},{id:3,label:"Created date"},{id:4,label:"Request type"},{id:5,label:"Request status"},{id:6,label:"Status"},{id:7,label:"Pick up point"},{id:8,label:"Delivery point"}],n.defaultText={buttonDefaultText:"Default"},n.column1=!0,n.column2=!0,n.column3=!0,n.column4=!0,n.column5=!0,n.column6=!0,n.column7=!0,n.column8=!0,n.columnModel=[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8}],n.eventListeners={onItemSelect:function(e){console.log("select > "+e.id),function(e){switch(e){case 1:n.column1=!0;break;case 2:n.column2=!0;break;case 3:n.column3=!0;break;case 4:n.column4=!0;break;case 5:n.column5=!0;break;case 6:n.column6=!0;break;case 7:n.column7=!0;break;case 8:n.column8=!0}}(e.id)},onItemDeselect:function(e){console.log("deselect : "+e.id),function(e){switch(e){case 1:n.column1=!1;break;case 2:n.column2=!1;break;case 3:n.column3=!1;break;case 4:n.column4=!1;break;case 5:n.column5=!1;break;case 6:n.column6=!1;break;case 7:n.column7=!1;break;case 8:n.column8=!1}}(e.id)}}}angular.module("main.module").directive("gridExt",(function(){return{restrict:"E",scope:{gridConfig:"=",optionsGrid:"=",options:"=",data:"=",actionRequest:"&",isLoading:"="},templateUrl:"app/directives/commonControls/gridExt/gridExt.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["setItemPerPage","$location"]}(),function(){"use strict";function e(e,t){this.data=t,this.ok=function(t){e.close(t)},this.cancel=function(){e.dismiss("cancel")}}angular.module("main.module").controller("ModalInstanceCtrl",e),e.$inject=["$uibModalInstance","data"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){var s=this;s.pageName=i,s.systemRole=r,s.logout=function(){o.logout(),t.currentUser=null,n.path("/login")},s.isNavItemAllowed=function(e){if(t.currentUser&&t.currentUser.role){var n=a[t.currentUser.role];if(n.viewOnly&&t.currentUser.viewOnly&&n.preventPage.indexOf(e)>-1)return!1}return l.indexOf(e)>-1},s.profileDisplayName="",t.currentUser&&(s.profileDisplayName=t.currentUser.firstName,t.currentUser.lastName&&(s.profileDisplayName+=" "+t.currentUser.lastName));var l=t.currentUser?a[t.currentUser.role].navigationItems:[]}angular.module("main.module").directive("headerPage",(function(){return{restrict:"E",templateUrl:"app/directives/header/header.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$timeout","$rootScope","$location","authService","pageName","systemRole","systemRolesConfigs"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){var s=this,l=r.footerHTML||[];s.content=_.map(l,(function(t){return e(t)})),s.alignment=t.alignFooter,t.$watch("alignFooter",(function(e){s.alignment=e})),s.doStickyCalculation=t.stickyFooter||!1,s.stickyFooter=!1;var c=document.getElementById("root-container");document.getElementById("footer");function d(){u()}function u(){if(s.doStickyCalculation){var e=c.clientHeight,t=a.getAbsoluteElHeight(footer),n=i.innerHeight,r=!1;e+t+0<n&&(r=!0),o((function(){s.stickyFooter=r}))}}t.$watch("stickyFooter",(function(e){s.doStickyCalculation=e,u()})),angular.element(i).on("resize",d),n.$on("$destroy",(function(){angular.element(i).off("resize",d)}))}angular.module("main.module").directive("footerPage",(function(){return{restrict:"E",templateUrl:"app/directives/footer/footer.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$sanitize","$rootScope","$scope","$timeout","$window","userConfig","utilityService"]}(),function(){"use strict";angular.module("main.module").directive("compareTo",(function(){return{restrict:"A",require:"ngModel",scope:{compareTo:"=compareTo"},link:function(e,t,n,o){t.bind("keyup",(function(){e.$apply((function(){var n=t.val(),i=e.compareTo,r=n&&n===i;o.$setValidity("compareTo",r)}))}))}}}))}(),function(){"use strict";function e(e,t){var n=this;n.onChange=function(){t((function(){n.ngChange&&n.ngChange()}))},n.onKeyDown=function(e){var t=e.which||e.keyCode,n=e.ctrlKey?e.ctrlKey:17===t,o=e.metaKey?e.metaKey:93===t;if((n||o)&&[65,67,86].indexOf(e.keyCode)>-1)return;-1===[46,48,49,50,51,52,53,54,55,56,57,191,8,9].indexOf(e.keyCode)&&e.preventDefault()},function(){n.isOpen=!1,n.datePicker="dd/MM/yyyy",n.minDate&&e.$watch("vm.minDate",(function(e){var t=angular.copy(e);t=new Date(t.setHours(0,0,0,0)),n.datepickerOptions=n.datepickerOptions?n.datepickerOptions:{},n.datepickerOptions.minDate=t}));n.monthPicker&&e.$watch("vm.monthPicker",(function(e){n.datepickerOptions=n.datepickerOptions?n.datepickerOptions:{},n.datepickerOptions.minMode="month"}));n.dateFormat&&e.$watch("vm.dateFormat",(function(e){n.datePicker=e}))}(),n.openCalendar=function(e){e.preventDefault(),e.stopPropagation(),n.isOpen=!0}}angular.module("main.module").directive("customDatePicker",(function(){return{restrict:"E",scope:{ngModel:"=",placeHolder:"@?",minDate:"=?",ngDisabled:"=?",isTouch:"=?",dateFormat:"=?",monthPicker:"=?",ngChange:"&?"},templateUrl:"app/directives/commonControls/datePicker/datePicker.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$scope","$timeout"]}(),function(){"use strict";function e(){var e=this;e.timepickerOptions={showMeridian:!1},e.isOpen=!1,e.openCalendar=function(t){t.preventDefault(),t.stopPropagation(),e.isOpen=!0}}angular.module("main.module").directive("customTimePicker",(function(){return{restrict:"E",scope:{ngModel:"=",ngDisabled:"=?"},templateUrl:"app/directives/commonControls/timePicker/timePicker.html",controller:e,controllerAs:"vm",bindToController:!0}}))}(),function(){"use strict";function e(e){return{restrict:"A",link:function(t,n,o){var i=e(o.fileModel).assign,r=t.$eval(o.customOnChange);n.bind("change",(function(){i(t,n[0].files[0]),r()}))}}}function t(e){return{restrict:"A",link:function(t,n,o){var i=e(o.filesModel).assign,r=t.$eval(o.customOnChange);n.bind("change",(function(){i(t,n[0].files),r()}))}}}angular.module("main.module").directive("fileModel",e).directive("filesModel",t),e.$inject=["$parse"],t.$inject=["$parse"]}(),function(){"use strict";function e(){var e=this;e.sortByColumn=function(t){e.options.sortColumn===t?e.options.sortAscending=!e.options.sortAscending:(e.options.sortAscending=!0,e.options.sortColumn=t);e.sort()}}angular.module("main.module").directive("headerSorting",(function(){return{restrict:"EA",replace:!0,scope:{column:"=",options:"=",sort:"&"},templateUrl:"app/directives/commonControls/headerSorting/headerSorting.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(e,t,n,o){var i=this;function r(){e.activateOrDeactivate(i.userDetail).then((function(e){var t=i.userDetail.lockoutEnabled?"The user has been activated successfully.":"The user has been deactivated successfully.";i.userDetail.lockoutEnabled=!i.userDetail.lockoutEnabled,n.success(t),i.onActivateOrDeactivate()}))}i.systemRole=o,i.addBillingAddress=function(){i.userDetail.billingAddresses.push({postalCode:"",blockNumber:"",streetName:"",unitNumber:""})},i.deleteBillAddress=function(e){i.userDetail.billingAddresses.splice(e,1)},i.checkEmailExist=function(){if(i.userDetail.id&&i.userDetail.email===i.originalEmail)return;e.checkEmailExist(i.userDetail.email).then((function(e){i.emailExist=!0}),(function(e){i.emailExist=!1}))},i.activateOrDeactivate=function(){var e=i.userDetail.lockoutEnabled?"Are you sure you want to activate this user?":"Are you sure you want to deactivate this user?";t.createWarningPopup(e,"Warning",r)},i.searchCostCenter=function(t){return e.searchCostCenter(t).then((function(e){return[]}))},i.onSelectCostCenter=function(e){i.userDetail.costCentre=e.name},i.searchPO=function(t){return e.searchPO(t).then((function(e){return e}))},i.onSelectPO=function(e){i.userDetail.po=e.name},i.createCostCenter=function(){n.success("The SBU has been created successfully."),i.noCostCenterFound=!1},i.emailFormat=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,function(){i.sapCodes.unshift({id:"",code:"Please select ..."}),i.userDetail.sapCodeId=i.userDetail.sapCodeId||"",i.userDetail.id&&(i.originalEmail=i.userDetail.email);i.userDetail.workAddress=i.userDetail.workAddress||{}}()}angular.module("main.module").directive("userClientDetail",(function(){return{restrict:"E",scope:{userDetail:"=",onCreateOrUpdate:"&",onActivateOrDeactivate:"&?",onCancel:"&",viewMode:"=",sapCodes:"=",poNumbers:"=",costCenters:"="},templateUrl:"app/directives/userClient/userClientDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["clientUserService","modalService","toastr","systemRole"]}(),function(){"use strict";function e(e){var t=this;function n(){t.ngModel.postalCode&&t.ngModel.blockNumber&&t.ngModel.streetName&&t.ngModel.unitNumber||t.isDelete?t.isValid=!0:t.isValid=!1}t.searchAddressByPostalCode=function(t){return e.getLocationByPostalCode(t).then((function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]}))},t.onSelect=function(e){t.ngModel.postalCode=e.postalCode,t.ngModel.blockNumber=e.blockNumber,t.ngModel.streetName=e.streetName},t.checkValidAddress=n,n()}angular.module("main.module").directive("userAddress",(function(){return{restrict:"E",scope:{ngModel:"=",isSearchable:"=",isDelete:"=?",isShowFullWidth:"=",onDelete:"&?",isValid:"=?",isShowWarning:"=?",warningMessage:"@?",viewMode:"=?",largeWidth:"=?"},templateUrl:"app/directives/userClient/userAddress.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["locationService"]}(),function(){"use strict";function e(e,t,n,o,i,r){var a=this;function s(){a.saturdaysChecked=a.ngModel.additionals.indexOf(a.milkRunAdditionals.saturdays.value)>-1,a.sundaysChecked=a.ngModel.additionals.indexOf(a.milkRunAdditionals.sundays.value)>-1,a.afterOfficeHoursChecked=a.ngModel.additionals.indexOf(a.milkRunAdditionals.afterOfficeHours.value)>-1,a.publicHolidaysChecked=a.ngModel.additionals.indexOf(a.milkRunAdditionals.publicHolidays.value)>-1}a.systemRole=r,a.milkRunTypes=e,a.milkRunFrequency=t,a.days=n,a.milkRunAdditionals=o,a.changeDay=function(e){var t=a.ngModel.days.indexOf(e);t>-1?a.ngModel.days.splice(t,1):a.ngModel.days.push(e);a.weeklyInvalid=0===a.ngModel.days.length},a.changeAdditional=function(e){var t=a.ngModel.additionals.indexOf(e);t>-1?a.ngModel.additionals.splice(t,1):a.ngModel.additionals.push(e);s()},a.changeFrequency=function(){a.ngModel.milkRunFrequency==t.weekly.value&&0===a.ngModel.days.length?a.weeklyInvalid=!0:(a.weeklyInvalid=!1,a.ngModel.days=[]);a.ngModel.milkRunFrequency!=t.projectRun.value||a.ngModel.projectRunDate?(a.projectRunInvalid=!1,a.ngModel.projectRunDate=null):a.projectRunInvalid=!0},a.changeMilkRunType=function(){},a.getFrequency=function(){return i.convertFrequency(a.ngModel)},function(){a.ngModel.requestDate=a.ngModel.requestDate||new Date,a.ngModel.days=a.ngModel.days||[],a.ngModel.additionals=a.ngModel.additionals||[],a.ngModel.milkRunFrequency!=t.weekly.value&&(a.ngModel.days=[]);a.ngModel.milkRunFrequency!=t.projectRun.value&&(a.ngModel.projectRunDate=null);s()}()}angular.module("milkRun.module").directive("choseMilkRunType",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/milkRun/step/choseMilkrunType.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["milkRunTypes","milkRunFrequency","days","milkRunAdditionals","milkrunService","systemRole"]}(),function(){"use strict";function e(e){this.jobStatus=e}angular.module("milkRun.module").directive("collectionPoint",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/milkRun/step/collectionPoint.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["jobStatus"]}(),function(){"use strict";function e(e){this.jobStatus=e}angular.module("milkRun.module").directive("deliveryPoint",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/milkRun/step/deliveryPoint.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["jobStatus"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d){var u=this;function m(){u.isLoading=!0,o.rejectApproveMilkRun(u.ngModel.id,{status:0,remark:u.approveRejectData.remark}).then((function(e){u.isLoading=!1,i.success("The Fixed Run has been rejected successfully."),u.ngModel.jobStatus=t.rejected.value}))}function p(){u.isLoading=!0,o.rejectApproveMilkRun(u.ngModel.id,{status:1,remark:u.approveRejectData.remark}).then((function(e){u.isLoading=!1,i.success("The Fixed Run has been approved successfully."),u.ngModel.jobStatus=t.accepted.value}))}u.systemRole=e,u.jobStatusType=t,u.saveMilkRun=function(){u.isLoading=!0,o.saveMilkRun(u.ngModel).then((function(e){u.isLoading=!1,r.clearImageItem();var t=u.ngModel.id?"The Fixed Run has been updated successfully.":"The Fixed Run has been created successfully.";i.success(t),s.path("/milkruns")}),(function(e){u.isLoading=!1,i.error(e.data.message)}))},u.calculate=function(){u.isLoading=!0,n.calculateMilkRun(u.ngModel).then((function(e){n.transferPricing(u.ngModel,e.data),u.isCalculated=!0,u.viewMode=!0,u.isLoading=!1})).catch((function(e){i.warning(e.data.message),u.isLoading=!1}))},u.edit=function(){u.viewMode=!1,u.updateMode=!0},u.onCancel=function(){u.ngModel.id?(u.viewMode=!0,u.updateMode=!1,u.cancel()):u.isCalculated?(u.isCalculated=!1,u.viewMode=!1):s.path("/milkruns")},u.approveReject=function(e){var t={confirm:e?p:m};u.approveRejectData={isApprove:e,remark:""},a.createPopup({templateUrl:"app/directives/milkRun/step/approveRejectModal.html",size:"lg",data:u.approveRejectData},t)},u.checkJobInvalid=function(){if(u.ngModel.isMultiplePO&&!u.ngModel.remark)return!0;var e=!(!(u.ngModel.customerId&&u.ngModel.requesterId&&u.ngModel.costCentreId&&u.ngModel.milkRunType&&u.ngModel.requestDate&&u.ngModel.requestTime)||!u.ngModel.milkRunFrequency&&0!=u.ngModel.milkRunFrequency);u.ngModel.milkRunFrequency!=l.weekly.value||u.ngModel.days.length||(e=!1);var t=u.ngModel.collectionPoints.find((function(e){return e.editMode})),n=u.ngModel.deliveryPoints.find((function(e){return e.editMode}));return!(e&&!t&&u.ngModel.collectionPoints.length&&!n&&u.ngModel.deliveryPoints.length)},u.onHoldMilkRun=function(){o.onHoldMilkRun(u.ngModel.id).then((function(e){i.success("The Fixed Run has been on hold successfully."),u.getJobDetail()}))},u.unholdMilkRun=function(){o.unholdMilkRun(u.ngModel.id).then((function(e){i.success("The Fixed Run has been un hold successfully."),u.getJobDetail()}))},u.typeOfBillings=d.currentUser.department===c.PSS.name?[{id:1,name:"Monthly fixed charges"},{id:2,name:"Monthly transaction charges"}]:[{id:1,name:"Monthly fixed charges"}],u.canEdit=u.ngModel.jobStatus!==u.jobStatusType.readyToBill.value&&u.ngModel.jobStatus!==u.jobStatusType.pendingRejection.value&&u.ngModel.jobStatus!==u.jobStatusType.billed.value}angular.module("milkRun.module").directive("milkRunConfirmPricing",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"=",isLoading:"=",getJobDetail:"&",cancel:"&"},templateUrl:"app/directives/milkRun/step/confirmPricing.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["systemRole","jobStatusType","pricingService","milkrunService","toastr","imageService","modalService","$location","milkRunFrequency","departments","$rootScope"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d){var u=this;function m(){u.isLoading=!0,i.rejectApproveMilkRun(u.ngModel.id,{status:0,remark:u.approveRejectData.remark}).then((function(e){u.isLoading=!1,s.success("The Fixed Run has been rejected successfully."),u.ngModel.jobStatus=l.rejected.value}))}function p(){u.isLoading=!0,i.rejectApproveMilkRun(u.ngModel.id,{status:1,remark:u.approveRejectData.remark}).then((function(e){u.isLoading=!1,s.success("The Fixed Run has been approved successfully."),u.ngModel.jobStatus=l.accepted.value}))}u.departments=d,u.milkRunTypes=o,u.systemRole=r,u.jobStatusType=l,u.back=function(){e.currentUser.role===r.Admin?u.currentProgress=n.remark:u.currentProgress=n.deliveryPoint},u.saveMilkRun=function(){u.isLoading=!0,i.saveMilkRun(u.ngModel).then((function(e){u.isLoading=!1;var n=u.ngModel.id?"The Fixed Run has been updated successfully.":"The Fixed Run has been created successfully.";s.success(n),t.path("/milkruns")}))},u.edit=function(){u.viewMode=!1,u.ngModel.originalCollectionPoints=angular.copy(u.ngModel.collectionPoints),u.ngModel.originalDeliveryPoints=angular.copy(u.ngModel.deliveryPoints),u.currentProgress=n.chosenMilkRunType,s.warning("Changing frequency, collection point or delivery point information will recalculate pricing based on current pricing table and overwrite the manual pricing edits.")},u.approveRejectMilkRun=function(e){var t={confirm:e?p:m};u.approveRejectData={isApprove:e,remark:""},a.createPopup({templateUrl:"app/directives/milkRun/step/approveRejectModal.html",size:"lg",data:u.approveRejectData},t)},function(){if(u.ngModel){if(u.ngModel.frequency=i.convertFrequency(u.ngModel),e.currentUser.department!==d.PSS.name)return;(!u.ngModel.id||u.ngModel.id&&function(){if(!angular.equals(u.ngModel.collectionPoints,u.ngModel.originalCollectionPoints)||!angular.equals(u.ngModel.deliveryPoints,u.ngModel.originalDeliveryPoints))return!0;return!1}())&&(u.isLoading=!0,c.calculateMilkRun(u.ngModel).then((function(e){i.transferPricing(u.ngModel,e.data),u.isLoading=!1})).catch((function(e){s.warning("There's no pricing for calculation!"),u.isLoading=!1})))}}()}angular.module("milkRun.module").directive("confirmOrder",(function(){return{restrict:"E",scope:{ngModel:"=",currentProgress:"=",viewMode:"=",isLoading:"="},templateUrl:"app/directives/milkRun/step/confirmOrder.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$rootScope","$location","milkRunProgress","milkRunTypes","milkrunService","systemRole","modalService","toastr","jobStatusType","pricingService","departments"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;function a(){r.isLoading=!0,n.assignVendor({isMilkRun:!0,isDriver:r.dataAssignVendor.isDriver,userId:r.dataAssignVendor.user.id,targetIds:r.ngModel.deliveryPoints.map((function(e){return e.id}))}).then((function(e){o.success("The selected points have been assigned to "+(r.dataAssignVendor.isDriver?"driver":"vendor")+" successfully."),r.listCheckPoint=[],r.isCheckAll=!1,r.isLoading=!1}))}function s(e,t){return{name:e.name,contactNumber:e.contactNumber,address:angular.copy(e.address),editMode:!0,tripSequence:t,items:[]}}r.systemRole=e,r.addNewTrip=function(){var e=r.ngModel.collectionPoints.length+1;r.ngModel.collectionPoints.push({editMode:!0,tripSequence:e}),r.ngModel.deliveryPoints.push({editMode:!0,tripSequence:e})},r.addRoundTrip=function(){var e=r.ngModel.collectionPoints.length+1;r.ngModel.collectionPoints.push(s(r.ngModel.deliveryPoints[r.ngModel.deliveryPoints.length-1],e)),r.ngModel.deliveryPoints.push(s(r.ngModel.collectionPoints[0],e))},r.isAddNewTrip=function(){return!r.ngModel.collectionPoints.some((function(e){return e.editMode}))},r.assignVendorDriver=function(e){if(r.ngModel.jobStatus==i.pendingApproval.value)return void o.warning("Job is not approved, please approve the job first");var n={assignVendor:a};r.dataAssignVendor={isDriver:e,customerId:r.ngModel.customerId},t.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:r.dataAssignVendor},n)},r.removeTrip=function(e){r.ngModel.collectionPoints.splice(e,1),r.ngModel.deliveryPoints.splice(e,1)},function(){r.canEdit=r.ngModel.jobStatus!==i.readyToBill.value&&r.ngModel.jobStatus!==i.pendingRejection.value&&r.ngModel.jobStatus!==i.billed.value;for(var e=0;e<r.ngModel.collectionPoints.length;e++)r.ngModel.collectionPoints[e].tripSequence=e+1,r.ngModel.deliveryPoints[e].tripSequence=e+1}()}angular.module("milkRun.module").directive("milkRunRoundTrip",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/milkRun/step/roundTrip.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["systemRole","modalService","adhocService","toastr","jobStatus"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){var s=this;function l(){var e=0;angular.forEach(s.ngModel,(function(t){s.listCheckPoint.indexOf(t.id)>=0&&(t.subTotalPrice=s.dataPricing.price),e+=t.subTotalPrice})),s.totalPrice=e,s.listCheckPoint=[],s.isCheckAll=!1}function c(){s.isLoading=!0,i.assignVendor({vendorId:s.dataAssignVendor.vendor.id,targetIds:s.listCheckPoint}).then((function(e){r.success("The selected points have been assigned to vendor successfully."),angular.forEach(s.ngModel,(function(e){s.listCheckPoint.indexOf(e.id)>=0&&(e.vendorName=s.dataAssignVendor.vendor.name)})),s.listCheckPoint=[],s.isCheckAll=!1,s.isLoading=!1}))}s.systemRole=a,s.milkRunTypes=t,s.departments=n,s.getMilkRunText=function(t){for(var n in e)if(e[n].id==t)return e[n].text;return""},s.removePoint=function(e,t){s.ngModel.splice(t,1),s.validatePoint(),e.stopPropagation()},s.checkAllChange=function(){s.isCheckAll?(s.listCheckPoint=[],angular.forEach(s.ngModel,(function(e){s.listCheckPoint.push(e.id)}))):s.listCheckPoint=[]},s.onCheckPoint=function(e){s.isCheckAll=!1;for(var t=0;t<s.listCheckPoint.length;t++)if(s.listCheckPoint[t]==e)return!0,void s.listCheckPoint.splice(t,1);s.listCheckPoint.push(e)},s.bindingCheck=function(e){for(var t=0;t<s.listCheckPoint.length;t++)if(s.listCheckPoint[t]==e)return!0;return!1},s.assignVendor=function(){var e={assignVendor:c};s.dataAssignVendor={},o.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:s.dataAssignVendor},e)},s.editPrice=function(){var e={updatePricing:l};s.dataPricing={},o.createPopup({templateUrl:"app/directives/jobCommon/editPrice/editPriceModal.html",size:"lg",data:s.dataPricing},e)},s.listCheckPoint=[]}angular.module("milkRun.module").directive("listPoint",(function(){return{restrict:"E",scope:{ngModel:"=",allowRemove:"=",milkRunType:"=?",onDetailClick:"&?",validatePoint:"&?",viewMode:"=?",isLoading:"=?",totalPrice:"=?"},templateUrl:"app/directives/milkRun/listPoint/listPoint.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["milkRunWeight","milkRunTypes","departments","modalService","milkrunService","toastr","systemRole"]}(),function(){"use strict";function e(e){var t=this;t.form=t.form||{},t.searchAddressByPostalCode=function(t){return e.getLocationByPostalCode(t).then((function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]}))},t.onSelect=function(e){t.ngModel.address.postalCode=e.postalCode,t.ngModel.address.blockNumber=e.blockNumber,t.ngModel.address.streetName=e.streetName}}angular.module("milkRun.module").directive("milkrunContact",(function(){return{restrict:"E",scope:{ngModel:"=",form:"=?"},templateUrl:"app/directives/milkRun/contact/milkrunContact.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["locationService"]}(),function(){"use strict";function e(e){var t=this;t.milkRunWeight=e,t.ngModel=t.ngModel||[{}],t.form=t.form||{}}angular.module("milkRun.module").directive("milkrunItem",(function(){return{restrict:"E",scope:{ngModel:"=",form:"=?"},templateUrl:"app/directives/milkRun/milkrunItem/milkrunItem.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["milkRunWeight"]}(),function(){"use strict";function e(e,t,n,o,i,r){var a=this;function s(){a.dataModal.applyTemplateItem&&(a.templateItem=a.dataModal.point.items),a.dataModal.isAddNew?a.ngModel.push(a.dataModal.point):(a.dataModal.point.isInValid=!1,a.ngModel[a.dataModal.index-1]=a.dataModal.point),c()}function l(){var e={updatePoint:s};n.createPopup({templateUrl:"app/directives/milkRun/point/newPointModal.html",size:"lg",data:a.dataModal},e)}function c(){a.isValid=i.checkValidCollectionPoints(a.ngModel)}a.ngModel=a.ngModel||[],a.milkRunTypes=t,a.addNewPoint=function(){a.dataModal={point:{items:angular.copy(a.templateItem)||[]},index:a.ngModel.length+1,isOneToMany:a.milkRunType==t.oneToMany,applyTemplateItem:!1,isAddNew:!0},l()},a.editPoint=function(e,n){a.dataModal={point:angular.copy(e),index:n,isOneToMany:a.milkRunType==t.oneToMany,applyTemplateItem:!1},l()},a.openFile=function(){r((function(){document.getElementById("uploadFile").click()}))},a.validatePoint=c,a.downloadSampleCsv=function(){var e=a.milkRunType==t.oneToMany?"MilkRunDeliveryTemplate.csv":"MilkRunCollectionTemplate.csv";o.exportCsvFile({data:[{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",FixedRunWeight:"<5",Quantity:2},{PostalCode:"551234",BlockNumber:"234A",StreetName:"Serangoon Avenue 2",UnitNumber:"07-08",ContactPerson:"Mr John",ContactNumber:"98769876",FixedRunWeight:"5to10",Quantity:3},{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",FixedRunWeight:"10to30",Quantity:2},{PostalCode:"551234",BlockNumber:"234A",StreetName:"Serangoon Avenue 2",UnitNumber:"07-08",ContactPerson:"Mr John",ContactNumber:"98769876",FixedRunWeight:"30to60",Quantity:3},{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",FixedRunWeight:"60to100",Quantity:2}],filename:e})},a.isValid=i.checkValidCollectionPoints(a.ngModel),a.uploadFile=function(){a.csvFile&&o.readAsDataUrl(a.csvFile,e).then((function(e){var t=i.getMilkRunPointsFromText(e);a.ngModel=a.ngModel.concat(t),c(),angular.element(document.getElementById("uploadFile")).val(null)}))}}angular.module("milkRun.module").directive("manyPoint",(function(){return{restrict:"E",scope:{ngModel:"=",milkRunType:"=",isValid:"="},templateUrl:"app/directives/milkRun/point/manyPoint.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$scope","milkRunTypes","modalService","fileReaderService","milkrunService","$timeout"]}(),function(){"use strict";function e(){this.ngModel=this.ngModel||[]}angular.module("milkRun.module").directive("onePoint",(function(){return{restrict:"E",scope:{ngModel:"=",contactForm:"=?",milkRunItemForm:"=?"},templateUrl:"app/directives/milkRun/point/onePoint.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(){this.ngModel=this.ngModel||[]}angular.module("milkRun.module").directive("pointDetail",(function(){return{restrict:"E",scope:{ngModel:"=",milkRunType:"=",viewMode:"=?",isLoading:"=?",totalPrice:"=?"},templateUrl:"app/directives/milkRun/point/pointDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(e,t,n){var o=this,i=[];i=t.currentUser.department===n.PSS.name?e.getFixedRungBiz():e.getGBizCodeHCFixedRun(),function(){var e=i.find((function(e){return e.id==o.weightId}));if(e){var t=e.rows.find((function(e){return e.text==o.label}));t&&(o.twiceDaily=t.twiceDaily,o.daily=t.daily,o.thricePerWeek=t.thricePerWeek,o.weekly=t.weekly,o.projectRun=t.projectRun)}}()}angular.module("main.module").directive("milkrunPricingRow",(function(){return{restrict:"E",scope:{ngModel:"=",label:"@",isValidate:"=",viewMode:"=?",weightId:"=?"},templateUrl:"app/directives/advanceMilkRunPricing/milkRunPricingRow.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["pricingService","$rootScope","departments"]}(),function(){"use strict";function e(e){var t=this;function n(t){for(var n in e)if(e[n].value===t)return e[n].display}t.ngModel&&0!==t.ngModel.length?angular.forEach(t.ngModel,(function(e){e.label=n(e.category)})):function(){for(var n in t.ngModel=[],e)t.ngModel.push({category:e[n].value,label:e[n].display})}()}angular.module("main.module").directive("milkrunPricingTab",(function(){return{restrict:"E",scope:{ngModel:"=",isValidate:"=",viewMode:"=?",weightId:"=?"},templateUrl:"app/directives/advanceMilkRunPricing/milkRunPricingTab.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["deliveryPointCategory"]}(),function(){"use strict";function e(e,t,n,o){var i=this;function r(e){if(!e)return!1;for(var t=0;t<e.length;t++)if(!((n=e[t]).twiceDaily&&n.daily&&n.thricePerWeek&&n.weekly&&n.projectRun))return!1;var n;return!0}i.departments=t,i.activateMilkRunTab=o.currentUser.department===t.PSS.name?e.milkrunUptoFiveKg.value:n.document.value,i.changeMilkRunTab=function(e){i.activateMilkRunTab=e},i.setPricing=function(){i.isValidate=!0;for(var e=!0,t=0;t<i.ngModel.weightCategories.length;t++){var n=r(i.ngModel.weightCategories[t].deliveryPointCategories);i.ngModel.weightCategories[t].isValid=n,e=!!n&&e}e&&i.setPrice()},i.ngModel.weightCategories&&0!==i.ngModel.weightCategories?angular.forEach(i.ngModel.weightCategories,(function(i){i.label=function(i){var r=o.currentUser.department===t.PSS.name?e:n;for(var a in r)if(r[a].value===i)return r[a].display}(i.weightCategoryId)})):function(){i.ngModel.weightCategories=[];var r=o.currentUser.department===t.PSS.name?e:n;for(var a in r)i.ngModel.weightCategories.push({weightCategoryId:r[a].value,label:r[a].display})}()}angular.module("main.module").directive("milkrunPricingAdvance",(function(){return{restrict:"E",scope:{ngModel:"=?",cancel:"&",setPrice:"&",viewMode:"=?"},templateUrl:"app/directives/advanceMilkRunPricing/milkRunPricingAdvance.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["milkRunWeightCategory","departments","healthCareFixedRunWeightCategory","$rootScope"]}(),function(){"use strict";angular.module("main.module").directive("fileUpload",(function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,o){t.bind("change",(function(t){var n=t.target.files[0];o.$setViewValue(n),e.$apply()}))}}}))}(),function(){"use strict";function e(e,t,n){var o,i=this,r=n.getGBizCodeHCAdhoc();(function(){if(!i.ngModel.label)for(var t in e)if(e[t].value===i.ngModel.weightCategoryId)return void(i.ngModel.label=e[t].display)})(),function(){if(!i.ngModel.deliveryTimings||0===i.ngModel.deliveryTimings.length)for(var e in i.ngModel.deliveryTimings=[],t)i.ngModel.deliveryTimings.push({deliveryTimingId:t[e].value,label:t[e].display})}(),function(){for(var e in i.rowLabels=[],t)i.rowLabels.push(t[e].display)}(),(o=r.find((function(e){return e.text==i.ngModel.label})))&&(i.codes={0:o.officeHour,1:o.officeHourExpress,2:o.weekdayEvening,3:o.weekdayEveningExpress,4:o.weekend})}angular.module("main.module").directive("healthCarePricingRow",(function(){return{restrict:"E",scope:{ngModel:"=",isValidate:"=",viewMode:"=?"},templateUrl:"app/directives/healthCarePricing/healthCarePricingRow.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["healthCareWeightCategory","healthCareDeliveryTiming","pricingService"]}(),function(){"use strict";function e(e){var t=this;function n(e){for(var t=0;t<e.deliveryTimings.length;t++)if(!e.deliveryTimings[t].rate||e.deliveryTimings[t].rate<=0)return!1;return!0}t.validateAndSave=function(){t.isValidate=!0;for(var e=0;e<t.ngModel.weightCategories.length;e++)if(!n(t.ngModel.weightCategories[e]))return!1;t.setPrice()},function(){if(!t.ngModel.weightCategories||0===t.ngModel.weightCategories.length)for(var n in t.ngModel.weightCategories=[],e)t.ngModel.weightCategories.push({weightCategoryId:e[n].value,label:e[n].display})}()}angular.module("main.module").directive("healthCarePricing",(function(){return{restrict:"E",scope:{ngModel:"=",cancel:"&",setPrice:"&",viewMode:"=?"},templateUrl:"app/directives/healthCarePricing/healthCarePricing.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["healthCareWeightCategory"]}(),function(){"use strict";function e(){}angular.module("main.module").directive("dashboardSpinner",(function(){return{restrict:"AE",templateUrl:"app/directives/dashboard/dashboardSpinner/dashboardSpinner.html",scope:{spinnerClasses:"@"},controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(e,t,n){var o=this;o.showCta="boolean"!=typeof o.tickerShowCta||o.tickerShowCta,o.ctaLink=o.tickerCtaLink||t.indexRoute,o.tickerDataLoaded=!1,o.tickerItemsLooped=[],e.$watch((function(){return o.tickerItems}),(function(){o.tickerItems&&o.tickerItems.length>0&&(o.tickerItemsLooped=JSON.parse(angular.toJson([].concat(o.tickerItems,o.tickerItems))),o.tickerDataLoaded=!0)}))}angular.module("main.module").directive("ticker",(function(){return{restrict:"AE",templateUrl:"app/directives/dashboard/ticker/ticker.html",scope:{tickerItems:"=",tickerShowCta:"=",tickerCtaLink:"="},controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$scope","$rootScope","$element"]}(),function(){"use strict";function e(e,t,n){var o=this,i=function(){for(var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=(new Date).getMonth(),n=[],o=0;o<12;++o)o+t<12?n.push(e[t+o]):n.push(e[o-(12-t)]);return _.map(n,(function(e){return{month:e,amount:0,height:0}}))}(),r=!1;function a(){var e=o.spendingsGraphHeight?o.spendingsGraphHeight:"270";o.graphHeight=e+"px"}function s(e){var t,n,i=_.max(o.data,(function(e){return e.amount})).amount,r=(t=i=i<7?7:i,n=7*(i<=700?10:100),Math.ceil(t/n)*n);if(!e)return r;e(r)}function l(){return _.map(o.data,(function(e){return e.month}))}function c(){for(var e=[],t=0;t<7;++t)e.push(o.maxY/7*(7-t));return e}function d(){return _.map(o.data,(function(e){return e.height=e.amount/o.maxY*100+"%",e}))}o.maxY=0,o.xAxis=[],o.yAxis=[],o.chartData=[],o.graphHeight="270px",a(),e.$watch("vm.spendingsGraphHeight",a),e.$watch("vm.data",(function(){o.data&&(r?(o.maxY=s(),o.xAxis=l(),o.yAxis=c(),o.chartData=d()):(o.maxY=s(),o.xAxis=l(),o.yAxis=c(),o.chartData=i,n((function(){o.chartData=d()}),200),r=!0))}))}angular.module("main.module").directive("spendingsGraph",(function(){return{restrict:"AE",templateUrl:"app/directives/dashboard/spendingsGraph/spendingsGraph.html",scope:{data:"=",spendingsGraphHeight:"="},controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$scope","$element","$timeout"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u){var m=this;m.departments=o,m.adhocTypes=i,m.adHocSurcharge=a,m.changeAdhocType=function(){r.switchCollectionDeliveryPoint(m.ngModel)},m.getServiceName=function(){if(m.ngModel&&m.ngModel.serviceType)return r.getServiceType(m.ngModel.serviceType);return""},m.validateSlotTime=function(e,n){if("09:00-17:30"==m.ngModel.collectBy&&"09:00-17:30"==m.ngModel.deliveryBy)return void(m.ngModel[n]=!0);var o=e.split("-");if(!e||!o.length||o.length>2)return void(m.ngModel[n]=!1);m.ngModel[n]=o.every(g),"deliveryByValid"===n&&function(){const e=l("date")(m.ngModel.deliveryDate,"yyyy-MM-dd"),n=l("date")(m.ngModel.collectionDate,"yyyy-MM-dd");if(e!==n)return m.ngModel.deliveryByValid=!0,void(m.deliveryWarningMessage="");if((m.ngModel.serviceType==t.sameDay.value||m.ngModel.serviceType==t.threeHour.value)&&m.ngModel.collectByValid&&m.ngModel.deliveryByValid&&v(m.ngModel.collectBy,m.ngModel.deliveryBy)&&n===e)return m.ngModel.deliveryByValid=!1,void(m.deliveryWarningMessage="Delivery by must be after collect by.");if(m.ngModel.serviceType==t.nextDay.value){v("12:00",m.ngModel.deliveryBy)&&u.warning("Your Type of Service can not choose Next Day Delivery, please select Same-Day Delivery due to the time limit")}}()},m.getDeliverySlot=p,m.setTypeOfService=h,m.changeTypeOfDelivery=function(){if(m.ngModel.deliveryDate="",m.ngModel.collectionDate="",m.minDeliveryDate=new Date,!(l("date")(m.ngModel.requestDate,"yyyy-MM-dd")===l("date")(new Date,"yyyy-MM-dd")&&l("date")(m.ngModel.collectionDate,"yyyy-MM-dd")===l("date")(new Date,"yyyy-MM-dd")&&l("date")(m.ngModel.deliveryDate,"yyyy-MM-dd")===l("date")(new Date,"yyyy-MM-dd")))return;m.ngModel.serviceType==t.threeHour.value&&m.clientDetail.cutOffTimeFor3HourDelivery&&m.validateThreeHourDelivery();m.ngModel.serviceType==t.sameDay.value&&m.clientDetail.cutOffTimeForSameDayPickupAndDelivery&&m.validateSameDayDelivery();m.ngModel.serviceType==t.nextDay.value&&m.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery&&m.validateNextDayDelivery()},m.onCollectionDateChange=function(){e.currentUser.department===o.PSS.name&&m.ngModel.collectionDate&&m.ngModel.serviceType==t.sameDay.value&&(m.validateSameDayDelivery()||(m.ngModel.collectionDate=""));if(e.currentUser.department===o.PSS.name&&m.ngModel.collectionDate&&m.ngModel.serviceType==t.nextDay.value&&(m.minDeliveryDate=function(){if(m.ngModel.serviceType==t.nextDay.value&&m.ngModel.collectionDate){const e=new Date(m.ngModel.collectionDate);return e.setDate(e.getDate()+1),e}return m.ngModel.collectionDate||m.ngModel.requestDate}(),m.validateNextDayDelivery()||(m.ngModel.collectionDate=""),m.ngModel.deliveryDate&&m.ngModel.collectionDate>m.ngModel.deliveryDate)){m.ngModel.collectionDate="";var n="Please select a collection date which is the same as or before the delivery date.";return void u.error(n)}if(e.currentUser.department===o.PSS.name&&m.ngModel.collectionDate&&m.ngModel.serviceType==t.threeHour.value&&(m.validateThreeHourDelivery()||(m.ngModel.collectionDate=""),m.ngModel.deliveryDate&&m.ngModel.collectionDate>m.ngModel.deliveryDate)){m.ngModel.collectionDate="";n="Please select a collection date which is the same as or before the delivery date.";return void u.error(n)}},m.minDeliveryDate=new Date,m.validateThreeHourDelivery=function(){const e=l("date")(m.ngModel.collectionDate,"yyyy-MM-dd"),t=l("date")(m.ngModel.requestDate,"yyyy-MM-dd");m.ngModel.collectBy&&m.ngModel.deliveryBy&&(m.validateSlotTime(m.ngModel.collectBy,"collectByValid"),m.validateSlotTime(m.ngModel.deliveryBy,"deliveryByValid"));if(e&&t&&e===t){var n=d.convertDate(m.clientDetail.cutOffTimeFor3HourDelivery),o=l("date")(n,"HH:mm"),i=d.convertDate(m.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery),r=l("date")(i,"HH:mm"),a=l("date")(m.ngModel.requestTime,"HH:mm");if(!v(o,a)){if(v(r,a)){var s="Cut-off time for 3-hour delivery is "+o+", please select next day delivery or contact our coordinators at 6867 9012/ 6867 8313";return u.error(s),!1}s="Cut-off time for 3-hour delivery is  "+o+", please contact our coordinators at: 6867 8012/ 6867 8313";return u.error(s),!1}return!0}return!0},m.validateNextDayDelivery=function(){const e=l("date")(m.ngModel.collectionDate,"yyyy-MM-dd"),t=l("date")(m.ngModel.requestDate,"yyyy-MM-dd");if(e===t){var n=d.convertDate(m.clientDetail.cutOffTimeForSameDayPickupAndNextDayDelivery),o=l("date")(n,"HH:mm"),i=l("date")(m.ngModel.requestTime,"HH:mm");if(!v(o,i)){var r="Cut-off time for next day delivery is "+o+", please select 3 hour delivery, change the collection date or contact our coordinators at: 6867 8012/ 6867 8313";return u.error(r),!1}return!0}return!0},m.validateSameDayDelivery=function(){const e=l("date")(m.ngModel.collectionDate,"yyyy-MM-dd"),t=l("date")(m.ngModel.requestDate,"yyyy-MM-dd");if(e===t){var n=d.convertDate(m.clientDetail.cutOffTimeForSameDayPickupAndDelivery),o=l("date")(n,"HH:mm"),i=l("date")(m.ngModel.requestTime,"HH:mm");if(!v(o,i)){var r="Cut-off time for same day delivery is "+o+", please select 3 hour delivery or contact our coordinators at: 6867 8012/ 6867 8313";return u.error(r),!1}return m.ngModel.deliveryDate=m.ngModel.collectionDate,!0}return m.ngModel.deliveryDate=m.ngModel.collectionDate,!0},m.clientDetail={},m.currentOptions=[];function p(){if(!m.ngModel.requestDate||!m.ngModel.deliveryDate)return[];var e=!(l("date")(m.ngModel.requestDate,"yyyy-MM-dd")!==l("date")(m.ngModel.deliveryDate,"yyyy-MM-dd"));if(m.ngModel.requestTime){var t=f(l("date")(m.ngModel.requestTime,"HH:mm"));m.currentOptions=function(e,t){var o=60*e.hour+e.minute;if(t)return o<750?[{text:"08:30-17:30",value:"08:30-17:30",typeOfService:n.hCOfficeHour.value},{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEvening.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]:o<900?[{text:"17:30",value:"17:30",typeOfService:n.hCOfficeHourExpress.value},{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEvening.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]:o<1020?[{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEvening.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]:[{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEveningExpress.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}];var i=m.ngModel.deliveryDate.getDay();return i>0&&i<=5?[{text:"08:30-17:30",value:"08:30-17:30",typeOfService:n.hCOfficeHour.value},{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekdayEvening.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]:6===i?5===m.ngModel.requestDate.getDay()&&60*e.hour+e.minute>1020?[{text:"08:30-12:00",value:"08:30-12:00",typeOfService:n.hCOfficeHourExpress.value},{text:"12:00-22:00",value:"12:00-22:00",typeOfService:n.hCWeekdayEveningExpress.value}]:[{text:"08:30-12:00",value:"08:30-12:00",typeOfService:n.hCOfficeHour.value},{text:"12:00-22:00",value:"12:00-22:00",typeOfService:n.hCWeekdayEvening.value}]:[{text:"08:30-17:30",value:"08:30-17:30",typeOfService:n.hCWeekend.value},{text:"17:30-22:00",value:"17:30-22:00",typeOfService:n.hCWeekend.value},{text:"After 22:00",value:"22:00",typeOfService:n.hCWeekend.value}]}(t,e)}}function g(e){var t=e.split(":");if(!e||!t.length||t.length>2)return!1;var n=t[0],o=t[1];return!(!n||2!==n.length||parseInt(n)<0||parseInt(n)>23)&&!(!o||2!==o.length||parseInt(o)<0||parseInt(o)>59)}function v(e,t){e=e.split("-")[0],t=t.split("-")[0];var n=f(e),o=f(t);return n.hour>o.hour||n.hour===o.hour&&n.minute>=o.minute}function f(e){var t=e.split(":");return{hour:parseInt(t[0]),minute:parseInt(t[1])}}function h(){if(m.ngModel.requestDate&&m.ngModel.deliveryDate&&m.ngModel.deliveryBy||m.ngModel.id){m.ngModel.deliveryByValid=!0;var e=m.currentOptions.find((function(e){return e.value===m.ngModel.deliveryBy}));e&&(m.ngModel.serviceType=e.typeOfService)}else m.ngModel.serviceType=""}!function(){(function(){var i=e.currentUser.department===o.PSS.name?t:n;for(var r in m.serviceTypes=[],i)m.serviceTypes.push({value:i[r].value,display:i[r].display,notes:s[r]?s[r].notes:null})})(),e.currentUser.department!==o.PSS.name?(m.ngModel.collectBy=m.ngModel.collectBy||"09:00-17:30",m.ngModel.collectByValid=!0,m.ngModel.requestDate=m.ngModel.requestDate||new Date,m.ngModel.requestTime=m.ngModel.requestTime||new Date,m.ngModel.collectionDate=m.ngModel.collectionDate||new Date,m.ngModel.deliveryDate=m.ngModel.deliveryDate||new Date,p()):(m.ngModel.collectBy=m.ngModel.collectBy||"09:00-17:30",m.ngModel.deliveryBy=m.ngModel.deliveryBy||"09:00-17:30",m.ngModel.collectByValid=!0,m.ngModel.deliveryByValid=!0);e.currentUser.department!==o.PSS.name&&(c.$watch("vm.ngModel.requestDate",(function(e){p()})),c.$watch("vm.ngModel.requestTime",(function(e){p()})),c.$watch("vm.ngModel.deliveryDate",(function(e){p()})),c.$watch("vm.ngModel.deliveryBy",(function(e){h()})))}()}angular.module("adhoc.module").directive("choseAdhocType",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/choseAdhocType.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$rootScope","adhocPSSServiceType","adhocHealthCareServiceType","departments","adhocTypes","adhocService","adHocSurcharge","healthCareServiceNote","$filter","$scope","utilityService","toastr"]}(),function(){"use strict";function e(e,t){this.adhocTypes=e,this.jobStatus=t}angular.module("adhoc.module").directive("adhocCollectionPoint",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/collectionPoint.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["adhocTypes","jobStatus"]}(),function(){"use strict";function e(e,t){this.adhocTypes=t,this.jobStatus=e}angular.module("adhoc.module").directive("adhocDeliveryPoint",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/deliveryPoint.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["jobStatus","adhocTypes"]}(),function(){"use strict";function e(e){this.systemRole=e}angular.module("adhoc.module").directive("adhocRemark",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/remark.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["systemRole"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s){var l=this;function c(){l.isLoading=!0,t.rejectApproveAdhoc({id:l.ngModel.id,jobStatus:r.rejected.value,remark:l.approveRejectData.remark}).then((function(e){l.isLoading=!1,i.success("The Adhoc has been rejected successfully."),l.ngModel.jobStatus=r.rejected.value}))}function d(){l.isLoading=!0,t.rejectApproveAdhoc({id:l.ngModel.id,jobStatus:r.accepted.value,remark:l.approveRejectData.remark}).then((function(e){l.isLoading=!1,i.success("The Adhoc has been approved successfully."),l.ngModel.jobStatus=r.accepted.value}))}l.systemRole=n,l.jobStatusType=r,l.saveAdhoc=function(){l.isLoading=!0,t.saveAdhoc(l.ngModel).then((function(t){l.isLoading=!1,s.clearImageItem();var n=l.ngModel.id?"The Ad Hoc has been updated successfully.":"The Ad Hoc has been created successfully.";i.success(n),e.path("/adhocs")}),(function(e){l.isLoading=!1,i.error(e.data.message)}))},l.calculate=function(){l.isLoading=!0,a.calculateAdhoc(l.ngModel).then((function(e){a.transferPricing(l.ngModel,e.data),l.isCalculated=!0,l.viewMode=!0,l.isLoading=!1})).catch((function(e){i.warning(e.data.message),l.isLoading=!1}))},l.edit=function(){l.viewMode=!1,l.updateMode=!0},l.onCancel=function(){l.ngModel.id?(l.viewMode=!0,l.updateMode=!1,l.cancel()):l.isCalculated?(l.isCalculated=!1,l.viewMode=!1):e.path("/adhocs")},l.approveReject=function(e){var t={confirm:e?d:c};l.approveRejectData={isApprove:e,remark:""},o.createPopup({templateUrl:"app/directives/milkRun/step/approveRejectModal.html",size:"lg",data:l.approveRejectData},t)},l.checkJobInvalid=function(){if(l.ngModel.isMultiplePO&&!l.ngModel.remark)return!0;var e=!!(l.ngModel.customerId&&l.ngModel.requesterId&&l.ngModel.costCentreId&&l.ngModel.requestDate&&l.ngModel.requestTime&&l.ngModel.collectionDate&&l.ngModel.deliveryDate&&l.ngModel.collectBy&&l.ngModel.deliveryBy&&l.ngModel.collectByValid&&l.ngModel.deliveryByValid),t=l.ngModel.collectionPoints.find((function(e){return e.editMode})),n=l.ngModel.deliveryPoints.find((function(e){return e.editMode}));return!(e&&!t&&l.ngModel.collectionPoints.length&&!n&&l.ngModel.deliveryPoints.length)},l.onHoldAdhoc=function(){t.onHoldAdhoc(l.ngModel.id).then((function(e){i.success("The Adhoc has been on hold successfully."),l.getJobDetail()}))},l.unholdAdhoc=function(){t.unholdAdhoc(l.ngModel.id).then((function(e){i.success("The Adhoc has been un hold successfully."),l.getJobDetail()}))},l.canEdit=l.ngModel.jobStatus!==l.jobStatusType.readyToBill.value&&l.ngModel.jobStatus!==l.jobStatusType.pendingRejection.value&&l.ngModel.jobStatus!==l.jobStatusType.billed.value}angular.module("adhoc.module").directive("adhocConfirmPricing",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"=",isLoading:"=",getJobDetail:"&",cancel:"&"},templateUrl:"app/directives/adhoc/step/confirmPricing.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$location","adhocService","systemRole","modalService","toastr","jobStatusType","pricingService","imageService"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;function a(){r.isLoading=!0,n.assignVendor({isDriver:r.dataAssignVendor.isDriver,userId:r.dataAssignVendor.user.id,targetIds:r.ngModel.deliveryPoints.map((function(e){return e.id}))}).then((function(e){o.success("The selected points have been assigned to "+(r.dataAssignVendor.isDriver?"driver":"vendor")+" successfully."),r.listCheckPoint=[],r.isCheckAll=!1,r.isLoading=!1}))}function s(e,t){return{name:e.name,contactNumber:e.contactNumber,address:angular.copy(e.address),editMode:!0,tripSequence:t,items:[]}}r.systemRole=e,r.addNewTrip=function(){var e=r.ngModel.collectionPoints.length+1;r.ngModel.collectionPoints.push(s(r.ngModel.deliveryPoints[r.ngModel.deliveryPoints.length-1],e)),r.ngModel.deliveryPoints.push({editMode:!0,tripSequence:e})},r.addRoundTrip=function(){var e=r.ngModel.collectionPoints.length+1;r.ngModel.collectionPoints.push(s(r.ngModel.deliveryPoints[r.ngModel.deliveryPoints.length-1],e)),r.ngModel.deliveryPoints.push(s(r.ngModel.collectionPoints[0],e))},r.isAddNewTrip=function(){return!r.ngModel.collectionPoints.some((function(e){return e.editMode}))},r.assignVendorDriver=function(e){if(r.ngModel.jobStatus==i.pendingApproval.value)return void o.warning("Job is not approved, please approve the job first");var n={assignVendor:a};r.dataAssignVendor={isDriver:e,customerId:r.ngModel.customerId},t.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:r.dataAssignVendor},n)},r.removeTrip=function(e){r.ngModel.collectionPoints.splice(e,1),r.ngModel.deliveryPoints.splice(e,1)},function(){r.canEdit=r.ngModel.jobStatus!==i.readyToBill.value&&r.ngModel.jobStatus!==i.pendingRejection.value&&r.ngModel.jobStatus!==i.billed.value;for(var e=0;e<r.ngModel.collectionPoints.length;e++)r.ngModel.collectionPoints[e].tripSequence=e+1,r.ngModel.deliveryPoints[e]&&(r.ngModel.deliveryPoints[e].tripSequence=e+1)}()}angular.module("adhoc.module").directive("adhocRoundTrip",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"="},templateUrl:"app/directives/adhoc/step/roundTrip.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["systemRole","modalService","adhocService","toastr","jobStatus"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l){var c=this;function d(e,t){a.getCustomerById(e).then((function(n){c.client=n.data,c.ngModel.customerId=e,c.ngModel.clientName=c.client.organizationCode+" - "+c.client.name,c.users=n.data.applicationUsers.filter((function(e){return 0==e.lockoutEnabled})),c.users.unshift({id:"",firstName:"Please",lastName:"select ..."}),t&&u(c.client),r.setChosenClient(n.data)}))}function u(e){var t=c.users.find((function(e){return e.id===c.ngModel.requesterId}));c.ngModel.requesterName=t.firstName+" "+t.lastName,c.costCenters=e.costCentres.filter((function(e){return t.costCentreIds.indexOf(e.id)>-1})),c.costCenters.unshift({id:"",name:"Please select ..."}),c.poNumbers=e.poNumbers.filter((function(e){return e.userIds.indexOf(t.id)>-1}));var n=e.sapCodes.find((function(e){return t.sapCodeId===e.id}));c.ngModel.billingAddress=n?n.blockNumber+" "+n.streetName+" "+n.unitNumber+" "+n.postalCode:""}function m(){r.setChosenClient(null),c.users=[],c.costCenters=[],c.poNumbers=[],c.ngModel.requesterId="",c.ngModel.billingAddress=""}function p(){c.poDetail.poNumber=c.poDetail.detailName,c.isLoading=!0,a.savePoNumber(c.poDetail).then((function(e){var t=c.poDetail.id?"The PO number has been updated successfully.":"The PO number has been created successfully.";c.isLoading=!1,a.getCustomerById(c.client.id).then((function(e){c.client=e.data,u(e.data)})),i.success(t)}),(function(e){c.isLoading=!1,i.error(e.data.message)}))}c.systemRole=t,c.searchClient=function(t){return a.getCustomerByCriteria({currentPage:1,itemPerPage:20,searchTerm:t,sortColumn:"organizationCode",sortAscending:!0},e.currentUser.department).then((function(e){return e.data.customers}))},c.onSelectClient=function(e){var t=s.convertDate(e.contractEndDate);t.setHours(0,0,0,0);var n=new Date;n.setHours(0,0,0,0),t<n?(l.createWarningPopup("This customers contract has expired. Please extend the contract date.","Warning",null,!0,"OK"),m(),c.ngModel.clientName=""):(c.poDetail.customerId=e.id,d(e.id))},c.changeUser=function(){c.ngModel.requesterId&&c.users?(c.poDetail.userIds=[c.ngModel.requesterId],u(c.client)):(c.ngModel.costCentreId="",c.ngModel.poNumberId="",c.ngModel.billingAddress="",c.costCenters=[],c.poNumbers=[])},c.clientChange=m,c.getCostCenterName=function(){if(c.ngModel.costCentreId&&c.costCenters){var e=c.costCenters.find((function(e){return e.id==c.ngModel.costCentreId}));return e?e.name:""}return""},c.getPoNumberName=function(){if(c.ngModel.poNumberId&&c.poNumbers){var e=c.poNumbers.find((function(e){return e.id==c.ngModel.poNumberId}));return e?e.number:""}return""},c.getRequesterName=function(){if(c.ngModel.requesterId&&c.users){var e=c.users.find((function(e){return e.id==c.ngModel.requesterId}));return e?e.firstName+" "+e.lastName:""}return""},c.editPo=function(){c.dataUpdatePo={poNumbers:c.poNumbers,poNumberId:c.ngModel.poNumberId},l.createPopup({templateUrl:"app/directives/jobCommon/jobChoseCustomerEditPoModal.html",size:"md",data:c.dataUpdatePo},{updatePo:function(){c.isLoading=!0,r.updatePo(c.ngModel.id,{poNumberId:c.dataUpdatePo.poNumberId},c.isMilkRun).then((function(e){c.ngModel.poNumberId=c.dataUpdatePo.poNumberId,i.success("Update PO number successfully!"),c.isLoading=!1}))}})},c.openPoModal=function(n){var o={onCreateOrUpdate:p};l.createPopup({templateUrl:"app/components/customer/poCc/poModal.html",size:"lg",data:{ngModel:n,isPo:!0,isJob:!0,viewMode:e.currentUser.role===t.SuperAdmin}},o)},c.onCreateOrUpdatePoSuccess=p,c.deliveryDateChange=function(){c.isMilkRun||e.currentUser.department===o.PSS.name||(c.ngModel.collectionDate=angular.copy(c.ngModel.deliveryDate),i.success("Collection date is changed to "+n("date")(c.ngModel.deliveryDate,"dd/MM/yyyy")+" according to Delivery"))},c.clickPoOption=function(e){c.ngModel.isMultiplePO=e},c.poDetail={detailName:"",poNumber:""},function(){c.viewMode&&(c.poDetail.customerId=c.ngModel.customerId,c.poDetail.userIds=[c.ngModel.requesterId]);r.setChosenClient(null),c.ngModel.requestDate=c.ngModel.requestDate||new Date,c.ngModel.requestTime=c.ngModel.requestTime||angular.copy(c.ngModel.requestDate),c.isPSS=e.currentUser.department===o.PSS.name,function(){c.ngModel.customerId&&e.currentUser.role!==t.User&&d(c.ngModel.customerId,!0);e.currentUser.role===t.User&&(c.ngModel.customerId=e.currentUser.customerId,c.ngModel.requesterId=e.currentUser.id,d(e.currentUser.customerId,!0))}()}()}angular.module("adhoc.module").directive("jobChoseCustomer",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"=",isMilkRun:"=?",client:"=?"},templateUrl:"app/directives/jobCommon/jobChoseCustomer.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$rootScope","systemRole","$filter","departments","toastr","adhocService","customerService","utilityService","modalService"]}(),function(){"use strict";function e(e,t,n,o){this.departments=e,this.viewPhotos=function(e){t.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:e}},{})},this.getMilkRunWeight=function(e){for(var t in n)if(n[t].id==e)return n[t].text;for(var t in o)if(o[t].value==e)return o[t].display;return"N/A"}}angular.module("main.module").directive("listItem",(function(){return{restrict:"E",scope:{ngModel:"=",isLoading:"=",isMilkRun:"=?"},templateUrl:"app/directives/jobCommon/pointItem/listItem.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["departments","modalService","milkRunWeight","healthCareFixedRunWeightCategory"]}(),function(){"use strict";function e(e){var t=this;function n(e){for(var t=0;t<e.deliveryTimings.length;t++)if(!e.deliveryTimings[t].rate||e.deliveryTimings[t].rate<=0)return!1;return!0}t.validateAndSave=function(){if(t.isValidate=!0,!t.ngModel.additionalRestrictedArea||t.ngModel.additionalRestrictedArea<=0||!t.ngModel.additionalAfterOfficeHr||t.ngModel.additionalAfterOfficeHr<=0)return;for(var e=0;e<t.ngModel.weightCategories.length;e++)if(!n(t.ngModel.weightCategories[e]))return;t.setPrice()},t.gBizCodePSSAdhoc=e.getAdhocgBiz()}angular.module("main.module").directive("adhocPssPricing",(function(){return{restrict:"E",scope:{ngModel:"=",cancel:"&",setPrice:"&",viewMode:"=?"},templateUrl:"app/directives/adhocPSSPricing/adhocPSSPricing.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["pricingService"]}(),function(){"use strict";function e(e){var t,n=this,o=e.getAdhocgBiz();(t=o.find((function(e){return e.text==n.text})))&&(n.threeHourCode=t.threeHour,n.sameDayCode=t.sameDay,n.nextDayCode=t.nextDay)}angular.module("main.module").directive("adhocPssPricingRow",(function(){return{restrict:"E",scope:{ngModel:"=",isValidate:"=",viewMode:"=?",text:"@?"},templateUrl:"app/directives/adhocPSSPricing/adhocPSSPricingRow.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["pricingService"]}(),function(){"use strict";function e(e){var t=this;t.isContainColumn=function(e){var n=!1;return angular.forEach(t.chosenColumnModel,(function(t){t.id===e&&(n=!0)})),n},t.goToDetailPage=function(t){e.path("/milkrun/detail/"+t)}}angular.module("milkRun.module").directive("milkrunJobGrid",(function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"="},templateUrl:"app/directives/milkRun/jobs/milkRunJobGrid.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$location"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){var s=this;function l(){s.isLoading=!0,n.assignVendorInternalDriver({isMilkRun:!0,userId:s.dataAssignVendor.user.id,targetIds:s.listAssignTransaction}).then((function(e){angular.forEach(s.ngModel,(function(e){s.listAssignTransaction.indexOf(e.id)>=0&&(e.vendorText=s.dataAssignVendor.user.name)})),o.success("The selected transactions have been assigned to vendor successfully."),s.listAssignTransaction=[],s.isCheckAll=!1,s.isLoading=!1}))}function c(e,t){e.stopPropagation(),s.isCheckAll=!1;for(var n=0;n<s.listAssignTransaction.length;n++)if(s.listAssignTransaction[n]==t)return!0,void s.listAssignTransaction.splice(n,1);s.listAssignTransaction.push(t)}function d(e){for(var t=0;t<s.listAssignTransaction.length;t++)if(s.listAssignTransaction[t]==e)return!0;return!1}s.systemRole=r,s.taskStatus=a,s.isContainColumn=function(e){var t=!1;return angular.forEach(s.chosenColumnModel,(function(n){n.id===e&&(t=!0)})),t},s.checkAllChange=function(){s.isCheckAll?(s.listAssignTransaction=[],angular.forEach(s.ngModel,(function(e){s.listAssignTransaction.push(e.id)}))):s.listAssignTransaction=[]},s.bindingCheck=d,s.onCheckTransaction=c,s.goToDetailPage=function(n){(function(e){var n=[];angular.forEach(s.ngModel,(function(e){n.push(e.id)})),t.milkrunTransaction={listTransaction:n,currentIndex:n.indexOf(e)}})(n),e.path("/milkrunTask/"+n)},s.assignVendorFunc=function(){if(!s.listAssignTransaction.length)return;var e={assignVendor:l};s.dataAssignVendor={},i.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:s.dataAssignVendor},e)},s.preventClick=function(e,t){e.preventDefault(),e.stopPropagation(),t.status!=s.taskStatus.delivered.value&&(c(e,t.id),d(t.id))},s.resetGridCheckingFunc=function(){o.success("Upload successfully for the selected transactions."),s.listAssignTransaction=[],s.isCheckAll=!1},s.listAssignTransaction=[],s.listTransactionId=s.listAssignTransaction}angular.module("milkRun.module").directive("milkrunTransactionGrid",(function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"=",assignVendorFunc:"=",isLoading:"=?",listTransactionId:"=",resetGridCheckingFunc:"="},templateUrl:"app/directives/milkRun/jobs/milkRunTransactionGrid.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$location","$rootScope","taskService","toastr","modalService","systemRole","taskStatus"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u){var m=this;function p(e,t){var n=[{value:"",text:"All"}];for(var o in e)t&&-1!==t.indexOf(e[o].value)||n.push({value:e[o].value,text:e[o].display});return n}m.systemRole=n,m.jobGridType=r,function(){m.poOptions=[{value:"",text:"All"},{value:"true",text:"Yes"},{value:"false",text:"No"}],e.currentUser.role!==n.User&&e.currentUser.role!==n.Vendor&&(t.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then((function(e){m.customers=t.convertListCustomerDropDownList(e.data.customers)})),m.isTransaction&&(function(){var t=0;e.currentUser.role==n.Admin&&(t=e.currentUser.department===s.PSS.name?s.PSS.id:s.Healthcare.id);d.getVendorByCriteria({departmentId:t,sortColumn:"organizationName",sortAscending:!0}).then((function(e){m.vendors=d.convertListVendorDropDownList(e.data.users)}))}(),function(){e.currentUser.role==n.Admin&&(e.currentUser.department===s.PSS.name?s.PSS.id:s.Healthcare.id);u.getInternalDriver("").then((function(e){m.drivers=u.convertListVendorDropDownList(e.data.users)}))}()));m.gridType===r.milkRunJob||m.gridType===r.milkRunTransaction?m.requestTypes=p(a):e.currentUser.role==n.SuperAdmin?m.requestTypes=function(){var e=[{value:"",text:"All"}];for(var t in l)e.push({value:l[t].value,text:l[t].display});for(var t in c)e.push({value:c[t].value,text:c[t].display});return e}():e.currentUser.department===s.PSS.name?m.requestTypes=p(l):m.requestTypes=p(c);m.statuses=m.isTransaction?p(i,[]):p(o)}()}angular.module("main.module").directive("jobFilter",(function(){return{restrict:"E",scope:{options:"=",actionRequest:"&",isTransaction:"@",gridType:"@"},templateUrl:"app/directives/jobCommon/jobFilter.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$rootScope","customerService","systemRole","jobStatus","taskStatus","jobGridType","milkRunFrequency","departments","adhocPSSServiceType","adhocHealthCareServiceType","vendorService","driverService"]}(),function(){"use strict";function e(e,t,n,o){var i=this;i.systemRole=n,i.setItemPerPage=e,i.jobGridType=t,i.printOrder=function(){var e=window.location.hostname,t='<link rel="stylesheet" type="text/css" href="../bower_components/bootstrap/dist/css/bootstrap.css"><link rel="stylesheet" type="text/css" href="./css/app.css">';"localhost"!==e&&(t='<link rel="stylesheet" href="css/styles.min.css">');var n=document.getElementById("printOrderTable").innerHTML,o=window.open("","_blank");o.document.open(),o.document.write("<html><head>"+t+'</head><body onload="setTimeout(function(){ window.print(); }, 500)">'+n+"</html>"),o.document.close()},i.assignVendor=function(){i.assignVendorFunc()},i.uploadCallback=function(){i.actionRequest(),i.resetGrid()},i.setReadyToBill=function(){o.createWarningPopup("Are you sure you want to set as ready to bill","Warning",(function(){i.setReadyToBillFunc()}))},i.assignVendorFunc={},i.setReadyToBillFunc={},i.resetGrid={},i.listTransactionId=[],i.translationTexts={checkAll:"Show All",dynamicButtonTextSuffix:"columns"},i.chosenColumnConfig={idProp:"name",displayProp:"display",showUncheckAll:!1},i.chosenColumnModel=[],angular.forEach(i.gridConfig.columns,(function(e){i.chosenColumnModel.push({id:e.name})})),i.getListTransactionId=function(){var e=[];return angular.forEach(i.ngModel,(function(t){i.listTransactionId.indexOf(t.id)>-1&&e.push({id:t.id,barcode:t.barcode})})),e},i.eventsChosenColumn={onItemDeselect:function(e){1===i.chosenColumnModel.length&&i.chosenColumnModel.push(e),document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="none"},onSelectAll:function(){document.querySelector(".dropdown-menu.dropdown-menu-form li:first-child a span").style.display="inline"}}}angular.module("main.module").directive("jobGrid",(function(){return{restrict:"E",scope:{ngModel:"=",options:"=",gridConfig:"=",actionRequest:"&",isLoading:"=",gridType:"@"},templateUrl:"app/directives/jobCommon/jobGrid.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["setItemPerPage","jobGridType","systemRole","modalService"]}(),function(){"use strict";function e(e){var t=this;t.isContainColumn=function(e){var n=!1;return angular.forEach(t.chosenColumnModel,(function(t){t.id===e&&(n=!0)})),n},t.goToDetailPage=function(t){e.path("/adhoc/detail/"+t)}}angular.module("adhoc.module").directive("adhocJobGrid",(function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"="},templateUrl:"app/directives/adhoc/jobs/adhocJobGrid.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$location"]}(),function(){"use strict";function e(e,t,n,o,i,r,a){var s=this;function l(){s.isLoading=!0,o.assignVendorInternalDriver({userId:s.dataAssignVendor.user.id,targetIds:s.listAssignTransaction}).then((function(e){angular.forEach(s.ngModel,(function(e){s.listAssignTransaction.indexOf(e.id)>=0&&(e.vendorText=s.dataAssignVendor.user.name)})),i.success("The selected transactions have been assigned to vendor successfully."),s.listAssignTransaction=[],s.isCheckAll=!1,s.isLoading=!1}))}function c(e,t){e.stopPropagation(),s.isCheckAll=!1;for(var n=0;n<s.listAssignTransaction.length;n++)if(s.listAssignTransaction[n]==t)return void s.listAssignTransaction.splice(n,1);s.listAssignTransaction.push(t)}function d(e){for(var t=0;t<s.listAssignTransaction.length;t++)if(s.listAssignTransaction[t]==e)return!0;return!1}s.systemRole=r,s.taskStatus=a,s.isContainColumn=function(e){var t=!1;return angular.forEach(s.chosenColumnModel,(function(n){n.id===e&&(t=!0)})),t},s.listAssignTransaction=[],s.listTransactionId=s.listAssignTransaction,s.checkAllChange=function(){s.isCheckAll?(s.listAssignTransaction=[],angular.forEach(s.ngModel,(function(e){s.listAssignTransaction.push(e.id)}))):s.listAssignTransaction=[]},s.bindingCheck=d,s.onCheckTransaction=c,s.assignVendorFunc=function(){if(!s.listAssignTransaction.length)return;var e={assignVendor:l};s.dataAssignVendor={},n.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:s.dataAssignVendor},e)},s.setReadyToBillFunc=function(){s.isLoading=!0,o.setReadyToBillAdhoc({targetIds:s.listAssignTransaction}).then((function(e){i.success("The selected transactions have been set as ready to bill successfully."),angular.forEach(s.ngModel,(function(e){s.listAssignTransaction.indexOf(e.id)>=0&&(e.statusText="Ready to Bill")})),s.listAssignTransaction=[],s.isCheckAll=!1,s.isLoading=!1})).catch((function(e){s.listAssignTransaction=[],s.isCheckAll=!1,i.warning(e.data.message),s.isLoading=!1}))},s.goToDetailPage=function(n){(function(t){var n=[];angular.forEach(s.ngModel,(function(e){n.push(e.id)})),e.adhocTransaction={listTransaction:n,currentIndex:n.indexOf(t)}})(n),t.path("/adhocTask/"+n)},s.preventClick=function(e,t){e.preventDefault(),e.stopPropagation(),t.status!=s.taskStatus.delivered.value&&(c(e,t.id),d(t.id))},s.resetGridCheckingFunc=function(){i.success("Upload successfully for the selected transactions."),s.listAssignTransaction=[],s.isCheckAll=!1},s.viewPhoto=function(e,t){e.stopPropagation(),n.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:t.map((function(e){return{imageUrl:e}}))}},{})}}angular.module("adhoc.module").directive("adhocTransactionGrid",(function(){return{restrict:"E",scope:{ngModel:"=",chosenColumnModel:"=",assignVendorFunc:"=",listTransactionId:"=",resetGridCheckingFunc:"=",setReadyToBillFunc:"="},templateUrl:"app/directives/adhoc/jobs/adhocTransactionGrid.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$rootScope","$location","modalService","taskService","toastr","systemRole","taskStatus"]}(),function(){"use strict";function e(e,t,n,o){var i=this;i.userChange=function(){angular.forEach(i.users,(function(e){i.ngModel.user.id===e.id&&(i.ngModel.user.name=e.name)}))},function(){if(i.isLoading=!0,i.ngModel.isDriver){var r=i.ngModel.customerId;t.getInternalDriver(r).then((function(e){i.isLoading=!1;var t=n.currentUser.department===o.PSS.name?o.PSS.id:o.Healthcare.id;i.users=e.data.users.filter((function(e){return e.driverDepartments.some((function(e){return e.departmentId==t&&e.active}))})).map((function(e){return{id:e.id,name:e.firstName+" "+e.lastName}})),i.users.unshift({id:void 0,name:"Please select ..."})}))}else e.getVendorByCriteria({}).then((function(e){i.isLoading=!1,i.users=e.data.users.filter((function(e){return!1===e.lockoutEnabled})).map((function(e){return{id:e.id,name:e.organization}})),i.users.unshift({id:void 0,name:"Please select ..."})}))}()}angular.module("main.module").directive("assignVendor",(function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&",onAction:"&"},templateUrl:"app/directives/jobCommon/assignVendor/assignVendor.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["vendorService","driverService","$rootScope","departments"]}(),function(){"use strict";function e(e){var t=this;t.driverChange=function(){angular.forEach(t.drivers,(function(e){t.ngModel.driver.id===e.id&&(t.ngModel.driver.name=e.firstName+" "+e.lastName)}))},e.getDriverByCriteria({}).then((function(e){t.drivers=e.data.users.filter((function(e){return e.driverDepartments.length&&e.driverDepartments[0]&&e.driverDepartments[0].active})),t.drivers.unshift({id:void 0,firstName:"Please",lastName:"select ..."})}))}angular.module("main.module").directive("assignDriver",(function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&",onAction:"&"},templateUrl:"app/directives/jobCommon/assignDriver/assignDriver.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["driverService"]}(),function(){"use strict";function e(e){var t=this;t.removePoC=function(e){t.ngModel.proofOfCollections.splice(e,1)},t.removePoD=function(e){t.ngModel.proofOfDeliveries.splice(e,1)},t.taskStatus=e}angular.module("main.module").directive("proofOfCollectionAndDelivery",(function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/directives/jobCommon/proofOfCollectionAndDelivery/proofOfCollectionAndDelivery.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["taskStatus"]}(),function(){"use strict";function e(e,t,n){var o=this;o.remove=function(){t.createWarningPopup("Are you sure you want to remove this proof?","Warning",(function(){e.removeProof({id:o.taskId,barcode:o.barcode,proofId:o.ngModel.id},o.poc).then((function(e){o.callback({index:o.index})}))}))},o.viewPhoto=function(){t.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:[{imageUrl:o.ngModel.imageUrl}]}},{})},o.systemRole=n,o.ngModel&&o.ngModel.imageUrl&&e.getImageFromFileName(o.ngModel.imageUrl).then((function(e){o.ngModel.src="data:image/png;base64,"+e.data}))}angular.module("main.module").directive("proofDetail",(function(){return{restrict:"E",scope:{ngModel:"=",taskId:"=",barcode:"=",poc:"=?",callback:"&?",index:"=",canEdit:"=?"},templateUrl:"app/directives/jobCommon/proofOfCollectionAndDelivery/proofDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["taskService","modalService","systemRole"]}(),function(){"use strict";function e(e){this.viewPhoto=function(t){e.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:[{imageUrl:t}]}},{})}}angular.module("main.module").directive("driverRemarks",(function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/directives/jobCommon/driverRemarks/driverRemarks.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["modalService"]}(),function(){"use strict";function e(e,t,n,o){var i=this;i.systemRole=t,i.changeStatus=function(){n.updateTask(i.ngModel.id,{barcode:i.ngModel.barcode,status:i.status}).then((function(t){for(var n in i.ngModel.status=i.status,e)if(e[n].value==i.status){i.ngModel.statusText=e[n].display;break}i.callback(),o.success("The Transaction has been updated status successfully.")}))},function(){for(var t in i.status=i.ngModel.status,i.statuses=[],e)i.statuses.push({value:e[t].value,display:e[t].display})}()}angular.module("main.module").directive("changeStatus",(function(){return{restrict:"E",scope:{ngModel:"=",callback:"&"},templateUrl:"app/directives/jobCommon/changeStatus/changeStatus.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["taskStatus","systemRole","taskService","toastr"]}(),function(){"use strict";function e(e){var t=this;e((function(){JsBarcode("#transaction"+t.transactionId,t.ngModel,{width:1,height:30})}))}angular.module("main.module").directive("barcodePrint",(function(){return{restrict:"E",scope:{ngModel:"=",transactionId:"="},templateUrl:"app/directives/jobCommon/barcodePrint/barcodePrint.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$timeout"]}(),function(){"use strict";function e(e){var t=this;t.uploadProof=function(){t.tasks=t.getTransactionId?t.getTransactionId():t.tasks,t.tasks.length&&(t.data={isPOC:t.poc,tasks:t.tasks,callback:t.callback},e.createPopup({templateUrl:"app/directives/jobCommon/uploadProof/uploadProofModal.html",size:"lg",data:t.data},{}))}}angular.module("main.module").directive("uploadProof",(function(){return{restrict:"E",scope:{label:"@",poc:"=",tasks:"=?",getTransactionId:"&?",callback:"&?"},templateUrl:"app/directives/jobCommon/uploadProof/uploadProof.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["modalService"]}(),function(){"use strict";function e(e,t){var n=this;n.onFileChange=function(){e((function(){n.isFileChoosen=!0;var e=new FileReader;e.onload=function(e){document.getElementById("image-proof").src=e.target.result},e.readAsDataURL(n.dataFile)}))},n.uploadProof=function(){var e=n.proofDetail.signedAtDate,o=n.proofDetail.signedAtTime;e.setHours(o.getHours()),e.setMinutes(o.getMinutes());var i=new FormData;i.append("file",n.dataFile);var r={type:n.ngModel.isPOC?"poc":"pod",remark:n.proofDetail.signedBy,signedDate:e,tasks:n.ngModel.tasks};i.append("data",JSON.stringify(r)),t.uploadProof(i).then((function(e){n.onCancel(),n.ngModel.callback&&n.ngModel.callback()}))},n.proofDetail={},n.isFileChoosen=!1,n.dataFile=null}angular.module("main.module").directive("uploadProofDetail",(function(){return{restrict:"E",scope:{ngModel:"=",onCancel:"&"},templateUrl:"app/directives/jobCommon/uploadProof/uploadProofDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$timeout","taskService"]}(),function(){"use strict";function e(e,t,n,o){var i=this;function r(){i.isLoading=!0,t.unAssignVendor({isMilkRun:i.isMilkRun,isDriver:i.unAssignData.isDriver,targetIds:[i.ngModel.id]}).then((function(e){n.success("The point has been unassigned "+(i.unAssignData.isDriver?"driver":"vendor")+" successfully."),i.unAssignData.isDriver?i.ngModel.hasInternalDriverAssigned=!1:i.ngModel.vendorName="",i.isLoading=!1}))}i.systemRole=e,i.save=function(){if(i.includeItems&&(!i.ngModel.items||!i.ngModel.items.length))return void n.warning("At least one item should be added to this point!");i.ngModel.id||i.ngModel.elementId||(i.ngModel.elementId=(new Date).getTime());delete i.ngModel.editMode},i.cancel=function(){var e=i.index-1;i.canRemove?i.removePoint({index:e}):(delete i.ngModel.address,delete i.ngModel.contactNumber,delete i.ngModel.name,delete i.ngModel.surchargeDescription,delete i.ngModel.surchargeAmount,delete i.ngModel.remark)},i.edit=function(){i.ngModel.editMode=!0,i.isCollapse=!1},i.surchargeDescriptionChange=function(){i.ngModel.surchargeAmount=t.getSurchargeAmount(i.ngModel.surchargeDescription)||0},i.unAssignVendorDriver=function(e){i.unAssignData={isDriver:e};var t=e?"Are you sure you want to unassign this driver?":"Are you sure you want to unassign this vendor?";o.createWarningPopup(t,"Warning",r)},i.ngModel=i.ngModel||{},i.surchargeList=["Evening, Sat, Sun & Public Holiday","Restricted Area"]}angular.module("main.module").directive("pointContact",(function(){return{restrict:"E",scope:{ngModel:"=",form:"=?",includeItems:"=?",isCollection:"=?",index:"=",canRemove:"=?",removePoint:"&?",viewMode:"=",onCheckPoint:"&?",bindingCheck:"&?",isMilkRun:"=?",canEdit:"=?",getAllPoints:"&?"},templateUrl:"app/directives/jobCommon/points/pointContact.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["systemRole","adhocService","toastr","modalService"]}(),function(){"use strict";function e(e,t,n,o,i){var r=this;function a(){var e=r.isCollection?1:2;return i.getFavoriteAddress(e)}function s(e){r.ngModel.address=r.ngModel.address||{},r.ngModel.address.postalCode=e.postalCode,r.ngModel.address.blockNumber=e.blockNumber,r.ngModel.address.streetName=e.streetName,r.ngModel.address.unitNumber=e.unitNumber,r.ngModel.contactNumber=e.contactNumber,r.ngModel.name=e.contactPerson,r.searchTerm=""}r.searchFavoriteAddress=function(e){var n=r.isCollection?1:2;return t.searchFavoriteAddress(e,n,i.getClientId()).then((function(e){return e.data.favoriteAddresses}))},r.changeFavoriteAddress=function(){s(a().find((function(e){return e.id==r.selectedAddress})))},r.searchAddressByPostalCode=function(t){return e.getLocationByPostalCode(t).then((function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]}))},r.onSelect=function(e){r.ngModel.address.postalCode=e.postalCode,r.ngModel.address.blockNumber=e.blockNumber,r.ngModel.address.streetName=e.streetName},r.onSelectAddress=s,r.addFavorite=function(){var e=i.getClientId();r.favoriteAddress={address:r.ngModel.address,contactNumber:r.ngModel.contactNumber,contactPerson:r.ngModel.name,addressType:r.isCollection?1:2,customerIds:e?[e]:[]},n.createPopup({templateUrl:"app/directives/jobCommon/points/pointAddFavorite.html",size:"lg",data:{favoriteAddress:r.favoriteAddress}},{onCreate:function(){r.isLoadingAddress=!0,t.saveFavoriteAddress(r.favoriteAddress).then((function(e){r.isLoadingAddress=!1,o.success("The favorite address has been created successfully.")}),(function(e){o.error(e.data.message),r.isLoadingAddress=!1}))}})},r.loadFavoriteAddress=a,a(),r.ngModel=r.ngModel||{}}angular.module("main.module").directive("pointContactInfo",(function(){return{restrict:"E",scope:{ngModel:"=",form:"=?",isCollection:"=?"},templateUrl:"app/directives/jobCommon/points/pointContactInfo.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["locationService","favoriteService","modalService","toastr","adhocService"]}(),function(){"use strict";function e(e){var t=this;t.save=function(){delete t.ngModel.editMode},t.surchargeDescriptionChange=function(){t.ngModel.surchargeAmount=e.getSurchargeAmount(t.ngModel.surchargeDescription)||0},t.surchargeList=["Evening, Sat, Sun & Public Holiday","Restricted Area"],t.ngModel=t.ngModel||{}}angular.module("main.module").directive("pointContactTrip",(function(){return{restrict:"E",scope:{ngModel:"=",index:"=",canRemove:"=?",removePoint:"&?",viewMode:"=",label:"@",isCollection:"=?",isMilkRun:"=?"},templateUrl:"app/directives/jobCommon/points/pointContactTrip.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["adhocService"]}(),function(){"use strict";function e(){var e=this;function t(e){return!!(e.contactNumber&&e.name&&e.address&&e.address.blockNumber&&e.address.postalCode&&e.address.unitNumber&&e.address.streetName)}e.save=function(){n=t(e.collectionPoint),o=t(e.deliveryPoint)&&e.deliveryPoint.items.length,n&&o&&(delete e.collectionPoint.editMode,delete e.deliveryPoint.editMode,e.collectionPoint.isCollapse=!0,e.deliveryPoint.isCollapse=!0);var n,o},e.onEdit=function(){e.orgCollectionPoint=angular.copy(e.collectionPoint),e.orgDeliveryPoint=angular.copy(e.deliveryPoint),e.collectionPoint.editMode=!0,e.deliveryPoint.editMode=!0,e.collectionPoint.isCollapse=!1,e.deliveryPoint.isCollapse=!1},e.cancel=function(){if(e.canRemove)e.removeTrip({index:e.index});else{var t=e.collectionPoint.tripSequence;e.collectionPoint={editMode:!0,tripSequence:t,items:[]},e.deliveryPoint={editMode:!0,tripSequence:t,items:[]}}},e.ngModel=e.ngModel||{}}angular.module("main.module").directive("pointTrip",(function(){return{restrict:"E",scope:{collectionPoint:"=",deliveryPoint:"=",index:"=",canRemove:"=?",canEdit:"=?",removeTrip:"&?",viewMode:"=",isMilkRun:"=?"},templateUrl:"app/directives/jobCommon/points/pointTrip.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(e,t,n,o){var i=this;i.departments=e,i.removeItem=function(e){i.relatedPoints=function(e){i.points=i.getAllPoints&&i.getAllPoints()||[];for(var t=[],n=0;n<i.points.length;n++){if(n!==i.index-1)i.points[n].items.some((function(t){return t.elementId&&t.elementId===e.elementId}))&&t.push(n)}return t}(i.ngModel.items[e]),i.selectedPoints=angular.copy(i.relatedPoints),i.currentIndex=e,i.relatedPoints.length?t.createPopup({templateUrl:"app/directives/jobCommon/items/applyRelatedPointModal.html",size:"lg",data:{relatedPoints:i.relatedPoints,selectedPoints:i.selectedPoints,isCollection:i.isCollection}},{yes:function(){i.selectedPoints.forEach((function(e){i.points[e].items=i.points[e].items.filter((function(e){return e.elementId&&e.elementId!==i.ngModel.items[i.currentIndex].elementId}))})),i.ngModel.items.splice(i.currentIndex,1)},no:function(){i.ngModel.items.splice(i.currentIndex,1)}}):i.ngModel.items.splice(i.currentIndex,1)},i.editItem=function(e){i.editMode=!0,e.editMode=!0},i.addItem=function(){i.editMode=!0,i.ngModel.items.push({editMode:!0})},i.editMode=!1,i.changeMode=function(e){i.editMode=!1,e.editMode=!1},i.viewPhotos=function(e){t.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:e}},{})},i.getMilkRunWeight=function(e){for(var t in n)if(n[t].id==e)return n[t].text;for(var t in o)if(o[t].value==e)return o[t].display;return"N/A"},i.ngModel.items=i.ngModel.items||[]}angular.module("main.module").directive("itemList",(function(){return{restrict:"E",scope:{ngModel:"=",viewMode:"=?",isRoundTrip:"=?",isMilkRun:"=?",isExist:"=?",getAllPoints:"&?",index:"=?",isCollection:"=?"},templateUrl:"app/directives/jobCommon/items/itemList.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["departments","modalService","milkRunWeight","healthCareFixedRunWeightCategory"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u,m,p,g){var v=this;function f(){return r.getFavoriteItems()}function h(e){v.ngModel.description=e.description,v.ngModel.issueQuantity=e.issueQuantity,v.ngModel.unitMass=e.unitMass,v.ngModel.uom=e.uom,v.ngModel.depth=e.depth||"",v.ngModel.height=e.height||"",v.ngModel.width=e.width||"",v.ngModel.width&&v.ngModel.height&&v.ngModel.depth?v.ngModel.unitVolume=v.ngModel.width*v.ngModel.height*v.ngModel.depth/5e3:v.ngModel.unitVolume="",v.searchTerm=""}v.departments=a,v.searchFavoriteItem=function(e){return s.searchFavoriteItem(e,r.getClientId()).then((function(e){return e.data.favoriteItems}))},v.onSelectItem=h,v.save=function(){if(delete v.ngModel.editMode,v.isNew){if(v.selectedPoints&&v.selectedPoints.length){e=v.getAllPoints();v.selectedPoints.forEach((function(t){e[t].items.push(angular.copy(v.ngModel))}))}}else if(v.selectedPoints&&v.selectedPoints.length){var e=v.getAllPoints();v.selectedPoints.forEach((function(t){e[t].items.forEach((function(n,o){if(n.elementId&&n.elementId===v.ngModel.elementId){var i=n.id;e[t].items[o]=angular.copy(v.ngModel),e[t].items[o].id=i}}))}))}v.changeMode()},v.cancel=function(){v.changeMode(v.ngModel)},v.openUploadFile=function(){c((function(){document.getElementById("uploadFile-"+v.uniqueElement).value="",document.getElementById("uploadFile-"+v.uniqueElement).click()}))},v.uploadFileComplete=function(){var e=Array.from(v.itemImages);v.ngModel.itemImages=v.ngModel.itemImages||[],v.ngModel.itemImages=v.ngModel.itemImages.concat(e.map((function(e){return{name:e.name}}))),d.setImageItem(e,v.ngModel.elementId),l.$apply()},v.addFavorite=function(){v.favoriteItem=angular.copy(v.ngModel);var e=r.getClientId();v.favoriteItem.customerIds=e?[e]:[],u.createPopup({templateUrl:"app/directives/jobCommon/items/addFavorite.html",size:"lg",data:{favoriteItem:v.favoriteItem}},{onCreate:function(){v.isLoadingItem=!0,delete v.favoriteItem.id,s.saveFavoriteItem(v.favoriteItem).then((function(e){v.isLoadingItem=!1,m.success("The favorite item has been created successfully.")}),(function(e){m.error(e.data.message),v.isLoadingItem=!1}))}})},v.milkRunWeight=p,v.uniqueElement=(new Date).getTime(),v.onRemove=function(e){u.createWarningPopup("Delete image"+v.ngModel.itemImages[e].name+" ? ","Warning",()=>function(e){v.ngModel.itemImages[e].imageUrl?v.ngModel.itemImages[e].isDeleted=!0:(d.setImageItem(v.ngModel.itemImages,v.ngModel.elementId,v.ngModel.itemImages[e].name),v.ngModel.itemImages.splice(e,1))}(e))},v.viewPhoto=function(e){u.createPopup({templateUrl:"app/directives/jobCommon/items/itemPhotoModal.html",size:"lg",data:{itemImages:[e]}},{})},v.changeFavoriteItem=function(){h(f().find((function(e){return e.id==v.selectedItem})))},v.loadFavoriteAddress=f,function(){v.isNew=!(v.ngModel.elementId||v.ngModel.id),v.ngModel.elementId=v.ngModel.elementId||(new Date).getTime(),v.getAllPoints&&void 0!==v.getAllPoints()&&function(){var e=v.getAllPoints();if(v.isLastPoint=v.indexPoint===e.length,v.relatedPoints=[],v.isNew){for(t=0;t<e.length;t++)t!==v.indexPoint-1&&v.relatedPoints.push(t);v.selectedPoints=[]}else{for(var t=0;t<e.length;t++){if(t!==v.indexPoint-1)e[t].items.some((function(e){return e.elementId&&e.elementId===v.ngModel.elementId}))&&v.relatedPoints.push(t)}v.selectedPoints=angular.copy(v.relatedPoints)}}();if(v.form=v.form||{},v.addNewItemReference=e,v.isAddItemSubmitted=!1,v.uoms=t.currentUser.department===a.PSS.name?o:i,v.isHealthCare=t.currentUser.department===a.Healthcare.name,v.isHealthCare)for(var r in v.itemsHealthCare=[{id:void 0,name:"Please select ..."}],angular.forEach(n,(function(e){v.itemsHealthCare.push({id:e,name:e})})),v.healthCareFixedRunWeightCategories=[],g)v.healthCareFixedRunWeightCategories.push({id:g[r].value,name:g[r].display})}()}angular.module("main.module").directive("itemDetail",(function(){return{restrict:"E",scope:{ngModel:"=",changeMode:"&",isMilkRun:"=?",index:"=?",remove:"&?",isExist:"=?",getAllPoints:"&?",indexPoint:"=?",isCollection:"=?"},templateUrl:"app/directives/jobCommon/items/itemDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["addNewItemReference","$rootScope","itemsHealthCare","uomPSS","uomHealthCare","adhocService","departments","favoriteService","$scope","$timeout","imageService","modalService","toastr","milkRunWeight","healthCareFixedRunWeightCategory"]}(),function(){"use strict";function e(e,t){var n=this;n.elementId="image-detail-"+t.$id,n.rotate=function(e){n.angle=(n.angle+e)%360;e=Math.abs(n.angle);n.width=n.width||document.getElementById(n.elementId).clientWidth,n.height=n.height||document.getElementById(n.elementId).clientHeight,n.className="rotate"+e,n.containerStyle=90===e||270===e?{width:n.height+"px",height:n.width+"px"}:{width:n.width+"px",height:n.height+"px"}},n.angle=0,n.className="",n.containerStyle={},function(){n.ngModel.imageUrl&&e.getImageFromFileName(n.ngModel.imageUrl).then((function(e){n.base64Image="data:image/png;base64,"+e.data}));if(!n.ngModel.imageUrl&&n.ngModel.name){var t=e.getImageFromName(n.ngModel.name),o=new FileReader;o.readAsDataURL(t),o.onload=function(e){document.getElementById(n.elementId).src=e.target.result}}}()}angular.module("main.module").directive("imageDetail",(function(){return{restrict:"E",scope:{ngModel:"="},templateUrl:"app/directives/jobCommon/items/imageDetail.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["imageService","$scope"]}(),function(){"use strict";function e(e,t,n,o,i,r,a,s,l,c,d,u){var m=this;function p(){m.isLoading=!0,o.assignVendor({isMilkRun:m.isMilkRun,isDriver:m.dataAssignVendor.isDriver,userId:m.dataAssignVendor.user.id,targetIds:m.listCheckPoint}).then((function(e){var t,n;i.success("The selected points have been assigned to "+(m.dataAssignVendor.isDriver?"driver":"vendor")+" successfully."),t=m.dataAssignVendor.isDriver,n=m.dataAssignVendor.user.name,angular.forEach(m.listCheckPoint,(function(e){var o=m.ngModel.find((function(t){return t.id===e}));t?(o.hasInternalDriverAssigned=!0,o.vendorName=""):(o.vendorName=n,o.hasInternalDriverAssigned=!1)})),m.listCheckPoint=[],m.isCheckAll=!1,m.isLoading=!1}))}m.adhocTypes=e,m.addPoint=function(){if(m.ngModel.find((function(e){if(e.editMode)return!0;var t=e.items;return!t.length||!!t.find((function(e){return e.editMode}))||void 0})))i.warning("Please save all points before adding new point!");else{var e=[];angular.forEach(m.ngModel[m.ngModel.length-1].items,(function(t){if(t.isApplyToNext){var n=angular.copy(t);delete n.id,e.push(n)}})),m.ngModel.push({editMode:!0,items:e})}},m.removePoint=function(e){m.ngModel.splice(e,1)},m.systemRole=t,m.checkAllChange=function(){m.isCheckAll?m.listCheckPoint=m.ngModel.map((function(e){return e.id})):m.listCheckPoint=[]},m.onCheckPoint=function(e){m.isCheckAll=!1;for(var t=0;t<m.listCheckPoint.length;t++)if(m.listCheckPoint[t]==e)return void m.listCheckPoint.splice(t,1);m.listCheckPoint.push(e)},m.bindingCheck=function(e){return m.listCheckPoint.some((function(t){return t==e}))},m.assignVendorDriver=function(e){if(!m.canAssign)return void i.warning("Job is not approved, please approve the job first");var t={assignVendor:p};m.dataAssignVendor={isDriver:e,customerId:m.customerId},n.createPopup({templateUrl:"app/directives/jobCommon/assignVendor/assignVendorModal.html",size:"lg",data:m.dataAssignVendor},t)},m.downloadSampleCsv=function(){var e=d.currentUser.department===u.PSS.name,t=[];t=e?[{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",Remark:"Avoid lunch time",SurchargeDescription:"Restricted area;Public Holiday",SurchargeAmount:"2;1",FixedRunWeight:"<5;5to10;10to30;30to60;60to100",Quantity:"1;2;3;4;5",ItemRemark:"Careful;;Careful;;"}]:[{PostalCode:"079905",BlockNumber:"70",StreetName:"Anson Rd",UnitNumber:"23-1",ContactPerson:"Mrs Lina",ContactNumber:"2352454",Remark:"Avoid lunch time",SurchargeDescription:"Restricted area;Public Holiday",SurchargeAmount:"2;1",ItemDescription:"Documents-18;Pharmaceutical-19;Blood-20",Quantity:"1;2;3",ItemRemark:"Careful;Careful;Careful"}];var n="FixedRun"+(m.isCollection?"Collection":"Delivery")+d.currentUser.department+"Template.csv";r.exportCsvFile({data:t,filename:n})},m.openFile=function(){s((function(){document.getElementById("uploadFile").click()}))},m.uploadFile=function(){m.csvFile&&r.readAsDataUrl(m.csvFile,l).then((function(e){var t=d.currentUser.department===u.PSS.name;if(angular.element(document.getElementById("uploadFile")).val(null),a.isValidFile(e,t)){var n=a.getMilkRunPointsFromText(e,t);m.ngModel=m.ngModel.concat(n),i.success("The csv file is uploaded successfully!")}else i.warning("The csv file is missing data or invalid format!")}))},m.getAllPoints=function(){return m.ngModel},m.listCheckPoint=[],m.isBatchUpload=m.isMilkRun&&(m.jobType==m.adhocTypes.oneToMany&&!m.isCollection||m.jobType==m.adhocTypes.manyToOne&&m.isCollection),m.canEdit=m.jobStatus!==c.readyToBill.value&&m.jobStatus!==c.pendingRejection.value&&m.jobStatus!==c.billed.value}angular.module("main.module").directive("jobPoints",(function(){return{restrict:"E",scope:{ngModel:"=",isCollection:"=?",jobType:"=",viewMode:"=",label:"@",isMilkRun:"=?",jobId:"=?",customerId:"=?",canAssign:"=?",jobStatus:"=?"},templateUrl:"app/directives/jobCommon/points/jobPoints.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["adhocTypes","systemRole","modalService","adhocService","toastr","fileReaderService","milkrunService","$timeout","$scope","jobStatusType","$rootScope","departments"]}(),function(){"use strict";function e(e,t){var n=this;n.searchFavoriteAddress=function(t){return e.searchFavoriteAddress(t).then((function(e){return e.data.favoriteAddresses}))},n.searchAddressByPostalCode=function(e){return t.getLocationByPostalCode(e).then((function(e){return[{postalCode:e.data.postalCode,blockNumber:e.data.buildingNumber,streetName:e.data.streetName}]}))},n.onSelect=function(e){n.ngModel.address.postalCode=e.postalCode,n.ngModel.address.blockNumber=e.blockNumber,n.ngModel.address.streetName=e.streetName},n.onSelectAddress=function(e){n.ngModel.address=n.ngModel.address||{},n.ngModel.address.postalCode=e.postalCode,n.ngModel.address.blockNumber=e.blockNumber,n.ngModel.address.streetName=e.streetName,n.ngModel.address.unitNumber=e.unitNumber,n.ngModel.address.contactPerson=e.contactPerson,n.ngModel.address.contactNumber=e.contactNumber,n.searchTerm=""}}angular.module("main.module").directive("contactReattempt",(function(){return{restrict:"E",scope:{ngModel:"=",form:"=?"},templateUrl:"app/directives/jobCommon/contactReattempt/contactReattempt.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["favoriteService","locationService"]}(),function(){"use strict";function e(e,t,n,o){var i=this;i.systemRole=t,i.viewMode=!0,i.edit=function(){i.viewMode=!1,i.value=e.convertDate(i.ngModel)},i.update=function(){n.updateTaskDate(i.task.id,{barcode:i.task.barcode,date:i.value,dateType:i.isCollection?1:2}).then((function(e){i.viewMode=!0,i.callback(),o.success("The date has been updated successfully.")}))}}angular.module("main.module").directive("updateTaskDate",(function(){return{restrict:"E",scope:{ngModel:"=",task:"=",callback:"&",isCollection:"=?",canEdit:"=?"},templateUrl:"app/directives/jobCommon/updateDate/updateTaskDate.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["utilityService","systemRole","taskService","toastr"]}(),function(){"use strict";function e(e){var t=this;t.systemRole=e,t.viewMode=!0,t.edit=function(){t.viewMode=!1,t.value=t.ngModel},t.save=function(){t.viewMode=!0,t.ngModel=t.value}}angular.module("main.module").directive("updatePrice",(function(){return{restrict:"E",scope:{ngModel:"=",isMilkRun:"=?",canEdit:"=?"},templateUrl:"app/directives/jobCommon/updatePrice/updatePrice.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["systemRole"]}(),function(){"use strict";function e(e){var t=this;t.addSurcharge=function(){t.ngModel.push({})},t.removeSurcharge=function(e){t.ngModel.splice(e,1)},t.surchargeDescriptionChange=function(n){t.ngModel[n].amount=e.getSurchargeAmount(t.ngModel[n].description)||0},t.surchargeList=["Evening, Sat, Sun & Public Holiday","Restricted Area"],t.ngModel=t.ngModel||[]}angular.module("main.module").directive("surchargePoint",(function(){return{restrict:"E",scope:{ngModel:"=",editMode:"="},templateUrl:"app/directives/jobCommon/points/surcharge.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["adhocService"]}(),function(){"use strict";function e(e,t){var n=this;(n=this).isCheckAll=!1,n.searchTerm="",n.bindingCheck=function(e){return!!n.detail.customerIds.find((function(t){return t===e}))},n.onCheck=function(e){n.isCheckAll=!1;for(var t=0;t<n.detail.customerIds.length;t++)if(n.detail.customerIds[t]===e)return void n.detail.customerIds.splice(t,1);n.detail.customerIds.push(e)},n.selectAll=function(){n.isCheckAll=!n.isCheckAll,n.isCheckAll?n.filteredUsers.forEach((function(e){-1===n.detail.customerIds.indexOf(e.id)&&n.detail.customerIds.push(e.id)})):n.filteredUsers.forEach((function(e){var t=n.detail.customerIds.indexOf(e.id);t>-1&&n.detail.customerIds.splice(t,1)}))},n.filter=function(){n.isCheckAll=!1,n.filteredUsers=n.users.filter((function(e){return e.name.toLowerCase().indexOf(n.searchTerm.toLowerCase())>-1}))},n.filteredUsers=[],n.detail.customerIds=n.detail.customerIds||[],n.users=[],e.getCustomerByCriteria({sortColumn:"organizationCode",sortAscending:!0}).then((function(e){n.users=e.data.customers.map((function(e){return{id:e.id,name:e.organizationCode+" "+e.name,departmentId:e.department.id}})),n.filteredUsers=angular.copy(n.users)})),n.departments&&t.$watch("vm.departments",(function(e){var t=e.filter((function(e){return e.isCheck})).map((function(e){return e.departmentId}));n.filteredUsers=n.users.filter((function(e){return t.indexOf(e.departmentId)>-1}))}),!0)}angular.module("main.module").directive("clientsSelection",(function(){return{restrict:"E",scope:{detail:"=?",departments:"=?"},templateUrl:"app/directives/clientsSelection/clientSelection.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["customerService","$scope"]}(),function(){"use strict";function e(){var e=this;e.collapse=!0,e.separator=e.separator||/\r?\n/g,e.values=e.ngModel?e.ngModel.split(e.separator):"",e.finalValues=[],angular.forEach(e.values,(function(t){e.finalValues=e.finalValues.concat(t.split("<br/>"))})),e.showMore=function(t){t.stopPropagation(),e.collapse=!1}}angular.module("main.module").directive("showMore",(function(){return{restrict:"E",scope:{ngModel:"=",separator:"=?"},templateUrl:"app/directives/showMore/showMore.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=[]}(),function(){"use strict";function e(e,t){var n=this;n.toggle=function(e){e.stopPropagation(),n.isOpen=!n.isOpen},n.bindingCheck=function(e){return n.selected.indexOf(e)>=0},n.onCheck=function(e,t){e.stopPropagation(),n.isCheckAll=!1;for(var o=0;o<n.selected.length;o++)if(n.selected[o]===t)return void n.selected.splice(o,1);n.selected.push(t)},n.selectAll=function(){n.isCheckAll=!n.isCheckAll,n.isCheckAll?n.selected=angular.copy(n.source):n.selected=[]},n.isCheckAll=!!n.selected.length;var o=function(){n.isOpen=!1,e.$apply()};t.bind("click",o),e.$on("$destroy",(function(){angular.element(t).off("click",o)}))}angular.module("main.module").directive("multiSelectCheckbox",(function(){return{restrict:"E",scope:{source:"=?",selected:"=?",isCollection:"=?"},templateUrl:"app/directives/multiSelectCheckbox/multiSelectCheckbox.html",controller:e,controllerAs:"vm",bindToController:!0}})),e.$inject=["$scope","$document"]}();