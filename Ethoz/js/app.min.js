!function(){"use strict";function e(e,t){t.isLocal||e.debugInfoEnabled(!1)}function t(e){e.interceptors.push("httpInterceptor")}function n(e,t){t.hashPrefix(""),e.when("/",{redirectTo:"/login"}).otherwise({redirectTo:"/"})}function a(e,t,n,a){e.$on("$locationChangeStart",function(e,i,r){var o=n.path(),s=t.routes[o];if(s&&s.authorize)return a.isAuthenticated()?void(a.isAuthorized(s.authorize)||n.path("/login")):void n.path("/login")}),e.$on("$routeChangeSuccess",function(){t.current&&(e.currentPage=t.current.page,e.loginPage=t.current.loginPage),t.current.title?document.title="Ethoz - "+t.current.title:document.title="Ethoz"})}angular.module("main.module",["ngRoute","ui.bootstrap","ngMap","ngDraggable","ngSanitize","LocalStorageModule","ui.bootstrap.contextMenu","duScroll","ui.bootstrap.datetimepicker","toastr","constants.module","dashboard.module","vehicleManagement.module","jobDetail.module","user.module","taskManagement.module","vehicleDetail.module"]).config(e).config(t).config(n).run(a),e.$inject=["$compileProvider","systemSetting"],t.$inject=["$httpProvider"],n.$inject=["$routeProvider","$locationProvider"],a.$inject=["$rootScope","$route","$location","authService"]}(),function(){"use strict";angular.module("constants.module",[]).constant("systemSetting",{serviceUrl:window.env.apiUrl,isLocal:["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.hostname)>-1}).constant("systemPage",{login:"login",dashboard:"dashboard"}).constant("systemRole",{SuperAdmin:"SuperAdmin",Admin:"Admin"}).constant("calendarSetting",{startTime:12,sizeHour:6,percentagePerJob:12.5}).constant("jobType",{regular:0,miceJobsheet:1}).constant("jobStatus",{unassigned:{value:0,text:"Unassigned"},assigned:{value:1,text:"Assigned"},inProgress:{value:2,text:"In Progress"},completed:{value:3,text:"Completed"},cancelled:{value:4,text:"Cancelled"}}).constant("taskStatus",{unassigned:{value:0,text:"Unassigned"},assigned:{value:1,text:"Assigned"},completed:{value:2,text:"Completed"},cancelled:{value:3,text:"Cancelled"}}).constant("handoverStatus",{itemChecklist:0,exteriorChecklist:1,handoverForm:2,confirmation:3,completed:4}).constant("driverStatus",{available:"available",onLeave:"onLeave",onLeaveButHaveJob:"onLeaveButHaveJob"}).constant("driverUnAvailable",{AM:{startTime:"8:30",endTime:"13:30",text:"On Leave - Half Day"},PM:{startTime:"12:30",endTime:"18",text:"On Leave - Half Day"},Both:{startTime:"8:30",endTime:"18",text:"On Leave - Whole Day"}}).constant("jobDetailState",{jobDetail:"jobDetail",itemChecklist:"itemChecklist",exteriorChecklist:"exteriorChecklist"})}(),function(){"use strict";function e(e,t){e.when("/dashboard",{title:"Dashboard",controller:"DashboardController",templateUrl:"app/views/dashboard/dashboard.html",controllerAs:"vm"})}function t(e,t,n,a,i){function r(){g.currentDate=new Date,g.timeSetting={startTime:i.getStartTimeFromCurrentTime(g.currentDate),sizeHour:n.sizeHour},g.calendarViewMode=!0,g.criteria={driver:"",branchLocation:""},g.numberOfRecord={request:null,task:null}}function o(){g.isLoading=!0,a.getDriverTimeLineByCriteria(g.currentDate,g.criteria).then(function(e){g.isLoading=!1,g.drivers=a.convertListDriverTimeLine(e.data),d()})}function s(){d(),m()}function c(){g.calendarViewMode?(o(),g.reloadRequestTab(),g.reloadTaskTab()):g.reloadDriverInMap()}function u(){g.calendarViewMode?o():"function"==typeof g.reloadDriverInMap&&g.reloadDriverInMap()}function l(e,t,n){n||g.reloadRequestTab(),angular.forEach(g.drivers,function(t){if(t.requests&&t.requests.length)for(var n=0;n<t.requests.length;n++)t.requests[n].id===e.id&&t.requests.splice(n,1)}),angular.forEach(g.drivers,function(n){n.id===t&&(n.requests=n.requests||[],n.requests.push(e))}),d()}function d(){g.currentTimeStyleDisplay=a.initStyleForCurrentTime(g.timeSetting.startTime,g.timeSetting.sizeHour,g.currentDate),angular.forEach(g.drivers,function(e){e.currentTimeStyles=g.currentTimeStyleDisplay,a.populateStyleForDriver(e,g.timeSetting.startTime,g.timeSetting.sizeHour),angular.forEach(e.requests,function(t){a.getRequestStatusFromJob(t),a.populateStyleForRequest(e,t,g.timeSetting.startTime,g.timeSetting.sizeHour),i.checkIsToDay(g.currentDate)&&a.checkJobInCurrentTime(t,g.timeSetting.startTime,g.timeSetting.sizeHour)})})}function m(){e.$broadcast("reInitDragTime",null)}function h(){g.maxHeight={"max-height":t.innerHeight-88+"px"}}var g=this;g.reAssignDriver=l,g.reRenderCalendar=s,g.getDriverByCriteria=o,g.currentDateChange=c,g.reloadWhenCriteriaChange=u,g.refreshData=c,function(){r(),o(),h(),g.reloadRequestTab={},g.reloadTaskTab={},g.reloadDriverInMap={}}()}angular.module("dashboard.module",["ngRoute"]).config(e).controller("DashboardController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$window","calendarSetting","dashboardService","timeService"]}(),function(){"use strict";function e(e){e.when("/itemChecklist",{title:"itemChecklist",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleItemChecklist.html",controllerAs:"vm"}).when("/exteriorChecklist",{title:"exteriorChecklist",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleItemChecklist.html",controllerAs:"vm"}).when("/vehicleType",{title:"vehicleType",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleType.html",controllerAs:"vm"}).when("/vehicleList/:id",{title:"vehicleList",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleList.html",controllerAs:"vm"}).when("/test",{title:"vehicleList",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/test.html",controllerAs:"vm"}).when("/vehicleManagement",{title:"vehicleManagement",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleManagement.html",controllerAs:"vm"})}function t(e,t,n,a){var i=this;i.requestNo="38183",i.date=new Date,n.go=function(e){a.path("/"+e),console.log(i.currentList)},n.showItemChecklist="/itemChecklist"===a.path(),n.showExteriorChecklist="/exteriorChecklist"===a.path(),i.ngChange=function(){alert(i.date)}}angular.module("vehicleManagement.module",["ngRoute"]).config(e).controller("vehicleManagementController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","timeService","$scope","$location"]}(),function(){"use strict";function e(e){e.when("/jobs/:id",{title:"Job Detail",controller:"JobDetailController",templateUrl:"app/views/jobDetail/jobDetail.html",controllerAs:"vm"}).when("/jobs/:jobId/handovers/:handoverId/itemChecklist",{title:"Job Detail - Item CheckList",controller:"JobDetailCheckListController",templateUrl:"app/views/jobDetail/itemCheckList.html",controllerAs:"vm"}).when("/jobs/:jobId/handovers/:handoverId/exteriorChecklist",{title:"Job Detail - Exterior CheckList",controller:"JobDetailCheckListController",templateUrl:"app/views/jobDetail/exteriorChecklist.html",controllerAs:"vm"})}function t(e,t,n,a){function i(){var t=e.id;o.isLoading=!0,n.getJobById(t).then(function(e){o.job=n.convertJobDetail(e.data),o.isLoading=!1})}function r(){var e=o.job.jobIds[o.job.jobIndex+1];t.path("/jobs/"+e)}var o=this;o.jobStatus=a,o.nextJob=r,function(){o.currentHandover={},i()}()}function n(e,t){function n(){a.jobId=e.jobId,a.handoverId=e.handoverId,a.isLoading=!0,t.getJobById(a.jobId).then(function(e){a.job=t.convertJobDetail(e.data),a.handover=t.getHandoverById(a.job,a.handoverId),a.isLoading=!1})}var a=this;!function(){n()}()}angular.module("jobDetail.module",["ngRoute"]).config(e).controller("JobDetailController",t).controller("JobDetailCheckListController",n),e.$inject=["$routeProvider"],t.$inject=["$routeParams","$location","jobService","jobStatus"],n.$inject=["$routeParams","jobService"]}(),function(){"use strict";function e(e,t){var n=this;n.data=t,n.ok=function(t){e.close(t)},n.cancel=function(){e.dismiss("cancel")}}angular.module("main.module").controller("ModalInstanceController",e),e.$inject=["$uibModalInstance","data"]}(),function(){"use strict";function e(e,t){e.when("/login",{title:"Login",controller:"UserController",templateUrl:"app/views/user/login.html",controllerAs:"vm",page:t.login,loginPage:!0})}function t(e,t,n){function a(){i.isLoading=!0,t.login(i.userName,i.password).then(function(t){i.isLoading=!1,e.path("/dashboard")},function(e){i.isLoading=!1,i.errorMessage=e.data.message})}var i=this;i.login=a,i.userName="superadmin",i.password="Admin@123456"}angular.module("user.module",["ngRoute"]).config(e).controller("UserController",t),e.$inject=["$routeProvider","systemPage"],t.$inject=["$location","authService","$rootScope"]}(),function(){"use strict";function e(e){e.when("/taskManagement",{title:"taskManagement",controller:"taskManagementController",templateUrl:"app/views/taskManagement/taskManagement.html",controllerAs:"vm"})}function t(e,t,n,a){var i=this;n.go=function(e){a.path("/"+e),console.log(i.currentList)},n.showItemChecklist="/itemChecklist"===a.path(),n.showExteriorChecklist="/exteriorChecklist"===a.path()}angular.module("taskManagement.module",["ngRoute"]).config(e).controller("taskManagementController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","timeService","$scope","$location"]}(),function(){"use strict";function e(e){e.when("/vehicles/:id",{title:"Vehicle Detail",controller:"VehicleDetailController",templateUrl:"app/views/vehicleDetail/vehicleDetail.html",controllerAs:"vm"})}function t(e,t,n){function a(){t.getVehicleById(s.vehicleId).then(function(e){s.vehicle=e.data})}function i(){s.currentViewMode==s.viewMode.exteriorChecklist&&r()}function r(){t.getVehicleVersion(s.vehicleId).then(function(e){s.versions=e.data,s.versions&&s.versions.length&&(s.versions[0].version="Current version",s.currentVersion=s.versions[0].id)})}function o(){n(function(){s.updateChecklist()})}var s=this;s.viewModeChange=i,s.versionChange=o,function(){s.vehicleId=e.id,s.viewMode={itemChecklist:"itemChecklist",exteriorChecklist:"exteriorChecklist"},s.checklists=[{text:"Item Checklist",value:s.viewMode.itemChecklist},{text:"Exterior Checklist",value:s.viewMode.exteriorChecklist}],s.currentViewMode=s.viewMode.itemChecklist,s.updateChecklist={},a()}()}angular.module("vehicleDetail.module",["ngRoute"]).config(e).controller("VehicleDetailController",t),e.$inject=["$routeProvider"],t.$inject=["$routeParams","vehicleService","$timeout"]}(),function(){"use strict";function e(e){this.systemPage=e}angular.module("main.module").component("headerPage",{bindings:{},templateUrl:"app/components/headerPage/headerPage.html",controller:e,controllerAs:"vm"}),e.$inject=["systemPage"]}(),function(){"use strict";function e(e){this.systemPage=e}angular.module("main.module").component("footerPage",{bindings:{},templateUrl:"app/components/footerPage/footerPage.html",controller:e,controllerAs:"vm"}),e.$inject=["systemPage"]}(),function(){"use strict";function e(e){function t(){i.ranges=[],i.textHours=[];for(var t=0;t<i.timeSetting.sizeHour;t++)i.ranges.push(t+i.timeSetting.startTime),i.textHours.push(e.timeToStringMaker(t+i.timeSetting.startTime));i.textHours.push(e.timeToStringMaker(i.timeSetting.startTime+i.timeSetting.sizeHour)),i.timeText=e.getCurrentTimeText()}function n(){i.timeSetting.startTime+=1,t(),i.timeChange()}function a(){i.timeSetting.startTime-=1,t(),i.timeChange()}var i=this;i.next=n,i.back=a,i.$onInit=function(){t()}}angular.module("main.module").component("timeControl",{bindings:{timeSetting:"=",timeChange:"&",currentDate:"<",currentTimeStyleDisplay:"<"},templateUrl:"app/components/dashboard/timeControl/timeControl.html",controller:e,controllerAs:"vm"}),e.$inject=["timeService"]}(),function(){"use strict";function e(e,t,n,a,i,r){function o(){m(),p()}function s(e,t,n,i){if(e)return e.startTime?void c(e,n,i):void(e.isHaveExpectedStartTime?d(e.expectedStartTime,n)?c(e,n,i):a.warning("This request should be assigned at "+e.expectedStartTimeString):c(e,n,i))}function c(e,n,a){var i=angular.copy(e),r=!!i.startTime;t.populateTimeForRequestAfterDrop(i,angular.copy(n)),u(i,a,r)}function u(e,n,a){v.isLoading=!0;var i=t.getAssignRequestData(e,n,v.currentDate);t.assignRequest(i).then(function(t){v.isLoading=!1,v.reAssignDriver({request:e,driverId:n,isAssigned:a})})}function l(e,n,a){t.setDuration(e,n,a),v.reRenderCalendar()}function d(e,t){return h(t,{hour:e.getHours(),minute:e.getMinutes()})}function m(){v.draps=[];for(var e=v.timeSetting.startTime,t=0,n=2,a=e;a<v.timeSetting.startTime+v.timeSetting.sizeHour;a++)v.draps.push({style:{left:12.5*n/2+"%"},hour:a,minute:t}),n++,0!=t?30==t&&(t=0):(a--,t=30)}function h(e,t){return e.hour<t.hour||e.hour==t.hour&&e.minute<=t.minute}function g(){i.createPopup({templateUrl:"app/components/dashboard/driverChartTime/driverDetailModal.html",size:"md",data:v.driver},null)}function p(){r.$on("reInitDragTime",function(e,t){m()})}var v=this;v.jobStatus=e,v.driverStatus=n,v.$onInit=o,v.onDropComplete=s,v.setDuration=l,v.viewDriverDetail=g}angular.module("main.module").component("driverChartTime",{bindings:{driver:"=",isLoading:"=",timeSetting:"<",isTaskActive:"<",reAssignDriver:"&",currentDate:"=",reRenderCalendar:"&",refreshData:"&"},templateUrl:"app/components/dashboard/driverChartTime/driverChartTime.html",controller:e,controllerAs:"vm"}),e.$inject=["jobStatus","dashboardService","driverStatus","toastr","modalService","$scope"]}(),function(){"use strict";function e(e,t,n,a){function i(){c.reload=r,e.getMap().then(function(e){c.map=e}),r()}function r(){t.getDriverLocationByCriteria(c.currentDate,c.criteria).then(function(e){c.drivers=t.convertListDriverLocation(e.data)})}function o(){c.place=this.getPlace(),c.map.setCenter(c.place.geometry.location)}function s(e,a){n.getJobById(a.jobId).then(function(e){c.job=t.convertJobOnMap(e.data),c.map.showInfoWindow("job-info",a.id)})}var c=this;c.taskStatus=a,c.showDetail=s,c.placeChanged=o,c.getBranchLocationByCriteria=r,c.$onInit=i}angular.module("main.module").component("jobOnMap",{bindings:{criteria:"<",currentDate:"<",reload:"="},templateUrl:"app/components/dashboard/jobOnMap/jobOnMap.html",controller:e,controllerAs:"vm"}),e.$inject=["NgMap","dashboardService","jobService","taskStatus"]}(),function(){"use strict";function e(e,t){function n(){a()}function a(){var n=t.checkIsToDay(s.currentDate)?"Today":e("date")(s.currentDate,"EEE");s.dateFormat=n+", "+o(s.currentDate.getDate())+" "+e("date")(s.currentDate,"MMM")+", "+s.currentDate.getFullYear()}function i(){s.currentDate.setDate(s.currentDate.getDate()+1),a(),s.dateChange()}function r(){s.currentDate.setDate(s.currentDate.getDate()-1),a(),s.dateChange()}function o(e){return e%20==1||e%30==1?e+"st":e%20==2||e%30==2?e+"nd":e%20==3||e%30==3?e+"rd":e+"th"}var s=this;s.$onInit=n,s.next=i,s.previous=r}angular.module("main.module").component("dateControl",{bindings:{currentDate:"=",dateChange:"&"},templateUrl:"app/components/dashboard/dateControl/dateControl.html",controller:e,controllerAs:"vm"}),e.$inject=["$filter","timeService"]}(),function(){"use strict";function e(e,t){function n(){a(),i()}function a(){e.getAllBranchLocation().then(function(e){c.branchLocations=e.data,c.branchLocations.unshift({id:"",name:"All Locations"})})}function i(){e.getDriverByBranchLocation(c.branchLocation).then(function(e){c.drivers=e.data,c.drivers.unshift({id:"",fullName:"All Drivers"})})}function r(){c.driver="",t(function(){i(),c.reloadTimeLine()})}function o(){t(function(){c.reloadTimeLine()})}function s(e){c.calendarViewMode=e,t(function(){c.reloadTimeLine()})}var c=this;c.$onInit=n,c.onLocationChange=r,c.onDriverChange=o,c.changeViewMode=s}angular.module("main.module").component("filterDashboard",{bindings:{calendarViewMode:"=",branchLocation:"=",driver:"=",reloadTimeLine:"&"},templateUrl:"app/components/dashboard/filterDashboard/filterDashboard.html",controller:e,controllerAs:"vm"}),e.$inject=["dashboardService","$timeout"]}(),function(){"use strict";function e(e,t,n){function a(){s.reLoad=i,s.criteria={status:e.unassigned.value,search:""},r(),i()}function i(){s.isLoading=!0,t.getRequestByCriteria(s.currentDate,s.criteria).then(function(e){s.isLoading=!1,s.requests=t.convertListRequestSearch(e.data),s.numberOfRecord=s.requests.length})}function r(){s.listJobStatus=n.getListFromObject(e),s.listJobStatus.unshift({value:"",text:"All Requests"})}function o(e){angular.element(document.getElementsByClassName("selected-item")).removeClass("selected-item"),angular.element(document.querySelector("#request-tab-"+e)).addClass("selected-item"),angular.element(document.querySelector("#request-"+e)).addClass("selected-item")}var s=this;s.jobStatus=e,s.$onInit=a,s.selectJob=o,s.getRequestByCriteria=i}angular.module("main.module").component("requestTab",{bindings:{currentDate:"<",reLoad:"=",numberOfRecord:"="},templateUrl:"app/components/dashboard/requestTab/requestTab.html",controller:e,controllerAs:"vm"}),e.$inject=["jobStatus","dashboardService","utilityService"]}(),function(){"use strict";function e(e,t,n,a,i,r,o,s){function c(){function e(){return f.job.status<=t.inProgress.value}f.menuOptions=[["Set duration",l,e],null,["Add task",d,e],null,["Add petrol card",m,function(){return null==r.getPetrolLog(f.job)&&e()}],null,["Upload document",h,e],null,["Unassign request",v,function(){var e=!1;return angular.forEach(f.request.jobs,function(n){f.job.status<t.inProgress.value&&(e=!0)}),e}]]}function u(e,r){if(f.job.status==t.completed.value||f.job.status==t.cancelled.value){var c=o.getTextFromValue(f.job.status,t);return void i.warning("Can not assign task to "+c+" Job.")}if(new Date(f.job.scheduledStartDate)<new Date)return void i.warning("Can not assign task to the past Job.");var u=e;u.status=a.assigned.value,u.jobId=f.job.id,u.driver=f.driverName,f.isLoading=!0,n.assignTask({taskId:u.id,jobId:f.job.id}).then(function(e){s.$broadcast("reloadTask",null),i.success("Assigning task successfully."),f.isLoading=!1,f.job.tasks=f.job.tasks||[],f.job.tasks.push(angular.copy(u))})}function l(){f.durationData={hour:"1"};var t={setDurationSuccess:g};e.createPopup({templateUrl:"app/components/dashboard/jobCell/setDurationModal.html",size:"md",data:f.durationData},t)}function d(){f.addTaskData={jobId:f.job.id,date:new Date,type:"Errand",status:a.assigned.value};var t={onAddTask:p};e.createPopup({templateUrl:"app/components/dashboard/jobCell/addTaskModal.html",size:"md",data:f.addTaskData},t)}function m(){var e={jobId:f.job.id,date:new Date,type:"Petrol Log",status:a.assigned.value,petrolLog:{date:new Date,mileage:0,gasolineLevel:0,referenceId:(new Date).getTime()}};f.isLoading=!0,n.createTask(e).then(function(e){f.isLoading=!1,f.job.tasks.push(e.data),i.success("Add petrol card successfully.")})}function h(){var t={uploadDocument:{}};e.createPopup({templateUrl:"app/components/dashboard/jobCell/uploadDocumentModal.html",size:"md",data:{jobId:f.job.id,pickupAddress:f.job.pickupAddress,deliveryAddress:f.job.deliveryAddress}},t)}function g(){f.isLoading=!0;var e=n.getDurationData(f.request,f.job,parseFloat(f.durationData.hour));n.saveTimeDuration(e).then(function(e){f.isLoading=!1,f.setDuration({request:f.request,job:f.job,hour:parseFloat(f.durationData.hour)})})}function p(){f.isLoading=!0,n.createTask(f.addTaskData).then(function(e){f.isLoading=!1,f.job.tasks=f.job.tasks||[],f.job.tasks.push(angular.copy(e.data))})}function v(){var e=n.getUnassignRequestData(f.request);f.isLoading=!0,n.unassignRequest(e).then(function(e){f.refreshData()})}var f=this;f.jobStatus=t,f.onDropComplete=u,f.$onInit=c}angular.module("main.module").component("jobCell",{bindings:{job:"=",isLoading:"=",request:"<",isTaskActive:"<",setDuration:"&",driverName:"@",refreshData:"&"},templateUrl:"app/components/dashboard/jobCell/jobCell.html",controller:e,controllerAs:"vm"}),e.$inject=["modalService","jobStatus","dashboardService","taskStatus","toastr","jobService","utilityService","$rootScope"]}(),function(){"use strict";function e(e,t,n,a,i){function r(){g.reLoad=o,g.criteria={status:e.unassigned.value,search:""},s(),h(),o()}function o(){g.isLoading=!0,a.getTaskByCriteria(g.currentDate,g.criteria).then(function(e){g.isLoading=!1,g.tasks=e.data.tasks,g.numberOfRecord=g.tasks.length})}function s(){g.listTaskStatus=n.getListFromObject(e),g.listTaskStatus.unshift({value:"",text:"All Tasks"})}function c(e,n){g.taskDetail=angular.copy(e),g.currentIndex=n;var a={onUpdateTask:l,unAssignDriver:d};t.createPopup({templateUrl:"app/components/dashboard/taskTab/editTaskModal.html",size:"md",data:g.taskDetail},a)}function u(){g.addTaskData={status:e.unassigned.value,date:new Date,type:"Errand"};var n={onAddTask:m};t.createPopup({templateUrl:"app/components/dashboard/jobCell/addTaskModal.html",size:"md",data:g.addTaskData},n)}function l(){g.isLoading=!0,a.updateTask(g.taskDetail).then(function(e){g.isLoading=!1,g.tasks[g.currentIndex]=g.taskDetail})}function d(){g.isLoading=!0,a.unAssignTask({taskId:g.taskDetail.id}).then(function(e){o(),g.reLoadTimeLine()})}function m(){g.isLoading=!0,a.createTask(g.addTaskData).then(function(e){o()})}function h(){i.$on("reloadTask",function(e,t){o()})}var g=this;g.$onInit=r,g.taskStatus=e,g.addTask=u,g.editTask=c,g.getTaskByCriteria=o}angular.module("main.module").component("taskTab",{bindings:{currentDate:"<",reLoad:"=",numberOfRecord:"=",reLoadTimeLine:"&"},templateUrl:"app/components/dashboard/taskTab/taskTab.html",controller:e,controllerAs:"vm"}),e.$inject=["taskStatus","modalService","utilityService","dashboardService","$scope"]}(),function(){"use strict";function e(e,t,n,a){function i(){r()}function r(){u.haveTask=!1,angular.forEach(u.tasks,function(e){e.petrolLogId||(u.haveTask=!0)})}function o(e,t){u.taskDetail=angular.copy(e),u.taskDetail.driver=u.driverName,u.currentIndex=t;var a={onUpdateTask:s,unAssignDriver:c};n.createPopup({templateUrl:"app/components/dashboard/taskTab/editTaskModal.html",size:"md",data:u.taskDetail},a)}function s(){u.isLoading=!0,a.updateTask(u.taskDetail).then(function(e){u.isLoading=!1,u.tasks[u.currentIndex]=u.taskDetail})}function c(){u.isLoading=!0,a.unAssignTask({taskId:u.taskDetail.id}).then(function(t){u.tasks.splice(u.currentIndex,1),r(),e.$broadcast("reloadTask",null)})}var u=this;u.taskStatus=t,u.$onInit=i,u.editTask=o}angular.module("main.module").component("taskAssignment",{bindings:{tasks:"=",driverName:"@"},templateUrl:"app/components/dashboard/taskAssignment/taskAssignment.html",controller:e,controllerAs:"vm"}),e.$inject=["$rootScope","taskStatus","modalService","dashboardService"]}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){e.status={available:"available",empty:"empty"},e.exteriorListItems=[{description:"Radio Antenna",status:e.status.available,change:"yes"},{description:"Number Plate",status:e.status.empty,change:"no"},{description:"Petrol Cap",status:e.status.available,change:"no"},{description:"4 Hub Caps/Rims",status:e.status.available,change:"yes"},{description:"Road Tax Expiry",status:e.status.available,change:"yes"},{description:"Speedlimit Label",status:e.status.available,change:"yes"},{description:"Panel Markings",status:e.status.available,change:"yes"}],e.interiorListItems=[{description:"Cash Card",status:e.status.available,change:"yes"},{description:"Manual Book",status:e.status.empty,change:"no"},{description:"Radio/Cassette",status:e.status.available,change:"no"},{description:"CD Player/Cartridge",status:e.status.available,change:"yes"},{description:"Ashtray",status:e.status.available,change:"yes"},{description:"4 Hub Caps/Rims",status:e.status.available,change:"yes"}],e.othersListItems=[{description:"Rear Booth Carpet/Mat",status:e.status.available,change:"no"},{description:"Supporting Board",status:e.status.empty,change:"no"},{description:"Spare Tyre",status:e.status.available,change:"no"},{description:"Wheel Brace",status:e.status.available,change:"no"},{description:"Tools Kit",status:e.status.available,change:"yes"},{description:"Breakdown Sign",status:e.status.empty,change:"no"},{description:"First Aid Kit",status:e.status.empty,change:"no"},{description:"Jack/Lever",status:e.status.available,change:"no"}],e.customListItems=[{description:"Custom 1",status:e.status.available,change:"yes"},{description:"Custom 2",status:e.status.empty,change:"no"},{description:"Custom 3",status:e.status.available,change:"no"},{description:"Custom 4",status:e.status.available,change:"no"}]}}angular.module("main.module").component("checklistBox",{bindings:{},templateUrl:"app/components/checklist/checklistBox/checklistBox.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("main.module").component("exteriorChecklistbox",{bindings:{},templateUrl:"app/components/checklist/exteriorChecklistBox/exteriorChecklistBox.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("main.module").component("markingComponent",{bindings:{},templateUrl:"app/components/checklist/exteriorChecklistBox/markingComponent.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){e.profileType=[{id:1,imageUrl:"/img/car_profile.png",description:"Left View",markings:[{xCoordinate:39,yCoordinate:39,description:"this is a marking",by:"boon hock",date:"07/06/2016 11:25am"},{xCoordinate:9,yCoordinate:19,description:"this is a second marking",by:"boon hock",date:"07/06/2016 11:25am"},{xCoordinate:9,yCoordinate:98,description:"this is a third marking",by:"boon hock",date:"07/06/2016 11:25am"}]},{id:2,imageUrl:"/img/car_profile.png",description:"RightView",markings:[{xCoordinate:39,yCoordinate:39,description:"this is a marking",by:"boon hock",date:"07/06/2016 11:25am"},{xCoordinate:9,yCoordinate:19,description:"this is a second marking",by:"boon hock",date:"07/06/2016 11:25am"},{xCoordinate:9,yCoordinate:98,description:"this is a third marking",by:"boon hock",date:"07/06/2016 11:25am"}]}]}}angular.module("main.module").component("exteriorimageComponent",{bindings:{},templateUrl:"app/components/checklist/exteriorChecklistBox/exteriorimageComponent.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(e,t,n,a){function i(){r.isLoading=!0,n.getVehicleTypes().then(function(e){r.isLoading=!1,r.vehicleTypes=n.convertVehicleType(e.data)})}var r=this;r.$onInit=function(){i(),r.status={available:!1,empty:!0}}}angular.module("main.module").component("vehicleType",{bindings:{},templateUrl:"app/components/checklist/vehicleType/vehicleType.html",controller:e,controllerAs:"vm"}),e.$inject=["$routeParams","$location","vehicleService","$filter"]}(),function(){"use strict";function e(e,t,n,a,i){function r(){var e=t.id;D.isLoading=!0,a.getVehicleById(e).then(function(e){D.isLoading=!1,D.vehicleTypeName=e.data.vehicleTypeName,D.vehicleChecklist=a.convertChecklistDetail(e.data.checkList)})}function o(){var n=t.id;D.addNewSubSectionData={vehicleTypeId:n,name:"",checkListItems:[]};var a={onAddSubSection:s};e.createPopup({templateUrl:"app/components/checklist/vehicleList/addNewSubSectionModal.html",size:"md",data:D.addNewSubSectionData},a)}function s(){D.isLoading=!0,a.createSubsection(D.addNewSubSectionData).then(function(e){D.vehicleChecklist=D.vehicleChecklist||[],D.vehicleChecklist.push(angular.copy(D.addNewSubSectionData)),r()})}function c(t){D.checklistCategory=angular.copy(t);var n={onDeleteCategory:u,onEditCategory:d};e.createPopup({templateUrl:"app/components/checklist/vehicleList/editSubsectionModal.html",size:"md",data:D.checklistCategory},n)}function u(){b(l,"Are you sure you want to delete this Subsection?")}function l(){D.isLoading=!0,a.deleteSubsection(D.checklistCategory).then(function(e){r()})}function d(){D.isLoading=!0,a.editSubsection(D.checklistCategory).then(function(e){r()})}function m(t){D.checklistCategory=angular.copy(t);var n=D.checklistCategory.id,a=D.checklistCategory.name;D.addNewItemData={sectionName:a,newItem:{MasterCheckListCategoryId:n,description:""}};var i={onAddNewItem:h};e.createPopup({templateUrl:"app/components/checklist/vehicleList/addNewItemModal.html",size:"md",data:D.addNewItemData},i)}function h(){D.isLoading=!0,a.addItem(D.addNewItemData.newItem).then(function(e){r()})}function g(t,n){D.checklistItem=angular.copy(t),D.checklistCategory=angular.copy(n);var a=D.checklistItem.id,i=D.checklistItem.description,r=D.checklistCategory.name;D.editItemData={editItem:{id:a,description:i,subsectionName:r}};var o={onDeleteItem:v,onEditItem:p};e.createPopup({templateUrl:"app/components/checklist/vehicleList/editItemModal.html",size:"md",data:D.editItemData.editItem},o)}function p(){D.isLoading=!0,a.editItem(D.editItemData.editItem).then(function(e){r()})}function v(){b(f,"Are you sure you want to delete this item?")}function f(){D.isLoading=!0,a.deleteItem(D.editItemData.editItem).then(function(e){r()})}function b(t,n){var a={onAction:t};e.createPopup({templateUrl:"app/components/common/warningModal/warningModal.html",size:"md",data:{title:"Warning",message:n}},a)}var D=this;!function(){r()}(),D.addNewSubSection=o,D.addNewItem=m,D.editItem=g,D.editCategory=c}angular.module("main.module").component("vehicleList",{templateUrl:"app/components/checklist/vehicleList/vehicleList.html",controller:e,controllerAs:"vm",bindings:{vehicleManagement:"<"}}),e.$inject=["modalService","$routeParams","$location","checklistService","vehicleService"]}(),function(){"use strict";function e(e,t){function n(){r.uploadStatus={isNotUpload:"isNotUpload",uploading:"uploading",uploaded:"uploaded"},r.status=r.uploadStatus.isNotUpload}function a(){e(function(){document.getElementById("documentUpload").click()})}function i(){for(var e=new FormData,n=0;n<r.documentFiles.length;n++)e.append("file",r.documentFiles[n]);e.append("jobId",r.data.jobId),r.numberOfDocument=r.documentFiles.length,t.uploadDocument(e).then(function(e){r.status=r.uploadStatus.uploaded,angular.element(document.getElementById("documentUpload")).val(null)})}var r=this;r.$onInit=n,r.uploadFiles=i,r.actionClick=a}angular.module("main.module").component("uploadDocument",{bindings:{data:"=",onCancel:"&"},templateUrl:"app/components/dashboard/uploadDocument/uploadDocument.html",controller:e,controllerAs:"vm"}),e.$inject=["$timeout","dashboardService"]}(),function(){"use strict";function e(){}angular.module("main.module").component("collectData",{bindings:{collected:"<"},templateUrl:"app/components/job/dataCollect/dataCollect.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(e){function t(){var e=angular.copy(a.logs);a.eventPageData=e.splice(a.currentPage*a.pageSize,a.pageSize)}function n(e){a.currentPage+=e,a.isLastPage=(a.currentPage+1)*a.pageSize>=a.logs.length,t()}var a=this;a.nextOrPrevious=n,function(){a.currentPage=0,a.pageSize=4,e(function(){t(),a.isLastPage=(a.currentPage+1)*a.pageSize>=a.logs.length})}()}angular.module("main.module").component("eventLog",{bindings:{logs:"="},templateUrl:"app/components/job/eventLog/eventLog.html",controller:e,controllerAs:"vm"}),e.$inject=["$timeout"]}(),function(){"use strict";function e(){}angular.module("main.module").component("handover",{bindings:{handover:"<",jobId:"<"},templateUrl:"app/components/job/handover/handover.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("main.module").component("replacement",{bindings:{jobDetail:"<"},templateUrl:"app/components/job/replacement/replacement.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(e){this.taskStatus=e}angular.module("main.module").component("taskAssign",{bindings:{tasks:"<"},templateUrl:"app/components/job/taskAssign/taskAssign.html",controller:e,controllerAs:"vm"}),e.$inject=["taskStatus"]}(),function(){"use strict";function e(e,t){function n(n){e.open(t.serviceUrl+"/"+n,"_blank")}this.openDocument=n}angular.module("main.module").component("uploadDoc",{bindings:{documents:"<"},templateUrl:"app/components/job/uploadDoc/uploadDoc.html",controller:e,controllerAs:"vm"}),
e.$inject=["$window","systemSetting"]}(),function(){"use strict";function e(){}angular.module("main.module").component("petrolLog",{bindings:{petrol:"<"},templateUrl:"app/components/job/petrolLog/petrolLog.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(e,t){function n(){e.createPopup({templateUrl:"app/components/job/viewImage/imageModal.html",size:"lg",data:{url:t.serviceUrl+"/"+a.url}},null)}var a=this;a.viewPhoto=n}angular.module("main.module").component("viewImage",{bindings:{url:"<",text:"@"},templateUrl:"app/components/job/viewImage/viewImage.html",controller:e,controllerAs:"vm"}),e.$inject=["modalService","systemSetting"]}(),function(){"use strict";function e(e,t){function n(){t.getVehicleTypes().then(function(e){r.vehicleTypes=t.convertVehicleType(e.data),r.vehicleTypes.unshift({id:"",name:"All"})})}function a(){r.isLoading=!0,t.getVehicleByCriteria(r.criteria).then(function(e){r.isLoading=!1,r.vehicles=e.data.vehicles,r.totalItems=e.data.totalItem})}function i(t){e.path("vehicles/"+t)}var r=this;r.getVehicleByCriteria=a,r.goToDetail=i,function(){r.criteria={search:"",type:"",currentPage:1,itemPerPage:5},n(),a()}()}angular.module("main.module").component("vehicleManagement",{bindings:{vehicleManagement:"<"},templateUrl:"app/components/vehicleManagement/vehicleManagement.html",controller:e,controllerAs:"vm"}),e.$inject=["$location","vehicleService"]}(),function(){"use strict";function e(e,t,n,a,i,r){function o(){c.listTaskStatus=i.getListFromObject(r),c.listTaskStatus.unshift({value:"",text:"All Tasks"})}function s(){c.isLoading=!0,n.getTaskByType(c.criteria).then(function(e){c.isLoading=!1,c.tasks=n.convertTasks(e.data.tasks),c.totalItems=e.data.totalItem})}var c=this;c.taskStatus=r,c.getTasksByCriteria=s,function(){c.criteria={search:"",status:"",fromDate:"",toDate:"",currentPage:1,itemPerPage:10},s(),o()}()}angular.module("main.module").component("taskManagement",{bindings:{taskManagement:"<"},templateUrl:"app/components/taskManagement/taskManagement.html",controller:e,controllerAs:"vm"}),e.$inject=["$routeParams","$location","taskService","$filter","utilityService","taskStatus"]}(),function(){"use strict";function e(e,t){var n=this;!function(){n.isOpen=!1,n.minDate&&e.$watch("vm.minDate",function(e){n.datepickerOptions={minDate:e}})}(),n.openCalendar=function(e){e.preventDefault(),e.stopPropagation(),n.isOpen=!0},n.dateChange=function(){t(function(){n.ngChange()})}}angular.module("main.module").component("customDatePicker",{bindings:{ngModel:"=",placeHolder:"@?",minDate:"=?",ngDisabled:"=?",isTouch:"=?",ngChange:"&?"},templateUrl:"app/components/common/datePicker/datePicker.html",controller:e,controllerAs:"vm"}),e.$inject=["$scope","$timeout"]}(),function(){"use strict";function e(e,t,n,a,i){function r(){g.currentIndex=0,g.updateChecklist=o,o()}function o(){g.isLoading=!0;var e;e=g.handoverId?t.getExteriorImageByHandoverId(g.handoverId):i.getVehicleExteriorChecklist(g.vehicleId,g.version),e.then(function(e){g.exteriorImages=e.data,l(),g.isLoading=!1})}function s(e,t){g.currentIndex=e,l()}function c(e,t){l(e),g.currentIndex=t,g.currentSelectedMarking=e}function u(){g.jobState=e.jobDetail}function l(e){a(function(){var t=document.getElementById("current-exterior"),n=document.getElementById("myCanvas");n.width=t.width,n.height=t.height;g.exteriorImages[g.currentIndex].id;g.drawMarkings=g.exteriorImages[g.currentIndex].markings,angular.forEach(g.drawMarkings,function(t){var a=!(!e||t.id!=e);d(n,{x:t.xPos,y:t.yPos},a)})},200)}function d(e,t,n){var a=e.getContext("2d");a.beginPath(),a.arc(t.x,t.y,12,0,2*Math.PI,!1),a.fillStyle=n?"#e6003c":"#4A90E2",a.lineWidth=2,a.fill(),a.strokeStyle="white",a.stroke()}function m(e){var t=h(g.drawMarkings,e.offsetX,e.offsetY);t&&c(t.id,g.currentIndex)}function h(e,t,n){for(var a=!1,i=0,r=e.length;i<r;i++){var o=e[i].xPos-12,s=e[i].xPos+12,c=e[i].yPos-12,u=e[i].yPos+12;s>=t&&o<=t&&u>=n&&c<=n&&(a=e[i])}return a}var g=this;g.serviceUrl=n.serviceUrl,g.$onInit=r,g.backToJob=u,g.selectExteriorImage=s,g.selectMarking=c,g.selectHighlightMarking=m}angular.module("main.module").component("exteriorChecklist",{bindings:{handoverId:"<?",vehicleId:"<?",version:"<?",updateChecklist:"=?"},templateUrl:"app/components/exteriorChecklist/exteriorChecklist.html",controller:e,controllerAs:"vm"}),e.$inject=["jobDetailState","handoverService","systemSetting","$timeout","vehicleService"]}(),function(){"use strict";function e(e){function t(){n.isLoading=!0,e.getVehicleItemChecklist(n.vehicleId).then(function(e){n.isLoading=!1,n.checkList=e.data})}var n=this;n.$onInit=t}angular.module("main.module").component("vehicleItemChecklist",{bindings:{vehicleId:"<"},templateUrl:"app/components/vehicleDetail/vehicleItemChecklist.html",controller:e,controllerAs:"vm"}),e.$inject=["vehicleService"]}(),function(){"use strict";function e(e){return{restrict:"A",link:function(t,n,a){var i=e(a.fileModel),r=i.assign,o=t.$eval(a.customOnChange);n.bind("change",function(){r(t,n[0].files),o()})}}}angular.module("main.module").directive("fileModel",e),e.$inject=["$parse"]}(),function(){"use strict";function e(e,t,n){function a(e){e.headers=e.headers||{};var n=t.get("tokenInfo");return n&&(e.headers.Authorization=n.token_type+" "+n.access_token),e}function i(a){return 401===a.status&&(t.remove("tokenInfo"),t.remove("userInfo"),n.path("/accessDeny")),e.reject(a)}return{request:a,responseError:i}}angular.module("main.module").factory("httpInterceptor",e),e.$inject=["$q","localStorageService","$location"]}(),function(){"use strict";function e(e){function t(t){return e("orderBy")(t,function(e){return e.startTime},!1,a)}function n(e){var t=e.split(":"),n={hour:parseInt(t[0])};return n.minute=t.length>1?parseInt(t[1]):0,n}function a(e,t){if(!Number.isInteger(e.value)&&!Number.isInteger(t.value)){var a=n(e.value),i=n(t.value);return a.hour>i.hour||a.hour==i.hour&&a.minute>i.minute}}function i(e){var t=[];for(var n in e)t.push({value:e[n].value,text:e[n].text});return t}function r(e,t){for(var n in t)if(e==t[n].value)return t[n].text;return"N/A"}return{sortByStartTime:t,getTimeObject:n,getListFromObject:i,getTextFromValue:r}}angular.module("main.module").factory("utilityService",e),e.$inject=["$filter"]}(),function(){"use strict";function e(e){function t(t,n,a){e.open({animation:!0,templateUrl:t.templateUrl,controller:"ModalInstanceController",controllerAs:"vm",size:t.size,backdrop:"static",resolve:{data:function(){return t.data},readOnly:function(){return t.readOnly}}}).result.then(function(e){n[e]()},a)}return{createPopup:t}}angular.module("main.module").factory("modalService",e),e.$inject=["$uibModal"]}(),function(){"use strict";function e(e,t){function n(e,t){var n=new Date,a=n.getHours(),i=n.getMinutes();return!(a<e||a>e+t||a===e+t&&i>0)}function a(e){var t=new Date;return e.setHours(0,0,0,0)==t.setHours(0,0,0,0)}function i(e,t,n,a){return b*s(e,t,n,a)/60}function r(e,t,n,a,i,r){var c=o(e,t,i,r);return s(n,a,i,r)*c}function o(e,t,n,a){return 100/s(e,t,n,a)}function s(e,t,n,a){var i=l(e.toString());return c(l(t),n,a)-c(i,n,a)}function c(e,t,n){var a=e.hour,i=e.minute;return a<t&&(a=t,i=0),(a>t+n||a===t+n&&i>0)&&(a=t+n,i=0),60*a+i}function u(t){return e("orderBy")(t,function(e){return e.startTime},!1,h)}function l(e){var t=e.split(":"),n={hour:parseInt(t[0])};return n.minute=t.length>1?parseInt(t[1]):0,n}function d(){var e=new Date;return e.getHours()+":"+e.getMinutes()}function m(){return e("date")(new Date,"h:mm a")}function h(e,t){if(!Number.isInteger(e.value)&&!Number.isInteger(t.value)){var n=l(e.value),a=l(t.value);return n.hour>a.hour||n.hour==a.hour&&n.minute>a.minute}}function g(e,t){var n=l(e),a=l(t);return n.hour>a.hour||n.hour==a.hour&&n.minute>a.minute}function p(e){return 0===e||24===e?"12 AM":12===e?e+" PM":e>12?e-12+" PM":e+" AM"}function v(t){var n=l(t),a=new Date;return a.setHours(n.hour,n.minute),e("date")(a,"h:mm a")}function f(e){var n=e.getHours(),a=n-3;return a<0&&(a=0),a>24-t.sizeHour&&(a=24-t.sizeHour),a}var b=12.5;return{sortByStartTime:u,getTimeObject:l,getCurrentTime:d,getPercentageFromDistance:i,getPercentageFromDistanceInRequest:r,isShowCurrentTime:n,getCurrentTimeText:m,checkIsToDay:a,compareTimeObject:g,timeToStringMaker:p,timeToStringFormatMaker:v,getTotalMinute:c,getStartTimeFromCurrentTime:f}}angular.module("main.module").factory("timeService",e),e.$inject=["$filter","calendarSetting"]}(),function(){"use strict";function e(e,t,n,a,i,r,o,s,c,u){function l(n,a){var i={date:t("date")(n,"yyyy-MM-dd")};return a.branchLocation&&(i.branchLocationId=a.branchLocation),a.driver&&(i.driverId=a.driver),e.get(oe+"/requests/driver",{params:i})}function d(n,a){var i={date:t("date")(n,"yyyy-MM-dd")};return a.search&&(i.search=a.search),(a.status||0==a.status)&&(i.status=a.status),e.get(oe+"/requests/dashboard",{params:i})}function m(n,a){var i={date:t("date")(n,"yyyy-MM-dd")};return a.search&&(i.search=a.search),(a.status||0===a.status)&&(i.status=a.status),e.get(oe+"/tasks",{params:i})}function h(t){return e.post(oe+"/requests/assign",t)}function g(t){return e.post(oe+"/requests/unassign",t)}function p(t){return e.post(oe+"/tasks",t)}function v(t){return e.put(oe+"/tasks/"+t.id,t)}function f(t){return e.post(oe+"/tasks/assign",t)}function b(t){return e.post(oe+"/tasks/unassign",t)}function D(t){return e.post(oe+"/jobs/setduration",t)}function k(n,a){var i={date:t("date")(n,"yyyy-MM-dd")};return a.branchLocation&&(i.branchLocationId=a.branchLocation),a.driver&&(i.driverId=a.driver),e.get(oe+"/branchlocations/drivers",{params:i})}function y(t){return e.post(oe+"/jobs/upload-document-signing",t,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}function T(){return e.get(oe+"/branchlocations")}function S(t){var n=oe+"/branchlocations/drivers";return n=t?n+"/?branchLocationId="+t:n,e.get(n)}function j(e,t,i){var r=n.getPercentageFromDistance(e.startTime,e.endTime,t,i);e.style={width:r+"%",left:n.getPercentageFromDistance(t,e.startTime,t,i)+a.percentagePerJob+"%"},e.isDisplay=0!==r}function C(e,t,n){if(!e.amAvailability&&!e.pmAvailability)return void(e.status=s.available);var a;e.amAvailability&&(a=o.AM),e.pmAvailability&&(a=o.PM),e.amAvailability&&e.pmAvailability&&(a=o.Both),(e.amAvailability||e.pmAvailability)&&(I(e)?e.status=s.onLeaveButHaveJob:e.status=s.onLeave);var i=L(a,t,n);e.style=i.style,e.isDisplay=i.isDisplay,e.leaveText=a.text,e.timeObject=a}function I(e){return e&&e.requests&&e.requests.length>0&&e.requests[0].jobs&&e.requests[0].jobs.length>0}function L(e,t,i){var r=n.getPercentageFromDistance(e.startTime,e.endTime,t,i);return{style:{width:r+"%",left:n.getPercentageFromDistance(t,e.startTime,t,i)+a.percentagePerJob+"%"},isDisplay:0!==r}}function x(e,t,a,i){j(t,a,i),t.isDisplay&&(n.sortByStartTime(t.jobs),angular.forEach(t.jobs,function(n){$(e,t,n,a,i)}))}function $(e,t,a,i,r){var o=n.getPercentageFromDistanceInRequest(t.startTime,t.endTime,a.startTime,a.endTime,i,r),s=n.getPercentageFromDistanceInRequest(t.startTime,t.endTime,t.startTime,a.startTime,i,r);a.style={width:o+"%",left:s+"%"},a.isDisplay=0!==o,a.startTime==t.startTime&&(a.style["border-bottom-left-radius"]="4px",a.style["border-top-left-radius"]="4px",a.type=t.type),a.endTime==t.endTime?(a.style["border-bottom-right-radius"]="4px",a.style["border-top-right-radius"]="4px"):a.style["border-right"]="1px solid rgba(255, 255, 255, .5)",e.timeObject&&n.compareTimeObject(a.startTime,e.timeObject.startTime)&&!n.compareTimeObject(a.startTime,e.timeObject.endTime)?a.isOnLeave=!0:a.isOnLeave=!1,1==t.jobs.length&&(a.type=t.type)}function w(e,t,a){var r=n.getCurrentTime(),o=n.isShowCurrentTime(t,a),s=!1;angular.forEach(e.jobs,function(e){e.isInFuture=s,o&&e.status===i.inProgress.value&&n.compareTimeObject(r,e.startTime)&&n.compareTimeObject(e.endTime,r)&&(s=!0)})}function A(e,t,i){var r=n.isShowCurrentTime(e,t),o=n.checkIsToDay(i);if(r&&o){return{left:n.getPercentageFromDistance(e,n.getCurrentTime(),e,t)+a.percentagePerJob+"%"}}return null}function M(e){var t=!1;angular.forEach(e.jobs,function(n){e.status=n.status,n.status===i.inProgress.value&&(t=!0)}),t&&(e.status=i.inProgress.value)}function P(e){var t=!0;return angular.forEach(e.jobs,function(e){e.status>=i.inProgress.value&&(t=!1)}),t}function E(e,n){if(e.canDrag=!0,e.startTime){var a=60*n.hour+n.minute,i=a-F(e.startTime);e.startTime=V(e.startTime,i),e.endTime=V(e.endTime,i),angular.forEach(e.jobs,function(e){e.startTime=V(e.startTime,i),e.endTime=V(e.endTime,i)})}else U(e)?angular.forEach(e.jobs,function(e){e.startTime=t("date")(new Date(e.expectedStartDate),"H:mm"),e.endTime=t("date")(new Date(e.expectedEndDate),"H:mm"),e.scheduledStartDate=e.expectedStartDate,e.scheduledEndDate=e.expectedEndDate}):angular.forEach(e.jobs,function(e){e.startTime=O(n),n.hour+=1,e.endTime=O(n)}),e.startTime=e.jobs[0].startTime,e.endTime=e.jobs[e.jobs.length-1].endTime}function U(e){if(!e.jobs||!e.jobs.length)return!1;var t=!0;return angular.forEach(e.jobs,function(e){e.expectedStartDate&&e.expectedEndDate||(t=!1)}),t}function q(e,t,n){var a=angular.copy(e),i=[];return angular.forEach(a.jobs,function(e){i.push(R(e,n))}),{driverId:t,request:R(a,n),jobs:i}}function B(e){var t={requestId:e.id},n=[];return angular.forEach(e.jobs,function(e){var t={id:e.id},a=[];angular.forEach(e.tasks,function(e){a.push(e.id)}),t.tasks=a,n.push(t)}),t.jobs=n,t}function H(e,t,a){n.sortByStartTime(e.jobs);var i=F(t.startTime),r=F(t.endTime),o=60*a-(r-i),s=!1;angular.forEach(e.jobs,function(e){s&&(e.startTime=V(e.startTime,o),e.endTime=V(e.endTime,o)),e.id===t.id&&(e.endTime=V(e.endTime,o),s=!0)}),e.endTime=e.jobs[e.jobs.length-1].endTime}function N(e,t,n){var a=angular.copy(e);H(a,t,n);var i=[];return angular.forEach(a.jobs,function(e){i.push(R(e))}),{request:R(a),jobs:i}}function R(e,t){var a=n.getTimeObject(e.startTime),i=n.getTimeObject(e.endTime),r=e.scheduledStartDate?new Date(e.scheduledStartDate):t?angular.copy(t):new Date;r.setHours(a.hour,a.minute,0,0);var o=e.scheduledStartDate?new Date(e.scheduledStartDate):t?angular.copy(t):new Date;return o.setHours(i.hour,i.minute,0,0),{id:e.originalId||e.id,jobType:e.jobType,scheduledStartDate:r,scheduledEndDate:o}}function O(e){return e.hour+":"+e.minute}function F(e){var t=n.getTimeObject(e);return 60*t.hour+t.minute}function V(e,t){var n=F(e)+t,a={minute:n%60};return a.hour=(n-a.minute)/60,O(a)}function J(e){var n=[];return angular.forEach(e,function(e){M(e);var a=U(e);n.push({id:Z(e),originalId:e.id,expectedStartTime:a?new Date(e.jobs[0].expectedStartDate):null,expectedStartTimeString:a?t("date")(new Date(e.jobs[0].expectedStartDate),"H:mm a"):null,isHaveExpectedStartTime:a,type:e.type,referenceId:e.referenceId,jobs:Y(e.jobs),jobSheets:e.jobSheets,driver:z(e),status:e.status})}),n}function z(e){if(!e.jobs||!e.jobs.length)return"";if(e.jobs[0].jobType==c.miceJobsheet){var t=e.jobs[0].driver;return t?t.fullName:""}return e.driver?e.driver.fullName:""}function _(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,name:e.fullName,contact:e.contact,alternateContact:e.alternateContact,branchLocation:e.branchLocation,amAvailability:e.amAvailability,pmAvailability:e.pmAvailability,requests:te(e.requests)})}),t}function W(e,n){return{id:e.id,status:e.status,jobType:e.jobType,pickupAddress:e.pickupAddress,deliveryAddress:e.deliveryAddress,vehiclePlateNumber:e.vehiclePlateNumber,clientName:e.clientName,clientContact:e.clientContact,startTime:n&&e.actualStartDate?t("date")(new Date(e.actualStartDate),"H:mm"):t("date")(new Date(e.scheduledStartDate),"H:mm"),endTime:n&&e.actualEndDate?t("date")(new Date(e.actualEndDate),"H:mm"):t("date")(new Date(e.scheduledEndDate),"H:mm"),tasks:re(e.tasks),scheduledStartDate:e.scheduledStartDate,scheduledEndDate:e.scheduledEndDate,expectedStartDate:e.expectedStartDate,expectedEndDate:e.expectedEndDate,actualStartDate:e.actualStartDate?new Date(e.actualStartDate):null,actualEndDate:e.actualEndDate?new Date(e.actualEndDate):null}}function K(e){return{id:e.id,type:e.type,status:e.status,pickupAddress:e.pickupAddress,deliveryAddress:e.deliveryAddress,vehiclePlateNumber:e.vehiclePlateNumber,clientName:e.clientName,clientContact:e.clientContact,startTime:t("date")(new Date(e.startDate),"H:mm a"),endTime:t("date")(new Date(e.endDate),"H:mm a"),tasks:e.tasks,driverName:e.driver?e.driver.fullName:"N/A",actualStartDate:e.actualStartDate?new Date(e.actualStartDate):null,actualEndDate:e.actualEndDate?new Date(e.actualEndDate):null}}function Y(e,t){var n=[];return angular.forEach(e,function(e){n.push(W(e,t))}),n}function X(e){M(e);var t=e.status==i.completed.value,n={id:Z(e),originalId:e.id,type:e.type,jobs:Y(e.jobs,t),scheduledStartDate:e.scheduledStartDate,scheduledEndDate:e.scheduledEndDate,canDrag:P(e)};return G(n),ee(n),Q(n,t),n}function G(e){e.startTime=t("date")(new Date(e.jobs[0].scheduledStartDate),"H:mm"),e.endTime=t("date")(new Date(e.jobs[e.jobs.length-1].scheduledEndDate),"H:mm")}function Q(e,n){if(n){var a=e.jobs[0].actualStartDate?e.jobs[0].actualStartDate:new Date(e.jobs[0].scheduledStartDate),i=e.jobs[e.jobs.length-1],r=i.actualEndDate?i.actualEndDate:new Date(i.scheduledEndDate);e.startTime=t("date")(a,"H:mm"),e.endTime=t("date")(r,"H:mm")}}function Z(e){return e.jobs&&e.jobs.length>0&&e.jobs[0].jobType==c.miceJobsheet?e.id+e.jobs[0].id:e.id}function ee(e){e.jobs[0].jobType==c.miceJobsheet&&(e.startTime=t("date")(new Date(e.jobs[0].scheduledStartDate),"H:mm"),e.endTime=t("date")(new Date(e.jobs[0].scheduledEndDate),"H:mm"))}function te(e){var t=[];return angular.forEach(e,function(e){t.push(X(e))}),t}function ne(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id.toString(),name:e.fullName,position:[e.locationDetail.lat,e.locationDetail.lon],time:ae(e.locationDetail.date),jobId:e.locationDetail.jobId})}),t}function ae(e){var t=ie(new Date(e)),n=ie(new Date),a=n-t;if(a/60>0){var i=Math.round(a/60);return i>1?i+" hours ago":i+"hour ago"}return a>1?a+" minutes ago":a+"minute ago"}function ie(e){return 60*e.getHours()+e.getMinutes()}function re(e){return angular.forEach(e,function(e){e.scheduledDate&&e.actualDate&&(e.description+="<br/>"+u.getTimeCompleted(e))}),e}var oe=r.serviceUrl+"/api";return{getDriverTimeLineByCriteria:l,getRequestByCriteria:d,getTaskByCriteria:m,assignRequest:h,unassignRequest:g,createTask:p,updateTask:v,assignTask:f,unAssignTask:b,uploadDocument:y,saveTimeDuration:D,getDriverLocationByCriteria:k,populateStyleForDriver:C,getAllBranchLocation:T,getDriverByBranchLocation:S,populateStyleForRequest:x,checkJobInCurrentTime:w,initStyleForCurrentTime:A,getRequestStatusFromJob:M,getAssignRequestData:q,getUnassignRequestData:B,populateTimeForRequestAfterDrop:E,setDuration:H,getDurationData:N,convertJob:W,convertJobOnMap:K,convertListRequestSearch:J,convertListDriverTimeLine:_,convertListDriverLocation:ne}}angular.module("main.module").factory("dashboardService",e),e.$inject=["$http","$filter","timeService","calendarSetting","jobStatus","systemSetting","driverUnAvailable","driverStatus","jobType","jobService"]}(),function(){"use strict";function e(e,t,n,a){function i(){return!!c()}function r(e){var t=c();return!!(t&&e.indexOf(t.role)>-1)}function o(a,i){var r=t.defer(),o={username:a,password:i};return e.post(u+"/token",o).then(function(e){var t={access_token:e.data.accessToken,token_type:e.data.tokenType},a={id:e.data.id,email:e.data.email,role:e.data.role};n.set("tokenInfo",t),n.set("userInfo",a),r.resolve(a)},function(e){r.reject(e)}),r.promise}function s(){n.remove("tokenInfo"),n.remove("userInfo")}function c(){return n.get("userInfo")}var u=a.serviceUrl+"/api/account";return{isAuthenticated:i,isAuthorized:r,login:o,logout:s,getCurrentUser:c}}angular.module("main.module").factory("authService",e),e.$inject=["$http","$q","localStorageService","systemSetting"]}(),function(){"use strict";function e(e,t,n,a,i,r){function o(t){return e.get(f+"/jobs/"+t)}function s(e){return{id:e.id,additionalRemarks:e.additionalRemarks,clientContact:e.clientContact,clientName:e.clientName,deliveryAddress:e.deliveryAddress,documents:e.documents,driver:e.driver,driverContact:e.driverContact,handovers:h(e.handover),pickupAddress:e.pickupAddress,tasks:u(e.tasks),requestType:e.requestType,uniqueVehicleNumber:e.uniqueVehicleNumber,expectedStartDate:e.expectedStartDate?r("date")(new Date(e.expectedStartDate),"h:mm a"):null,expectedEndDate:e.expectedEndDate?r("date")(new Date(e.expectedEndDate),"h:mm a"):null,vehicleType:e.vehicleType,vehicleId:e.vehicleId,requestNo:e.requestNo,jobIndex:e.jobIds.indexOf(e.id),status:e.status,otherJob:p(e.id,e.jobIds),statusText:a.getTextFromValue(e.status,t),eventLogs:e.eventLogs,jobIds:e.jobIds,petrolLog:c(e),dataCollected:{startedAt:e.actualStartDate,totalDistance:v(e.handover),totalTimeTaken:l(e.scheduledStartDate,e.actualEndDate)}}}function c(e){if(!e.tasks||!e.tasks.length)return null;var t=e.tasks.filter(function(e){return e.petrolLogId});return t&&t[0]?t[0].petrolLog?t[0].petrolLog:t[0].petrolLogId:null}function u(e){var t=[];return angular.forEach(e,function(e){e.petrolLogId||t.push({description:e.description,statusText:a.getTextFromValue(e.status,i),status:e.status,startTime:e.scheduledDate?r("date")(new Date(e.scheduledDate),"h:mm a"):"N/A",endTime:e.actualDate?r("date")(new Date(e.actualDate),"h:mm a"):"N/A",totalTime:l(e.scheduledDate,e.actualDate)})}),t}function l(e,t){if(!t||!e)return"";var n=(new Date(t).getTime()-new Date(e).getTime())/6e4,a=Math.floor(n/60),i=Math.floor(n%60);return(a>1?a+"hrs":a+"hr")+" "+(i>1?i+"mins":i+"min")}function d(e){return r("date")(new Date(e.scheduledDate),"h:mm a")+" - "+r("date")(new Date(e.actualDate),"h:mm a")+" "+l(e.scheduledDate,e.actualDate)}function m(e,t){var n;return angular.forEach(e.handovers,function(e){e.id==t&&(n=e)}),n}function h(e){return angular.forEach(e,function(e){e.totalCheckListChange=g(e),e.totalMarking=e.markings.length}),e}function g(e){var t=0;return angular.forEach(e.checkList,function(e){angular.forEach(e.checklistItems,function(e){e.isChanged&&(t+=1)})}),t}function p(e,t){if(t.length<=1)return null;var n=t.indexOf(e);return n+1===t.length?{index:n,id:t[n-1]}:{index:n+2,id:t[n+1]}}function v(e){if(!e||e.length<1)return null;var t=e[0].mileage,n=e[e.length-1].mileage;return t&&n?Math.abs(n-t):null}var f=n.serviceUrl+"/api";return{getJobById:o,convertJobDetail:s,getPetrolLog:c,getTimeCompleted:d,getHandoverById:m}}angular.module("main.module").factory("jobService",e),e.$inject=["$http","jobStatus","systemSetting","utilityService","taskStatus","$filter"]}(),function(){"use strict";function e(e,t){function n(t){return e.get(o+"/handover/"+t)}function a(t){return e.get(o+"/exteriorchecklist/handover/"+t)}function i(e,t){var n=[];return angular.forEach(e,function(e){var a=r(e.id,t);if(a.length>0){var i=angular.copy(e);i.markings=a,n.push(i)}}),n}function r(e,t){var n=[];return angular.forEach(t,function(t){t.exteriorImageId==e&&n.push(t)}),n}var o=t.serviceUrl+"/api";return{getHandoverById:n,getExteriorImageByHandoverId:a,convertMarking:i,getMarkingByExteriorImageId:r}}angular.module("main.module").factory("handoverService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n,a){function i(t){return e.get(h+"/checklist?vehicleTypeId="+t)}function r(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,name:e.name,checklistItems:o(e.checklistItems)})}),t}function o(e){var t=[];return angular.forEach(e,function(e){t.push({description:e.description,id:e.id})}),t}function s(t){return e.post(h+"/checklistcategory",t)}function c(t){return e.delete(h+"/checklistcategory/"+t.id,t)}function u(t){return e.put(h+"/checklistcategory/"+t.id,t)}function l(t){return e.post(h+"/checklistitem",t)}function d(t){return e.put(h+"/checklistitem/"+t.id,t)}function m(t){return e.delete(h+"/checklistitem/"+t.id,t)}var h=t.serviceUrl+"/api";return{getVehicleById:i,convertChecklistDetail:r,createSubsection:s,deleteSubsection:c,editSubsection:u,addItem:l,editItem:d,deleteItem:m}}angular.module("main.module").factory("checklistService",e),e.$inject=["$http","systemSetting","utilityService","taskStatus","$filter"]}(),function(){"use strict";function e(e,t){function n(){return e.get(u+"/vehicles/types")}function a(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,name:e.name})}),t}function i(t){var n={};return t.search&&(n.search=t.search),(t.type||0===t.type)&&(n.type=t.type),t.currentPage&&t.itemPerPage&&(n.offset=(t.currentPage-1)*t.itemPerPage,n.limit=t.itemPerPage),e.get(u+"/vehicles",{params:n})}function r(t){return e.get(u+"/vehicles/"+t)}function o(t){return e.get(u+"/checklist?vehicleId="+t)}function s(t){return e.get(u+"/vehicles/versions/"+t)}function c(t,n){var a=u+"/exteriorchecklist/vehicle/"+t;return n&&(a+="?vehicleVersionId="+n),e.get(a)}var u=t.serviceUrl+"/api";return{getVehicleTypes:n,convertVehicleType:a,getVehicleByCriteria:i,getVehicleById:r,getVehicleItemChecklist:o,getVehicleVersion:s,getVehicleExteriorChecklist:c}}angular.module("main.module").factory("vehicleService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n,a,i){function r(e){var t=[];return angular.forEach(e,function(e){t.push({description:e.description,jobId:e.jobId,driver:e.driver,date:new Date(e.date),status:e.status,statusText:n.getTextFromValue(e.status,a)})}),t}function o(t){var n={};return t.fromDate&&(n.fromDate=i("date")(t.fromDate,"yyyy-MM-dd")),t.toDate&&(n.toDate=i("date")(t.toDate,"yyyy-MM-dd")),(t.status||0==t.status)&&(n.status=t.status),t.search&&(n.search=t.search),(t.type||0===t.type)&&(n.type=t.type),t.currentPage&&t.itemPerPage&&(n.offset=(t.currentPage-1)*t.itemPerPage,n.limit=t.itemPerPage),e.get(s+"/tasks",{params:n})}var s=t.serviceUrl+"/api";return{getTaskByType:o,convertTasks:r}}angular.module("main.module").factory("taskService",e),e.$inject=["$http","systemSetting","utilityService","taskStatus","$filter"]}();