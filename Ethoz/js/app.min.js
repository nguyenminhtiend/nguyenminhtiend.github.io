!function(){"use strict";function e(e,t){t.isLocal||e.debugInfoEnabled(!1)}function t(e){e.interceptors.push("httpInterceptor")}function n(e,t){t.hashPrefix(""),e.when("/",{redirectTo:"/login"}).otherwise({redirectTo:"/"})}function a(e,t,n,a){var i=a.getCurrentUser();i?e.currentUser=i:n.path("/login"),e.$on("$locationChangeStart",function(e,i,o){var r=n.path(),s=t.routes[r];if(s&&s.authorize)return a.isAuthenticated()?void(a.isAuthorized(s.authorize)||n.path("/login")):void n.path("/login")}),e.$on("$routeChangeSuccess",function(){t.current&&(e.currentPage=t.current.page,e.loginPage=t.current.loginPage),t.current.title?document.title="Ethoz - "+t.current.title:document.title="Ethoz"})}angular.module("main.module",["ngRoute","ui.bootstrap","ngMap","ngDraggable","ngSanitize","LocalStorageModule","ui.bootstrap.contextMenu","duScroll","ui.bootstrap.datetimepicker","toastr","constants.module","dashboard.module","vehicleManagement.module","jobDetail.module","user.module","taskManagement.module","vehicleDetail.module"]).config(e).config(t).config(n).run(a),e.$inject=["$compileProvider","systemSetting"],t.$inject=["$httpProvider"],n.$inject=["$routeProvider","$locationProvider"],a.$inject=["$rootScope","$route","$location","authService"]}(),function(){"use strict";angular.module("constants.module",[]).constant("systemSetting",{serviceUrl:window.env.apiUrl,isLocal:["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.hostname)>-1}).constant("systemPage",{login:"login",dashboard:"dashboard"}).constant("systemRole",{SuperAdmin:"SuperAdmin",Controller:"Controller"}).constant("calendarSetting",{startTime:9,sizeHour:8,percentagePerJob:10}).constant("jobType",{regular:0,miceJobsheet:1}).constant("jobStatus",{unassigned:{value:1,text:"Unassigned"},assigned:{value:2,text:"Assigned"},inProgress:{value:3,text:"In Progress"},completed:{value:4,text:"Completed"},cancelled:{value:5,text:"Cancelled"}}).constant("taskStatus",{unassigned:{value:0,text:"Unassigned"},assigned:{value:1,text:"Assigned"},completed:{value:2,text:"Completed"},cancelled:{value:3,text:"Cancelled"}}).constant("handoverStatus",{itemChecklist:0,exteriorChecklist:1,handoverForm:2,confirmation:3,completed:4}).constant("driverStatus",{available:"available",onLeave:"onLeave",onLeaveButHaveJob:"onLeaveButHaveJob"}).constant("driverUnAvailable",{AM:{startTime:"8:30",endTime:"13:30",text:"On Leave - Half Day"},PM:{startTime:"12:30",endTime:"18",text:"On Leave - Half Day"},Both:{startTime:"8:30",endTime:"18",text:"On Leave - Whole Day"}}).constant("jobDetailState",{jobDetail:"jobDetail",itemChecklist:"itemChecklist",exteriorChecklist:"exteriorChecklist"})}(),function(){"use strict";function e(e,t){e.when("/dashboard",{title:"Dashboard",controller:"DashboardController",templateUrl:"app/views/dashboard/dashboard.html",controllerAs:"vm",authorize:[t.SuperAdmin,t.Controller]})}function t(e,t,n,a,i){function o(){r(),s(),p(),v(),f.reloadRequestTab={},f.reloadTaskTab={},f.reloadDriverInMap={},f.reloadTime={}}function r(){f.currentDate=e.currentDate||new Date,e.currentDate=null,f.timeSetting={startTime:i.getStartTimeFromCurrentTime(f.currentDate),sizeHour:n.sizeHour},f.calendarViewMode=!0,f.criteria={driver:"",branchLocation:""},f.numberOfRecord={request:null,task:null}}function s(){f.isLoading=!0,a.getDriverTimeLineByCriteria(f.currentDate,f.criteria).then(function(e){f.isLoading=!1,f.drivers=a.convertListDriverTimeLine(e.data),g()})}function c(){g(),h()}function l(){f.calendarViewMode?(u(),s(),f.reloadRequestTab(),f.reloadTaskTab()):f.reloadDriverInMap()}function u(){i.checkIsToDay(f.currentDate)?f.timeSetting.startTime=i.getStartTimeFromCurrentTime(f.currentDate):f.timeSetting.startTime=9,"function"==typeof f.reloadTime&&f.reloadTime()}function d(){f.calendarViewMode?(s(),f.reloadRequestTab(),f.reloadTaskTab()):"function"==typeof f.reloadDriverInMap&&f.reloadDriverInMap()}function m(e,t,n){n||f.reloadRequestTab(),angular.forEach(f.drivers,function(t){if(t.requests&&t.requests.length)for(var n=0;n<t.requests.length;n++)t.requests[n].id===e.id&&t.requests.splice(n,1)}),angular.forEach(f.drivers,function(n){n.id===t&&(n.requests=n.requests||[],n.requests.push(e))}),g()}function g(){f.currentTimeStyleDisplay=a.initStyleForCurrentTime(f.timeSetting.startTime,f.timeSetting.sizeHour,f.currentDate),angular.forEach(f.drivers,function(e){e.currentTimeStyles=f.currentTimeStyleDisplay,a.populateStyleForDriver(e,f.timeSetting.startTime,f.timeSetting.sizeHour),angular.forEach(e.requests,function(t){a.getRequestStatusFromJob(t),a.populateStyleForRequest(e,t,f.timeSetting.startTime,f.timeSetting.sizeHour),i.checkIsToDay(f.currentDate)&&a.checkJobInCurrentTime(t,f.timeSetting.startTime,f.timeSetting.sizeHour)})})}function h(){e.$broadcast("reInitDragTime",null)}function p(){f.maxHeight={"max-height":t.innerHeight-88+"px"}}function v(){f.maxHeightTimeLine={"max-height":t.innerHeight-240+"px",height:t.innerHeight-240+"px","overflow-y":"scroll"}}var f=this;f.reAssignDriver=m,f.reRenderCalendar=c,f.getDriverByCriteria=s,f.currentDateChange=l,f.reloadWhenCriteriaChange=d,f.refreshData=l,o()}angular.module("dashboard.module",["ngRoute"]).config(e).controller("DashboardController",t),e.$inject=["$routeProvider","systemRole"],t.$inject=["$rootScope","$window","calendarSetting","dashboardService","timeService"]}(),function(){"use strict";function e(e){e.when("/itemChecklist",{title:"itemChecklist",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleItemChecklist.html",controllerAs:"vm"}).when("/exteriorChecklist",{title:"exteriorChecklist",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleItemChecklist.html",controllerAs:"vm"}).when("/vehicleType",{title:"vehicleType",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleType.html",controllerAs:"vm"}).when("/vehicleList/:id",{title:"vehicleList",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleList.html",controllerAs:"vm"}).when("/test",{title:"vehicleList",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/test.html",controllerAs:"vm"}).when("/vehicleManagement",{title:"vehicleManagement",controller:"vehicleManagementController",templateUrl:"app/views/vehicleManagement/vehicleManagement.html",controllerAs:"vm"})}function t(e,t,n,a){var i=this;i.requestNo="38183",i.date=new Date,n.go=function(e){a.path("/"+e),console.log(i.currentList)},n.showItemChecklist="/itemChecklist"===a.path(),n.showExteriorChecklist="/exteriorChecklist"===a.path(),i.ngChange=function(){alert(i.date)}}angular.module("vehicleManagement.module",["ngRoute"]).config(e).controller("vehicleManagementController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","timeService","$scope","$location"]}(),function(){"use strict";function e(e){e.when("/jobs/:id",{title:"Job Detail",controller:"JobDetailController",templateUrl:"app/views/jobDetail/jobDetail.html",controllerAs:"vm"}).when("/jobs/:jobId/handovers/:handoverId/itemChecklist",{title:"Job Detail - Item CheckList",controller:"JobDetailCheckListController",templateUrl:"app/views/jobDetail/itemCheckList.html",controllerAs:"vm"}).when("/jobs/:jobId/handovers/:handoverId/exteriorChecklist",{title:"Job Detail - Exterior CheckList",controller:"JobDetailCheckListController",templateUrl:"app/views/jobDetail/exteriorChecklist.html",controllerAs:"vm"})}function t(e,t,n,a,i){function o(){l.currentHandover={},r()}function r(){l.jobId=e.id,l.isLoading=!0,n.getJobById(l.jobId).then(function(e){l.job=n.convertJobDetail(e.data),l.isLoading=!1})}function s(){l.isLoading=!0,n.resyncJob(l.jobId).then(function(e){r()},function(e){i.warning("Not found job"),l.isLoading=!1})}function c(){var e=l.job.jobIds[l.job.jobIndex+1];t.path("/jobs/"+e)}var l=this;l.jobStatus=a,l.nextJob=c,l.resyncJob=s,o()}function n(e,t){function n(){a()}function a(){i.jobId=e.jobId,i.handoverId=e.handoverId,i.isLoading=!0,t.getJobById(i.jobId).then(function(e){i.job=t.convertJobDetail(e.data),i.handover=t.getHandoverById(i.job,i.handoverId),i.isLoading=!1})}var i=this;n()}angular.module("jobDetail.module",["ngRoute"]).config(e).controller("JobDetailController",t).controller("JobDetailCheckListController",n),e.$inject=["$routeProvider"],t.$inject=["$routeParams","$location","jobService","jobStatus","toastr"],n.$inject=["$routeParams","jobService"]}(),function(){"use strict";function e(e,t){var n=this;n.data=t,n.ok=function(t){e.close(t)},n.cancel=function(){e.dismiss("cancel")}}angular.module("main.module").controller("ModalInstanceController",e),e.$inject=["$uibModalInstance","data"]}(),function(){"use strict";function e(e,t){e.when("/login",{title:"Login",controller:"UserController",templateUrl:"app/views/user/login.html",controllerAs:"vm",page:t.login,loginPage:!0})}function t(e,t,n){function a(){i.isLoading=!0,t.login(i.userName,i.password).then(function(a){n.currentUser=t.getCurrentUser(),i.isLoading=!1,e.path("/dashboard")},function(e){i.isLoading=!1,i.errorMessage=e.data.message})}var i=this;i.login=a,i.userName="superadmin",i.password="Admin@123456"}angular.module("user.module",["ngRoute"]).config(e).controller("UserController",t),e.$inject=["$routeProvider","systemPage"],t.$inject=["$location","authService","$rootScope"]}(),function(){"use strict";function e(e){e.when("/taskManagement",{title:"taskManagement",controller:"taskManagementController",templateUrl:"app/views/taskManagement/taskManagement.html",controllerAs:"vm"})}function t(e,t,n,a){var i=this;n.go=function(e){a.path("/"+e),console.log(i.currentList)},n.showItemChecklist="/itemChecklist"===a.path(),n.showExteriorChecklist="/exteriorChecklist"===a.path()}angular.module("taskManagement.module",["ngRoute"]).config(e).controller("taskManagementController",t),e.$inject=["$routeProvider"],t.$inject=["$rootScope","timeService","$scope","$location"]}(),function(){"use strict";function e(e){e.when("/vehicles/:id",{title:"Vehicle Detail",controller:"VehicleDetailController",templateUrl:"app/views/vehicleDetail/vehicleDetail.html",controllerAs:"vm"})}function t(e,t,n){function a(){c.vehicleId=e.id,c.viewMode={itemChecklist:"itemChecklist",exteriorChecklist:"exteriorChecklist"},c.checklists=[{text:"Item Checklist",value:c.viewMode.itemChecklist},{text:"Exterior Checklist",value:c.viewMode.exteriorChecklist}],c.currentViewMode=c.viewMode.itemChecklist,c.updateChecklist={},i()}function i(){t.getVehicleById(c.vehicleId).then(function(e){c.vehicle=e.data})}function o(){c.currentViewMode==c.viewMode.exteriorChecklist&&r()}function r(){t.getVehicleVersion(c.vehicleId).then(function(e){c.versions=e.data,c.versions&&c.versions.length&&(c.versions[0].version="Current version",c.currentVersion=c.versions[0].id)})}function s(){n(function(){c.updateChecklist()})}var c=this;c.viewModeChange=o,c.versionChange=s,a()}angular.module("vehicleDetail.module",["ngRoute"]).config(e).controller("VehicleDetailController",t),e.$inject=["$routeProvider"],t.$inject=["$routeParams","vehicleService","$timeout"]}(),function(){"use strict";function e(e,t,n){function a(){t.logout(),n.path("/login")}var i=this;i.systemPage=e,i.logout=a}angular.module("main.module").component("headerPage",{bindings:{},templateUrl:"app/components/headerPage/headerPage.html",controller:e,controllerAs:"vm"}),e.$inject=["systemPage","authService","$location"]}(),function(){"use strict";function e(e){var t=this;t.systemPage=e}angular.module("main.module").component("footerPage",{bindings:{},templateUrl:"app/components/footerPage/footerPage.html",controller:e,controllerAs:"vm"}),e.$inject=["systemPage"]}(),function(){"use strict";function e(e){function t(){a(),n(),s.reloadTime=a}function n(){var e=angular.element(document.getElementById("control-time-container")),t=e.prop("offsetWidth"),n=r();e.css("width",t-n+"px")}function a(){s.ranges=[],s.textHours=[];for(var t=0;t<s.timeSetting.sizeHour;t++)s.ranges.push(t+s.timeSetting.startTime),s.textHours.push(e.timeToStringMaker(t+s.timeSetting.startTime));s.textHours.push(e.timeToStringMaker(s.timeSetting.startTime+s.timeSetting.sizeHour)),s.timeText=e.getCurrentTimeText()}function i(){s.timeSetting.startTime+=1,a(),s.timeChange()}function o(){s.timeSetting.startTime-=1,a(),s.timeChange()}function r(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var a=n.offsetWidth;return e.parentNode.removeChild(e),t-a}var s=this;s.next=i,s.back=o,s.$onInit=t}angular.module("main.module").component("timeControl",{bindings:{timeSetting:"=",timeChange:"&",currentDate:"<",currentTimeStyleDisplay:"<",reloadTime:"="},templateUrl:"app/components/dashboard/timeControl/timeControl.html",controller:e,controllerAs:"vm"}),e.$inject=["timeService"]}(),function(){"use strict";function e(e,t,n,a,i,o){function r(){m(),p()}function s(e,t,n,i){if(e)return e.startTime?void c(e,n,i):void(e.isHaveExpectedStartTime?d(e.expectedStartTime,n)?c(e,n,i):a.warning("This request should be assigned at "+e.expectedStartTimeString):c(e,n,i))}function c(e,n,a){var i=angular.copy(e),o=!!i.startTime;t.populateTimeForRequestAfterDrop(i,angular.copy(n)),l(i,a,o)}function l(e,n,i){v.isLoading=!0;var o=t.getAssignRequestData(e,n,v.currentDate);t.assignRequest(o).then(function(t){v.reAssignDriver({request:e,driverId:n,isAssigned:i})},function(e){a.warning(e.data.message)}).finally(function(){v.isLoading=!1})}function u(e,n,a){t.setDuration(e,n,a),v.reRenderCalendar()}function d(e,t){var n={hour:e.getHours(),minute:e.getMinutes()};return g(t,n)}function m(){v.draps=[];for(var e=v.timeSetting.startTime,t=0,n=2,a=e;a<v.timeSetting.startTime+v.timeSetting.sizeHour;a++)v.draps.push({style:{left:10*n/2+"%"},hour:a,minute:t}),n++,0!=t?30==t&&(t=0):(a--,t=30)}function g(e,t){return e.hour<t.hour||e.hour==t.hour&&e.minute<=t.minute}function h(){i.createPopup({templateUrl:"app/components/dashboard/driverChartTime/driverDetailModal.html",size:"md",data:v.driver},null)}function p(){o.$on("reInitDragTime",function(e,t){m()})}var v=this;v.jobStatus=e,v.driverStatus=n,v.$onInit=r,v.onDropComplete=s,v.setDuration=u,v.viewDriverDetail=h}angular.module("main.module").component("driverChartTime",{bindings:{driver:"=",isLoading:"=",timeSetting:"<",isTaskActive:"<",reAssignDriver:"&",currentDate:"=",reRenderCalendar:"&",refreshData:"&"},templateUrl:"app/components/dashboard/driverChartTime/driverChartTime.html",controller:e,controllerAs:"vm"}),e.$inject=["jobStatus","dashboardService","driverStatus","toastr","modalService","$scope"]}(),function(){"use strict";function e(e,t,n,a){function i(){c.reload=o,e.getMap().then(function(e){c.map=e}),o()}function o(){t.getDriverLocationByCriteria(c.currentDate,c.criteria).then(function(e){c.drivers=t.convertListDriverLocation(e.data)})}function r(){c.place=this.getPlace(),c.map.setCenter(c.place.geometry.location)}function s(e,a){a.jobId&&n.getJobById(a.jobId).then(function(e){c.job=t.convertJobOnMap(e.data),c.map.showInfoWindow("job-info",a.id)})}var c=this;c.taskStatus=a,c.showDetail=s,c.placeChanged=r,c.getBranchLocationByCriteria=o,c.$onInit=i}angular.module("main.module").component("jobOnMap",{bindings:{criteria:"<",currentDate:"<",reload:"="},templateUrl:"app/components/dashboard/jobOnMap/jobOnMap.html",controller:e,controllerAs:"vm"}),e.$inject=["NgMap","dashboardService","jobService","taskStatus"]}(),function(){"use strict";function e(e,t,n,a,i){function o(){r(),c(),h.isOpen=!1,h.datePicker={option:{showWeeks:!1,formatDayTitle:"MMM yyyy",formatDay:"d",formatDayHeader:"EEE",maxMode:"day",minMode:"day",customClass:s},showButtonBar:!1,startingDay:2},h.datePickerOption={showWeeks:!1,formatDayTitle:"MMM yyyy",formatDay:"d",formatDayHeader:"EEE",datepickerMode:"day",maxMode:"day",minMode:"day",customClass:s}}function r(){a.getIncompletedJob().then(function(e){h.dayJobs=e.data})}function s(e){var t=e.date;return m(t)?"date-with-pending-job":""}function c(){var n=t.checkIsToDay(h.currentDate)?"Today":e("date")(h.currentDate,"EEE");h.dateFormat=n+", "+d(h.currentDate.getDate())+" "+e("date")(h.currentDate,"MMM")+", "+h.currentDate.getFullYear()}function l(e){h.currentDate.setDate(h.currentDate.getDate()+e),h.isOpen=!1,c(),h.dateChange()}function u(){n(function(){c(),h.dateChange()})}function d(e){return e%20==1||e%30==1?e+"st":e%20==2||e%30==2?e+"nd":e%20==3||e%30==3?e+"rd":e+"th"}function m(e){var t=!1;return angular.forEach(h.dayJobs,function(n){g(i.getDateFromJsonString(n),e)&&(t=!0)}),t}function g(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}var h=this;h.$onInit=o,h.nextOrPrevious=l,h.modelChange=u,h.openCalendar=function(e){e.preventDefault(),e.stopPropagation(),h.isOpen=!0}}angular.module("main.module").component("dateControl",{bindings:{currentDate:"=",dateChange:"&"},templateUrl:"app/components/dashboard/dateControl/dateControl.html",controller:e,controllerAs:"vm"}),e.$inject=["$filter","timeService","$timeout","jobService","utilityService"]}(),function(){"use strict";function e(e,t,n,a){function i(){e.currentUser.role==a.SuperAdmin&&o(),r()}function o(){t.getAllBranchLocation().then(function(e){u.branchLocations=e.data,u.branchLocations.unshift({id:"",name:"All Locations"})})}function r(){t.getDriverByBranchLocation(u.branchLocation).then(function(e){u.drivers=e.data,u.drivers.unshift({id:"",fullName:"All Drivers"})})}function s(){u.driver="",n(function(){r(),u.reloadTimeLine()})}function c(){n(function(){u.reloadTimeLine()})}function l(e){u.calendarViewMode=e,n(function(){u.reloadTimeLine()})}var u=this;u.systemRole=a,u.$onInit=i,u.onLocationChange=s,u.onDriverChange=c,u.changeViewMode=l}angular.module("main.module").component("filterDashboard",{bindings:{calendarViewMode:"=",branchLocation:"=",driver:"=",reloadTimeLine:"&"},templateUrl:"app/components/dashboard/filterDashboard/filterDashboard.html",controller:e,controllerAs:"vm"}),e.$inject=["$rootScope","dashboardService","$timeout","systemRole"]}(),function(){"use strict";function e(e,t,n,a,i,o){function r(){m.reLoad=s,m.criteria={status:a.unassigned.value,search:""},c(),s(),d()}function s(){m.isLoading=!0,i.getRequestByCriteria(m.currentDate,m.criteria,m.branchLocation).then(function(e){m.isLoading=!1,m.requests=i.convertListRequestSearch(e.data),m.numberOfRecord=m.requests.length})}function c(){m.listJobStatus=o.getListFromObject(a),m.listJobStatus.unshift({value:"",text:"All Requests"})}function l(e){angular.element(document.getElementsByClassName("selected-item")).removeClass("selected-item"),angular.element(document.querySelector("#request-tab-"+e)).addClass("selected-item"),angular.element(document.querySelector("#request-"+e)).addClass("selected-item")}function u(n){t.currentDate=m.currentDate,e.path("jobs/"+n)}function d(){m.containerStyle={"max-height":n.innerHeight-270+"px","overflow-y":"auto"}}var m=this;m.jobStatus=a,m.$onInit=r,m.selectJob=l,m.jobDetail=u,m.getRequestByCriteria=s}angular.module("main.module").component("requestTab",{bindings:{currentDate:"<",reLoad:"=",numberOfRecord:"=",branchLocation:"="},templateUrl:"app/components/dashboard/requestTab/requestTab.html",controller:e,controllerAs:"vm"}),e.$inject=["$location","$rootScope","$window","jobStatus","dashboardService","utilityService"]}(),function(){"use strict";function e(e,t,n,a,i,o,r,s,c,l){function u(){m(),d()}function d(){function e(){return S.job.status<=t.inProgress.value}var n=o.getPetrolLog(S.job),a=null==n?"Add petrol card":"Remove petrol card";S.menuOptions=[["Set duration",h,e],null,["Add task",p,e],null,[a,v,function(){return e()}],null,["Manage documents",f,e],null,["Unassign request",y,function(){var e=!1;return angular.forEach(S.request.jobs,function(n){S.job.status<t.inProgress.value&&(e=!0)}),e}]]}function m(){if(S.job.tasks&&S.job.tasks.length){var e=0;angular.forEach(S.job.tasks,function(t){t.petrolLogId||e++}),e>0&&(S.job.taskText=e>1?e+" tasks":e+" task")}var t=o.getPetrolLog(S.job);S.job.havePetrolLog=null!=t}function g(e,o){if(S.job.status==t.completed.value||S.job.status==t.cancelled.value){var c=r.getTextFromValue(S.job.status,t);return void i.warning("Can not assign task to "+c+" Job.")}if(T(S.job.startTime))return void i.warning("Can not assign task to the past Job.");var l=e;l.status=a.assigned.value,l.jobId=S.job.id,l.driver=S.driverName,S.isLoading=!0,n.assignTask({taskId:l.id,jobId:S.job.id}).then(function(e){s.$broadcast("reloadTask",null),i.success("Assigning task successfully."),S.isLoading=!1,S.job.tasks=S.job.tasks||[],S.job.tasks.push(angular.copy(l)),m()})}function h(){S.durationData={hour:"1"};var t={setDurationSuccess:b};e.createPopup({templateUrl:"app/components/dashboard/jobCell/setDurationModal.html",size:"md",data:S.durationData},t)}function p(){S.addTaskData={jobId:S.job.id,date:new Date,type:"Errand",status:a.assigned.value};var t={onAddTask:k};e.createPopup({templateUrl:"app/components/dashboard/jobCell/addTaskModal.html",size:"md",data:S.addTaskData},t)}function v(){var e=o.getPetrolLog(S.job);if(null!=e){S.isLoading=!0;var t=o.getTaskIdOfPetrolLog(S.job);n.removePetrolLog(t).then(function(e){S.isLoading=!1,o.removePetrolLogFromTask(S.job.tasks,t),m(),i.success("Remove petrol card successfully."),d()})}else{var r={jobId:S.job.id,date:new Date,type:"Petrol Log",status:a.assigned.value,petrolLog:{date:new Date,mileage:0,gasolineLevel:0,referenceId:(new Date).getTime()}};S.isLoading=!0,n.createTask(r).then(function(e){S.isLoading=!1,S.job.tasks.push(e.data),m(),i.success("Add petrol card successfully."),d()})}}function f(){var t={uploadDocument:{}};e.createPopup({templateUrl:"app/components/dashboard/jobCell/uploadDocumentModal.html",size:"md",data:{jobId:S.job.id,pickupAddress:S.job.pickupAddress,deliveryAddress:S.job.deliveryAddress}},t)}function b(){S.isLoading=!0;var e=n.getDurationData(S.request,S.job,parseFloat(S.durationData.hour),S.driverId);n.saveTimeDuration(e).then(function(e){S.isLoading=!1,S.setDuration({request:S.request,job:S.job,hour:parseFloat(S.durationData.hour)})},function(e){S.isLoading=!1,i.warning("Duration cannot be changed as another job is assigned.")})}function k(){S.isLoading=!0,n.createTask(S.addTaskData).then(function(e){S.isLoading=!1,S.job.tasks=S.job.tasks||[],S.job.tasks.push(angular.copy(e.data)),m()})}function y(){var e=n.getUnassignRequestData(S.request);S.isLoading=!0,n.unassignRequest(e).then(function(e){S.refreshData()})}function D(e){s.currentDate=S.currentDate,c.path("jobs/"+e)}function T(e){var t=l.getTimeObject(e),n=new Date;return t.hour<n.getHours()||t.hour==n.getHours()&&t.minute<=n.getMinutes()}var S=this;S.jobStatus=t,S.onDropComplete=g,S.jobDetail=D,S.$onInit=u}angular.module("main.module").component("jobCell",{bindings:{job:"=",isLoading:"=",request:"<",isTaskActive:"<",setDuration:"&",driverName:"@",refreshData:"&",currentDate:"<",driverId:"@"},templateUrl:"app/components/dashboard/jobCell/jobCell.html",controller:e,controllerAs:"vm"}),e.$inject=["modalService","jobStatus","dashboardService","taskStatus","toastr","jobService","utilityService","$rootScope","$location","timeService"]}(),function(){"use strict";function e(e,t,n,a,i,o,r){function s(){k.reLoad=c,k.criteria={status:e.unassigned.value,search:""},l(),f(),c(),b()}function c(){k.isLoading=!0,a.getTaskByCriteria(k.currentDate,k.criteria,k.branchLocation).then(function(e){k.isLoading=!1,k.tasks=e.data.tasks,k.numberOfRecord=k.tasks.length})}function l(){k.listTaskStatus=n.getListFromObject(e),k.listTaskStatus.unshift({value:"",text:"All Tasks"})}function u(e,a){k.taskDetail=angular.copy(e),k.taskDetail.date=n.getDateFromJsonString(k.taskDetail.date),k.currentIndex=a;var i={onUpdateTask:m,unAssignDriver:g,cancelTask:p};t.createPopup({templateUrl:"app/components/dashboard/taskTab/editTaskModal.html",size:"md",data:k.taskDetail},i)}function d(){k.addTaskData={status:e.unassigned.value,date:new Date,type:"Errand",branchLocationId:k.branchLocation};var n={onAddTask:v};t.createPopup({templateUrl:"app/components/dashboard/jobCell/addTaskModal.html",size:"md",data:k.addTaskData},n)}function m(){k.isLoading=!0,a.updateTask(k.taskDetail).then(function(e){k.isLoading=!1,k.tasks[k.currentIndex]=k.taskDetail})}function g(){k.isLoading=!0,a.unAssignTask({taskId:k.taskDetail.id}).then(function(e){c(),k.reLoadTimeLine()})}function h(){k.isLoading=!0,r.cancelTask(k.taskDetail.id).then(function(e){c(),k.reLoadTimeLine()})}function p(){t.showWarningModal(h,"Are you sure you want to cancel this task?")}function v(){k.isLoading=!0,a.createTask(k.addTaskData).then(function(e){c()})}function f(){i.$on("reloadTask",function(e,t){c()})}function b(){k.containerStyle={"max-height":o.innerHeight-320+"px","overflow-y":"auto"}}var k=this;k.$onInit=s,k.taskStatus=e,k.addTask=d,k.editTask=u,k.getTaskByCriteria=c}angular.module("main.module").component("taskTab",{bindings:{currentDate:"<",reLoad:"=",numberOfRecord:"=",reLoadTimeLine:"&",branchLocation:"="},templateUrl:"app/components/dashboard/taskTab/taskTab.html",controller:e,controllerAs:"vm"}),e.$inject=["taskStatus","modalService","utilityService","dashboardService","$scope","$window","taskService"]}(),function(){"use strict";function e(e,t,n,a,i,o){function r(){s()}function s(){g.haveTask=!1,angular.forEach(g.tasks,function(e){e.petrolLogId||(g.haveTask=!0)})}function c(e,t){g.taskDetail=angular.copy(e),g.taskDetail.date=i.getDateFromJsonString(g.taskDetail.scheduledDate),g.taskDetail.driver=g.driverName,g.currentIndex=t;var a={onUpdateTask:d,unAssignDriver:m,cancelTask:l};n.createPopup({templateUrl:"app/components/dashboard/taskTab/editTaskModal.html",size:"md",data:g.taskDetail},a)}function l(){n.showWarningModal(u,"Are you sure you want to cancel this task?")}function u(){g.isLoading=!0,o.cancelTask(g.taskDetail.id).then(function(n){g.tasks[g.currentIndex].status=t.cancelled.value,e.$broadcast("reloadTask",null)})}function d(){g.isLoading=!0,a.updateTask(g.taskDetail).then(function(e){g.isLoading=!1,g.tasks[g.currentIndex]=g.taskDetail})}function m(){g.isLoading=!0,a.unAssignTask({taskId:g.taskDetail.id}).then(function(t){g.tasks.splice(g.currentIndex,1),s(),e.$broadcast("reloadTask",null)})}var g=this;g.taskStatus=t,g.$onInit=r,g.editTask=c}angular.module("main.module").component("taskAssignment",{bindings:{tasks:"=",driverName:"@"},templateUrl:"app/components/dashboard/taskAssignment/taskAssignment.html",controller:e,controllerAs:"vm"}),e.$inject=["$rootScope","taskStatus","modalService","dashboardService","utilityService","taskService"]}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){e.status={available:"available",empty:"empty"},e.exteriorListItems=[{description:"Radio Antenna",status:e.status.available,change:"yes"},{description:"Number Plate",status:e.status.empty,change:"no"},{description:"Petrol Cap",status:e.status.available,change:"no"},{description:"4 Hub Caps/Rims",status:e.status.available,change:"yes"},{description:"Road Tax Expiry",status:e.status.available,change:"yes"},{description:"Speedlimit Label",status:e.status.available,change:"yes"},{description:"Panel Markings",status:e.status.available,change:"yes"}],e.interiorListItems=[{description:"Cash Card",status:e.status.available,change:"yes"},{description:"Manual Book",status:e.status.empty,change:"no"},{description:"Radio/Cassette",status:e.status.available,change:"no"},{description:"CD Player/Cartridge",status:e.status.available,change:"yes"},{description:"Ashtray",status:e.status.available,change:"yes"},{description:"4 Hub Caps/Rims",status:e.status.available,change:"yes"}],e.othersListItems=[{description:"Rear Booth Carpet/Mat",status:e.status.available,change:"no"},{description:"Supporting Board",status:e.status.empty,change:"no"},{description:"Spare Tyre",status:e.status.available,change:"no"},{description:"Wheel Brace",status:e.status.available,change:"no"},{description:"Tools Kit",status:e.status.available,change:"yes"},{description:"Breakdown Sign",status:e.status.empty,change:"no"},{description:"First Aid Kit",status:e.status.empty,change:"no"},{description:"Jack/Lever",status:e.status.available,change:"no"}],e.customListItems=[{description:"Custom 1",status:e.status.available,change:"yes"},{description:"Custom 2",status:e.status.empty,change:"no"},{description:"Custom 3",status:e.status.available,change:"no"},{description:"Custom 4",status:e.status.available,change:"no"}]}}angular.module("main.module").component("checklistBox",{bindings:{},templateUrl:"app/components/checklist/checklistBox/checklistBox.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("main.module").component("exteriorChecklistbox",{bindings:{},templateUrl:"app/components/checklist/exteriorChecklistBox/exteriorChecklistBox.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("main.module").component("markingComponent",{bindings:{},templateUrl:"app/components/checklist/exteriorChecklistBox/markingComponent.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){e.profileType=[{id:1,imageUrl:"/img/car_profile.png",description:"Left View",markings:[{xCoordinate:39,yCoordinate:39,description:"this is a marking",by:"boon hock",date:"07/06/2016 11:25am"},{xCoordinate:9,yCoordinate:19,description:"this is a second marking",by:"boon hock",date:"07/06/2016 11:25am"},{xCoordinate:9,yCoordinate:98,description:"this is a third marking",by:"boon hock",date:"07/06/2016 11:25am"}]},{id:2,imageUrl:"/img/car_profile.png",description:"RightView",markings:[{xCoordinate:39,yCoordinate:39,description:"this is a marking",by:"boon hock",date:"07/06/2016 11:25am"},{xCoordinate:9,yCoordinate:19,description:"this is a second marking",by:"boon hock",date:"07/06/2016 11:25am"},{xCoordinate:9,yCoordinate:98,description:"this is a third marking",by:"boon hock",date:"07/06/2016 11:25am"}]}]}}angular.module("main.module").component("exteriorimageComponent",{bindings:{},templateUrl:"app/components/checklist/exteriorChecklistBox/exteriorimageComponent.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(e,t,n,a){function i(){o.isLoading=!0,n.getVehicleTypes().then(function(e){o.isLoading=!1,o.vehicleTypes=n.convertVehicleType(e.data)})}var o=this;o.$onInit=function(){i(),o.status={available:!1,empty:!0}}}angular.module("main.module").component("vehicleType",{bindings:{},templateUrl:"app/components/checklist/vehicleType/vehicleType.html",controller:e,controllerAs:"vm"}),e.$inject=["$routeParams","$location","vehicleService","$filter"]}(),function(){"use strict";function e(e,t,n,a,i){function o(){r()}function r(){S.id=t.id,S.isLoading=!0,a.getVehicleById(S.id).then(function(e){S.isLoading=!1,S.vehicleTypeName=e.data.vehicleTypeName,S.vehicleChecklist=a.convertChecklistDetail(e.data.checkList)})}function s(){var n=t.id;S.addNewSubSectionData={vehicleTypeId:n,name:"",checkListItems:[]};var a={onAddSubSection:c};e.createPopup({templateUrl:"app/components/checklist/vehicleList/addNewSubSectionModal.html",size:"md",data:S.addNewSubSectionData},a)}function c(){S.isLoading=!0,a.createSubsection(S.addNewSubSectionData).then(function(e){S.vehicleChecklist=S.vehicleChecklist||[],S.vehicleChecklist.push(angular.copy(S.addNewSubSectionData)),r()})}function l(t){S.checklistCategory=angular.copy(t);var n={onDeleteCategory:u,onEditCategory:m};e.createPopup({templateUrl:"app/components/checklist/vehicleList/editSubsectionModal.html",size:"md",data:S.checklistCategory},n)}function u(){k(d,"Are you sure you want to delete this Subsection?")}function d(){S.isLoading=!0,a.deleteSubsection(S.checklistCategory).then(function(e){r()})}function m(){S.isLoading=!0,a.editSubsection(S.checklistCategory).then(function(e){r()})}function g(t){
S.checklistCategory=angular.copy(t);var n=S.checklistCategory.id,a=S.checklistCategory.name;S.addNewItemData={sectionName:a,newItem:{MasterCheckListCategoryId:n,description:""}};var i={onAddNewItem:h};e.createPopup({templateUrl:"app/components/checklist/vehicleList/addNewItemModal.html",size:"md",data:S.addNewItemData},i)}function h(){S.isLoading=!0,a.addItem(S.addNewItemData.newItem).then(function(e){r()})}function p(t,n){S.checklistItem=angular.copy(t),S.checklistCategory=angular.copy(n);var a=S.checklistItem.id,i=S.checklistItem.description,o=S.checklistCategory.name;S.editItemData={editItem:{id:a,description:i,subsectionName:o}};var r={onDeleteItem:f,onEditItem:v};e.createPopup({templateUrl:"app/components/checklist/vehicleList/editItemModal.html",size:"md",data:S.editItemData.editItem},r)}function v(){S.isLoading=!0,a.editItem(S.editItemData.editItem).then(function(e){r()})}function f(){k(b,"Are you sure you want to delete this item?")}function b(){S.isLoading=!0,a.deleteItem(S.editItemData.editItem).then(function(e){r()})}function k(t,n){var a={onAction:t};e.createPopup({templateUrl:"app/components/common/warningModal/warningModal.html",size:"md",data:{title:"Warning",message:n}},a)}function y(){i.getVehicleTypes().then(function(e){S.replaceData={currentVehicleType:S.vehicleTypeName,vehicleTypes:[]},angular.forEach(e.data,function(e){e.id!=S.id&&e.checkList.length>0&&S.replaceData.vehicleTypes.push({text:e.name,value:e.id})}),D()})}function D(){var t={onReplace:T};e.createPopup({templateUrl:"app/components/checklist/vehicleList/replaceChecklistModal.html",size:"md",data:S.replaceData},t)}function T(){i.replaceChecklist({vehicleTypeId:S.id,targetVehicleTypeId:S.replaceData.vehicleType}).then(function(e){r()})}var S=this;S.addNewSubSection=s,S.addNewItem=g,S.editItem=p,S.editCategory=l,S.replaceChecklist=y,S.$onInit=o}angular.module("main.module").component("vehicleList",{templateUrl:"app/components/checklist/vehicleList/vehicleList.html",controller:e,controllerAs:"vm",bindings:{vehicleManagement:"<"}}),e.$inject=["modalService","$routeParams","$location","checklistService","vehicleService"]}(),function(){"use strict";function e(e,t,n,a,i){function o(){d.uploadStatus={isNotUpload:"isNotUpload",uploading:"uploading",uploaded:"uploaded"},d.status=d.uploadStatus.isNotUpload,c()}function r(){e(function(){document.getElementById("documentUpload").click()})}function s(){for(var e=new FormData,n=0,a=0;a<d.documentFiles.length;a++)"application/pdf"==d.documentFiles[a].type&&(e.append("file",d.documentFiles[a]),n++);e.append("jobId",d.data.jobId),d.numberOfDocument=n,n>0&&t.uploadDocument(e).then(function(e){c(),d.status=d.uploadStatus.uploaded,angular.element(document.getElementById("documentUpload")).val(null)})}function c(){n.getDocumentByJobId(d.data.jobId).then(function(e){d.documents=e.data})}function l(e){d.documents.splice(e,1)}function u(e){0==e.indexOf("http")?a.open(e,"_blank"):a.open(i.serviceUrl+"/"+e,"_blank")}var d=this;d.$onInit=o,d.uploadFiles=s,d.actionClick=r,d.openDocument=u,d.removeDocument=l}angular.module("main.module").component("uploadDocument",{bindings:{data:"=",onCancel:"&"},templateUrl:"app/components/dashboard/uploadDocument/uploadDocument.html",controller:e,controllerAs:"vm"}),e.$inject=["$timeout","dashboardService","jobService","$window","systemSetting"]}(),function(){"use strict";function e(){}angular.module("main.module").component("collectData",{bindings:{collected:"<"},templateUrl:"app/components/job/dataCollect/dataCollect.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(e){function t(){i.currentPage=0,i.pageSize=4,e(function(){n(),i.isLastPage=(i.currentPage+1)*i.pageSize>=i.logs.length})}function n(){var e=angular.copy(i.logs);i.eventPageData=e.splice(i.currentPage*i.pageSize,i.pageSize)}function a(e){i.currentPage+=e,i.isLastPage=(i.currentPage+1)*i.pageSize>=i.logs.length,n()}var i=this;i.nextOrPrevious=a,t()}angular.module("main.module").component("eventLog",{bindings:{logs:"="},templateUrl:"app/components/job/eventLog/eventLog.html",controller:e,controllerAs:"vm"}),e.$inject=["$timeout"]}(),function(){"use strict";function e(){}angular.module("main.module").component("handover",{bindings:{handover:"<",jobId:"<"},templateUrl:"app/components/job/handover/handover.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("main.module").component("replacement",{bindings:{jobDetail:"<"},templateUrl:"app/components/job/replacement/replacement.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(e){var t=this;t.taskStatus=e}angular.module("main.module").component("taskAssign",{bindings:{tasks:"<"},templateUrl:"app/components/job/taskAssign/taskAssign.html",controller:e,controllerAs:"vm"}),e.$inject=["taskStatus"]}(),function(){"use strict";function e(e,t){function n(n){0==n.indexOf("http")?e.open(n,"_blank"):e.open(t.serviceUrl+"/"+n,"_blank")}function a(e){i.documents.splice(e,1)}var i=this;i.openDocument=n,i.removeDocument=a}angular.module("main.module").component("uploadDoc",{bindings:{documents:"="},templateUrl:"app/components/job/uploadDoc/uploadDoc.html",controller:e,controllerAs:"vm"}),e.$inject=["$window","systemSetting"]}(),function(){"use strict";function e(){}angular.module("main.module").component("petrolLog",{bindings:{petrol:"<"},templateUrl:"app/components/job/petrolLog/petrolLog.html",controller:e,controllerAs:"vm"}),e.$inject=[]}(),function(){"use strict";function e(e,t){function n(){e.createPopup({templateUrl:"app/components/job/viewImage/imageModal.html",size:"lg",data:{url:t.serviceUrl+"/"+a.url}},null)}var a=this;a.viewPhoto=n}angular.module("main.module").component("viewImage",{bindings:{url:"<",text:"@"},templateUrl:"app/components/job/viewImage/viewImage.html",controller:e,controllerAs:"vm"}),e.$inject=["modalService","systemSetting"]}(),function(){"use strict";function e(e,t,n){function a(){s.criteria=e.vehicleManagementCriteria||{search:"",type:"",currentPage:1,itemPerPage:20},i(),o()}function i(){n.getVehicleTypes().then(function(e){s.vehicleTypes=n.convertVehicleType(e.data),s.vehicleTypes.unshift({id:"",name:"All Types"})})}function o(){s.isLoading=!0,n.getVehicleByCriteria(s.criteria).then(function(e){s.isLoading=!1,s.vehicles=e.data.vehicles,s.totalItems=e.data.totalItem})}function r(n){e.vehicleManagementCriteria=s.criteria,t.path("vehicles/"+n)}var s=this;s.getVehicleByCriteria=o,s.goToDetail=r,a()}angular.module("main.module").component("vehicleManagement",{bindings:{vehicleManagement:"<"},templateUrl:"app/components/vehicleManagement/vehicleManagement.html",controller:e,controllerAs:"vm"}),e.$inject=["$rootScope","$location","vehicleService"]}(),function(){"use strict";function e(e,t,n,a,i){function o(){h.criteria={search:"",status:"",fromDate:"",toDate:"",currentPage:1,itemPerPage:20},s(),r()}function r(){h.listTaskStatus=t.getListFromObject(n),h.listTaskStatus.unshift({value:"",text:"All Tasks"})}function s(){h.isLoading=!0,e.getTaskByType(h.criteria).then(function(t){h.isLoading=!1,h.tasks=e.convertTasks(t.data.tasks),h.totalItems=t.data.totalItem})}function c(e){h.taskDetail=angular.copy(e);var t={onUpdateTask:m,unAssignDriver:g,cancelTask:u};i.createPopup({templateUrl:"app/components/dashboard/taskTab/editTaskModal.html",size:"md",data:h.taskDetail},t)}function l(e){e.stopPropagation()}function u(){i.showWarningModal(d,"Are you sure you want to cancel this task?")}function d(){h.isLoading=!0,e.cancelTask(h.taskDetail.id).then(function(e){h.isLoading=!1,s()})}function m(){h.isLoading=!0,a.updateTask(h.taskDetail).then(function(e){h.isLoading=!1,s()})}function g(){h.isLoading=!0,a.unAssignTask({taskId:h.taskDetail.id}).then(function(e){s()})}var h=this;h.taskStatus=n,h.getTasksByCriteria=s,h.editTask=c,h.preventOpenTask=l,h.$onInit=o}angular.module("main.module").component("taskManagement",{bindings:{taskManagement:"<"},templateUrl:"app/components/taskManagement/taskManagement.html",controller:e,controllerAs:"vm"}),e.$inject=["taskService","utilityService","taskStatus","dashboardService","modalService"]}(),function(){"use strict";function e(e,t){function n(){a.isOpen=!1,a.minDate&&e.$watch("vm.minDate",function(e){a.datepickerOptions={minDate:e}})}var a=this;n(),a.openCalendar=function(e){e.preventDefault(),e.stopPropagation(),a.isOpen=!0},a.dateChange=function(){t(function(){a.ngChange()})}}angular.module("main.module").component("customDatePicker",{bindings:{ngModel:"=",placeHolder:"@?",minDate:"=?",ngDisabled:"=?",isTouch:"=?",ngChange:"&?"},templateUrl:"app/components/common/datePicker/datePicker.html",controller:e,controllerAs:"vm"}),e.$inject=["$scope","$timeout"]}(),function(){"use strict";function e(e){function t(){n.isOpen=!1}var n=this;t(),n.openCalendar=function(e){e.preventDefault(),e.stopPropagation(),n.isOpen=!0},n.dateChange=function(){e(function(){n.ngChange()})}}angular.module("main.module").component("labelDatePicker",{bindings:{ngModel:"=",ngChange:"&?"},templateUrl:"app/components/common/labelDatePicker/labelDatePicker.html",controller:e,controllerAs:"vm"}),e.$inject=["$timeout"]}(),function(){"use strict";function e(e,t,n,a,i,o,r){function s(){y.currentIndex=0,y.updateChecklist=c,c(),b()}function c(){y.isLoading=!0;var e;e=y.handoverId?t.getExteriorImageByHandoverId(y.handoverId):i.getVehicleExteriorChecklist(y.vehicleId,y.version),e.then(function(e){y.exteriorImages=e.data,m(),y.isLoading=!1})}function l(e,t){y.currentIndex=e,m()}function u(e,t){m(e),y.currentIndex=t,y.currentSelectedMarking=e}function d(){y.jobState=e.jobDetail}function m(e){var t=function(t,n){a(function(){var a=document.getElementById("current-exterior"),i=document.getElementById("myCanvas"),o=a.width,r=a.height;i.width=o,i.height=r;y.exteriorImages[y.currentIndex].id;y.drawMarkings=y.exteriorImages[y.currentIndex].markings,angular.forEach(y.drawMarkings,function(a){var s=!(!e||a.id!=e);g(i,{x:h(o,t,a.xPos),y:h(r,n,a.yPos)},s)})},200)};k(y.serviceUrl+"/"+y.exteriorImages[y.currentIndex].imageUrl,t)}function g(e,t,n){var a=e.getContext("2d");a.beginPath(),a.arc(t.x,t.y,12,0,2*Math.PI,!1),a.fillStyle=n?"#e6003c":"#4A90E2",a.lineWidth=2,a.fill(),a.strokeStyle="white",a.stroke()}function h(e,t,n){return e*n/t}function p(e){var t=v(y.drawMarkings,e.offsetX,e.offsetY);t&&u(t.id,y.currentIndex)}function v(e,t,n){for(var a=!1,i=0,o=e.length;i<o;i++){var r=e[i].xPos-12,s=e[i].xPos+12,c=e[i].yPos-12,l=e[i].yPos+12;s>=t&&r<=t&&l>=n&&c<=n&&(a=e[i])}return a}function f(e){t.getHandoverById(e).then(function(e){o.path("/jobs/"+e.data.jobId)})}function b(){var e=y.handoverId?r.innerHeight-151:r.innerHeight-217;y.markingScrollStyle={"max-height":e+"px","overflow-y":"auto"}}function k(e,t){var n=new Image;n.src=e,n.onload=function(){t(n.width,n.height)}}var y=this;y.serviceUrl=n.serviceUrl,y.$onInit=s,y.backToJob=d,y.selectExteriorImage=l,y.selectMarking=u,y.selectHighlightMarking=p,y.jobDetail=f}angular.module("main.module").component("exteriorChecklist",{bindings:{handoverId:"<?",vehicleId:"<?",version:"<?",updateChecklist:"=?"},templateUrl:"app/components/exteriorChecklist/exteriorChecklist.html",controller:e,controllerAs:"vm"}),e.$inject=["jobDetailState","handoverService","systemSetting","$timeout","vehicleService","$location","$window"]}(),function(){"use strict";function e(e){function t(){n.isLoading=!0,e.getVehicleItemChecklist(n.vehicleId).then(function(e){n.isLoading=!1,n.checkList=e.data})}var n=this;n.$onInit=t}angular.module("main.module").component("vehicleItemChecklist",{bindings:{vehicleId:"<"},templateUrl:"app/components/vehicleDetail/vehicleItemChecklist.html",controller:e,controllerAs:"vm"}),e.$inject=["vehicleService"]}(),function(){"use strict";function e(e){function t(){e.removeDocument(n.documentId).then(function(e){n.onRemove()})}var n=this;n.remove=t}angular.module("main.module").component("removeDocument",{bindings:{documentId:"=",onRemove:"&"},templateUrl:"app/components/common/removeDocument/removeDocument.html",controller:e,controllerAs:"vm"}),e.$inject=["jobService"]}(),function(){"use strict";function e(e){return{restrict:"A",link:function(t,n,a){var i=e(a.fileModel),o=i.assign,r=t.$eval(a.customOnChange);n.bind("change",function(){o(t,n[0].files),r()})}}}angular.module("main.module").directive("fileModel",e),e.$inject=["$parse"]}(),function(){"use strict";function e(e){return{restrict:"A",link:function(t,n,a){var i=n[0];n.bind("scroll",function(){var n=i.scrollTop;console.log(n);var o=e(a.scrolly),r=n>a.max;o(t,{isStick:r})})}}}angular.module("main.module").directive("scrolly",e),e.$inject=["$parse"]}(),function(){"use strict";function e(e,t,n){function a(e){e.headers=e.headers||{};var n=t.get("tokenInfo");return n&&(e.headers.Authorization=n.token_type+" "+n.access_token),e}function i(a){return 401===a.status&&(t.remove("tokenInfo"),t.remove("userInfo"),n.path("/accessDeny")),e.reject(a)}var o={request:a,responseError:i};return o}angular.module("main.module").factory("httpInterceptor",e),e.$inject=["$q","localStorageService","$location"]}(),function(){"use strict";function e(e){function t(t){return e("orderBy")(t,function(e){return e.startTime},!1,a)}function n(e){var t=e.split(":"),n={hour:parseInt(t[0])};return n.minute=t.length>1?parseInt(t[1]):0,n}function a(e,t){if(!Number.isInteger(e.value)&&!Number.isInteger(t.value)){var a=n(e.value),i=n(t.value);return a.hour>i.hour||a.hour==i.hour&&a.minute>i.minute}}function i(e){var t=[];for(var n in e)t.push({value:e[n].value,text:e[n].text});return t}function o(e,t){for(var n in t)if(e==t[n].value)return t[n].text;return"N/A"}function r(e){return e?new Date(e):new Date}var s={sortByStartTime:t,getTimeObject:n,getListFromObject:i,getTextFromValue:o,getDateFromJsonString:r};return s}angular.module("main.module").factory("utilityService",e),e.$inject=["$filter"]}(),function(){"use strict";function e(e){function t(t,n,a){var i=e.open({animation:!0,templateUrl:t.templateUrl,controller:"ModalInstanceController",controllerAs:"vm",size:t.size,backdrop:"static",resolve:{data:function(){return t.data},readOnly:function(){return t.readOnly}}});i.result.then(function(e){n[e]()},a)}function n(e,n){var a={onAction:e};t({templateUrl:"app/components/common/warningModal/warningModal.html",size:"md",data:{title:"Warning",message:n}},a)}var a={createPopup:t,showWarningModal:n};return a}angular.module("main.module").factory("modalService",e),e.$inject=["$uibModal"]}(),function(){"use strict";function e(e,t){function n(e,t){var n=new Date,a=n.getHours(),i=n.getMinutes();return!(a<e||a>e+t||a===e+t&&i>0)}function a(e){var t=new Date,n=angular.copy(e);return n.setHours(0,0,0,0)==t.setHours(0,0,0,0)}function i(e,t,n,a){var i=s(e,t,n,a);return b*i/60}function o(e,t,n,a,i,o){var c=r(e,t,i,o),l=s(n,a,i,o);return l*c}function r(e,t,n,a){var i=s(e,t,n,a);return 100/i}function s(e,t,n,a){var i=u(e.toString()),o=u(t),r=c(o,n,a)-c(i,n,a);return r}function c(e,t,n){var a=e.hour,i=e.minute;return a<t&&(a=t,i=0),(a>t+n||a===t+n&&i>0)&&(a=t+n,i=0),60*a+i}function l(t){return e("orderBy")(t,function(e){return e.startTime},!1,g)}function u(e){var t=e.split(":"),n={hour:parseInt(t[0])};return n.minute=t.length>1?parseInt(t[1]):0,n}function d(){var e=new Date;return e.getHours()+":"+e.getMinutes()}function m(){return e("date")(new Date,"h:mm a")}function g(e,t){if(!Number.isInteger(e.value)&&!Number.isInteger(t.value)){var n=u(e.value),a=u(t.value);return n.hour>a.hour||n.hour==a.hour&&n.minute>a.minute}}function h(e,t){var n=u(e),a=u(t);return n.hour>a.hour||n.hour==a.hour&&n.minute>a.minute}function p(e){return 24===e?"23:59":e<10?"0"+e+":00":e+":00"}function v(t){var n=u(t),a=new Date;return a.setHours(n.hour,n.minute),e("date")(a,"h:mm a")}function f(e){var n=e.getHours(),a=n-3;return a<0&&(a=0),a>24-t.sizeHour&&(a=24-t.sizeHour),a}var b=10,k={sortByStartTime:l,getTimeObject:u,getCurrentTime:d,getPercentageFromDistance:i,getPercentageFromDistanceInRequest:o,isShowCurrentTime:n,getCurrentTimeText:m,checkIsToDay:a,compareTimeObject:h,timeToStringMaker:p,timeToStringFormatMaker:v,getTotalMinute:c,getStartTimeFromCurrentTime:f};return k}angular.module("main.module").factory("timeService",e),e.$inject=["$filter","calendarSetting"]}(),function(){"use strict";function e(e,t,n,a,i,o,r,s,c,l,u,d){function m(n,a){var i={date:t("date")(n,"yyyy-MM-dd")};return a.branchLocation&&(i.branchLocationId=a.branchLocation),a.driver&&(i.driverId=a.driver),e.get(ce+"/requests/driver",{params:i})}function g(n,a,i){var o={date:t("date")(n,"yyyy-MM-dd")};return a.search&&(o.search=a.search),(a.status||0==a.status)&&(o.status=a.status),i&&(o.branchLocationId=i),e.get(ce+"/requests/dashboard",{params:o})}function h(n,a,i){var o={date:t("date")(n,"yyyy-MM-dd")};return a.search&&(o.search=a.search),(a.status||0===a.status)&&(o.status=a.status),i&&(o.branchLocationId=i),e.get(ce+"/tasks",{params:o})}function p(t){return e.post(ce+"/requests/assign",t)}function v(t){return e.post(ce+"/requests/unassign",t)}function f(t){return e.post(ce+"/tasks",t)}function b(t){return e.put(ce+"/tasks/"+t.id,t)}function k(t){return e.post(ce+"/tasks/assign",t)}function y(t){return e.post(ce+"/tasks/unassign",t)}function D(t){return e.delete(ce+"/tasks/remove-petrol-log/"+t,{})}function T(t){return e.post(ce+"/jobs/setduration",t)}function S(n,a){var i={date:t("date")(n,"yyyy-MM-dd")};return a.branchLocation&&(i.branchLocationId=a.branchLocation),a.driver&&(i.driverId=a.driver),e.get(ce+"/branchlocations/drivers",{params:i})}function j(t){return e.post(ce+"/jobs/upload-document-signing",t,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}function C(){return e.get(ce+"/branchlocations")}function I(t){var n=ce+"/branchlocations/drivers";return n=t?n+"/?branchLocationId="+t:n,e.get(n)}function L(e,t,i){var o=n.getPercentageFromDistance(e.startTime,e.endTime,t,i);e.style={width:o+"%",left:n.getPercentageFromDistance(t,e.startTime,t,i)+a.percentagePerJob+"%"},e.isDisplay=0!==o}function M(e,t,n){if(!e.amAvailability&&!e.pmAvailability)return void(e.status=s.available);var a;e.amAvailability&&(a=r.AM),e.pmAvailability&&(a=r.PM),e.amAvailability&&e.pmAvailability&&(a=r.Both),(e.amAvailability||e.pmAvailability)&&(x(e)?e.status=s.onLeaveButHaveJob:e.status=s.onLeave);var i=$(a,t,n);e.style=i.style,e.isDisplay=i.isDisplay,e.leaveText=a.text,e.timeObject=a}function x(e){return e&&e.requests&&e.requests.length>0&&e.requests[0].jobs&&e.requests[0].jobs.length>0}function $(e,t,i){var o=n.getPercentageFromDistance(e.startTime,e.endTime,t,i),r={width:o+"%",left:n.getPercentageFromDistance(t,e.startTime,t,i)+a.percentagePerJob+"%"};return{style:r,isDisplay:0!==o}}function w(e,t,a,i){L(t,a,i),t.isDisplay&&(n.sortByStartTime(t.jobs),angular.forEach(t.jobs,function(n){P(e,t,n,a,i)}))}function P(e,t,a,i,o){var r=n.getPercentageFromDistanceInRequest(t.startTime,t.endTime,a.startTime,a.endTime,i,o),s=n.getPercentageFromDistanceInRequest(t.startTime,t.endTime,t.startTime,a.startTime,i,o);a.style={width:r+"%",left:s+"%"},a.isDisplay=0!==r,a.startTime==t.startTime&&(a.style["border-bottom-left-radius"]="4px",a.style["border-top-left-radius"]="4px",a.type=t.type),a.endTime==t.endTime?(a.style["border-bottom-right-radius"]="4px",a.style["border-top-right-radius"]="4px"):a.style["border-right"]="1px solid rgba(255, 255, 255, .5)",e.timeObject&&n.compareTimeObject(a.startTime,e.timeObject.startTime)&&!n.compareTimeObject(a.startTime,e.timeObject.endTime)?a.isOnLeave=!0:a.isOnLeave=!1,1==t.jobs.length&&(a.type=t.type)}function A(e,t,a){var o=n.getCurrentTime(),r=n.isShowCurrentTime(t,a),s=!1;angular.forEach(e.jobs,function(e){e.isInFuture=s,r&&e.status===i.inProgress.value&&n.compareTimeObject(o,e.startTime)&&n.compareTimeObject(e.endTime,o)&&(s=!0)})}function E(e,t,i){var o=n.isShowCurrentTime(e,t),r=n.checkIsToDay(i);if(o&&r){var s=n.getPercentageFromDistance(e,n.getCurrentTime(),e,t)+a.percentagePerJob;return{left:s+"%"}}return null}function U(e){var t=!1;angular.forEach(e.jobs,function(n){e.status=n.status,n.status===i.inProgress.value&&(t=!0)}),t&&(e.status=i.inProgress.value)}function J(e){var t=!0;return angular.forEach(e.jobs,function(e){e.status>=i.inProgress.value&&(t=!1)}),t}function F(e,t){if(e.canDrag=!0,e.startTime){var n=60*t.hour+t.minute,a=n-z(e.startTime);e.startTime=W(e.startTime,a),e.endTime=W(e.endTime,a),angular.forEach(e.jobs,function(e){e.startTime=W(e.startTime,a),e.endTime=W(e.endTime,a)})}else angular.forEach(e.jobs,function(e){e.startTime=V(t),t.hour+=1,e.endTime=V(t)}),e.startTime=e.jobs[0].startTime,e.endTime=e.jobs[e.jobs.length-1].endTime}function H(e){if(!e.jobs||!e.jobs.length)return!1;var t=!0;return angular.forEach(e.jobs,function(e){e.expectedStartDate&&e.expectedEndDate||(t=!1)}),t}function q(e,t,n){var a=angular.copy(e),i=[];return angular.forEach(a.jobs,function(e){i.push(N(e,n))}),{driverId:t,request:N(a,n),jobs:i}}function B(e){var t={requestId:e.id},n=[];return angular.forEach(e.jobs,function(e){var t={id:e.id},a=[];angular.forEach(e.tasks,function(e){a.push(e.id)}),t.tasks=a,n.push(t)}),t.jobs=n,t}function R(e,t,a){n.sortByStartTime(e.jobs);var i=z(t.startTime),o=z(t.endTime),r=60*a-(o-i),s=!1;angular.forEach(e.jobs,function(e){s&&(e.startTime=W(e.startTime,r),e.endTime=W(e.endTime,r)),e.id===t.id&&(e.endTime=W(e.endTime,r),s=!0)}),e.endTime=e.jobs[e.jobs.length-1].endTime}function O(e,t,n,a){var i=angular.copy(e);R(i,t,n);var o=[];return angular.forEach(i.jobs,function(e){o.push(N(e))}),{driverId:a,request:N(i),jobs:o}}function N(e,t){var a=n.getTimeObject(e.startTime),i=n.getTimeObject(e.endTime),o=e.scheduledStartDate?u.getDateFromJsonString(e.scheduledStartDate):t?angular.copy(t):new Date;o.setHours(a.hour,a.minute,0,0);var r=e.scheduledStartDate?u.getDateFromJsonString(e.scheduledStartDate):t?angular.copy(t):new Date;return r.setHours(i.hour,i.minute,0,0),{id:e.originalId||e.id,jobType:e.jobType,scheduledStartDate:o,scheduledEndDate:r}}function V(e){return e.hour+":"+e.minute}function z(e){var t=n.getTimeObject(e);return 60*t.hour+t.minute}function W(e,t){var n=z(e)+t,a={minute:n%60};return a.hour=(n-a.minute)/60,V(a)}function _(e){var n=[];return angular.forEach(e,function(e){U(e);var a=H(e);n.push({id:ne(e),originalId:e.id,expectedStartTime:a?u.getDateFromJsonString(e.jobs[0].expectedStartDate):null,expectedStartTimeString:a?t("date")(u.getDateFromJsonString(e.jobs[0].expectedStartDate),"H:mm a"):null,isHaveExpectedStartTime:a,type:e.type,referenceId:e.referenceId,jobs:Q(e.jobs),jobSheets:e.jobSheets,driver:Y(e),status:e.status})}),n}function Y(e){if(!e.jobs||!e.jobs.length)return"";if(e.jobs[0].jobType==c.miceJobsheet){var t=e.jobs[0].driver;return t?t.fullName:""}return e.driver?e.driver.fullName:""}function K(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,name:e.fullName,contact:e.contact,alternateContact:e.alternateContact,branchLocation:e.branchLocation,amAvailability:e.amAvailability,pmAvailability:e.pmAvailability,requests:ie(e.requests)})}),t}function X(e,n){return{id:e.id,status:e.status,jobType:e.jobType,pickupAddress:e.pickupAddress,deliveryAddress:e.deliveryAddress,vehiclePlateNumber:e.vehiclePlateNumber,vehicleModel:e.vehicleModel,clientName:e.clientName,clientContact:e.clientContact,jobPurpose:e.jobPurpose,startTime:n&&e.actualStartDate?t("date")(u.getDateFromJsonString(e.actualStartDate),"H:mm"):t("date")(u.getDateFromJsonString(e.scheduledStartDate),"H:mm"),endTime:n&&e.actualEndDate?t("date")(u.getDateFromJsonString(e.actualEndDate),"H:mm"):t("date")(u.getDateFromJsonString(e.scheduledEndDate),"H:mm"),tasks:se(e.tasks),scheduledStartDate:e.scheduledStartDate,scheduledEndDate:e.scheduledEndDate,expectedStartDate:e.expectedStartDate,expectedEndDate:e.expectedEndDate,actualStartDate:e.actualStartDate?u.getDateFromJsonString(e.actualStartDate):null,actualEndDate:e.actualEndDate?u.getDateFromJsonString(e.actualEndDate):null,additionalRemarks:e.additionalRemarks,numberOfDocument:e.numberOfDocument}}function G(e){return{id:e.id,type:e.type,status:e.status,pickupAddress:e.pickupAddress,deliveryAddress:e.deliveryAddress,vehiclePlateNumber:e.licensePlate,vehicleModel:e.vehicleModel,clientName:e.clientName,jobPurpose:e.jobPurpose,additionalRemarks:e.additionalRemarks,clientContact:e.clientContact,startTime:t("date")(u.getDateFromJsonString(e.startDate),"H:mm a"),endTime:t("date")(u.getDateFromJsonString(e.endDate),"H:mm a"),tasks:e.tasks,driverName:e.driver?e.driver.fullName:"N/A",actualStartDate:e.actualStartDate?u.getDateFromJsonString(e.actualStartDate):null,actualEndDate:e.actualEndDate?new u.getDateFromJsonString(e.actualEndDate):null,requestNo:e.requestNo,numberOfDocument:e.documents?e.documents.length:0}}function Q(e,t){var n=[];return angular.forEach(e,function(e){n.push(X(e,t))}),n}function Z(e){U(e);var t=e.status==i.completed.value,n={id:ne(e),originalId:e.id,type:e.type,referenceId:e.referenceId,jobs:Q(e.jobs,t),scheduledStartDate:e.scheduledStartDate,scheduledEndDate:e.scheduledEndDate,canDrag:J(e)};return ee(n),ae(n),te(n,t),n}function ee(e){e.startTime=t("date")(u.getDateFromJsonString(e.jobs[0].scheduledStartDate),"H:mm"),e.endTime=t("date")(u.getDateFromJsonString(e.jobs[e.jobs.length-1].scheduledEndDate),"H:mm")}function te(e,n){if(n){var a=e.jobs[0].actualStartDate?e.jobs[0].actualStartDate:u.getDateFromJsonString(e.jobs[0].scheduledStartDate),i=e.jobs[e.jobs.length-1],o=i.actualEndDate?i.actualEndDate:u.getDateFromJsonString(i.scheduledEndDate);e.startTime=t("date")(a,"H:mm"),e.endTime=t("date")(o,"H:mm")}}function ne(e){return e.jobs&&e.jobs.length>0&&e.jobs[0].jobType==c.miceJobsheet?e.id+e.jobs[0].id:e.id}function ae(e){e.jobs[0].jobType==c.miceJobsheet&&(e.startTime=t("date")(u.getDateFromJsonString(e.jobs[0].scheduledStartDate),"H:mm"),e.endTime=t("date")(u.getDateFromJsonString(e.jobs[0].scheduledEndDate),"H:mm"))}function ie(e){var t=[];return angular.forEach(e,function(e){t.push(Z(e))}),t}function oe(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id.toString(),name:e.fullName,position:[e.locationDetail.lat,e.locationDetail.lon],time:re(u.getDateFromJsonString(e.locationDetail.date)),jobId:e.locationDetail.jobId})}),t}function re(e){var t=Math.abs(((new Date).getTime()-e)/1e3),n=[],a=60,i=3600,o=86400,r=604800,s=31556926,c=315569260;return n=t<=a?["",""]:t<60*a?[Math.round(Math.abs(t/a)),"min"]:t<24*i?[Math.round(Math.abs(t/i)),"hr"]:t<7*o?[Math.round(Math.abs(t/o)),"day"]:t<52*r?[Math.round(Math.abs(t/r)),"week"]:t<10*s?[Math.round(Math.abs(t/s)),"year"]:t<100*c?[Math.round(Math.abs(t/c)),"decade"]:["","a long time"],n[1]+=0===n[0]||n[0]>1?"s":"",n=n.join(" "),n+" ago"}function se(e){return angular.forEach(e,function(e){e.status==d.completed.value&&e.scheduledDate&&e.actualDate&&(e.description+="<br/>"+l.getTimeCompleted(e))}),e}var ce=o.serviceUrl+"/api";return{getDriverTimeLineByCriteria:m,getRequestByCriteria:g,getTaskByCriteria:h,assignRequest:p,unassignRequest:v,createTask:f,updateTask:b,assignTask:k,unAssignTask:y,removePetrolLog:D,uploadDocument:j,saveTimeDuration:T,getDriverLocationByCriteria:S,populateStyleForDriver:M,getAllBranchLocation:C,getDriverByBranchLocation:I,populateStyleForRequest:w,checkJobInCurrentTime:A,initStyleForCurrentTime:E,getRequestStatusFromJob:U,getAssignRequestData:q,getUnassignRequestData:B,populateTimeForRequestAfterDrop:F,setDuration:R,getDurationData:O,convertJob:X,convertJobOnMap:G,convertListRequestSearch:_,convertListDriverTimeLine:K,convertListDriverLocation:oe}}angular.module("main.module").factory("dashboardService",e),e.$inject=["$http","$filter","timeService","calendarSetting","jobStatus","systemSetting","driverUnAvailable","driverStatus","jobType","jobService","utilityService","taskStatus"]}(),function(){"use strict";function e(e,t,n,a){function i(){return!!c()}function o(e){var t=c();return!!(t&&e.indexOf(t.role)>-1)}function r(a,i){var o=t.defer(),r={username:a,password:i};return e.post(l+"/token",r).then(function(e){var t={access_token:e.data.accessToken,token_type:e.data.tokenType},a={id:e.data.id,email:e.data.email,role:e.data.role};n.set("tokenInfo",t),n.set("userInfo",a),o.resolve(a)},function(e){o.reject(e)}),o.promise}function s(){n.remove("tokenInfo"),n.remove("userInfo")}function c(){return n.get("userInfo")}var l=a.serviceUrl+"/api/account",u={isAuthenticated:i,isAuthorized:o,login:r,logout:s,getCurrentUser:c};return u}angular.module("main.module").factory("authService",e),e.$inject=["$http","$q","localStorageService","systemSetting"]}(),function(){"use strict";function e(e,t,n,a,i,o){function r(t){return e.get(S+"/jobs/"+t)}function s(e){return{id:e.id,additionalRemarks:e.additionalRemarks,clientContact:e.clientContact,clientName:e.clientName,deliveryAddress:e.deliveryAddress,documents:e.documents,driver:e.driver,driverContact:e.driverContact,handovers:k(e.handover),pickupAddress:e.pickupAddress,tasks:h(e.tasks),requestType:e.requestType,uniqueVehicleNumber:e.uniqueVehicleNumber,licensePlate:e.licensePlate,vehicleModel:e.vehicleModel,expectedStartDate:e.expectedStartDate?o("date")(a.getDateFromJsonString(e.expectedStartDate),"dd/MM/yyyy HH:mm"):null,expectedEndDate:e.expectedEndDate?o("date")(a.getDateFromJsonString(e.expectedEndDate),"dd/MM/yyyy HH:mm"):null,scheduledStartDate:e.scheduledStartDate?o("date")(a.getDateFromJsonString(e.scheduledStartDate),"dd/MM/yyyy HH:mm"):null,scheduledEndDate:e.scheduledEndDate?o("date")(a.getDateFromJsonString(e.scheduledEndDate),"dd/MM/yyyy HH:mm"):null,vehicleType:e.vehicleType,vehicleId:e.vehicleId,requestNo:e.requestNo,jobIndex:e.jobIds.indexOf(e.id),status:e.status,otherJob:D(e.id,e.jobIds),statusText:a.getTextFromValue(e.status,t),eventLogs:e.eventLogs,jobIds:e.jobIds,jobPurpose:e.jobPurpose,petrolLog:c(e),dataCollected:{startedAt:e.actualStartDate,totalDistance:T(e.handover),totalTimeTaken:p(e.scheduledStartDate,e.actualEndDate)}}}function c(e){if(!e.tasks||!e.tasks.length)return null;var t=e.tasks.filter(function(e){return e.petrolLogId});return t&&t[0]?t[0].petrolLog?t[0].petrolLog:t[0].petrolLogId:null}function l(e){var t=e.tasks.filter(function(e){return e.petrolLogId});return t&&t[0]?t[0].id:0}function u(e,t){for(var n=0;n<e.length;n++)if(e[n].id==t)return void e.splice(n,1)}function d(t){return e.get(S+"/jobs/resync/"+t)}function m(t){return e.put(S+"/jobs/documents/remove/"+t)}function g(t){return e.get(S+"/jobs/documents/"+t)}function h(e){var t=[];return angular.forEach(e,function(e){e.petrolLogId||t.push({description:e.description,statusText:a.getTextFromValue(e.status,i),status:e.status,startTime:e.scheduledDate?o("date")(a.getDateFromJsonString(e.scheduledDate),"HH:mm"):"N/A",endTime:e.actualDate?o("date")(a.getDateFromJsonString(e.actualDate),"HH:mm"):"N/A",totalTime:p(e.scheduledDate,e.actualDate)})}),t}function p(e,t){if(!t||!e)return"";var n=(a.getDateFromJsonString(t).getTime()-a.getDateFromJsonString(e).getTime())/6e4,i=Math.floor(n/60),o=Math.floor(n%60),r=i>1?i+"hrs":i+"hr",s=o>1?o+"mins":o+"min";return r+" "+s}function v(e){return o("date")(a.getDateFromJsonString(e.scheduledDate),"HH:mm")+" - "+o("date")(a.getDateFromJsonString(e.actualDate),"HH:mm")+" "+p(e.scheduledDate,e.actualDate)}function f(e,t){var n;return angular.forEach(e.handovers,function(e){e.id==t&&(n=e)}),n}function b(){return e.get(S+"/jobs/get-incomplete-job")}function k(e){return angular.forEach(e,function(e){e.totalCheckListChange=y(e),e.totalMarking=e.markings.length}),e}function y(e){var t=0;return angular.forEach(e.checkList,function(e){angular.forEach(e.checklistItems,function(e){e.isChanged&&(t+=1)})}),t}function D(e,t){if(t.length<=1)return null;var n=t.indexOf(e);return n+1===t.length?{index:n,id:t[n-1]}:{index:n+2,id:t[n+1]}}function T(e){if(!e||e.length<1)return null;var t=e[0].mileage,n=e[e.length-1].mileage;return t&&n?Math.abs(n-t):null}var S=n.serviceUrl+"/api";return{getJobById:r,convertJobDetail:s,getPetrolLog:c,getTimeCompleted:v,getHandoverById:f,getIncompletedJob:b,getTaskIdOfPetrolLog:l,removePetrolLogFromTask:u,
resyncJob:d,removeDocument:m,getDocumentByJobId:g}}angular.module("main.module").factory("jobService",e),e.$inject=["$http","jobStatus","systemSetting","utilityService","taskStatus","$filter"]}(),function(){"use strict";function e(e,t){function n(t){return e.get(r+"/handover/"+t)}function a(t){return e.get(r+"/exteriorchecklist/handover/"+t)}function i(e,t){var n=[];return angular.forEach(e,function(e){var a=o(e.id,t);if(a.length>0){var i=angular.copy(e);i.markings=a,n.push(i)}}),n}function o(e,t){var n=[];return angular.forEach(t,function(t){t.exteriorImageId==e&&n.push(t)}),n}var r=t.serviceUrl+"/api";return{getHandoverById:n,getExteriorImageByHandoverId:a,convertMarking:i,getMarkingByExteriorImageId:o}}angular.module("main.module").factory("handoverService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n,a){function i(t){return e.get(g+"/checklist?vehicleTypeId="+t)}function o(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,name:e.name,checklistItems:r(e.checklistItems)})}),t}function r(e){var t=[];return angular.forEach(e,function(e){t.push({description:e.description,id:e.id})}),t}function s(t){return e.post(g+"/checklistcategory",t)}function c(t){return e.delete(g+"/checklistcategory/"+t.id,t)}function l(t){return e.put(g+"/checklistcategory/"+t.id,t)}function u(t){return e.post(g+"/checklistitem",t)}function d(t){return e.put(g+"/checklistitem/"+t.id,t)}function m(t){return e.delete(g+"/checklistitem/"+t.id,t)}var g=t.serviceUrl+"/api";return{getVehicleById:i,convertChecklistDetail:o,createSubsection:s,deleteSubsection:c,editSubsection:l,addItem:u,editItem:d,deleteItem:m}}angular.module("main.module").factory("checklistService",e),e.$inject=["$http","systemSetting","utilityService","taskStatus","$filter"]}(),function(){"use strict";function e(e,t){function n(){return e.get(u+"/vehicles/types")}function a(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,name:e.name,hasChecklist:e.checkList.length>0})}),t}function i(t){var n={};return t.search&&(n.search=t.search),(t.type||0===t.type)&&(n.type=t.type),t.currentPage&&t.itemPerPage&&(n.offset=(t.currentPage-1)*t.itemPerPage,n.limit=t.itemPerPage),e.get(u+"/vehicles",{params:n})}function o(t){return e.get(u+"/vehicles/"+t)}function r(t){return e.get(u+"/checklist?vehicleId="+t)}function s(t){return e.get(u+"/vehicles/versions/"+t)}function c(t,n){var a=u+"/exteriorchecklist/vehicle/"+t;return n&&(a+="?vehicleVersionId="+n),e.get(a)}function l(t){return e.post(u+"/checklist/replacechecklist",t)}var u=t.serviceUrl+"/api";return{getVehicleTypes:n,convertVehicleType:a,getVehicleByCriteria:i,getVehicleById:o,getVehicleItemChecklist:r,getVehicleVersion:s,getVehicleExteriorChecklist:c,replaceChecklist:l}}angular.module("main.module").factory("vehicleService",e),e.$inject=["$http","systemSetting"]}(),function(){"use strict";function e(e,t,n,a,i){function o(e){var t=[];return angular.forEach(e,function(e){t.push({id:e.id,description:e.description,jobId:e.jobId,driver:e.driver,date:n.getDateFromJsonString(e.date),status:e.status,statusText:n.getTextFromValue(e.status,a)})}),t}function r(t){var n={};return t.fromDate&&(n.fromDate=i("date")(t.fromDate,"yyyy-MM-dd")),t.toDate&&(n.toDate=i("date")(t.toDate,"yyyy-MM-dd")),(t.status||0==t.status)&&(n.status=t.status),t.search&&(n.search=t.search),(t.type||0===t.type)&&(n.type=t.type),t.currentPage&&t.itemPerPage&&(n.offset=(t.currentPage-1)*t.itemPerPage,n.limit=t.itemPerPage),e.get(c+"/tasks",{params:n})}function s(t){var n=[{taskId:t,status:a.cancelled.value}];return e.post(c+"/tasks/status",n)}var c=t.serviceUrl+"/api";return{getTaskByType:r,convertTasks:o,cancelTask:s}}angular.module("main.module").factory("taskService",e),e.$inject=["$http","systemSetting","utilityService","taskStatus","$filter"]}();